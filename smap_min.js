function resizeIframeHeight(e){e.height=e.contentWindow.document.body.scrollHeight+14+"px"}window.getQueryParameters=function(e){var t="",n=window.location.href;if(n.indexOf("?")>-1)for(var a=n.substr(n.indexOf("?")).toLowerCase(),o=a.split("&"),i=0;i<o.length;i++)if(o[i].indexOf(e.toLowerCase()+"=")>-1){var r=o[i].split("=");t=r[1];break}return unescape(t)};var QRCode;!function(){function e(e){this.mode=p.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,n=this.data.length;t<n;t++){var a=[],o=this.data.charCodeAt(t);o>65536?(a[0]=240|(1835008&o)>>>18,a[1]=128|(258048&o)>>>12,a[2]=128|(4032&o)>>>6,a[3]=128|63&o):o>2048?(a[0]=224|(61440&o)>>>12,a[1]=128|(4032&o)>>>6,a[2]=128|63&o):o>128?(a[0]=192|(1984&o)>>>6,a[1]=128|63&o):a[0]=o,this.parsedData.push(a)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function n(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var a=0;a<e.length-n;a++)this.num[a]=e[a+n]}function a(e,t){this.totalCount=e,this.dataCount=t}function o(){this.buffer=[],this.length=0}function i(){return"undefined"!=typeof CanvasRenderingContext2D}function r(){var e=!1,t=navigator.userAgent;if(/android/i.test(t)){e=!0;var n=t.toString().match(/android ([0-9]\.[0-9])/i);n&&n[1]&&(e=parseFloat(n[1]))}return e}function s(e,t){for(var n=1,a=l(e),o=0,i=f.length;o<=i;o++){var r=0;switch(t){case c.L:r=f[o][0];break;case c.M:r=f[o][1];break;case c.Q:r=f[o][2];break;case c.H:r=f[o][3]}if(a<=r)break;n++}if(n>f.length)throw new Error("Too long data");return n}function l(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var n=new e(t);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var a=0;a<this.moduleCount;a++){this.modules[a]=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++)this.modules[a][o]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,n),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(e,t){for(var n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(var a=-1;a<=7;a++)t+a<=-1||this.moduleCount<=t+a||(0<=n&&n<=6&&(0==a||6==a)||0<=a&&a<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=a&&a<=4?this.modules[e+n][t+a]=!0:this.modules[e+n][t+a]=!1)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;n<8;n++){this.makeImpl(!0,n);var a=h.getLostPoint(this);(0==n||e>a)&&(e=a,t=n)}return t},createMovieClip:function(e,t,n){var a=e.createEmptyMovieClip(t,n),o=1;this.make();for(var i=0;i<this.modules.length;i++)for(var r=i*o,s=0;s<this.modules[i].length;s++){var l=s*o,p=this.modules[i][s];p&&(a.beginFill(0,100),a.moveTo(l,r),a.lineTo(l+o,r),a.lineTo(l+o,r+o),a.lineTo(l,r+o),a.endFill())}return a},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=h.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var a=e[t],o=e[n];if(null==this.modules[a][o])for(var i=-2;i<=2;i++)for(var r=-2;r<=2;r++)i==-2||2==i||r==-2||2==r||0==i&&0==r?this.modules[a+i][o+r]=!0:this.modules[a+i][o+r]=!1}},setupTypeNumber:function(e){for(var t=h.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var a=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=a}for(var n=0;n<18;n++){var a=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=a}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,a=h.getBCHTypeInfo(n),o=0;o<15;o++){var i=!e&&1==(a>>o&1);o<6?this.modules[o][8]=i:o<8?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(var o=0;o<15;o++){var i=!e&&1==(a>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=i:o<9?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,a=this.moduleCount-1,o=7,i=0,r=this.moduleCount-1;r>0;r-=2)for(6==r&&r--;;){for(var s=0;s<2;s++)if(null==this.modules[a][r-s]){var l=!1;i<e.length&&(l=1==(e[i]>>>o&1));var p=h.getMask(t,a,r-s);p&&(l=!l),this.modules[a][r-s]=l,o--,o==-1&&(i++,o=7)}if(a+=n,a<0||this.moduleCount<=a){a-=n,n=-n;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,n,i){for(var r=a.getRSBlocks(e,n),s=new o,l=0;l<i.length;l++){var p=i[l];s.put(p.mode,4),s.put(p.getLength(),h.getLengthInBits(p.mode,e)),p.write(s)}for(var c=0,l=0;l<r.length;l++)c+=r[l].dataCount;if(s.getLengthInBits()>8*c)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*c+")");for(s.getLengthInBits()+4<=8*c&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;;){if(s.getLengthInBits()>=8*c)break;if(s.put(t.PAD0,8),s.getLengthInBits()>=8*c)break;s.put(t.PAD1,8)}return t.createBytes(s,r)},t.createBytes=function(e,t){for(var a=0,o=0,i=0,r=new Array(t.length),s=new Array(t.length),l=0;l<t.length;l++){var p=t[l].dataCount,c=t[l].totalCount-p;o=Math.max(o,p),i=Math.max(i,c),r[l]=new Array(p);for(var d=0;d<r[l].length;d++)r[l][d]=255&e.buffer[d+a];a+=p;var u=h.getErrorCorrectPolynomial(c),m=new n(r[l],u.getLength()-1),f=m.mod(u);s[l]=new Array(u.getLength()-1);for(var d=0;d<s[l].length;d++){var g=d+f.getLength()-s[l].length;s[l][d]=g>=0?f.get(g):0}}for(var _=0,d=0;d<t.length;d++)_+=t[d].totalCount;for(var v=new Array(_),y=0,d=0;d<o;d++)for(var l=0;l<t.length;l++)d<r[l].length&&(v[y++]=r[l][d]);for(var d=0;d<i;d++)for(var l=0;l<t.length;l++)d<s[l].length&&(v[y++]=s[l][d]);return v};for(var p={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},c={L:1,M:0,Q:3,H:2},d={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},h={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;h.getBCHDigit(t)-h.getBCHDigit(h.G15)>=0;)t^=h.G15<<h.getBCHDigit(t)-h.getBCHDigit(h.G15);return(e<<10|t)^h.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;h.getBCHDigit(t)-h.getBCHDigit(h.G18)>=0;)t^=h.G18<<h.getBCHDigit(t)-h.getBCHDigit(h.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return h.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case d.PATTERN000:return(t+n)%2==0;case d.PATTERN001:return t%2==0;case d.PATTERN010:return n%3==0;case d.PATTERN011:return(t+n)%3==0;case d.PATTERN100:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case d.PATTERN101:return t*n%2+t*n%3==0;case d.PATTERN110:return(t*n%2+t*n%3)%2==0;case d.PATTERN111:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new n([1],0),a=0;a<e;a++)t=t.multiply(new n([1,u.gexp(a)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case p.MODE_NUMBER:return 10;case p.MODE_ALPHA_NUM:return 9;case p.MODE_8BIT_BYTE:return 8;case p.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case p.MODE_NUMBER:return 12;case p.MODE_ALPHA_NUM:return 11;case p.MODE_8BIT_BYTE:return 16;case p.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case p.MODE_NUMBER:return 14;case p.MODE_ALPHA_NUM:return 13;case p.MODE_8BIT_BYTE:return 16;case p.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,a=0;a<t;a++)for(var o=0;o<t;o++){for(var i=0,r=e.isDark(a,o),s=-1;s<=1;s++)if(!(a+s<0||t<=a+s))for(var l=-1;l<=1;l++)o+l<0||t<=o+l||0==s&&0==l||r==e.isDark(a+s,o+l)&&i++;i>5&&(n+=3+i-5)}for(var a=0;a<t-1;a++)for(var o=0;o<t-1;o++){var p=0;e.isDark(a,o)&&p++,e.isDark(a+1,o)&&p++,e.isDark(a,o+1)&&p++,e.isDark(a+1,o+1)&&p++,0!=p&&4!=p||(n+=3)}for(var a=0;a<t;a++)for(var o=0;o<t-6;o++)e.isDark(a,o)&&!e.isDark(a,o+1)&&e.isDark(a,o+2)&&e.isDark(a,o+3)&&e.isDark(a,o+4)&&!e.isDark(a,o+5)&&e.isDark(a,o+6)&&(n+=40);for(var o=0;o<t;o++)for(var a=0;a<t-6;a++)e.isDark(a,o)&&!e.isDark(a+1,o)&&e.isDark(a+2,o)&&e.isDark(a+3,o)&&e.isDark(a+4,o)&&!e.isDark(a+5,o)&&e.isDark(a+6,o)&&(n+=40);for(var c=0,o=0;o<t;o++)for(var a=0;a<t;a++)e.isDark(a,o)&&c++;var d=Math.abs(100*c/t/t-50)/5;return n+=10*d}},u={glog:function(e){if(e<1)throw new Error("glog("+e+")");return u.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return u.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},m=0;m<8;m++)u.EXP_TABLE[m]=1<<m;for(var m=8;m<256;m++)u.EXP_TABLE[m]=u.EXP_TABLE[m-4]^u.EXP_TABLE[m-5]^u.EXP_TABLE[m-6]^u.EXP_TABLE[m-8];for(var m=0;m<255;m++)u.LOG_TABLE[u.EXP_TABLE[m]]=m;n.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),a=0;a<this.getLength();a++)for(var o=0;o<e.getLength();o++)t[a+o]^=u.gexp(u.glog(this.get(a))+u.glog(e.get(o)));return new n(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=u.glog(this.get(0))-u.glog(e.get(0)),a=new Array(this.getLength()),o=0;o<this.getLength();o++)a[o]=this.get(o);for(var o=0;o<e.getLength();o++)a[o]^=u.gexp(u.glog(e.get(o))+t);return new n(a,0).mod(e)}},a.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],a.getRSBlocks=function(e,t){var n=a.getRsBlockTable(e,t);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var o=n.length/3,i=[],r=0;r<o;r++)for(var s=n[3*r+0],l=n[3*r+1],p=n[3*r+2],c=0;c<s;c++)i.push(new a(l,p));return i},a.getRsBlockTable=function(e,t){switch(t){case c.L:return a.RS_BLOCK_TABLE[4*(e-1)+0];case c.M:return a.RS_BLOCK_TABLE[4*(e-1)+1];case c.Q:return a.RS_BLOCK_TABLE[4*(e-1)+2];case c.H:return a.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},o.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var f=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],g=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var a in t)t.hasOwnProperty(a)&&n.setAttribute(a,t[a]);return n}var n=this._htOption,a=this._el,o=e.getModuleCount();Math.floor(n.width/o),Math.floor(n.height/o);this.clear();var i=t("svg",{viewBox:"0 0 "+String(o)+" "+String(o),width:"100%",height:"100%",fill:n.colorLight});i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),a.appendChild(i),i.appendChild(t("rect",{fill:n.colorLight,width:"100%",height:"100%"})),i.appendChild(t("rect",{fill:n.colorDark,width:"1",height:"1",id:"template"}));for(var r=0;r<o;r++)for(var s=0;s<o;s++)if(e.isDark(r,s)){var l=t("use",{x:String(s),y:String(r)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),i.appendChild(l)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),_="svg"===document.documentElement.tagName.toLowerCase(),v=_?g:i()?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),window.currentQRCode=this._elImage.src,this._elImage.style.display="block",this._elCanvas.style.display="none"}function t(e,t){var n=this;if(n._fFail=t,n._fSuccess=e,null===n._bSupportDataURI){var a=document.createElement("img"),o=function(){n._bSupportDataURI=!1,n._fFail&&n._fFail.call(n)},i=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)};return a.onabort=o,a.onerror=o,a.onload=i,void(a.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}n._bSupportDataURI===!0&&n._fSuccess?n._fSuccess.call(n):n._bSupportDataURI===!1&&n._fFail&&n._fFail.call(n)}if(this._android&&this._android<=2.1){var n=1/window.devicePixelRatio,a=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,o,i,r,s,l,p,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var d=arguments.length-1;d>=1;d--)arguments[d]=arguments[d]*n;else"undefined"==typeof p&&(arguments[1]*=n,arguments[2]*=n,arguments[3]*=n,arguments[4]*=n);a.apply(this,arguments)}}var o=function(e,t){this._bIsPainted=!1,this._android=r(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return o.prototype.draw=function(e){var t=this._elImage,n=this._oContext,a=this._htOption,o=e.getModuleCount(),i=a.width/o,r=a.height/o,s=Math.round(i),l=Math.round(r);t.style.display="none",this.clear();for(var p=0;p<o;p++)for(var c=0;c<o;c++){var d=e.isDark(p,c),h=c*i,u=p*r;n.strokeStyle=d?a.colorDark:a.colorLight,n.lineWidth=1,n.fillStyle=d?a.colorDark:a.colorLight,n.fillRect(h,u,i,r),n.strokeRect(Math.floor(h)+.5,Math.floor(u)+.5,s,l),n.strokeRect(Math.ceil(h)-.5,Math.ceil(u)-.5,s,l)}this._bIsPainted=!0},o.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},o.prototype.isPainted=function(){return this._bIsPainted},o.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},o.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},o}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,n=this._el,a=e.getModuleCount(),o=Math.floor(t.width/a),i=Math.floor(t.height/a),r=['<table style="border:0;border-collapse:collapse;">'],s=0;s<a;s++){r.push("<tr>");for(var l=0;l<a;l++)r.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+o+"px;height:"+i+"px;background-color:"+(e.isDark(s,l)?t.colorDark:t.colorLight)+';"></td>');r.push("</tr>")}r.push("</table>"),n.innerHTML=r.join("");var p=n.childNodes[0],c=(t.width-p.offsetWidth)/2,d=(t.height-p.offsetHeight)/2;c>0&&d>0&&(p.style.margin=d+"px "+c+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:c.H},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];"string"==typeof e&&(e=document.getElementById(e)),this._htOption.useSVG&&(v=g),this._android=r(),this._el=e,this._oQRCode=null,this._oDrawing=new v(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(e){this._oQRCode=new t(s(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=c}();var smap={core:{},event:$("<div />"),copyright:"© 2014 Malmö stad, Kristianstad kommun, Helsingborg stad, Lunds kommun"};smap.core.Div=L.Class.extend({initialize:function(){this.parentTag=$("body"),this.draw()},draw:function(){var e=$("#mapdiv");if(!e.length){var e=$('<div id="mapdiv" class="mapdiv" />'),t=$('<div id="maindiv" class="maindiv" />');t.append(e),this.parentTag.append(t)}L.Browser.touch&&$(window).on("orientationchange",function(){window.scrollTo(0,0)}),smap.event.on("smap.core.pluginsadded",function(){($("body > header").length||smap.cmd.getControl("MalmoHeader"))&&t.addClass("map-with-header");var e=utils.getBrowser();e.ie&&e.ieVersion<=8&&$(".leaflet-top.leaflet-right").addClass("map-with-header-ie8")})},CLASS_NAME:"smap.core.Div"}),smap.core.Init=L.Class.extend({_selectedFeatures:[],initialize:function(){this.defineProjs(),smap.core.divInst=new smap.core.Div,smap.cmd.loading(!0),this.init()},_checkBrowserSupport:function(){var e=utils.getBrowser();e.ie&&e.ieVersion<=8&&smap.cmd.notify("Obs! Applikationen stödjer inte din webbläsare. Använd en nyare version.","warning")},init:function(e){e=e||{};var t=this;this.drawMap(),this._checkBrowserSupport(),smap.core.layerInst=new smap.core.Layer(this.map),smap.core.selectInst=new smap.core.Select(this.map),smap.core.paramInst=new smap.core.Param(this.map),smap.core.pluginHandlerInst=new smap.core.PluginHandler(this.map);var n=e.params||smap.core.paramInst.getParams();this.loadConfig(n.CONFIG).done(function(){function e(){if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&"undefined"!=typeof n.QL&&null!==n.QL&&n.QL.length>0){var e=n.QL.split(",");"undefined"!=typeof n.OL&&null!==n.OL?"object"==typeof n.OL||(n.OL=n.OL.split(",")):n.OL=[];for(var a=0;a<e.length;a++)n.OL.push(e[a])}if("undefined"!=typeof n.OL&&null!==n.OL)if("object"==typeof n.OL){if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&n.OL.length>0){for(var o=[],i=0;i<n.OL.length;i++)for(var r=0;r<config.ol.length;r++)n.OL[i].toUpperCase()===config.ol[r].options.layerId.toUpperCase()?o.push(config.ol[r].options.layerId):"undefined"!=typeof config.ol[r].options.alias&&null!==config.ol[r].options.alias&&n.OL[i].toUpperCase()===config.ol[r].options.alias.toUpperCase()&&(o.contains||o.push(config.ol[r].options.layerId));n.OL=o}}else if("ALL"===n.OL.toUpperCase())n.OL=smap.core.Init.prototype._createOLArrayForParamAll();else if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&n.OL.length>0){for(var s=0,l=0;l<config.ol.length;l++)if(config.ol[l].options.layerId.toUpperCase()===n.OL.toUpperCase()){s++;break}if(0===s)for(var p=0;p<config.ol.length;p++)"undefined"!=typeof config.ol[p].options.alias&&null!==config.ol[p].options.alias&&config.ol[p].options.alias.toUpperCase()===n.OL.toUpperCase()&&(n.OL=config.ol[p].options.layerId)}if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&"undefined"!=typeof n.BL&&null!==n.BL&&n.BL.length>0){for(var c=0,l=0;l<config.bl.length;l++)if(config.bl[l].options.layerId.toUpperCase()===n.BL.toUpperCase()){c++;break}if(0===c)for(var p=0;p<config.bl.length;p++)"undefined"!=typeof config.bl[p].options.alias&&null!==config.bl[p].options.alias&&config.bl[p].options.alias.toUpperCase()===n.BL.toUpperCase()&&(n.BL=config.bl[p].options.layerId)}smap.config.configName=n.CONFIG,smap.config.langCode=smap.cmd.getLang();var d=window.getQueryParameters("hlp"),h=window.getQueryParameters("hideallmodules");if(h.length>0&&"true"===h&&(d.length>0||(d="true")),d.length>0&&"true"===d){if(config)for(var u=0;u<config.plugins.length;u++)"L.Control.LayerSwitcher"===config.plugins[u].init&&(config.plugins[u].options.showBgLabel=!1,config.plugins[u].options.showBgLayer=!1,config.plugins[u].options.showOvLabel=!1,config.plugins[u].options.showOvLayer=!1);if(smap.config)for(var u=0;u<smap.config.plugins.length;u++)"L.Control.LayerSwitcher"===smap.config.plugins[u].init&&(smap.config.plugins[u].options.showBgLabel=!1,smap.config.plugins[u].options.showBgLayer=!1,smap.config.plugins[u].options.showOvLabel=!1,smap.config.plugins[u].options.showOvLayer=!1)}if(config)for(var u=0;u<config.plugins.length;u++)"L.Control.ShareLink"===config.plugins[u].init&&config.plugins[u].options&&config.plugins[u].options.root&&(config.plugins[u].options.root=config.plugins[u].options.root.replace("abk kartan","kkarta_abk"));if(smap.config)for(var u=0;u<smap.config.plugins.length;u++)"L.Control.ShareLink"===smap.config.plugins[u].init&&smap.config.plugins[u].options&&smap.config.plugins[u].options.root&&(smap.config.plugins[u].options.root=smap.config.plugins[u].options.root.replace("abk kartan","kkarta_abk"));t.applyConfig(smap.config),n=$.extend({},utils.objectToUpperCase(smap.config.params||{}),n),smap.core.paramInst.applyParams(n),smap.cmd.loading(!1)}if(smap.config=config||window.config,smap.config.onLoad){var a=smap.config.onLoad(smap.config);a.done(e)}else e(smap.config)}).fail(function(){smap.cmd.loading(!1)})},applyConfig:function(e){this.preProcessConfig(e);var t=e.coreConfig||{};$.extend(smap.core.selectInst.options,t.select||{}),$.extend(this.map.options,e.mapConfig||{}),$.extend(smap.core.mainConfig.smapOptions,e.smapOptions||{});var n=smap.core.mainConfig.smapOptions,a=utils.getBrowser();a.ie&&a.ieVersion<=8||$("title").text(n.title);var o=n.favIcon;if(o&&!(a.ie&&a.ieVersion<=8)){var i=$('<link rel="shortcut icon" type="image/x-icon" href="'+o+'" />');$("[rel=shortcut]").remove(),$("title").after(i)}this.map.options.maxBounds&&this.map.setMaxBounds(this.map.options.maxBounds),smap.core.pluginHandlerInst.addPlugins(e.plugins)},resetMap:function(){smap.map.off();for(var e=smap.core.controls,t=0,n=e.length;n>t;t++)try{smap.map.removeControl(e[t])}catch(a){}this.map.remove(),this.map=null,delete this.map,smap.map=null,delete smap.map,window.config=null;try{delete window.config}catch(a){}smap.config=null,delete smap.config,smap.event.off(),smap.core.controls=[],smap.core.layerInst=null,smap.core.modInst=null,smap.core.paramInst=null,delete smap.core.layerInst,delete smap.core.modInst,delete smap.core.paramInst},drawMap:function(e){e=e||{},L.Browser.touch&&L.Browser.ie&&(e.tapTolerance=30);var t=smap.core.mainConfig.mapConfig||{},n=$.extend(t,e);this.map=L.map("mapdiv",n),smap.map=this.map;var a=this.map.attributionControl;a.addAttribution(""),n.disabledRightClick&&this.map.on("contextmenu",function(e){e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()}),utils.getBrowser().ie9&&$(".leaflet-bottom.leaflet-right").addClass(".leaflet-bottom-right-ie9")},loadConfig:function(e){return e=e||"empty",-1===e.search(/\//g)&&(e=document.URL.split("?")[0].search("dev.html")>-1?"dist/configs/"+e:"configs/"+e),$.ajax({url:e,context:this,dataType:"script"})},preProcessConfig:function(e){e.ws&&e.ws.hasOwnProperty(document.domain)&&(e.ws=e.ws[document.domain]);for(var t=e.bl||[],n=0,a=t.length;a>n;n++)t[n].options=t[n].options||{},t[n].options.isBaseLayer=!0;for(var o,i=e.bl.concat(e.ol||[]),r=this._createLegendUrl,n=0,a=i.length;a>n;n++)o=i[n],void 0===o.options.legend&&o.options.layers&&_.indexOf(["L.TileLayer.WMS","L.NonTiledLayer.WMS"],o.init)>-1&&(o.options.legend=r(o.url,o.options.layers))},_createLegendUrl:function(e,t){t.split(",").length>1&&(t=t.split(",")[0]);var n="version=1.1.1&request=GetLegendGraphic&format=image/png&width=20&height=20&layer="+t;return utils.urlAppend(e,n)},_createOLArrayForParamAll:function(){var e=[];if("undefined"!=typeof smap.config.ol&&null!==smap.config.ol)for(var t=smap.config.ol,n=0;n<t.length;n++)e.push(t[n].options.layerId);else e=null;return e},defineProjs:function(){window.proj4&&(proj4=window.proj4,proj4.defs([["EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"],["EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"],["EPSG:3008","+proj=tmerc +lat_0=0 +lon_0=13.5 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3006","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3021","+proj=tmerc +lat_0=0 +lon_0=15.8062845294444 +k=1.00000561024+x_0=1500064.274 +y_0=-667.711 +ellps=GRS80 +units=m"]]))},CLASS_NAME:"smap.core.Init"}),smap.core.Layer=L.Class.extend({options:{defaultStyle:{color:"#00F",fillColor:"#00F",opacity:1,fillOpacity:.3,radius:8,weight:1},selectStyle:{weight:5,color:"#00DDFF",dashArray:"",fillOpacity:.8,strokeOpacity:1}},_layers:{},_bindEvents:function(){var e=this.map;this._onLayerAdd=this._onLayerAdd||$.proxy(this.onLayerAdd,this),this._onLayerRemove=this._onLayerRemove||$.proxy(this.onLayerRemove,this),e.on("layeradd",this._onLayerAdd),e.on("layerremove",this._onLayerRemove),smap.event.on("smap.core.applyparams",$.proxy(function(t,n){var a;if(n.BL&&(a=smap.cmd.getLayerConfig(n.BL)),a=a||smap.config.bl[0],a&&a.options&&(a.options.isBaseLayer=!0,e.addLayer(this._createLayer(a))),n.OL){var o,i,r=n.OL instanceof Array?n.OL:n.OL.split(",");for(o=0,i=r.length;i>o;o++)this._addLayerWithConfig(smap.cmd.getLayerConfig(r[o]))}},this))},initialize:function(e){this.map=e,this._bindEvents()},addOverlays:function(e){this._addLayers(e)},_addLayers:function(e){e=e||[];var t,n;for(t=0,len=e.length;t<len;t++)n=e[t],this._addLayerWithConfig(n)},_addLayerWithConfig:function(e){if(!e||!e.options)return!1;var t=this._createLayer(e);if(!t)return!1;var n=e.options.parentLayerId?this._getLayer(e.options.parentLayerId)||this.map:this.map;return n.addLayer(t),t},onLayerAdd:function(e){var t=e.layer;if(t.options&&!t.options._silent&&t.options.layerId&&!t.feature&&(t instanceof L.NonTiledLayer||t._tileContainer||t._layers)){var n=t.options.layerId;this._layers[n]=t,t._layers&&this._wfsLayers.push(t)}},onLayerRemove:function(e){var t=e.layer;t._layers&&this._wfsLayers.splice(t,1)},_getLayer:function(e){return this._layers[e]||null},_wfsLayers:[],_createLayer:function(t){var layerAlreadyAdded=this._getLayer(t.options.layerId);if(layerAlreadyAdded)return layerAlreadyAdded;var init=eval(t.init);init.options=init.options||{},t.options.zIndex=t.options.isBaseLayer?t.options.zIndex||0:t.options.zIndex||10;var layer;if(t.params)layer=Object.create(init.prototype),init.apply(layer,t.params),t.options&&t.options instanceof Object&&$.extend(layer.options,t.options);else{if(t.url){var opts=t.options;if(init===L.TileLayer.WMS){var newOpts=$.extend(!0,{},opts);newOpts=_.pick(newOpts,["tileSize","service","request","version","layers","styles","format","width","height","bbox","angle","buffer","cql_filter","env","featureid","filter","format_options","maxfeatures","namespace","palette","propertyname","tiled","tilesorigin","scalemethod","srs","map_resolution","transparent"]),layer=new init(t.url,newOpts),$.extend(layer.wmsParams,newOpts),$.extend(layer.options,opts),layer.setZIndex(opts.zIndex)}else layer=new init(t.url,opts)}else t.key?(layer=new init(t.key,t.options),layer.options.layerid=t.options.layerId,this._layers[t.options.layerId]=layer):layer=new init(t.options);layer instanceof L.esri.DynamicMapLayer&&(this._layers[t.options.layerId]=layer)}var self=this;return layer.on&&layer.options&&(layer._layers?(layer.options.style=!layer.options.style&&(!layer.options.geomType||layer.options.geomType&&layer.options.geomType.search(/POINT/gi))>-1?null:layer.options.style||$.extend({},self.options.defaultStyle),layer.on("loadcancel loaderror",function(){
smap.cmd.loading(!1)})):layer.on("load",function(){smap.cmd.loading(!1)}),layer.on&&(layer.on("load",function(){smap.cmd.loading(!1)}),layer.on("loading",function(){smap.cmd.loading(!0)}))),layer},showLayer:function(e){var t=e instanceof Object?e:smap.cmd.getLayerConfig(e);if(t){var n=this._getLayer(e);n||(n=this._createLayer(t));var a=t.options.parentLayerId?this._getLayer(t.options.parentLayerId)||this.map:this.map;return a.hasLayer(n)===!1&&a.addLayer(n),n}},hideLayer:function(e){var t=e instanceof Object?e:this._getLayer(e);t.fire&&t.fire("loadcancel",{layer:this});var n=t.options.parentLayerId?this._getLayer(t.options.parentLayerId)||this.map:this.map;return n.removeLayer(t),t},CLASS_NAME:"smap.core.Layer"}),smap.core.Param=L.Class.extend({initialize:function(e){this.map=e},_lang:{sv:{remove:"Ta bort"},en:{remove:"Remove"}},_setLang:function(){langCode=smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[langCode]:null)},getParams:function(){var e=this._cachedParams||null;return e||(e=this.getWebParamsAsObject(),smap.config&&(configParams=smap.config.params||{},e=$.extend({},utils.objectToUpperCase(configParams),e),this._cachedParams=e)),e},getWebParamsAsObject:function(e){e=e||"?";var t=location.href.split(e),n=t.length>1?t[1]:"";return paramsObject=utils.paramsStringToObject(n,!0),paramsObject},getHashParamsAsObject:function(){return this.getWebParamsAsObject("#")},createParamsAsObject:function(){var e,t,n,a=this.map.getCenter(),o=this.map._layers,i=[];for(var r in o)t=o[r],t&&t.options&&t.options.layerId&&t.options.layerId.split("_mergedLayer_").length<2&&(n=t.options.layerId,t.options.isBaseLayer?e=n:-1===$.inArray(t.options.layerId,i)&&i.push(n));var s={zoom:this.map.getZoom(),center:[utils.round(a.lng,5),utils.round(a.lat,5)],ol:i,bl:e};return smap.config.configName&&(s.config=smap.config.configName),smap.event.trigger("smap.core.createparams",s),s},createParams:function(e){e=e||!1;var t,n=this.createParamsAsObject(),a="";for(var o in n){if(t=n[o],t instanceof Array){if(!t.length)continue;t=t.join(",")}a+="&"+o+"="+t}if(a=a.substring(1),e){var i="";e===!0?i=document.URL.split("?")[0]+"?":"string"==typeof e&&(i=e),a=i+a}return a},applyParams:function(a){function t(){$(".smap-core-btn-popup").on("click",function(){return e.map.removeLayer(g),!1})}function del(){$("#smap-search-popupbtn-xym").off("click").on("click",function(){var that_marker=eval(this.getAttribute("markar_id"));return mrLg.removeLayer(mrLg._layers[that_marker]),g=null,!1}),$(".lead")&&$(".lead").length>0&&($(".lead")[0].style.width=$(".leaflet-popup-content").width()-$(".leaflet-popup-close-button").width()+"px")}function del1(){$("#smap-search-popupbtn-xym").off("click").on("click",function(){smap.map.removeLayer(g),g=null,!1}),$(".lead")&&$(".lead").length>0&&($(".lead")[0].style.width=$(".leaflet-popup-content").width()-$(".leaflet-popup-close-button").width()+"px")}a=a||{};var e=this;smap.event.trigger("smap.core.beforeapplyparams",a),this._setLang();var n=a.ZOOM?parseInt(a.ZOOM):0,r=a.CENTER?L.latLng([parseFloat(a.CENTER[1]),parseFloat(a.CENTER[0])]):null;if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&(Math.abs(r.lat)>90||Math.abs(r.lng)>180)){var center_4326=utils.projectPoint(r.lng,r.lat,"EPSG:3008","EPSG:4326");r.lng=center_4326[0],r.lat=center_4326[1]}if(n||0===n||(n=this.map.options.minZoom||0),r?this.map.setView(r,n,{animate:!1}):this.map.fitWorld(),a.XY){var s=this.getWebParamsAsObject(),o=parseFloat(a.XY[1]),i=parseFloat(a.XY[0]),p=null;if(a.XY.length>2){var m=a.XY[2];if(p="<p>"+m+'</p><button class="btn btn-default smap-core-btn-popup">'+this.lang.remove+"</button>",a.XY.length>3){var c=a.XY[3];1!=/^EPSG:/.test(c)&&(c="EPSG:"+c);var l=utils.projectPoint(i,o,c,"EPSG:4326");i=l[0],o=l[1]}}var g=L.marker([o,i]);this.map.addLayer(g),s.CENTER||this.map.setView(g.getLatLng(),s.ZOOM||16,{animate:!1}),p&&(this.map.off("popupopen",t).on("popupopen",t),g.bindPopup(p).openPopup())}if(a.XYM){var s=this.getWebParamsAsObject(),diainfo="";if(a.DIAINFO)try{diainfo=a.DIAINFO instanceof Array?a.DIAINFO:a.DIAINFO,diainfo.length>0&&(diainfo instanceof Array?diainfo=eval(diainfo.join()):(dia_str=eval(diainfo),dia_str instanceof Array&&(diainfo=dia_str)))}catch(e){diainfo=""}if(a.XYM.length>2){var mrLg=L.layerGroup(),invGeoOptions={stroke:!0,color:"yellow",weight:4,opacity:.8,fill:!0,fillColor:null,fillOpacity:.5,clickable:!1};if(this.map.addLayer(mrLg),a.XYM.length%2===0){for(var allX=[],allY=[],all_sok_pos=[],i=0;i<a.XYM.length;i++)i%2===1?allX.push(a.XYM[i]):allY.push(a.XYM[i]);for(var j=0;j<allX.length;j++){if(o=parseFloat(allX[j]),i=parseFloat(allY[j]),p=null,Math.abs(o)>180||Math.abs(i)>180){var coor_4326=utils.projectPoint(i,o,"EPSG:3008","EPSG:4326");i=coor_4326[0],o=coor_4326[1]}var sok_pos=L.latLng(o,i);all_sok_pos.push(sok_pos);var g=L.marker(sok_pos,{iconOptions:L.icon(L.Control.Search.prototype.options.iconOptions)});g.addTo(mrLg);var hideSearchDeleteButton=window.getQueryParameters("hideSDeleteButton");if(diainfo instanceof Array)try{hideSearchDeleteButton.length>0&&"true"===hideSearchDeleteButton?g.bindPopup('<p class="lead">'+decodeURIComponent(diainfo[j][0])+"</p><div><button markar_id="+g._leaflet_id+' style="display:none;" id="smap-search-popupbtn-xym" class="btn btn-default btn-sm">Ta bort</button></div>'):g.bindPopup('<p class="lead">'+decodeURIComponent(diainfo[j][0])+"</p><div><button markar_id="+g._leaflet_id+' id="smap-search-popupbtn-xym" class="btn btn-default btn-sm">Ta bort</button></div>')}catch(e){hideSearchDeleteButton.length>0&&"true"===hideSearchDeleteButton?g.bindPopup("</br><div><button markar_id="+g._leaflet_id+' style="display:none;" id="smap-search-popupbtn-xym" class="btn btn-default btn-sm">Ta bort</button></div>'):g.bindPopup("<div><button markar_id="+g._leaflet_id+' id="smap-search-popupbtn-xym" class="btn btn-default btn-sm">Ta bort</button></div>')}}this.map.off("popupopen",del),this.map.on("popupopen",del),$.proxy(window.setTimeout(function(){smap.map.fitBounds(L.latLngBounds(all_sok_pos))},200),all_sok_pos)}else alert("Fel webbadress")}else{if(o=parseFloat(a.XYM[1]),i=parseFloat(a.XYM[0]),p=null,Math.abs(o)>180||Math.abs(i)>180){var coor_4326=utils.projectPoint(i,o,"EPSG:3008","EPSG:4326");i=coor_4326[0],o=coor_4326[1]}var g=L.marker([o,i]);this.map.addLayer(g),s.CENTER||this.map.setView(g.getLatLng(),s.ZOOM||16,{animate:!1});try{var hideSearchDeleteButton=window.getQueryParameters("hideSDeleteButton");p=hideSearchDeleteButton.length>0&&"true"===hideSearchDeleteButton?'<p class="lead">'+decodeURIComponent(diainfo[0][0])+"</p><div><button markar_id="+g._leaflet_id+' style="display:none;" id="smap-search-popupbtn-xym" class="btn btn-default btn-sm">Ta bort</button></div>':'<p class="lead">'+decodeURIComponent(diainfo[0][0])+"</p><div><button markar_id="+g._leaflet_id+' id="smap-search-popupbtn-xym" class="btn btn-default btn-sm">Ta bort</button></div>'}catch(e){p="<div><button markar_id="+g._leaflet_id+' id="smap-search-popupbtn-xym" class="btn btn-default btn-sm">Ta bort</button></div>'}p&&(this.map.off("popupopen",del1).on("popupopen",del1),g.bindPopup(p).openPopup()),window.xym_single_marker=g,window.setTimeout(function(){window.xym_single_marker.closePopup(),window.xym_single_marker.openPopup();var e=window.getQueryParameters("hideSearchInfo");if(e.length>0&&"true"===e){window.xym_single_marker.closePopup();var t=smap.core.Param.prototype.getWebParamsAsObject();smap.map.setView(window.xym_single_marker.getLatLng(),t.ZOOM||16,{animate:!1})}},300)}}smap.event.trigger("smap.core.applyparams",a)},CLASS_NAME:"smap.core.Param"}),smap.core.PluginHandler=L.Class.extend({initialize:function(e){this.map=e;var t=this;smap.event.on("smap.core.pluginsadded",function(){t._processQueue()})},getPlugin:function(){for(var e,t=smap.core.controls||[],n=0,a=t.length;a>n;n++)if(e=t[n],e instanceof L.Control[controlName])return e;return null},addPlugins:function(arr){var t,init,autoActivates=[];smap.core.controls=smap.core.controls||[];for(var i=0,len=arr.length;len>i;i++)t=arr[i],init=eval(t.init),init&&(init=new init(t.options||{}),this.map.addControl(init),smap.core.controls.push(init),init.options.autoActivate&&autoActivates.push(init));smap.event.trigger("smap.core.pluginsadded"),smap.event.pluginsadded=!0;for(var i=0,len=autoActivates.length;len>i;i++)autoActivates[i].activate();$(".leaflet-bottom.leaflet-right button").tooltip({placement:"left",container:"#mapdiv"})},_callQueue:[],callPlugin:function(e,t,n,a){n=n||[];var o=L.Control[e];smap.event.pluginsadded?this._callPlugin(o,t,n,a):this._callQueue.push([o,t,n,a])},_callPlugin:function(e,t,n,a){if(!e)return null;for(var o,i=smap.core.controls||[],r=null,s=0,l=i.length;l>s;s++)if(o=i[s],o instanceof e){r=o[t].apply(o,n||[]);break}return a?a(r):r},_processQueue:function(){var e,t,n,a=this._callQueue||[];for(t=0,len=a.length;t<len;t++)e=a[t],n=this._callPlugin.apply(this,e);return this._callQueue=[],n},CLASS_NAME:"smap.core.PluginHandler"}),smap.core.Select=L.Class.extend({options:{manyUseDialog:!0},_selectedFeaturesVector:[],_selectedFeaturesWms:[],initialize:function(e){this.map=e,this._bindEvents(e),this._wfsLayers=smap.core.layerInst._wfsLayers},_getVectorVal:function(e,t){var n,e=e||{};if(paramVal=null,t.split(";").length>1){var a=t.split(";");n=e[a[0]]+";"+e[a[1]]}else n=e[t];return n},_setSelectStyle:function(e){var t=e.target;t.setStyle&&t.setStyle(this.options.selectStyle),!t.bringToFront||L.Browser.ie||L.Browser.opera||t.bringToFront()},_resetStyle:function(e){e.resetStyle&&e.eachLayer(function(t){e.resetStyle(t)})},_processHtml:function(e){var t=$("<div>"+e+"</div>");return t.find("a").each(function(){var e=$(this),t=e.attr("href"),n=e.text();if(t&&t.length>=4&&-1===$.inArray(t,["null","undefined"]))if("undefined"!=typeof t.match("mailto")&&null!==t.match("mailto"))if(t.match("mailto").indexOf("mailto")>=0){window.customMailOpen||(window.customMailOpen=function(e){var t=document.createElement("a");t.href=e,t.click()}),"HTTP"!==t.substring(0,4).toUpperCase()&&(t=t);var a=$('<button class="btn btn-default btn-sm">'+n+"</button>");a.attr("onclick",'window.customMailOpen("'+t+'");'),e.after(a),e.remove()}else{"HTTP"!==t.substring(0,4).toUpperCase()&&(t="http://"+t);var a=$('<button class="btn btn-default btn-sm">'+n+"</button>");a.attr("onclick",'window.open("'+t+'", "_blank")'),e.after(a),e.remove()}else{"HTTP"!==t.substring(0,4).toUpperCase()&&(t="http://"+t);var a=$('<button class="btn btn-default btn-sm">'+n+"</button>");a.attr("onclick",'window.open("'+t+'", "_blank")'),e.after(a),e.remove()}else e.remove()}),t.html()},_extractAllAttributes:function(e,t){t=t||{};var n="",a="<div><strong>_key_:</strong>&nbsp;<span>_val_</span></div>";for(var o in t)n+=a.replace(/_key_/g,o).replace(/_val_/g,"${"+o+"}");var i="*";return e.search(/\$\{\*\}/)>-1&&(i=/\$\{\*\}/g),e.replace(i,n)},_bindEvents:function(e){function t(){var t=$(".leaflet-popup-close-button"),n='<a class="leaflet-popup-close-button leaflet-popup-minimize-button" href="#">–</a>';t.before(n),$(".leaflet-popup-minimize-button").on("click",function(){return smap.map.closePopup(),!1}),t.on("click",function(){return e.fire("unselected",{}),!1})}var n=this;e.on("popupopen",t),e.on("layerremove",function(t){var a=void 0!==t.layer._tip;return!a&&void(n._rasterFeature&&(e.removeLayer(n._rasterFeature),n._rasterFeature=null))}),e.on("click",function(){for(var t=n._wfsLayers,a=0,o=t.length;o>a;a++)n._resetStyle(t[a]);e.fire("unselected",{})}),e.on("unselected",function(e){n._rasterFeature&&(n.map.removeLayer(n._rasterFeature),n._rasterFeature=null),e.feature?$.each(n._selectedFeaturesVector,function(t,a){return e.feature.id===a.id?(n._selectedFeaturesVector.splice(t,1),!1):void 0}):(n._selectedFeaturesVector=[],n._selectedFeaturesWms=[])}),e.on("selected",function(t){function a(e,t,n){var a="",o="";return o+='<div style="width:inherit;" class="'+a+'"><h4 class="popup-layertitle">'+n+"</h4>",o+=utils.extractToHtml(e,t)+"</div>"}function o(){n._rasterFeature&&(n._rasterFeature.resetStyle(),n.map.removeLayer(n._rasterFeature),n._rasterFeature=null)}function i(e){return o(),e.geometry.type&&"Point"!==e.geometry.type&&"MultiPoint"!==e.geometry.type&&(n._rasterFeature=L.geoJson(e.geometry),n._rasterFeature.options=$.extend({},e.options),n._rasterFeature.options._silent=!0,n._rasterFeature.latLng=e.latLng,n._rasterFeature.setStyle({color:"#0FF",fillColor:"#0FF",weight:10,opacity:.9,fillOpacity:.3}),n._rasterFeature.options.selectable=!1,n._rasterFeature.eachLayer(function(e){e.eachLayer&&e.eachLayer(function(e){e.options.clickable=!1}),e.options&&(e.options.clickable=!1)}),n.map.addLayer(n._rasterFeature),n._rasterFeature.setZIndex(900)),n._rasterFeature}function r(){var e=$(this).data("index"),t=n._selectedFeaturesWms[e];i(t);var o=L.popup(),r=a(t.options.popup,t.properties,t.options.displayName);if(r=n._processHtml(r),o.setContent(r),n._rasterFeature&&n._rasterFeature.getBounds&&1===t.geometry.coordinates.length){var s=n._rasterFeature.getBounds(),l=s.getCenter();o.setLatLng(l)}else o.setLatLng(t.latLng);o.openOn(n.map);var p=$(".leaflet-popup-content:visible");return p.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})}),$(this).trigger("mouseenter"),n._selectManyModal.modal("hide"),!1}var s=t.layer,l=s.hasOwnProperty("_layers")||s.options&&s.options.clickable,p=(s.options.layerId,t.feature),c=t.selectedFeatures||[],d=(s.options.uniqueKey||"-",t.shiftKeyWasPressed),h=p.properties,u=t.latLng;if(l?(n._selectedFeaturesWms=[],d?(n._selectedFeaturesVector=utils.makeUniqueArr(n._selectedFeaturesVector.concat(c)),$.each(n._wfsLayers,function(e,t){t.eachLayer(function(e){e.unbindPopup&&e.unbindPopup(),e._layers&&$.each(e._layers,function(e,t){t.unbindPopup&&t.unbindPopup()})})})):n._selectedFeaturesVector=[].concat(c)):(n._selectedFeaturesVector=[],n._selectedFeaturesWms=utils.makeUniqueArr(n._selectedFeaturesWms.concat(c))),l&&!d&&n._selectedFeaturesVector.length<=1){for(var m,f=n._wfsLayers,g=0,_=f.length;_>g;g++)m=f[g],m!==s&&(m.resetStyle&&m.resetStyle(m),m._selectedFeatures=[]);var v=s.options.popup;(s.options.popup&&"*"===s.options.popup||s.options.popup.search(/\$\{\*\}/)>-1)&&(v=n._extractAllAttributes(v,h));var y=utils.extractToHtml(v,h);y=n._processHtml(y);var m=utils.getLayerFromFeature(p,s)||p;if(m._popup&&m.unbindPopup(),m.bindPopup(y,{autoPan:!0,keepInView:!1,autoPanPadding:L.point(smap.core.mainConfig.smapOptions.popupAutoPanPadding)}),m._map){m.openPopup(u);var b=$(".leaflet-popup-content:visible");b.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})})}}if(!l){var w=L.popup(),C=n._selectedFeaturesWms[0];if(1===n._selectedFeaturesWms.length)i(C);else{if(n.options.manyUseDialog){if(!n._selectManyModal){var h,k,A=$('<button type="button" class="btn btn-default">Stäng</button>'),P=$('<div class="list-group"></div>');A.on("tap click",function(){return o(),n._selectManyModal.modal("hide"),!1}),n._selectManyModal=utils.drawDialog("Flera träffar: Välj ett objekt",P,A,{size:"sm"}),n._selectManyModal.find(".modal-header").addClass("panel-heading"),n._selectManyModal.on("hidden.bs.modal",function(){$(this).find(".list-group").empty()}),n._selectManyModal.on("shown.bs.modal",function(){$(this).scrollTop(0)}),n._selectManyModal.addClass("core-select-modal")}for(var x,B,S=n._selectManyModal.find(".list-group"),g=0,_=c.length;_>g;g++)x=c[g],h=x.properties,B=utils.extractToHtml(x.options.popup,h),(B&&"*"===B||B.search(/\$\{\*\}/)>-1)&&(B=n._extractAllAttributes(B,h)),B=n._processHtml(B),k=$('<a href="#" class="list-group-item"><span><strong style="display:none;">'+x.options.displayName+"</strong>"+B+'</span><div class="btn btn-success select-btn-zoom-to-feature">Zooma hit</div></a>'),k.data("index",g),L.Browser.touch&&k.addClass("select-row-touch"),S.append(k);var I=S.find(".list-group-item");return I.find(".select-btn-zoom-to-feature").on("touchend click",function(){if(r.call($(this).parent()[0]),n._rasterFeature){var e=n._rasterFeature.getBounds(),t=L.Browser.touch?[100,100]:[200,150];n.map.fitBounds(e,{paddingTopLeft:t,paddingBottomRight:[100,100]})}else{var a=($(this).parent().data("index"),15);a=n.map.getZoom()<a?a:n.map.getZoom()+1,n.map.setZoomAround(C.latLng,a)}return n._selectManyModal.modal("hide"),!1}),L.Browser.touch?I.on("tap",function(){var e=$(this).data("index"),t=n._selectedFeaturesWms[e];return i(t),r.call(this),!1}):I.on("click",r),n._selectManyModal.modal("show"),!0}for(var E,T=n._selectedFeaturesWms||[],g=0,_=T.length;_>g;g++)if(C=T[g],C.geometry&&C.geometry.type&&C.geometry.type.search(/point/gi)>-1){E=C;break}if(!E){var D=parseInt(n._selectedFeaturesWms.length/2);E=n._selectedFeaturesWms[D]}i(E),C=E}var y="",h=C.properties,v=C.options.popup;(v&&"*"===v||v.search(/\$\{\*\}/)>-1)&&(v=n._extractAllAttributes(v,h)),y=a(v,C.properties,C.options.displayName),y=n._processHtml(y),e.closePopup(),w.setContent(y),w.setLatLng(C.latLng),setTimeout(function(){var t=smap.cmd.getControl("SelectWMS");if(t&&t._dblclickWasRegistered===!0)return!1;w.openOn(e);var n=$(".leaflet-popup-content:visible");n.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})})},100)}}),smap.event.on("smap.core.createparams",function(e,t){function a(e,t,n){e&&(s[e]||(s[e]={}),s[e][t]||(s[e][t]=[]),s[e][t].push(n))}var o,i,r,s={};if(n._selectedFeaturesVector&&n._selectedFeaturesVector.length){r=n._selectedFeaturesVector;for(var l=0,p=r.length;p>l;l++)o=r[l],o.properties&&o.uniqueKey&&(i=n._getVectorVal(o.properties,o.uniqueKey),a(o.layerId,"vals",i),s[o.layerId].key=o.uniqueKey)}if(n._selectedFeaturesWms&&n._selectedFeaturesWms.length){r=n._selectedFeaturesWms;for(var l=0,p=r.length;p>l;l++)o=r[l],i=[o.latLng.lng,o.latLng.lat],a(o.options.layerId,"xy",i)}$.isEmptyObject(s)===!1&&(t.sel=encodeURIComponent(JSON.stringify(s)))}),smap.event.on("smap.core.applyparams",$.proxy(function(e,t){function n(){var e,t,o,i,l,p,c=this,d=this.options.layerId,h=this.options.uniqueKey,u=r[d],m=u.vals;for(o=0,len=m.length;o<len;o++)t=m[o],e=null,$.each(c._layers,function(n,a){if(a.feature){if(i=a.feature.properties,h.split(";").length>1?(l=h.split(";"),p=i[l[0]]+";"+i[l[1]]):p=a.feature.properties[h],!p)return!1;if(p===t)return e=a,!1}}),e&&e.fire("click",{properties:e.feature.properties,latlng:a,originalEvent:{shiftKey:s}});c.off("load",n)}if(t.SEL){var a,o,i,r=JSON.parse(decodeURIComponent(t.SEL)),s=!1,l=0;for(var p in r)if(l+=1,l>1||r[p].vals&&r[p].vals.length>1){s=!0;break}for(i in r)if(o=r[i],o.key){var c=smap.core.layerInst.showLayer(i);c&&c.on("load",n)}}}))}}),smap.cmd={createParams:function(e){return smap.core.paramInst.createParams(e)},createParamsAsObject:function(){return smap.core.paramInst.createParamsAsObject()},removeAllMapLayer:function(){smap.map.eachLayer(function(e){"undefined"!=typeof e.options&&null!==e.options&&"undefined"!=typeof e.options.isBaseLayer&&null!==e.options.isBaseLayer&&e.options.isBaseLayer===!1?smap.map.removeLayer(e):""},this)},showAllMapLayerLegendTogether:function(){smap.cmd.allActiveLayersLegend=[],smap.cmd.allActiveLayersLegendWithDisplayName=[],smap.map.eachLayer(function(e){"undefined"!=typeof e.options&&null!==e.options&&"undefined"!=typeof e.options.isBaseLayer&&null!==e.options.isBaseLayer&&e.options.isBaseLayer===!1&&(smap.cmd.allActiveLayersLegend.push(e.options.printLegend),smap.cmd.allActiveLayersLegendWithDisplayName.push(e.options.displayName+"legend_saperator"+e.options.printLegend))},this)},getControl:function(e){var t=this.getControls(e);return t.length?t[0]:null},getControls:function(e){e.search(/\./)>-1&&(e=e.split(".").slice(2).join("."));for(var t,n=smap.core.controls||[],a=[],o=0,i=n.length;i>o;o++)t=n[o],t instanceof L.Control[e]&&a.push(t);return a},notify:function(e,t,n){switch(n=n||{},n.parent=n.parent||$("body"),t){case"success":t="alert-success";break;case"warning":t="alert-danger";break;case"info":t="alert-info";break;case"error":t="alert-danger";break;default:t="alert-"+t}var a=$('<div class="alert map-alert '+t+' alert-dismissable"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e+"</div>");return n.parent.find(".alert").remove(),n.parent.append(a),n.fade&&(a.addClass("notify-transition"),setTimeout(function(){a.addClass("notify-visible")},1)),this._notifyTimeOut&&clearTimeout(this._notifyTimeOut),n.fadeOut&&(this._notifyTimeOut=setTimeout(function(){$(".alert").remove()},n.fadeOut||7e3)),a},showLayer:function(e){return smap.core.layerInst.showLayer(e)},hideLayer:function(e){return smap.core.layerInst.hideLayer(e)},addLayerWithConfig:function(e){return smap.core.layerInst._addLayerWithConfig(e)},getLayer:function(e){return smap.core.layerInst._getLayer(e)},getLayerConfig:function(e){return this.getLayerConfigBy("layerId",e)},getLayerConfigBy:function(key,val,options){options=options||{};var arr=smap.config.bl.concat(smap.config.ol||[]),i,t,compVal;for(i=0,len=arr.length;i<len;i++){if(t=arr[i],-1!==key.search(/\./))try{compVal=eval("t."+key)}catch(e){continue}else compVal=t.options[key];if(options.inText){if(void 0!==compVal&&compVal.search(val)>-1)return t}else if(void 0!==compVal&&compVal===val)return t}return null},getLang:function(){var e=smap.core.mainConfig.smapOptions.defaultLanguage||"en",t=smap.core.paramInst?smap.core.paramInst.getParams().LANG:e,n=t?t.split("-")[0]:e;return n},reloadCore:function(e){e=e||{},smap.core.initInst.resetMap(),smap.core.initInst.init(e)},loading:function(e,t){if(t=t||{},!window.Spinner)return!1;var n={sv:{loading:"Laddar"},en:{loading:"Loading"}},a=this.getLang(),o=n.hasOwnProperty(a)?n[a]:n.en,i=t.text;if(i instanceof Object&&(i=i[o]),e&&e===!0){if(!this.spinner){var r={lines:12,length:4,width:6,radius:40};this.spinner=new Spinner(r).spin()}this.spinner.spin(),$("#mapdiv").append(this.spinner.el),$("div .spinner").css({top:"50%",left:"50%"}),$(this.spinner.el).append('<div id="loadingText">'+(i||o.loading)+"</div>")}else this.spinner.stop()},mergeLayers:function(){smap.cmd.mergeLayers.mergeLayers={},smap.cmd.mergeLayers.tmp_memove_lg_list=[],smap.map.on("layeradd",function(e){if(e.layer&&e.layer.options&&e.layer.options.mergeLayers&&e.layer.options.mergeLayers.length>0)for(var t=0;t<e.layer.options.mergeLayers.length;t++){if("object"==typeof e.layer.options.mergeLayers[t])var n=JSON.parse(JSON.stringify(e.layer.options.mergeLayers[t]));else if("string"==typeof e.layer.options.mergeLayers[t])var n=JSON.parse(JSON.stringify(smap.cmd.getLayerConfig(e.layer.options.mergeLayers[t])));if("undefined"!=typeof n&&null!==n){n.options.isBaseLayer=!0,n.options.isMultipleBaseLayer=!0,n.options.layerId=n.options.layerId+"_mergedLayer_"+e.layer.options.layerId;var a=smap.core.layerInst._createLayer(n);"undefined"!=typeof a&&null!==a&&(smap.cmd.mergeLayers.mergeLayers[n.options.layerId]=a,smap.map.addLayer(a))}}}),smap.map.on("layerremove",function(e){if("undefined"!=typeof smap.cmd.mergeLayers.mergeLayers&&null!==smap.cmd.mergeLayers.mergeLayers&&e.layer&&e.layer.options&&e.layer.options.layerId){var t=e.layer.options.layerId;for(mglg in smap.cmd.mergeLayers.mergeLayers)mglg.split("_mergedLayer_")[1]===t&&(smap.cmd.mergeLayers.tmp_memove_lg_list.push(mglg),smap.map.removeLayer(smap.cmd.mergeLayers.mergeLayers[mglg]));for(var n=0;n<smap.cmd.mergeLayers.tmp_memove_lg_list.length;n++)delete smap.cmd.mergeLayers.mergeLayers[smap.cmd.mergeLayers.tmp_memove_lg_list[n]];smap.cmd.mergeLayers.tmp_memove_lg_list=[]}})},getLayerConfigAlias:function(e){return this.getLayerConfigBy("alias",e)},getLayerConfigAliasBy:function(key,val,options){options=options||{};var arr=smap.config.bl.concat(smap.config.ol||[]),i,t,compVal;for(i=0,len=arr.length;i<len;i++){if(t=arr[i],-1!==key.search(/\./))try{compVal=eval("t."+key)}catch(e){continue}else compVal=t.options[key];if(options.inText){if(void 0!==compVal&&compVal.search(val)>-1)return t}else if(void 0!==compVal&&compVal===val)return t}return null},_xhr_handler:function(e,t){try{return new XMLHttpRequest}catch(n){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(n){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}return alert("XMLHttpRequest not supported"),null},createGetFeatureURL:function(e,t,n,a){var o=e.options.layers,i=a,r=e.init;"L.TileLayer.WMS"===r&&(i=o+"."+i);var s=e.url.split("?")[0]+"?service=WFS&version=1.3.0&request=GetFeature&outputFormat=GeoJSON&typename="+o+"&featureid="+i;return s},getSingleGeoJSON:function(e,t,n){var a=this.getLayerConfigAlias(e);if("undefined"!=typeof a&&null!==a)var o=this.createGetFeatureURL(a,e,t,n);else{var a=this.getLayerConfig(e);if("undefined"!=typeof a&&null!==a)var o=this.createGetFeatureURL(a,e,t,n);else var o=null}if(null!==o){var i=new this._xhr_handler;if(i.open("GET",o,!1),i.send(null),4==i.readyState&&200==i.status)var r=JSON.parse(i.responseText);return[r,a]}return null},getPopHTML:function(e,t,n){var a="",o="";return o+='<div id="advSokCatDiv" style="width:inherit;" class="'+a+'"><h4 class="popup-layertitle">'+n+"</h4>",o+=utils.extractToHtml(e,t)+"</div>"},advSearch:function(e){var t=smap.core.paramInst.getParams();if("undefined"!=typeof t.QL&&null!==t.QL&&"undefined"!=typeof t.QA&&null!==t.QA&&"undefined"!=typeof t.POI&&null!==t.POI&&t.QL.length>0&&t.QA.length>0&&t.POI.length>0){var n=this.getSingleGeoJSON(t.QL,t.QA,t.POI),a=n[0],o=n[1];if(null!==a)if(a.features.length>0){"undefined"!=typeof smap.map.avdSearchLg&&null!==smap.map.avdSearchLg||(smap.map.avdSearchLg=L.layerGroup(),window.avdSearchLg=smap.map.avdSearchLg,smap.map.avdSearchLg.id="avdSearchLg",smap.map.addLayer(smap.map.avdSearchLg));var i={stroke:!0,color:"#00FFFF",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},r=L.latLng(a.features[0].geometry.coordinates[1],a.features[0].geometry.coordinates[0]);window.advSolcreateRandomNumber=Math.random().toString().split(".")[1];var s=new L.Circle(r,10,i);s.id="advSokMarkerId_"+window.advSolcreateRandomNumber;var l={keepInView:!0};smap.map.setView(r,15,{animate:!1});var p=document.createElement("div");p.style.display="none";var c=document.createElement("button");c.id="smapadvsokpopupbtn_"+window.advSolcreateRandomNumber,c.className="btn btn-default btn-sm",c.value="Ta bort kartsymbol",c[getTextContent(c)]="Ta bort kartsymbol",c.onclick=function(){var e=null,t="advSokMarkerId_"+this.id.split("_")[1],n=smap.map.avdSearchLg._layers;if(n)for(lay in n)n[lay].id===t&&(e=n[lay]);smap.map.avdSearchLg.removeLayer(e)},p.appendChild(c);var d=smap.core.Select.prototype._processHtml(this.getPopHTML(o.options.popup,a.features[0].properties,o.options.displayName)),h=document.createElement("html");h.innerHTML=d;var u=h.getElementsByTagName("body")[0],m=u.childNodes[0].childNodes[u.childNodes[0].childNodes.length-1],f=m.tagName;(f="IMG")?u.childNodes[0].insertBefore(p,m):u.childNodes[0].appendChild(p),d=u.childNodes[0],window.avdSokPopup=L.popup(l);var g=d;window.avdSokPopup.setContent(g),window.avdSokPopup.setLatLng(r),s.bindPopup(window.avdSokPopup),window.avdSokPopup.openOn(smap.map),s.addTo(smap.map.avdSearchLg),smap.map.on("popupclose",$.proxy(function(){c.click()},c)),window.setTimeout(function(){$(".lswitch-btnhide.btn.btn-default")[0].click()},500)}else smap.cmd.notify("Den sökta fråga hittades inte","error");else smap.cmd.notify("Den sökta fråga hittades inte","error")}}},smap.core.mainConfig={mapConfig:{layers:[],crs:L.CRS.EPSG3857,attributionControl:!0,zoomControl:!1,maxZoom:12,disabledRightClick:!0},smapOptions:{title:"sMap-responsive",favIcon:"https://assets-cdn.github.com/favicon.ico",popupAutoPanPadding:[0,70],defaultLanguage:"sv"},toolbarPlugin:"Menu",defaultTheme:"smap",configFolders:["/rest/leaf/configs-1.0/"]};var utils={rmPx:function(e){return e&&e.replace?parseInt(e.replace(/px/gi,"").replace(/em/gi,"").replace(/pt/gi,"")):e},log:function(){window.console},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},addImageLoadIndicator:function(e,t){t=t||{};var n={height:"100px"};$.extend(n,t);var a=$('<div class="img-load-indicator"><i class="fa fa-spinner"></i></div>');a.css("height","100px"),e.before(a),e.addClass("hidden img-smooth-loading"),e.on("load",function(){var e=$(this);e.prev(".img-load-indicator").remove(),e.removeClass("hidden"),setTimeout(function(){e.addClass("img-fade-in"),window.loadedPopup_image_Height=e[0].height,window.loadedPopup_image_Width=e[0].width,"undefined"!=typeof smap.map._popup&&null!==smap.map._popup&&(smap.map._popup.update(),window.setTimeout(function(){var e=0,t=function(){var e=document.getElementById("smap-search-div");return e?e.getBoundingClientRect().bottom:0}(),n=function(){return toolbarDiv=document.getElementById("malmo-masthead"),toolbarDiv?toolbarDiv.getBoundingClientRect().bottom:0}(),a=0;a=t>0?t:n;var o=a;e=o>smap.map._popup._container.getBoundingClientRect().top?smap.map._popup._container.getBoundingClientRect().top-o-10:e,smap.map.panBy([0,e]),window.loadedPopup_image_Height=0,window.loadedPopup_image_Width=0},500))},200)}),1===e.length?e[0].naturalHeight>0&&e[0].naturalWidth>0?"":e.prev(".img-load-indicator").remove():""},textInsert:function(e,t){for(var n=0,a=t.length;a>n;n++)e=e.replace("%s",t[n]);return e},getBrowser:function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/),t=e?parseInt(e[1]):void 0;return{ie:e,ieVersion:t,ie8:8===t,ie9:9===t,ie10:10===t,ie11:11===t}},urlAppend:function(e,t,n){n=n||"?";var a="?"===n?/\?/g:/#/g,o=t.charAt(t.length-1);return"&"===o&&(e=o.substring(0,t.length-1)),-1===e.search(a)&&(e+=n),e+t},isInIframe:function(){return top.location!=self.location},makeUniqueArr:function(e){var t=[];return $.each(e,function(e,n){-1===$.inArray(n,t)&&t.push(n)}),t},objectToUpperCase:function(e){var t={};for(var n in e)t[n.toUpperCase()]=e[n];return t},drawDialog:function(e,t,n,a,o){a=a||{},a.size=a.size||"";var o=function(){return"undefined"!=typeof o&&null!==o?o:"ctrlNotDefined"}(),i="modalDialogCloseID_"+o,r="modalDialogMinimizeID_"+o,s=$('<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" id="'+i+'" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><button type="button" class="minimize" id="'+r+'" minimize_ctrl='+o+'  aria-hidden="true">-</button>'+(-1===e.search(/</g)?'<h4 class="modal-title">'+e+"</h4>":e)+'</div><div class="modal-body"></div></div>');if(s.find(".modal-body").append(t),n){var l=$('<div class="modal-footer"></div>');s.find(".modal-body").after(l),l.append(n)}var p=L.Browser.touch?"tap":"click";return s.find("#"+r).on(p,function(){"-"===this[window.getTextContent(this)]?(this[window.getTextContent(this)]="+",$(".modal-body").toggle(),$(".modal-footer").toggle(),"undefined"!=typeof this.getAttribute("minimize_ctrl")&&null!==this.getAttribute("minimize_ctrl")&&"LControlPrint"===this.getAttribute("minimize_ctrl")&&($(".modal").height($(".modal-dialog")[0].getBoundingClientRect().bottom),$(".modal-backdrop")[0].style.display="none")):"+"===this[window.getTextContent(this)]&&(this[window.getTextContent(this)]="-",$(".modal-body").toggle(),$(".modal-footer").toggle(),"undefined"!=typeof this.getAttribute("minimize_ctrl")&&null!==this.getAttribute("minimize_ctrl")&&"LControlPrint"===this.getAttribute("minimize_ctrl")&&($(".modal").height(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),$(".modal-backdrop")[0].style.display="block"))}),s.on("hide.bs.modal",function(){"+"===$(this).find(".minimize")[0][window.getTextContent($(this).find(".minimize")[0])]&&($(this).find(".minimize")[0][window.getTextContent($(this).find(".minimize")[0])]="-",$(".modal-body").toggle(),$(".modal-footer").toggle(),"undefined"!=typeof $(this).find(".minimize")[0].getAttribute("minimize_ctrl")&&null!==$(this).find(".minimize")[0].getAttribute("minimize_ctrl")&&"LControlPrint"===$(this).find(".minimize")[0].getAttribute("minimize_ctrl")&&($(".modal").height(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),
$(".modal-backdrop")[0].style.display="block"))}),a.size&&s.find(".modal-dialog").addClass("modal-"+a.size),s},getLayerFromFeature:function(e,t){var n=t._layers;for(var a in n){var o=n[a];if(o.feature&&o.feature.id===e.id)return o}return null},round:function(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n},makeUnselectable:function(e){e.attr("unselectable","unselectable").addClass("unselectable")},extractToHtml:function(html,props){function getFunctionEnd(e){var t=1,n=!1,a=e.search(/\{/g);e=e.substring(a+1);var o=0;for(o=0,len=e.length;o<len;o++)if("{"===e.charAt(o)?t+=1:"}"===e.charAt(o)&&(t-=1),0===t){n=!0,o=o+a+2;break}return n||(o=-1),o}function extractAttribute(a,txt){var index=txt.search(/\${/g);if(-1!==index){var extractedAttribute="",attr=html.substring(index+2),endIndex=0;if(endIndex="function"===attr.substring(0,8)?getFunctionEnd(attr):attr.search(/\}/g),attr=attr.substring(0,endIndex),"function"===attr.substring(0,8)){var theFunc=attr.replace("function","function f");eval(theFunc),extractedAttribute=f.call(this,a)}else{var paramsArr=attr.split(",");if(paramsArr.length>1){var firstParam=$.trim(paramsArr[0]),secondParam=$.trim(paramsArr[1]);if(extractedAttribute=a[firstParam]||"",secondParam&&1===parseInt(secondParam))try{extractedAttribute=decodeURIComponent(extractedAttribute)}catch(e){}}else extractedAttribute=a[attr]||""}txt=txt.replace("${"+attr+"}",extractedAttribute)}return txt}if(!props)return"";if("undefined"==typeof html)return html=null;for(var index=html.search(/\${/g);-1!==index;)html=extractAttribute(props,html),index=html.search(/\${/g);return html},createLabel:function(e,t,n){n=n||"leaflet-maplabel";var a=L.marker(e,{icon:new L.DivIcon({iconSize:null,className:n,html:"<div>"+t+"</div>"})});return a.options._noprint=!0,a.options.clickable=!1,a.options.selectable=!1,a},getLength:function(e){var t,n=0;for(t=0,len=e.length-1;t<len;t++)n+=e[t].distanceTo(e[t+1]);return n},paramsStringToObject:function(e,t){t=t||!1;for(var n,a,o,i={},r=e.split(/[&;]/),s=0,l=r.length;l>s;s++)if(o=r[s].split("="),o[0]){n=o[0];try{n=decodeURIComponent(n)}catch(p){n=unescape(n)}a=(o[1]||"").replace(/\+/g," ");try{a=decodeURIComponent(a)}catch(p){a=unescape(a)}a=a.split(","),1==a.length&&(a=a[0]),t&&(n=n.toUpperCase()),i[n]=a}return i},projectPoint:function(e,t,n,a){return window.proj4(n,a,[e,t])},projectLatLng:function(e,t,n,a,o){var i=a?[e.lat,e.lng]:[e.lng,e.lat],r=window.proj4(t,n,i),s=o?L.latLng(r[0],r[1]):L.latLng(r[1],r[0]);return s},projectFeature:function(e,t,n){function a(e,t){return c(e[0],e[1],t,"EPSG:4326")}function o(e){return e=[e[1],e[0]]}n=n||{};var i,r,s,l,p,c=this.projectPoint;switch(p=e.geometry,p.type){case"Point":i=p.coordinates,n.reverseAxis&&(i=this.swapCoords(i)),s=a(i,t),p.coordinates=s;break;case"MultiPoint":for(l=0,h=p.coordinates.length;h>l;l++)i=p.coordinates[l],n.reverseAxis&&(i=this.swapCoords(i)),s=a(i,t),p.coordinates[l]=s;break;case"LineString":for(r=p.coordinates[0],l=0,lenP=r.length;l<lenP;l++)i=r[l],n.reverseAxis&&(i=this.swapCoords(i)),s=a(i,t),r[l]=s;break;case"MultiLineString":r=[];var d,h,u;for(l=0,h=p.coordinates.length;h>l;l++){for(r=p.coordinates[l],d=0,u=r.length;u>d;d++)i=r[d],n.reverseAxis&&(i=o(i)),s=a(i,t),r[d]=s;p.coordinates[l]=r}break;case"Polygon":for(r=p.coordinates[0],l=0,lenP=r.length;l<lenP;l++)i=r[l],n.reverseAxis&&(i=this.swapCoords(i)),s=a(i,t),r[l]=s;break;case"MultiPolygon":r=[];var d,m,h,u,f,g;for(l=0,h=p.coordinates.length;h>l;l++)for(r=p.coordinates[l],d=0,u=r.length;u>d;d++)for(g=r[d],m=0,f=g.length;f>m;m++)i=g[m],n.reverseAxis&&(i=o(i)),s=a(i,t),g[m]=s}}};L.Control.Editor=L.Control.extend({options:{position:"bottomright",useProxy:!1,reverseAxis:!1,encodeKeys:null,saveOnPressEnter:!1},_lang:{sv:{dTitle:"Objektets attribut",close:"Avbryt",save:"Spara",remove:"Ta bort",move:"Flytta",editProps:"Ändra",moveLP:"Ändra geometri",editPropsLP:"Ändra attribut",ruSureRemove:"Ta bort objektet? Åtgärden kan inte ångras.",saveNewMarker:"Spara",saveMove:"Spara",undo:"Ångra",cancel:"Avbryt"},en:{dTitle:"Object attributes",close:"Cancel",save:"Save",remove:"Remove",move:"Move",editProps:"Edit",moveLP:"Edit geometry",editPropsLP:"Edit attributes",doYouWantTo:"Do you want to",cannotBeUndoed:"Cannot be undoed",ruSureRemove:"Remove feature? Cannot be undoed.",saveNewMarker:"Save",saveMove:"Save",undo:"Undo",cancel:"Cancel"}},_geomTypes:{POINT:"marker",MULTIPOINT:"marker",LINESTRING:"polyline",MULTILINESTRING:"polyline",POLYGON:"polygon",MULTIPOLYGON:"polygon"},_geomType:"marker",_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode),this._inserts=[],this._updates=[],this._deletes=[]},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-editor"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawModal();var t=this;return smap.event.on("smap.core.pluginsadded",function(){t._setEditableLayer()}),this._container},onRemove:function(){},_addBtnAdd:function(){var e=this,t=$(".smap-editor-btnadd");if(!t.length){var t=$('<button class="btn btn-default btn-lg smap-editor-btnadd"><i class="glyphicon glyphicon-plus"></i></button>');$(".leaflet-top.leaflet-left").prepend(t),t.on("click touchend",function(){var t=e._getDrawToolbar();return $(this).toggleClass("btn-danger"),$(this).hasClass("btn-danger")?(t.handler.type&&"marker"===t.handler.type&&(e._onTouchHold=e._onTouchHold||function(n){var a=t.handler;e._tooltip=e._tooltip||{updatePosition:function(){}},a._onMouseMove({latlng:n.latlng}),a._onClick({latlng:n.latlng})},e.map.on("click",e._onTouchHold,e)),t.handler.enable()):(L.Browser.touch&&t.handler.type&&"marker"===t.handler.type&&(e.map.off("click",e._onTouchHold,e),$("#smap-editor-uglyhackconfirm").remove()),t.handler.disable()),!1})}},_setEditableLayer:function(){function e(){if($(this).parent().hasClass("list-group-item-danger"))r.stopEditing();else{var e=$(this).data("t")||{};e=$.extend(!0,{},e),"L.GeoJSON.WFS"===e.init&&r.startEditing(e,$(this).parent())}return!1}var t,n,a,o=smap.config.ol||[],i=smap.cmd.getControl("LayerSwitcher");if(!i)return!1;for(var r=this,s=0,l=o.length;l>s;s++)t=o[s],a=$('<i class="fa fa-edit smap-editor-switcher-icon"></i>'),t.options.isEditable&&(n=$("#"+i._makeId(t.options.layerId)),n.append(a),a.data("t",t),a.on("click",e))},_disabledRowClick:function(e){return e.stopPropagation(),e.preventDefault(),$(e.target).hasClass("smap-editor-switcher-icon")?$(".smap-editor-switcher-icon").trigger("click"):($(e.target).tooltip("show"),setTimeout(function(){$(e.target).tooltip("hide")},2e3)),!1},stopEditing:function(){if(this._editLayer){this._editLayer.options.editable=!1;var e=this._editLayer.options.layerId,t=e.substring(0,e.length-"-edit".length),n=smap.cmd.getLayer(t);n&&n.clearLayers&&n.clearLayers(),n&&n._refresh&&n._refresh({force:!0}),this.map.removeLayer(this._editLayer)}return $(".lswitch-panel-ol .list-group-item").off("click",this._disabledRowClick).removeClass("list-group-item-danger"),$(".lswitch-panel-ol .list-group-item").tooltip("destroy"),this.map.off("draw:created"),this.map.off("popupopen",this.__onPopupOpen),$(".smap-editor-btnadd").remove(),!0},_validateConfig:function(e){e=e||{};var t=e.options||{},n=[];for(var a in this._geomTypes)n.push(a);return!!t.geomType&&-1!==$.inArray(t.geomType.toUpperCase(),n)},startEditing:function(e,t){function n(e){var t=e.layer.jsonData.features||[];if(t.length)a.options.geomType=a._geomType=a._geomTypes[e.layer.options.geomType.toUpperCase()],!a._geomType;else{var n=e.layer.options.geomType;n&&(a._geomType=a._geomTypes[n.toUpperCase()])}}var a=this,o=this.map;if(this.stopEditing()!==!0)return!1;if(this._addBtnAdd(),a._tooltip=a._tooltip||{updatePosition:function(){}},$(".lswitch-panel-ol .list-group-item.active").trigger("tap"),$(".lswitch-panel-ol .list-group-item-danger").removeClass("list-group-item-danger"),$(".lswitch-panel-ol .list-group-item").tooltip({title:"Redigering är aktiv. Deaktivera redigering för att tända lagret.",trigger:"manual",placement:"right",container:"#maindiv"}).on("click",this._disabledRowClick),t.addClass("list-group-item-danger"),this._validateConfig(e)===!1)return!1;var i=$.extend({},e.options),r=i.params.typeName;i.url=e.url,i.featureNS=r.split(":")[0],i.featureType=r.split(":")[1],i.layerId=i.layerId+"-edit";var s=i.geomType.toUpperCase(),l="POINT"===s?this.lang.move:this.lang.moveLP,p="POINT"===s?this.lang.editProps:this.lang.editPropsLP,c=this.lang.remove;i.popup='${*}<div class="popup-divider"></div><div style="white-space:nowrap;min-width:25em;" class="btn-group btn-group-sm editor-popup-edit"><button id="editor-popup-edit" type="button" class="btn btn-default">'+p+'</button><button id="editor-popup-move" type="button" class="btn btn-default">'+l+'</button><button id="editor-popup-remove" type="button" class="btn btn-default">'+c+"</button></div>",this._editLayer=L.wfst(e.url,i),this._editLayer.options.editing=this._editLayer.options.editing||{},this._editLayer.on("wfst:savesuccess",function(){smap.cmd.loading(!1)}),this._editLayer.on("wfst:saveerror",function(){smap.cmd.loading(!1)}),this._editLayer.on("wfst:ajaxerror",function(){smap.cmd.loading(!1)}),o.addLayer(this._editLayer),this._drawControl=new L.Control.Draw({edit:{featureGroup:this._editLayer}}),o.addControl(this._drawControl),$(".leaflet-draw").remove(),this._editLayer.on("load",n),o.on("draw:created",function(e){$(".smap-editor-btnadd").removeClass("btn-danger"),a._editLayer.addLayer(e.layer),a._marker=e.layer,a._showSaveToolbar("insert")}),this.__onPopupOpen=this.__onPopupOpen||$.proxy(this._onPopupOpen,this),this.map.on("popupopen",this.__onPopupOpen)},_getLayerById:function(e,t){function n(i){var r=i._layers||{};if(!r)return null;if(r.hasOwnProperty(t))return{marker:r[t],markerGeometry:r[t]};var s,l;for(l in r)if(0===o&&(a=l),o+=1,s=n(r[l]),o-=1,s)return{marker:e._layers[a],markerGeometry:s.marker};return null}var a,o=0;return n(e)},_onPopupOpen:function(e){var t=this;if(this._marker&&this._marker.dragging&&this._marker.dragging._draggable&&this._marker.dragging._draggable._enabled){if(this.map.closePopup(),confirm("Do you to stop editing this feature? Any changes made to the feature will be removed.")!==!0)return;this.cancelEdit()}var n=$(e.popup._container);if(e.popup._source.feature&&"polyline"!=this._geomType)this._marker=e.popup._source,this._markerGeometry=null;else{var a=this._getLayerById(this._editLayer,e.popup._source._leaflet_id);this._marker=a.marker,this._markerGeometry=e.popup._source}n.find("#editor-popup-remove").on("click",function(){return confirm(t.lang.ruSureRemove)===!0&&t._editLayer.wfstRemove(t._marker).done(function(){t._editLayer.clearLayers(),t._editLayer._refresh({force:!0})}),!1}),n.find("#editor-popup-move").on("click",function(){t.map.closePopup();var e=t._getEditToolbar();return e.handler._enableLayerEdit(t._markerGeometry||t._marker),t._showSaveToolbar("update"),t._editLayer.options.editable=!0,!1}),n.find("#editor-popup-edit").on("click",function(){return t._modalEdit.modal("show"),!1})},_getEditToolbar:function(){var e;for(var t in this._drawControl._toolbars)if(e=this._drawControl._toolbars[t],e&&e._modes&&e._modes.edit)return e._modes.edit;return null},_getDrawToolbar:function(){var e;for(var t in this._drawControl._toolbars)if(e=this._drawControl._toolbars[t],e&&e._modes&&e._modes[this._geomType])return e._modes[this._geomType];return null},wfstSave:function(e){e=e?L.Util.isArray(e)?e:[e]:[];var t,n,a=[],o=this._editLayer;for(n=0,len=e.length;n<len;n++)if("object"==typeof e[n]._layers)for(t in e[n]._layers)smap.cmd.loading(!0),a.push(o._wfstSave(e[n]._layers[t]));else a.push(o._wfstSave(e[n]));return $.when.apply($,a)},save:function(e){e=e||null;var t,n,a=this._inserts,o=this._updates,i=this._editLayer,r=a.length;for(t=0;r>t;t++)n=a[t],i._wfstAdd(n).done(function(){a.splice(n,1),e&&e()});for(r=o.length,t=0;r>t;t++)n=o[t],this.wfstSave(n).done(function(){o.splice(n,1)})},cancelEdit:function(){var e=this._getEditToolbar();e.handler._disableLayerEdit(this._markerGeometry||this._marker),this._editLayer.clearLayers(),this._editLayer._refresh({force:!0}),this._hideSaveToolbar()},_showSaveToolbar:function(e){if(this._editType=e,!this._saveToolbar){var t=this;this._saveToolbar=$('<div class="smap-editor-savetoolbar btn-group btn-group-lg" />');var n=$('<button class="btn btn-success">Save</button>'),a=$('<button class="btn btn-default">Cancel</button>');this._saveToolbar.append(a).append(n),$(".leaflet-top.leaflet-left").append(this._saveToolbar),n.on("click",function(){if(t._marker.options.geomType=t._editLayer.options.geomType.toUpperCase(),"update"===t._editType){var e=t._marker.options.geomType;"POINT"===e||"POLYGON"===e?t.wfstSave(t._marker):(t._markerGeometry.feature=$.extend({},t._marker.feature),t.wfstSave(t._markerGeometry))}var n=t._getEditToolbar();return n.handler._disableLayerEdit(t._markerGeometry||t._marker),"insert"===t._editType?(t._inserts.push(t._marker),t.save(function(){t._editLayer.clearLayers(),t._editLayer._refresh({force:!0}),t._hideSaveToolbar()})):"update"===t._editType&&(t.save(),t._hideSaveToolbar()),!1}),a.on("click",function(){return t.cancelEdit(),!1})}var o="insert"==this._editType?this.lang.saveNewMarker:this.lang.saveMove,i=this.lang.cancel;this._saveToolbar.find("button:eq(0)").text(i),this._saveToolbar.find("button:eq(1)").text(o),this._saveToolbar.show()},_hideSaveToolbar:function(){this._saveToolbar.hide()},_fillModal:function(e){if(e=e||null,null===e)return!1;var t,n,a,o,i=this._modalEdit.find("#smap-editor-content"),r=$('<form role="form" />'),s=this.options.encodeKeys||[];for(t in e)"fid"!==t&&"id"!==t&&"gid"!==t&&(n=e[t],n=n||"",("*"===s||$.inArray(t,s)>-1)&&(n=decodeURIComponent(n)),o="smap-editor-propentry-"+t,a='<div class="form-group">\t\t\t\t\t<label for="'+o+'">'+t+'</label>\t\t\t\t\t<textarea rows="1" resizable name="'+t+'" class="form-control" id="'+o+'">'+n+"</textarea>\t\t\t\t</div>",r.append(a));r.find("textarea").on("change",function(){$(this).addClass("changed")}).on("focus",function(){$(this).prop("rows",5)}).on("blur",function(){$(this).prop("rows",1)}),i.append(r)},_onSaveAttributesSuccess:function(){this._marker.fire("click")},_saveAttributes:function(){var e=this._marker.feature.properties,t={},n=this._modalEdit.find("form").find("textarea.changed");if(!n.length)return this._modalEdit.modal("hide"),!1;var a,o,i=this.options.encodeKeys||[];n.each(function(){a=$(this).attr("name"),o=$(this).val(),("*"===i||$.inArray(a,i)>-1)&&(o=encodeURIComponent(o)),t[a]=o});var r=$.extend({},e,t);this._marker.feature.properties=r,this._marker.toGML||(this._markerGeometry.feature=$.extend({},this._marker.feature)),this.__onSaveAttributesSuccess=this.__onSaveAttributesSuccess||$.proxy(this._onSaveAttributesSuccess,this),this._editLayer.off("wfst:savesuccess",this.__onSaveAttributesSuccess).on("wfst:savesuccess",this.__onSaveAttributesSuccess),this._editLayer._wfstSave(this._markerGeometry||this._marker,{newProps:t}),this._modalEdit.modal("hide"),this.map.closePopup()},_drawModal:function(){var e=this,t=$('<div id="smap-editor-content" />'),n='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+'</button><button id="smap-editor-editmodal-btnsave" type="button" class="btn btn-primary">'+this.lang.save+"</button>";this._modalEdit=utils.drawDialog(this.lang.dTitle,t,n,{}),this._modalEdit.find("#smap-editor-editmodal-btnsave").on("click",function(){return e._saveAttributes(),!1}),this._modalEdit.on("shown.bs.modal",function(){var t=e._marker.feature.properties;e._fillModal(t),e.options.saveOnPressEnter&&e._modalEdit.on("keypress",function(t){13===t.which&&($("#smap-editor-editmodal-btnsave").focus(),e._saveAttributes(),e._modalEdit.modal("hide"),t.preventDefault())})}),e._modalEdit.on("hidden.bs.modal",function(){t.empty(),e._modalEdit.off("keypress")})}}),L.Control.FullScreen=L.Control.extend({options:{position:"topright",url_root:location.origin+location.pathname+"?",mode:"full"},_properties:function(){var e=this,t=this.lang;switch(this.options.mode){case"replace":return{expand:"fa fa-expand",compress:"fa fa-compress",expTitle:t.viewLarge,compTitle:t.back,action:function(){window.parent.location.href=smap.cmd.createParams(e.options.url_root)}};case"newTab":return{expand:"fa fa-external-link",compress:"fa fa-compress",expTitle:t.newTab,compTitle:t.back,action:function(){window.open(smap.cmd.createParams(e.options.url_root))}};case"full":return{expand:"fa fa-expand",compress:"fa fa-compress",expTitle:t.fullExp,compTitle:t.reset,action:function(){var e=document.getElementById("body");screenfull.enabled&&screenfull.toggle(e)}}}},_lang:{sv:{viewLarge:"Visa större karta",newTab:"Öppna kartan i ny flik",fullExp:"Visa kartan i fullskärm",reset:"Återställ",back:"Tillbaka",notAllowed:"Helskärmsläge stöds eller tillåts inte av din webläsare. Funktionen kommer inte vara tillgänglig"},en:{viewLarge:"Show larger map",newTab:"Open map in new tab",fullExp:"Show in fullscreen",reset:"Reset",back:"Go back",notAllowed:"Fullscreen mode not supported/allowed by your browser. Feature will not be available."}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e;var t=this;return this._container=L.DomUtil.create("div","leaflet-control-fullScreen"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),"full"===this.options.mode?this._enableIframeFullscreen()&&screenfull.enabled&&(this._createBtn(),document.addEventListener(screenfull.raw.fullscreenchange,function(){t._updateButton()})):this._createBtn(),this._container},activate:function(){this._properties().action()},_enableIframeFullscreen:function(){if(self===top)return!0;try{var e=window.parent.document.getElementsByTagName("iframe")[0];return e.setAttribute("allowfullscreen",""),!0}catch(t){return!1}},_updateButton:function(){var e=$("#smap-fullscreen-btn"),t=this._properties();screenfull.isFullscreen?(e.find("span").removeClass(t.expand).addClass(t.compress),e.attr("data-original-title",t.compTitle)):(e.find("span").removeClass(t.compress).addClass(t.expand),e.attr("data-original-title",t.expTitle)),e.blur()},onRemove:function(){},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-fullscreen-btn" title="'+e._properties().expTitle+'" class="btn btn-default"><span class="'+e._properties().expand+'"></span></button>'),this.$btn.on("click",function(){return e.activate(),!1}),this.$container.append(this.$btn)}}),L.control.fullScreen=function(e){return new L.Control.FullScreen(e)},L.Control.GuideIntroScreen=L.Control.extend({options:{autoActivate:!0,position:"bottomright",prefix:"",bgSrc:null,langs:{sv:"Svenska",en:"English"},words:{sv:{btnStartTour:"Starta turen"},en:{btnStartTour:"Start the tour"}},header:{sv:{title:"Promenadstaden",subHeaders:["Malmö museer, Science Center"]},en:{title:"The walking city",subHeaders:["Malmö museums, Science Center"]}},configs:[{configName:"guide-industri.js",disabledText:!1,sv:{title:"Industristaden",description:"Industrispåret guidar dig genom de gamla industrierna i Malmös innerstad."},en:{title:"The industrial city",description:"This tour guides you to some old industrial buildings of Malmö"}},{configName:"guide-vh.js",disabledText:!1,sv:{title:"Västra hamnen",description:"Västra hamnen guidar dig genom Malmös modernaste och fräsigaste stadsdel."},en:{title:"Western harbor",description:"This tour guides you through the most modern part of Malmö."}}]},initialize:function(e){L.setOptions(this,e)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-guideintroscreen"),L.DomEvent.disableClickPropagation(this._container);var t=this._makeContent("sv"),n=$('<div class="guide-introscreen" />');return n.append(t),this.options.euLogoSrc&&n.append('<img class="gintro-eulogo" src="'+this.options.euLogoSrc+'"></img>'),this.options.bgSrc&&n.prepend('<img class="gintro-bg gintro-bg-left" src="'+this.options.bgSrc+'"></img><img class="gintro-bg gintro-bg-right" src="'+this.options.bgSrc+'"></img>'),this.$container=n,this._container},onRemove:function(){this.deactivate(),this.$container.remove()},activate:function(){$("#maindiv").append(this.$container),$("#mapdiv").hide()},deactivate:function(){this.$container.detach(),$("#mapdiv").show()},_makeContent:function(e){for(var t=$('<div class="guide-content container" />'),n=this.options.words[e],a=this,o=function(){smap.cmd.loading(!0);var e=$(this).data("configName");return smap.map.removeControl(a),smap.cmd.reloadCore({params:{CONFIG:e}}),!1},i=this.options.header[e],r="",s=0,l=i.subHeaders.length;l>s;s++)r+='<p class="lead">'+i.subHeaders[s]+"</p>";var p=$('<div class="container" id="gintro-logo-container"></div>');this.options.munLogoSrc&&p.append('<img class="gintro-munlogo" src="'+this.options.munLogoSrc+'"></img>');var c,d='<div class="container"><h1 style="margin-bottom:20px;">'+i.title+"</h1>"+r+"</div>",h="btn-danger",u=this.options.langs,m="",f=$('<div style="margin-top:30px;" class="btn-group" />');for(var g in u)m=u[g],c=$('<button type="button" class="guideintro-btn-option btn btn-default">'+m+"</button>"),g===e&&c.addClass(h),c.data("langCode",g),f.append(c);t.append(d),p.children().length&&t.append(p),t.append(f);var _,v,y,b,L=this.options.configs,w=$('<div class="row" />');t.append(w);for(var s=0,l=L.length;l>s;s++){if(_=L[s],b=_.configName,v=_[e],y=$('<div class="gintro-box col-xs-6 col-md-4 col-lg-3 text-left"><h3>'+v.title+'</h3><div style="margin-bottom:20px;"><p class="lead text-muted">'+v.description+'</p><button class="btn btn-default btn-sm gintro-btn-configoption">'+n.btnStartTour+"</button></div></div>"),_.disabledText){var C=$('<div class="gintro-disbox"><label>'+_.disabledText+"</label></div>");y.find("div").append(C),y.find("button").addClass("disabled"),y.addClass("disabled")}y.addClass("col-xs-offset-3 col-md-offset-1 col-lg-offset-1");var k=y.find("button");k.data("configName",b),w.append(y)}return t.find(".guideintro-btn-option").on("click",function(){var t=$(this).data("langCode");if(e!==t){$(this).addClass(h).siblings().removeClass(h).addClass("btn-default");var n=a._makeContent(t).children();$(".guide-content").empty().append(n)}return!1}),t.find(".gintro-btn-configoption").on("click",o),t}}),L.control.guideIntroScreen=function(e){return new L.Control.GuideIntroScreen(e)},L.Control.Geolocate=L.Control.extend({options:{position:"bottomright",locateOptions:{maxZoom:17,enableHighAccuracy:!0}},_lang:{sv:{errorGeolocate:"Kunde inte hitta din position. Position / gps är inte aktiverad",notSupported:"Din webbläsare stödjer inte geolokalisering"},en:{errorGeolocate:"The browser could not detect your position",notSupported:"Your browser does not support geolocation"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Geolocate"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawButton(),this._container},onRemove:function(){},_drawButton:function(){var e=$('<button id="smap-glocate-btn" class="btn btn-default"><span class="fa fa-location-arrow"></span></button>');this.$container.append(e),this.btn=e,e.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this))},activate:function(){return!this.active&&(navigator.geolocation?(this.active=!0,this.btn.addClass("btn-primary"),smap.cmd.loading(!0),this.__onLocationFound=this.__onLocationFound||$.proxy(this._onLocationFound,this),this.__onLocationError=this.__onLocationError||$.proxy(this._onLocationError,this),this.__onDragStart=this.__onDragStart||$.proxy(this._onDragStart,this),this.map.on("locationfound",this.__onLocationFound),this.map.on("locationerror",this.__onLocationError),this.map.on("dragstart",this.__onDragStart),this.map.on("zoomstart",this.__onDragStart),void this._startLocate(this.options.locateOptions)):(smap.cmd.notify(this.lang.notSupported,"error"),!1))},deactivate:function(){return!!this.active&&(this.active=!1,smap.cmd.loading(!1),this.btn.removeClass("btn-primary"),this.map.off("locationfound",this.__onLocationFound),this.map.off("locationerror",this.__onLocationError),this.map.off("dragstart",this.__onDragStart),this.map.off("zoomstart",this.__onDragStart),this._stopLocate(),void(this.marker&&(this.map.removeLayer(this.marker),this.marker=null)))},_startLocate:function(e){e=e||{};var t={watch:!0,setView:!0,enableHighAccuracy:!1};e=$.extend(t,e),this.map.locate(e)},_stopLocate:function(){this.map.stopLocate()},_onLocationFound:function(e){smap.cmd.loading(!1),this.marker=this.marker||L.userMarker(e.latlng,{pulsing:!0}).addTo(this.map),this.marker.setLatLng(e.latlng),this.marker.setAccuracy(e.accuracy)},_onLocationError:function(e){smap.cmd.loading(!1);var t=smap.cmd.notify(this.lang.errorGeolocate+": "+e.message,"error",{parent:$("body")});t.on("touchstart",function(){$("body").find(".alert").remove()}),this.deactivate()},_onDragStart:function(){this._stopLocate(),this._startLocate({setView:!1})}}),L.control.geolocate=function(e){return new L.Control.Geolocate(e)},L.Control.GuidePopup=L.Control.extend({options:{},initialize:function(e){L.setOptions(this,e),this._setLang()},_lang:{sv:{introHeader:"Info",mediaHeader:"Media",accessHeader:"Tillgänglighet",close:"Stäng",showMore:"Visa mer",clickToSee:"Klicka för mer info",loadingPic:"Hämtar bild",tipClickForFullScreen:"Klicka för fullskärmsbild"},en:{introHeader:"About",mediaHeader:"Media",accessHeader:"Accessibility",close:"Close",showMore:"Read more",loadingPic:"Loading photo",clickToSee:"Click for more info",picFullScreenTitle:"Slideshow",tipClickForFullScreen:"Click for full-screen photo"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-guidepopup"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.__onPopupClick=this.__onPopupClick||$.proxy(this._onPopupClick,this);var t=this;return t._activate(),this._container},onRemove:function(){this._deactivate(),windowWidth<950?this.hideTheTag():this.showTheTag()},_onPopupClick:function(e){var t=$("#gp-btn-show").data("props"),n=this._getFeatureData(t[this.options.attrId]),a=n.tabMedia,o=n.tabIntro;if(o)this.createPopup(t);else if(a&&a instanceof Object){var i,r=this._makeMediaContent(a.mediaType,utils.extractToHtml(a.sources,t).split(","));"image"!==n.mediaType&&(i=utils.extractToHtml(n.fullScreenIntroPic,t)),this.showFullScreen(r,utils.extractToHtml(a.label,t),i)}return($(e.target).hasClass("gp-mediaicons")||$(e.target).parent().hasClass("gp-mediaicons"))&&$('[href="#gp-moreinfo"]').click(),!1},_onPopupOpen:function(e){if(e.popup._source&&e.popup._source.feature){var t=(e.popup._source.feature.layerId,e.popup._source.feature.properties);e.popup.options.autoPanPaddingTopLeft=[0,60],$(".leaflet-popup-content").find(".gp-mediaicons").on("touchstart click",this.__onPopupClick);var n=this._getFeatureData(t[this.options.attrId]);if(n&&n instanceof Object){var a=$('<button style="margin-top:10px;" id="gp-btn-show" class="btn btn-default">'+this.lang.showMore+"</button>");$(".leaflet-popup-content").append(a),a.data("props",t),a.on("touchstart click",this.__onPopupClick),$(".leaflet-popup-content img").on("touchstart click",this.__onPopupClick).css("cursor","pointer").tooltip({title:this.lang.clickToSee})}}},_onPopupClose:function(e){$(e.popup._wrapper).off("touchstart",this.onPopupClick)},_activate:function(){for(var e,t=this,n={audio:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/120-headphones.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})},video:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/46-movie-2.png",iconSize:[20,25],iconAnchor:[10,12],popupAnchor:[0,-9]})},image:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/121-landscape.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})}},n={audio:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/120-headphones.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})},video:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/46-movie-2.png",iconSize:[20,25],iconAnchor:[10,12],popupAnchor:[0,-9]})},image:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/121-landscape.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})}},a=smap.config.ol||[],o=0,i=a.length;i>o;o++)e=a[o].options,e.params&&e.params.q&&(e.pointToLayer=function(e,a){var o=e.properties||{},i=t.options.modalContentOverrides[o[t.options.attrId]]||{};return i.tabMedia,i.iconType&&n[i.iconType]?L.marker(a,n[i.iconType]):L.marker(a)});this.map.on("popupopen",this._onPopupOpen,this),this.map.on("popupclose",this._onPopupClose,this)},_deactivate:function(){this.map.off("popupopen",this.__onPopupOpen),this.map.off("popupclose",this.__onPopupClose)},_makeCarousel:function(e){e=e||[];for(var t,n=$('<div id="guide-carousel" class="carousel slide">'),a=$('<ol class="carousel-indicators" />'),o=$('<div class="carousel-inner" />'),i=$('<a class="left carousel-control" href="#guide-carousel" data-slide="prev"><span class="icon-prev"></span></a><a class="right carousel-control" href="#guide-carousel" data-slide="next"><span class="icon-next"></span></a>'),r=0,s=e.length;s>r;r++)t=e[r],a.append('<li data-target="#guide-carousel" data-slide-to="'+r+'"></li>'),o.append('<div class="item"><img src="'+t+'"></img></div>');return o.find(".item:first").add(a.find("li:first")).addClass("active"),n.append(o),e.length>1&&(n.prepend(a),n.append(i),n.swiperight(function(){$(this).carousel("prev")}).swipeleft(function(){$(this).carousel("next")})),$(document).on("orientationchange",function(){var e=window.innerHeight;$(".gp-fullscreen").height(e)}),n},_makeAudioTag:function(e){e=e||[];for(var t,n,a,o,i=$('<audio controls="controls" />'),r=0,s=e.length;s>r;r++){switch(t=e[r],n=t.substring(t.length-3).toUpperCase()){case"OGG":a="audio/ogg";break;case"MP3":a="audio/mpeg"}o='<source src="'+t+'" type="'+a+'" />',i.append(o)}return i},_makeVideoTag:function(e){e=e||[];var t=$(window).width()-2,n=$(window).height()-65;if(n>t){var a=t;t=n,n=a}n/=2,t/=2;var o,i=e[0];return i.search(/youtu.be|youtube/i)>-1?o=$('<iframe src="'+i+'?rel=0" width="100%" height="80%" frameborder="0" allowfullscreen></iframe>'):i.search(/vimeo.com/i)&&(o=$('<iframe src="'+i+'" width="100%" height="80%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')),o},_makeAccessContent:function(e){var t=this._getFeatureData(e[this.options.attrId]);return utils.extractToHtml(t.tabAccess,e)},_makeMediaList:function(e,t){if(e=e||[],!e.length)return null;var n,a,o,i={image:"fa fa-picture-o fa-lg",audio:"fa fa-volume-up fa-lg",video:"fa fa-film fa-lg"},r=$('<div id="gp-listmoreinfo" class="list-group" />');for(a=0,len=e.length;a<len;a++)n=e[a],(!n.condition||n.condition&&n.condition(t)===!0)&&(o=$('<a href="#" class="list-group-item"><span class="'+i[n.mediaType]+'"></span>&nbsp;&nbsp;&nbsp;'+utils.extractToHtml(n.label,t)+"</a>"),o.data("mediaType",a),r.append(o));return r.children().length?r:null},showFullScreen:function(e,t,n){function a(e){27===e.which&&o()}function o(){return $("body").off("keydown",a),$(".gp-fullscreen").removeClass("gp-fs-visible"),$(".gp-fullscreen").find("audio").each(function(){this.pause&&this.pause()}),setTimeout(function(){$(".gp-fullscreen").empty().remove()},500),!1}var i=$('<div class="gp-fullscreen"></div>');$("body").on("keydown",a);var r=$('<button type="button" class="btn btn-default">Stäng</button>');
r.on("click",function(){return o(),!1});var s="<h1>"+t+"</h1>";if(i.append(s),n){var l=$('<img class="gp-mediapic" src="'+n+'" />');i.append(l)}i.append(e),i.append(r),r.css("z-index",3e3),$("body").append(i),setTimeout(function(){i.addClass("gp-fs-visible")},50)},_makeMediaContent:function(e,t){switch(e.toLowerCase()){case"image":content=this._makeCarousel(t);break;case"audio":content=this._makeAudioTag(t);break;case"video":content=this._makeVideoTag(t)}return content},_getFeatureData:function(e){var t=this.options.modalContentOverrides[e]||{};return $.extend(!0,{},this.options.modalContent||{},t)},createPopup:function(e){function t(){var t,a=$(this).data("mediaType"),i=o.tabMedia[a],r=utils.extractToHtml(i.sources,e),s=n._makeMediaContent(i.mediaType,r.split(","));return"audio"===i.mediaType&&(t=utils.extractToHtml(o.fullScreenIntroPic,e)),n.showFullScreen(s,$(this).text(),t),!1}e=e||{};var n=this,a='<ul class="nav nav-tabs"><li class="active"><a href="#gp-intro" data-toggle="tab">'+this.lang.introHeader+'</a></li><li><a href="#gp-moreinfo" data-toggle="tab">'+this.lang.mediaHeader+'</a></li><li><a href="#gp-access" data-toggle="tab">'+this.lang.accessHeader+'</a></li></ul><div class="tab-content gp-popup"><div class="tab-pane active" id="gp-intro"></div><div class="tab-pane" id="gp-moreinfo"></div><div class="tab-pane" id="gp-access"></div></div>';a=$(a);var o=this._getFeatureData(e[this.options.attrId]),i=this._makeMediaList(o.tabMedia,e);i?a.find("#gp-moreinfo").append(i):a.find('[href="#gp-moreinfo"], #gp-moreinfo').remove();var r=this._makeAccessContent(e);r?a.find("#gp-access").append(r):a.find('[href="#gp-access"], #gp-access').remove();var s=utils.extractToHtml(o.dialogTitle||e[this.options.dialogTitle],e),l='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";if(this.dialog=utils.drawDialog(s,a,l),this.dialog.on("hidden.bs.modal",function(){$(this).empty().remove(),n.dialog=null,delete n.dialog}),this.dialog.attr("id","gp-popup"),this.dialog.find("#gp-listmoreinfo").find(".list-group-item").on("tap click",t),$("body").append(this.dialog),this.dialog.modal(),o.tabIntro){var p=utils.extractToHtml(o.tabIntro,e);if("HTTP"===p.substring(0,4).toUpperCase())this._getData(p,function(){$("#gp-intro").append(utils.extractToHtml($(this).html(),e)),smap.cmd.loading(!1)});else{var c=$("<div />").append(p);c.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"150px"})}),c.find("img").on("click tap",function(){var e=n._makeCarousel([$(this).prop("src")]);n.showFullScreen(e,s)}).prop("title",this.lang.tipClickForFullScreen).tooltip(),$("#gp-intro").append(c)}}},_getData:function(e,t){var n=$("<div />");smap.cmd.loading(!0),e=this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(e):e,n.load(e,t)}}),L.control.guidePopup=function(e){return new L.Control.GuidePopup(e)},L.Control.Helper=L.Control.extend({options:{autoActivate:!1,position:"topright",steps:[{title:"Welcome to Malmö Stadsatlas!",description:'<p>Would you like to take a little tour?</p><div class="smap-helper-button-group smap-helper-tour-or-not" style="text-align: left; font-size:1.5em;"><div class="smap-helper-button"><i class="fa fa-close"></i><span> No</span></div><div class="smap-helper-button" style="margin-left: 10px;"><span>Yes </span><i class="fa fa-check"></i></div></div>',noNav:!0,func:function(){var e=this._$stepContainer.find(".smap-helper-tour-or-not"),t=e.find(".smap-helper-button:eq(0)"),n=e.find(".smap-helper-button:eq(1)"),a=this;t.on("click",function(){return a.deactivate(),!1}),n.on("click",function(){return a.goToNextStep(),!1}),e.addClass("smap-helper-fadein")}},{title:"Toggle button",description:"To hide the switcher you can press this button.",breakPoint:991,bbox:{selector:".lswitch-btnhide",mobileSelector:!1},css:{side:"right"}},{title:"Layer switcher",description:"The layer switcher is not visible from start on mobile devices. Try making the window smaller and notice that the switcher hides. You can then show it by clicking the expand button in the lower left section of the map.",breakPoint:991,bbox:{selector:".lswitch-panel .panel",mobileSelector:"#lswitch-btn"},css:{side:"right",mobileSide:"bottom"},func:function(){}},{title:"Search functionality",description:"The search functionality is vast. You can search for Malmö addresses or a place like Turning Torso, or Zlatans home.",bbox:{selector:"#smap-search-div"},css:{side:"bottom"}},{title:"Tools",description:"These are the basic tools for map navigation",bbox:{selector:".leaflet-bottom.leaflet-right"},css:{side:"top"}},{title:"Masthead",description:"Left",bbox:{selector:"#malmo-masthead"},css:{side:"bottom"}},{title:"Search again",description:"The search functionality is vast. You can search for Malmö addresses or a place like Turning Torso, or Zlatans home.",bbox:{selector:"#smap-search-div"},css:{side:"bottom"}},{title:"That's it",description:'<p>If you have questions, please contact stadsatlas@malmo.se</p><div id="smap-helper-done" class="smap-helper-button" style="font-size:1.5em;"><span>Done </span><i class="fa fa-check"></i></div>',noNav:!0,func:function(){var e=this;$("#smap-helper-done").on("click",function(){return e.deactivate(),!1})}}]},_lang:{sv:{btnLabel:"Hjälp"},en:{btnLabel:"Help"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-helper"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn();var t=this;return this._refresh=function(){setTimeout(function(){t.refresh()},500)},this._container},onRemove:function(){},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-helper-btn" title="'+e.lang.btnLabel+'" class="btn btn-default"><span class="fa fa-question"></span></button>'),this.$btn.on("touchend click",function(){return e.activate(),!1}),this.$container.append(this.$btn)},activate:function(){return this._active&&this._active===!0?this.deactivate():(this._active=!0,this._nbr=0,this._prevNbr=0,this._drawBasic(),this._bindEvents(),this.goToStep(1),$(this._bgCanvas).addClass("smap-helper-fadein"),void $(window).on("resize",this._refresh))},deactivate:function(){if(this._active===!1)return!1;this._active=!1;var e=this;this._$btnClose.remove(),this._$btnClose=null,this._$clickTip.popover("destroy"),this._$clickTip.empty().remove(),this._$clickTip=null,e._$stepContainer.empty().remove(),e._$stepContainer=null,$(this._bgCanvas).removeClass("smap-helper-fadein"),setTimeout(function(){$(e._bgCanvas).remove(),e._bgCanvas=null},300),$(window).off("resize",this._refresh),this._unbindEvents()},_unbindEvents:function(){$("body").off("keydown",this.onKeyDown)},_bindEvents:function(){var e=this;this._$clickTip.find(".smap-helper-button").on("tap click",function(){var t=$(this).index();switch(t){case 0:e.goToPrevStep();break;case 1:e.goToNextStep()}return!1}),this.onKeyDown=function(t){switch(t.which){case 27:e.deactivate();break;case 37:e.goToPrevStep();break;case 38:e.goToPrevStep();break;case 39:e.goToNextStep();break;case 40:e.goToNextStep()}return!1},$("body").on("keydown",this.onKeyDown)},_drawBasic:function(){if(this._$stepContainer)return!1;var e=this;this._$btnClose=$('<div class="smap-helper-btnclose"><i class="fa fa-close"></i></div>'),$("#maindiv").append(this._$btnClose),this._$btnClose.on("tap click",function(){return e.deactivate(),!1}),this._$stepContainer=$('<div class="smap-helper-stepcont"><div class="smap-helper-steptitle"><span>The title</span></div><div class="smap-helper-stepdescription">The description</div></div>'),this._$clickTip=$('<div class="smap-helper-button-group smap-helper-clicktip"><div class="smap-helper-button smap-helper-button-icon-effect"><i class="fa fa-chevron-left"></i><span> Back</span></div><div class="smap-helper-button smap-helper-button-icon-effect"><span>Next </span><i class="fa fa-chevron-right"></i></div></div>'),$("#mapdiv").append(this._$clickTip);var t='<canvas class="smap-helper-bgcanvas" />';$("#mapdiv").append(this._$stepContainer),$("body").append(t),this._bgCanvas=$(".smap-helper-bgcanvas")[0]},_drawCanvasHole:function(e){var t=this._bgCanvas,n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);var a=$(window).width(),o=$(window).height();if(e){var i=[];if(e instanceof Array)i=e;else if(e.selector){var r=15,s=e.selector,l=$(s),p=l.offset(),c=0,d=0,h=0,u=0;i.push(p.left+c-r-h),i.push(p.top+d-r-u),i.push(p.left+l.width()+c+r-h),i.push(p.top+l.height()+d+r-h)}var m=i[0],f=i[1],g=i[2],_=i[3]}t.width=a,t.height=o,n.moveTo(0,0),n.lineTo(a,0),n.lineTo(a,o),n.lineTo(0,o),n.lineTo(0,0),n.closePath(),e&&(n.moveTo(m,f),n.lineTo(m,_),n.lineTo(g,_),n.lineTo(g,f),n.lineTo(m,f),n.closePath()),n.fillStyle="rgba(0,0,0,0.5)",n.shadowColor="rgba(0,0,0,1)",n.shadowBlur=20,n.fill()},refresh:function(){this.goToStep(this._nbr)},goToStep:function(e){var t=this;if(0>=e)return!1;if(this._prevNbr=this._nbr,this._nbr=e,this._$clickTip.removeClass("smap-helper-fadein"),e>this.options.steps.length)return this.deactivate();var n=this.options.steps[e-1],a=this._$stepContainer.find(".smap-helper-steptitle"),o=this._$stepContainer.find(".smap-helper-stepdescription");a.find("span").empty().html(n.title),o.empty().html(n.description);var i;if(n.bbox&&n.bbox.selector){if(i=n.bbox.selector,n.breakPoint&&$(window).width()<=n.breakPoint&&(i=n.bbox.mobileSelector),i===!1)return this._prevNbr<this._nbr?this.goToNextStep():this.goToPrevStep();this._$stepContainer.css(n.css.standard?n.css.standard:n.css),n.css.side&&$(document).ready(function(){var e,t,a=n.css.side;n.bbox.breakPoint&&n.css.mobileSide&&$(window).width()<=n.bbox.breakPoint&&(a=n.css.mobileSide),"top"===a?(e="bottom",t=a+"-20px"):"bottom"===a?(e="top",t=a+"+20px"):"left"===a?(e="right",t=a+"-20px"):"right"===a&&(e="left",t=a+"+20px"),$(".smap-helper-stepcont").position({my:e,at:t,of:i,collision:"fit flip"})})}else $(".smap-helper-stepcont").position({my:"center",at:"center",of:"#mapdiv",collision:"fit flip"});n.css&&n.css.standard&&this._$stepContainer.css(n.css.standard),this._drawCanvasHole({selector:i}),this._showHelperTimeout&&clearTimeout(this._showHelperTimeout),n.noNav||($(".smap-helper-clicktip").popover("destroy"),this._$clickTip.show(),this._nbr>=this.options.steps.length?this._$clickTip.find(".smap-helper-button:eq(1)").hide():this._$clickTip.find(".smap-helper-button").show(),this._showHelperTimeout=setTimeout(function(){t._$clickTip.addClass("smap-helper-fadein"),L.Browser.touch||t._helperPopoverShownOnce||(t._helperPopoverShownOnce=!0,$(".smap-helper-clicktip").popover({content:'Tip! Use your keyboards\' arrow keys to navigate through the help section <i class="fa fa-caret-square-o-left"><i class="fa fa-caret-square-o-up"></i><i class="fa fa-caret-square-o-right"><i class="fa fa-caret-square-o-down"></i>',html:!0,placement:"top",trigger:"manual",container:".maindiv"}).popover("show"),$(".smap-helper-clicktip").data("bs.popover").$tip.addClass("smap-helper-popover"))},950)),n.func&&n.func.call(this)},goToPrevStep:function(){this.goToStep(this._nbr-1)},goToNextStep:function(){this.goToStep(this._nbr+1)}}),L.Control.Info=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",logo:"",_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Om kartan",close:"Stäng"},en:{btntitle:"About Map",close:"Close"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-info"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._container},onRemove:function(){},activate:function(){var e=this,t='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>",n='<div><div class="row"><div class="col-xs-12"><div style="clear:both"><a id="omkartalogo" href="http://www.kristianstad.se/"target="_blank" style="position:relative;display:block;height:62px"></a></div></div></div>'+this.lang.bodyContent+'</div><script>document.getElementById("omkartalogo").innerHTML = \''+this.options.logo+"'</script>";e._$dialog||(e._$dialog=utils.drawDialog(e.lang.titleInfo,n,t)),e._$dialog.modal("show")},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-info",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-info-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="fa fa-info"></span></button>');t.on("click",function(){return e.activate(),!1}),this.$container.append(t)}}}),L.control.info=function(e){return new L.Control.Info(e)},L.Control.LayerSwitcher=L.Control.extend({options:{pxDesktop:992,toggleSubLayersOnClick:!1,unfoldOnClick:!0,olFirst:!1,unfoldAll:!1,btnHide:!0,zoomToExtent:!1,catIconClass:"fa fa-chevron-right",showBgLabel:!0,showBgLayer:!0,showOvLabel:!0,showOvLayer:!0,getFitBoundsOptions:function(){var e={paddingTopLeft:[0,0]};return $(".lswitch-panel:visible").length&&(e.paddingTopLeft[0]=330),e}},_lang:{sv:{baselayers:"Bakgrundslager",overlays:"Kartlager",close:"Stäng",hide:"Göm",btnHideTooltip:"Göm lagerväljaren",btnShowTooltip:"Visa lagerväljaren",layerSwitcher:"",btnRemoveLgTooltip:"Släck alla kartlager"},en:{baselayers:"Baselayers",overlays:"Overlays",close:"Close",hide:"Hide",btnHideTooltip:"Hide layer switcher",btnShowTooltip:"Show layer switcher",layerSwitcher:"Layer switcher",btnRemoveLgTooltip:"Remove all overlays"}},showLayer:function(e){return smap.core.layerInst.showLayer(e)},hideLayer:function(e){smap.core.layerInst.hideLayer(e)},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"sv",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.lang)},onAdd:function(e){function t(e){var t=0;$(e).on("touchstart",function(e){t=this.scrollTop+e.originalEvent.touches[0].pageY}),$(e).on("touchmove",function(e){this.scrollTop=t-e.originalEvent.touches[0].pageY})}this.map=e,this._container=L.DomUtil.create("div","leaflet-control-LayerSwitcher"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.__onRowTap=this.__onRowTap||$.proxy(this._onRowTap,this),this.__onHeaderClick=this.__onHeaderClick||$.proxy(this._onHeaderClick,this),this.__onHeaderIconClick=this.__onHeaderIconClick||$.proxy(this._onHeaderIconClick,this),this.__onBtnDialogClick=this.__onBtnDialogClick||$.proxy(this._onBtnDialogClick,this),this.__onLegendEnter=this.__onLegendEnter||$.proxy(this._onLegendEnter,this),this.__onLegendLeave=this.__onLegendLeave||$.proxy(this._onLegendLeave,this);var n=this;if(this._moveWithCursor=function(e){$("body").find(".lswitch-legend-big").length||$("body").append(n._hoverImg),$(".lswitch-legend-big").css({left:e.pageX+10+"px",top:e.pageY-30+"px"})},this._addPanel(),this._addLayers(smap.config.bl,smap.config.ol),this.options.startOpened=!1,this.options.startOpened){var a=$("#lswitch-olcont, #lswitch-blcont");1===this.options.startOpened?a.children(".lswitch-cat").click():2===this.options.startOpened?a.children(".lswitch-cat").next().find(".lswitch-cat").click():this.options.startOpened===!0&&a.find(".lswitch-cat").click()}return this._addBtn(),this._bindEvents(),$("#mapdiv").addClass("lswitch-panelslide"),L.Browser.android&&t($(".lswitch-panel")),this._container},onRemove:function(){},_addLayers:function(e,t){e=e||[],t=t||[];var n;if(e.length>1)for(var a=0,o=e.length;o>a;a++)n=e[a],n.options.isBaseLayer=!0,this._addRow(n);else $(".lswitch-panel-bl").hide();if(t.length>0)for(var a=0,o=t.length;o>a;a++)n=t[a],n.options.isBaseLayer=!1,n.options.showInLayerSwitcher!==!1&&this._addRow(n);else $(".lswitch-panel-ol").hide();e.length<=1&&0===t.length&&$(".lswitch-panel span").css("color","#fff"),this._setSwitcherPosition(),this.__setSwitcherPosition=this.__setSwitcherPosition||$.proxy(this._setSwitcherPosition,this),$(window).on("resize",this.__setSwitcherPosition)},_setSwitcherPosition:function(){var e=0,t=$(".lswitch-panel");t.children().each(function(){e+=$(this).outerHeight()}),e>$("#mapdiv").innerHeight()-utils.rmPx(t.css("padding-top")+20)?t.css("position","absolute"):t.css("position","relative");var n=utils.getBrowser();n.ie&&t.css("position","absolute"),L.Browser.touch||n.ie&&n.ieVersion<=8||this.hidePanel()},_bindEvents:function(){var e=this;$("#mapdiv").on("touchstart click",$.proxy(function(){return $(window).width()<this.options.pxDesktop?(this.hidePanel(),!1):void 0},this));var t=($.proxy(this.showPanel,this),$.proxy(this.hidePanel,this));L.Browser.touch&&$(window).on("orientationchange",function(){e.$panel.is(":visible")&&t()}),this.map.on("layeradd layerremove",function(t){var n=t.layer||{};if(n.options&&!n.options._silent&&n.options.layerId&&!n.feature){var a=n.options.layerId,o=e._makeId(a),i=$("#"+o),r=i.hasClass("active");i.length&&("layeradd"===t.type&&r===!1?e.onRowTap(i):"layerremove"===t.type&&r===!0&&e.onRowTap(i))}}),smap.event.on("smap.core.createparams",function(e,t){var n=smap.core.paramInst.getParams();n.LSW&&(t.lsw=n.LSW)});var n=function(){if($(window).width()>e.options.pxDesktop)return!1;var t=smap.core.paramInst.getParams();t.LSW&&1===parseInt(t.LSW)&&setTimeout(function(){$("#lswitch-btn").trigger("mousedown")},310)};smap.event.on("smap.core.pluginsadded",n)},_addBtn:function(){var e=$('<div id="lswitch-btn"><span class="fa fa-bars fa-2x"></span></div>');$("#mapdiv").prepend(e),e.on("mousedown "+L.DomEvent._touchstart,$.proxy(function(){if(!this._panelIsSliding){var e=$(".lswitch-panel").hasClass("panel-visible");e?this.hidePanel():this.showPanel()}return!1},this)),e.on("dblclick",function(){return!1})},_addPanel:function(){function e(e,t){e.tooltip("destroy"),$(".tooltip").remove(),e.prop("title",t),e.tooltip({placement:"right",text:t,container:"#maindiv"})}var t=this;if(this.$panel=$('<div id="lswitch-panel_unselectable" class="lswitch-panel unselectable" />'),this.$panel.on("swipeleft",$.proxy(function(){this.hidePanel()},this)),this.$panel.on("touchstart",function(){$(this).css("overflow-y","auto")}),this.$list=$('<div class="panel panel-default lswitch-panel-bl"><div id="background_label_id"  class="panel-heading"><span>'+this.lang.baselayers+'</span></div><div id="lswitch-blcont" class="list-group"></div></div><div class="panel panel-default lswitch-panel-ol"><div id="overlays_label_id" class="panel-heading"><span>'+this.lang.overlays+'</span></div><div id="lswitch-olcont" class="list-group"></div></div>'),this.$panel.append(this.$list),this.options.olFirst&&this.options.olFirst===!0&&this.$panel.prepend(this.$panel.find(".lswitch-panel-ol")),this.options.btnHide){var n=$('<button title="'+this.lang.btnHideTooltip+'" type="button" class="lswitch-btnhide btn btn-default"><i class="fa fa-chevron-up"></i></button>'),a=$('<button title="'+this.lang.btnRemoveLgTooltip+'" type="button" class="slack-alla-kartskikt btn btn-default"><i class="fa fa-times"></i></button>');this.$panel.find(".panel-heading:first").append(n),this.$panel.find(".panel-heading:first").append(a),e(n,this.lang.btnHideTooltip),e(a,this.lang.btnRemoveLgTooltip);var o=n.parent().text(),i=!1;n.on("tap click",function(){var n=$(this);if(i)return!1;var a="fa-bars",r=n.find("i");return r.hasClass(a)?(setTimeout(function(){$(".lswitch-panel").removeClass("lswitch-displaynone"),"undefined"!==$(".slack-alla-kartskikt")&&null!==$(".slack-alla-kartskikt")&&$(".slack-alla-kartskikt").length>0?$(".slack-alla-kartskikt")[0].style.display="table-cell":"",n.prev().text(o),$("#overlays_label_id>button").removeClass("lswitch-btnshow"),$("#overlays_label_id>button").addClass("lswitch-btnhide"),r.removeClass(a),r.addClass("fa-chevron-up"),$(".lswitch-panel").removeClass("lswitch-hidden")},1),e(n,t.lang.btnHideTooltip)):(i=!0,r.removeClass("fa-chevron-up"),r.addClass(a),"undefined"!==$(".slack-alla-kartskikt")&&null!==$(".slack-alla-kartskikt")&&$(".slack-alla-kartskikt").length>0?$(".slack-alla-kartskikt")[0].style.display="none":"",$(".lswitch-panel").addClass("lswitch-hidden"),$("#overlays_label_id>button").removeClass("lswitch-btnhide"),$("#overlays_label_id>button").addClass("lswitch-btnshow"),e(n,t.lang.btnShowTooltip),n.prev().text(t.lang.layerSwitcher),setTimeout(function(){$(".lswitch-panel").addClass("lswitch-displaynone"),i=!1},200)),!1}),a.on("tap click",function(){smap.cmd.removeAllMapLayer()})}$("#maindiv").append(this.$panel),"undefined"!=typeof this.options.showOvLabel&&null!==this.options.showOvLabel&&(this.options.showOvLabel||(this.$list.find("#overlays_label_id")[0].style.display="none")),"undefined"!=typeof this.options.showOvLayer&&null!==this.options.showOvLayer&&(this.options.showOvLayer||(this.$list.find("#lswitch-olcont")[0].style.display="none")),"undefined"!=typeof this.options.showBgLabel&&null!==this.options.showBgLabel&&(this.options.showBgLabel||(this.$list.find("#background_label_id")[0].style.display="none")),"undefined"!=typeof this.options.showBgLayer&&null!==this.options.showBgLayer&&(this.options.showBgLayer||(this.$list.find("#lswitch-blcont")[0].style.display="none")),$("#mapdiv").on("touchstart click",$.proxy(function(){if(L.Browser.touch&&$(".lswitch-btnhide.btn.btn-default")&&1===$(".fa.fa-chevron-up").length){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;e<=767&&n.tap()}},n))},showPanel:function(){var e=this;if(this.$panel.show(),this._panelIsSliding)return!1;this._panelIsSliding=!0,$("#lswitch-btn span").removeClass("fa-bars").addClass("fa-chevron-left"),setTimeout(function(){$(".lswitch-panel").addClass("panel-visible")},1),setTimeout(function(){e._panelIsSliding=!1},300),$("#mapdiv").addClass("mapdiv-slidetransition"),$("#maindiv").addClass("lswitcher-slidetransition");this.$panel.outerWidth();$("#lswitch-btn").css({left:$(".lswitch-panel").outerWidth()-3+"px"})},hidePanel:function(){return!this._panelIsSliding&&(this._panelIsSliding=!0,$("#lswitch-btn span").removeClass("fa-chevron-left").addClass("fa-bars"),$("#lswitch-btn").css({left:"0"}),$(".lswitch-panel").removeClass("panel-visible"),$("#maindiv").addClass("lswitch-overflow-hidden"),$("#maindiv").removeClass("lswitcher-slidetransition"),void setTimeout($.proxy(function(){$("#mapdiv").removeClass("mapdiv-slidetransition"),this._panelIsSliding=!1,this.$panel.hide(),$("#maindiv").removeClass("lswitch-overflow-hidden")},this),300))},_setBaseLayer:function(e){var t,n=this.map._layers;for(var a in n)t=n[a],t&&t.options&&t.options.isBaseLayer&&("undefined"==typeof t.options.isMultipleBaseLayer||null===t.options.isMultipleBaseLayer&&t.options.isMultipleBaseLayer!==!0)&&t.options.layerId!==e&&this.hideLayer(t.options.layerId);this.showLayer(e)},_onLegendClick:function(){return $(this).parent().trigger("tap"),!1},_onRowTap:function(e){var t=$(e.target);return t.hasClass("list-group-item")?(this.onRowTap(t),!1):void 0},onRowTap:function(e){var t=e.attr("id"),n=this._unMakeId(t),a=$("#"+t).parents("#lswitch-blcont").length>0;if(a)return $("#lswitch-blcont").find("a.active").removeClass("active"),e.addClass("active"),this._setBaseLayer(n),!1;e.toggleClass("active");var o=e.hasClass("active"),i=e.parents(".lswitch-catcont");i.each(function(){if(o)$(this).prev().addClass("active");else{if($(this).find("a.list-group-item.active").length>0)return!1;$(this).prev().removeClass("active")}});var r,o=e.hasClass("active");if(o){var s=e.data("t")||null;r=this.showLayer(s||n);var l=this.options.getFitBoundsOptions?this.options.getFitBoundsOptions():null;(this.options.zoomToExtent||s&&s.options&&s.options.zoomToExtent)&&!this._sumBounds&&r.getBounds&&($.isEmptyObject(r._layers)?r.once("load",function(e){e.layer._map.fitBounds(r.getBounds(),l)}):this.map.fitBounds(r.getBounds(),l))}else this.map.closePopup(),r=this.hideLayer(n);return r},_makeId:function(e){return"lswitchrow-"+encodeURIComponent(e).replace(/%/g,"--pr--")},_unMakeId:function(e){return decodeURIComponent(e.replace("lswitchrow-","").replace(/--pr--/g,"%"))},_toggleHeader:function(e){e.next().toggleClass("lswitch-catcont-visible"),e.toggleClass("open")},_onHeaderClick:function(e,t){t=t||{};var n=this,a=e.target;a="A"===a.tagName||"SPAN"===a.tagName?$(a).parent():$(a);var o=a.next();if(!this.options.unfoldOnClick||!this.options.unfoldAll&&t.isSubHeader||this._toggleHeader(a),!this.options.toggleSubLayersOnClick&&this.options.unfoldOnClick&&this.options.unfoldAll&&o.find("div.list-group-item").each(function(){h=$(this);var e=a.hasClass("open"),t=h.hasClass("open");e!==t&&n._toggleHeader(h)}),this.options.toggleSubLayersOnClick&&0===a.parents("#lswitch-blcont").length){var i,r,s=a.hasClass("active"),l=a.hasClass("open");this.options.unfoldOnClick&&l===s&&!t.isSubHeader?s=!s:a.toggleClass("active");var p,c;this._sumBounds=null,!this.options.zoomToExtent||s||this._sumBounds||(p=$.Deferred(),p.done(function(){n._sumBounds.isValid()&&n.map.fitBounds(n._sumBounds,n.options.getFitBoundsOptions?n.options.getFitBoundsOptions():null),n._rowCount=null,n._sumBounds=null}),this._rowCount=this._rowCount||o.find("a.list-group-item").length,this._sumBounds=L.latLngBounds([]),c=function(e,t){this._rowCount-=1,this._sumBounds.extend(e.getBounds()),0===this._rowCount&&t.resolve()}),o.children(".list-group-item").each(function(){if(r=$(this),i=r.hasClass("active"),"A"===r[0].tagName&&s===i){var e=n.onRowTap(r);n._sumBounds&&e.getBounds&&($.isEmptyObject(e._layers)===!0?e.once("load",function(){c.call(n,e,p)}):c.call(n,e,p))}else"DIV"===r[0].tagName&&s===i&&n._onHeaderClick({target:r},{isSubHeader:!0})})}return $(window).width()>this.options.pxDesktop?this._setSwitcherPosition():$(".lswitch-panel").css("position","absolute"),!1},_onHeaderIconClick:function(e){var t=$(e.target);return this._toggleHeader(t.parent()),!1},_onBtnDialogClick:function(e){var t=$(e.target).parents(".list-group-item:first").data("t").options,n="",a=t.dialog;("http"===a.substring(0,4)||"//"===a.substring(0,2))&&(n='<div class="modal-body-container"><iframe frameborder="0" scrolling="auto" src="'+a+'" width="100%" height="100%" style="position:absolute;left:0;top:0;margin:0;padding:0;" frameborder="0"></iframe></div>');var o='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>",i=utils.drawDialog(t.displayName,n,o,{});i.addClass("lswitch-dialog"),i.modal("show");var r=$("#mapdiv").height();return r=r>500?500:r,i.find(".modal-body").css({"min-height":r+"px"}),i.on("hidden.bs.modal",function(){$(this).empty().remove()}),!1},_addBtnDialog:function(e){var t=$('<span class="fa fa-info-circle lswitch-btndialog" aria-hidden="true"></span>');t.on("click touchstart",this.__onBtnDialogClick),e.prepend(t)},_addLegend:function(e,t,n){var a=$('<img class="lswitch-legend" src="'+t+'" />');if(this.options.layerInfoConfig){if(L.Browser.touch)var o=$('<div class="layer-info-btn"><span class="glyphicon glyphicon-info-sign"  /></div>');else var o=$('<div class="layer-info-btn"><span class="glyphicon glyphicon-info-sign"  /></div>');n.options.layerInfoConfig=this.options.layerInfoConfig,o.on("tap",$.proxy(function(e){if(e.preventDefault(),n.options){var t="";for(col in n.options.layerInfoConfig){var a=this.options.layerInfoConfig[col],o=function(){return n.options[col]?n.options[col]:""}();if("legend"===col){t+='<div id="postProcessLegendContent" class="row">  </div>';var i=new Image;i.columnNmae=a,i.columnValue=o,i.src=o,window.image_content="",i.onload=function(){this.width<300?window.image_content=$(' <div class="col-xs-12 col-sm-6"><b>'+this.columnNmae+':</b></div> <div  class="col-xs-12 col-sm-6"><img style="max-width:85%;" class="" src="'+this.columnValue+'" /> </div> '):window.image_content=$(' <div class="col-xs-12"><b>'+this.columnNmae+':</b></div> <div  class="col-xs-12"><img class="layerInfoLegend" src="'+this.columnValue+'" /> </div>')}}else t="link"===col?o.length>0?t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a+':</b></div> <div  class="col-xs-12 col-sm-6"><a href='+o+' target="_blank">Mer information</a></div> </div>':t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a+':</b></div> <div  class="col-xs-12 col-sm-6"></div> </div>':"attribution"===col?t+'<div class="row"> <div class="col-xs-12 col-sm-12">'+o+"</div></div>":t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a+':</b></div> <div  class="col-xs-12 col-sm-6">'+o+"</div> </div>"}var e='<button type="button" class="btn btn-default" data-dismiss="modal">Stäng</button>',r=utils.drawDialog("Information för "+n.options.displayName,t,e,null);r.modal("show"),r.on("hidden.bs.modal",function(){document.body.removeChild(this)}),r.on("shown.bs.modal",function(){window.image_content&&$("#postProcessLegendContent")&&$("#postProcessLegendContent").append(window.image_content)})}},n))}a.on("tap",this._onLegendClick),L.Browser.touch?"":a.on("mouseenter",this.__onLegendEnter),L.Browser.touch?"":a.on("mouseleave",this.__onLegendLeave),e.prepend(a),this.options.layerInfoConfig&&e.prepend(o)},_onLegendLeave:function(){$(".lswitch-legend-big").remove(),$(document).off("mousemove",this._moveWithCursor)},_onLegendEnter:function(e){var t=$(e.target),n=t.parent().data("t"),a=n.options.legendBig||n.options.legend;$(".lswitch-legend-big").remove(),delete this._hoverImg;var o=$('<img class="lswitch-legend-big" src="'+a+'" />');this._hoverImg=o,$(document).on("mousemove",this._moveWithCursor)},_addRow:function(e){function t(e,o,r){return d=e[o],p=r.find('.lswitch-cat:has(span:contains("'+d+'"))'),p.length?c=p.next():(p=$('<div class="list-group-item lswitch-cat"><i class="'+n+'"></i><span>'+d+"</span></div>").appendTo(r),c=$('<div class="lswitch-catcont"></div>'),p.after(c),p.on("tap",a.__onHeaderClick),p.find("i").on("tap",a.__onHeaderIconClick)),e.length>o+1?t(e,o+1,c):(c.append(i),!0)}var n=this.options.catIconClass,a=this,o=e.options,i=$('<a class="list-group-item"></a>'),r=$('<div class="displayname-div-lvl1"></div>'),s=$('<div class="displayname-div-lvl2">'+o.displayName+"</div>");r.append(s),i.append(r),i.attr("id",this._makeId(o.layerId)),i.on("tap",this.__onRowTap),s.on("tap",$.proxy(function(e){i.tap(),e.preventDefault()},i)),i.data("t",e),!o.legend&&$(window).width()<this.options.pxDesktop||this._addLegend(i,o.legend,e),o.dialog&&this._addBtnDialog(i,e);var l;if(o.isBaseLayer?(l=$("#lswitch-blcont"),l.is(":visible")||$(".lswitch-panel-bl").show()):(l=$("#lswitch-olcont"),l.is(":visible")||$(".lswitch-panel-ol").show()),o.category){var p,c,d,h=o.category;t(h,0,l)}else l.append(i);return i}}),L.control.layerSwitcher=function(e){return new L.Control.LayerSwitcher(e)},L.Control.MMP=L.Control.extend({options:{position:"bottomright",wsSave:location.protocol+"//gkkundservice.test.malmo.se/KartService.svc/saveGeometry"},_lang:{sv:{btnLabel:"Spara",clickHereToSave:"Klicka här för att spara positionen",dragInfo:'<div style="font-size:1.2em;"><strong style="font-size:1.3em;">Instruktioner</strong><ol style="margin:0;padding-left:1.65em;margin-top:0.5em;"><li>Zooma in i kartan så mycket som möjligt</li><li>Klicka i kartan för att markera platsen för ärendet<br />(pekskärm: peka och håll kvar fingret på en plats)</li></ol></div>',youCanDragMeOrClick:"<strong>Klicka i kartan</strong> igen eller <strong>dra i markören</strong> för att ändra positionen",btnSave:"Bekräfta position",zoomInMore:"Du måste zooma in mer i kartan för att kunna lägga till markör"},en:{btnLabel:"Save",clickHereToSave:"Click here to save new position",dragInfo:"<h1>Instructions</h1><ol><li>Zoom the map as much as possible</li><li>Then click once in the map to set the location of the incident</li></ol>",youCanDragMeOrClick:"Click on the map again or drag the marker to adjust the location",
btnSave:"Confirm position",zoomInMore:"You must zoom the map more before you can add a marker"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-mmp"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._bindEvents(),this._mmpExternalLayers=[],this._container},onRemove:function(){this._unbindEvents(),this.$btn.empty().remove(),this._mmpExternalLayers=null},activateAddMarker:function(){this._editingIsActive=!0,this._createBtn();var e;e=L.Browser.touch?"contextmenu":"click",this.map.on(e,this.onMapClick,this)},deactivateAddMarker:function(){this._editingIsActive=!1;var e;e=L.Browser.touch?"contextmenu":"click",this.map.off(e,this.onMapClick),$("#smap-mmp-btn").empty().remove(),this.$btn=null},onMapClick:function(e){return this.map.getZoom()<this.options.minZoom?void smap.cmd.notify(this.lang.zoomInMore,"error",{fadeOut:5e3}):(this._marker&&(this.map.removeLayer(this._marker),this._marker=null),void this._addMarker(e.latlng))},onHashChange:function(){var e=location.hash.substring(1),t=utils.paramsStringToObject(e,!0);if(t&&t.MMP_DATA){var n=t.MMP_DATA;n=decodeURIComponent(n),this._counterLayerId=this._counterLayerId||0,this._clearExternalData(),this._counterLayerId+=1,this._addExternalData(n,{layerId:"mmp-extlayer-"+this._counterLayerId})}},_bindEvents:function(){var e=this;smap.event.on("smap.core.beforeapplyparams",function(e,t){var n=t.OL||"";n=n.split(","),n.push(t.CATEGORY),n=n.join(","),t.OL=n}),smap.event.on("smap.core.applyparams",function(t,n){n.MMP_EDIT&&"TRUE"===n.MMP_EDIT.toUpperCase()&&e.activateAddMarker();var a=null,o=null;if(n.MMP_XY){var a=n.MMP_XY instanceof Array?n.MMP_XY:n.MMP_XY.split(",");a=$.map(a,function(e){return parseFloat(e)}),o=utils.projectLatLng(L.latLng(a),"EPSG:3008","EPSG:4326",!0,!1)}else this._editingIsActive&&smap.cmd.notify(e.lang.dragInfo,"info");n.MMP_ID&&(e._tempId=n.MMP_ID),o&&e._addMarker(o),e.onHashChange()}),this._onHashChange=$.proxy(this.onHashChange,this),$(window).on("hashchange",this._onHashChange)},_clearExternalData:function(){for(var e=this._mmpExternalLayers,t=0;t<e.length;t++)smap.cmd.hideLayer(e[t]);this._mmpExternalLayers=[]},_addExternalData:function(e,t){t=t||{};var n,a=L.AwesomeMarkers.icon({icon:"warning",markerColor:"black",prefix:"fa"}),o={url:e,init:"L.GeoJSON.WFS",options:$.extend(!0,{layerId:L.stamp(this),displayName:"Incidenter",xhrType:"GET",attribution:"Malmö stad",inputCrs:"EPSG:3008",uniqueKey:"arendeId",selectable:!0,reverseAxis:!1,showInLayerSwitcher:!0,reverseAxisBbox:!0,geomType:"POINT",includeParams:["bbox"],separator:"&",popup:"*",style:{icon:a}},t)},i=smap.cmd.getControl("LayerSwitcher");if(i){var r=i._addRow(o);r.trigger("tap"),n=smap.cmd.getLayer(o.layerId)}else n=smap.cmd.addLayerWithConfig(o);this._mmpExternalLayers.push(n)},_unbindEvents:function(){this.map.off("click",this.onMapClick)},_adaptUrl:function(e){return"localhost"===document.domain?e=e.replace("gkkundservice.test.malmo.se","localhost").replace("kartor.malmo.se","localhost"):"kartor.malmo.se"===document.domain&&(e=e.replace("gkkundservice.test.malmo.se/","kartor.malmo.se/gkkundservicedev/").replace("gkkundservice.malmo.se/","kartor.malmo.se/gkkundservicedev/")),e},_save:function(e){var t=this.options.wsSave;t=this._adaptUrl(t),smap.cmd.loading(!0),$.ajax({url:t,type:"GET",data:e,context:this,dataType:"json",success:function(e){e.success&&JSON.parse(e.success)},error:function(){},complete:function(){smap.cmd.loading(!1)}})},save:function(){var e=utils.projectPoint(this._latLng.lng,this._latLng.lat,"EPSG:4326","EPSG:3008"),t=e[0],n=e[1];this._save({easting:parseInt(t),northing:parseInt(n),tempId:this._tempId||null})},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-mmp-btn" class="btn btn-primary btn-lg hidden"><span class="fa fa-check"></span> '+this.lang.btnSave+"</button>"),this.$btn.on("click",function(t){return t.stopPropagation(),e.save(),!1}),$("#mapdiv").append(this.$btn)},_addMarker:function(e){var t=this;e&&(this._latLng=e);var n=L.AwesomeMarkers.icon({icon:this._editingIsActive?"arrows":"lock",markerColor:"darkred",prefix:"fa",extraClasses:"mmpmarker"}),a=L.marker(e,{draggable:this._editingIsActive||!1,icon:n,zIndexOffset:999});a.on("dragstart",function(e){e.target.closePopup()}),a.on("dragend",function(e){t._latLng=e.target.getLatLng()}),this.map.addLayer(a),a.openPopup(),this._marker=a,this.$btn&&(this.$btn.removeClass("hidden"),$(".alert").remove())}}),L.Control.Add2HomeScreen=L.Control.extend({options:{},initialize:function(e){L.setOptions(this,e),$("body").append('<script src="lib/add-to-homescreen/src/addtohomescreen.js"></script>')},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-add2HomeScreen"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._container},onRemove:function(){}}),L.control.add2HomeScreen=function(e){return new L.Control.Add2HomeScreen(e)},L.Control.Mapillary=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-mapillary"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._container},onRemove:function(){},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-mapillary-btn" title="'+e.lang.exampleLabel+'" class="btn btn-default"><span class="fa fa-expand"></span></button>'),this.$btn.on("click",function(){return e.activate(),!1}),this.$container.append(this.$btn)}}),L.Control.MeasureDraw=L.Control.extend({options:{position:"topright",saveMode:"url",saveWfsUrl:"",saveWfsTypeName:"",layerName:"measurelayer",moreCoordsAsModal:!0,touchShowButtonAsDisabled:!0,stylePolygon:{color:"#0077e2",weight:3},stylePolyline:{color:"#0077e2",weight:9}},_lang:{sv:{btnDisabledBecauseTouch:"Rita & Mät stödjer inte din nuvarande enhet",close:"Stäng",drawTools:"Ritverktyg",draggableMarker:"Markören är dragbar",btnTitle:"Rita & Mät",drawPoint:"Punkt/Koordinater",drawLine:"Linje",drawPolygon:"Yta",drawCircle:"Cirkel",drawRectangle:"Rektangel",circumference:"Omkrets",radius:"Radie",area:"Area",len:"Längd",lenPart:"Sidlängd",easting:"Easting (x/longitud)",northing:"Northing (y/latitud)",clickToAddText:"Klicka för att lägga till text (stäng pratbubblan för att spara)",showMeasures:"Visa mätresultat",remove:"Ta bort",moreCoords:"Fler koordinatsystem",helpTextSavePopup:"Stäng pratbubblan för att spara",handlers:{circle:{tooltip:{start:"Klicka och dra för att rita cirkel."}},marker:{tooltip:{start:"Klicka i kartan för att placera markör."}},polygon:{tooltip:{start:"Klicka för att påbörja yta",cont:"Klicka igen för att fortsätta rita ytan.",end:"Dubbelklicka eller klicka första punkten för att avsluta ytan."}},polyline:{error:"<strong>Error:</strong> linjers kanter kan inte korsa varandra!",tooltip:{start:"Klicka för att påbörja linje.",cont:"Klicka för att fortsätta linje.",end:"Dubbelklicka för att avsluta linje."}},rectangle:{tooltip:{start:"Klicka och dra för att rita rektangel."}},simpleshape:{tooltip:{end:"Släpp musknappen för att avsluta."}}}},en:{btnDisabledBecauseTouch:"Draw & Measure is not supported on your device",close:"Close",drawTools:"Draw tools",draggableMarker:"The marker is draggable",btnTitle:"Draw & Measure",drawPoint:"Point/Coordinates",drawLine:"Line",drawPolygon:"Area",drawCircle:"Circle",drawRectangle:"Rectangle",circumference:"Circumference",radius:"Radius",area:"Area",len:"Length",easting:"Easting (x/longitude)",northing:"Northing (y/latitude)",clickToAddText:"Click to add text",showMeasures:"Show measure results",remove:"Remove",moreCoords:"More projections",helpTextSavePopup:"Close the popup to save"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode),this._tools={},this._setLabels()},_jsonCompressDict:{'"FeatureCollection":':":fc:",'"Feature"':":F:",'"Point"':":P:",'"features":':":fs:",'"type":':":t:",'"geometry":':":g:",'"coordinates":':":c:",'"properties":':":p",'"measure_form"':":m:",'"measure_text"':":mt:"},_compressJson:function(e){var t,n=this._jsonCompressDict;for(var a in n)t=new RegExp(a,"g"),e=e.replace(t,n[a]);return e},_uncompressJson:function(e){var t,n=this._jsonCompressDict;for(var a in n)t=new RegExp(n[a],"g"),e=e.replace(t,a);return e},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-measuredraw"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._proxyListeners(),this._initDraw();var t=L.Browser.touch&&this.options.touchShowButtonAsDisabled;if(!L.Browser.touch||t){var n=this._createBtn();t?(n.prop("disabled",!0),n.prop("title",this.lang.btnDisabledBecauseTouch),n.tooltip({placement:"bottom"})):smap.event.on("smap.core.pluginsadded",function(){$(".leaflet-control-measuredraw .dropdown-toggle").dropdown()})}var a=this;return this.map.on("layeradd",function(){a._layer.bringToFront(),a._layer.setZIndex(1e4),a._layer.eachLayer(function(e){e.options.selectable=!0,e.options.clickable=!1,e.bringToFront&&e.bringToFront(),e.setZIndex&&e.setZIndex(1e4)})}),smap.event.on("smap.core.createparams",$.proxy(this._onCreateParams,this)),smap.event.on("smap.core.applyparams",$.proxy(this._onApplyParams,this)),this._container},_onCreateParams:function(e,t){function n(e){for(var t,a=0,o=e.length;o>a;a++)t=e[a],t instanceof Array?n(t):e[a]=L.Util.formatNum(t,5)}for(var a=t.ol,o=0,i=a.length,r=this.options.layerName;i>o;o++)if(a[o]===r){a.splice(o,1);break}if("url"===this.options.saveMode){var s=[],l=0;if(this._layer.eachLayer(function(e){e._radius&&(e.properties.radius=e.getRadius()),e._popup&&e._popup._isOpen&&(delete t.sel,e.properties.popupIsOpen=!0),e._popup&&e._popup._isOpen?"undefined"!=typeof e.properties&&null!==e.properties&&"undefined"!=typeof e.properties.popupIsOpen&&null!==e.properties.popupIsOpen&&(e.properties.popupIsOpen=!0):"undefined"!=typeof e.properties&&null!==e.properties&&"undefined"!=typeof e.properties.popupIsOpen&&null!==e.properties.popupIsOpen&&(e.properties.popupIsOpen=!1),s.push(e.properties),e.properties&&(l+=1)}),0===l)return!1;for(var p,c,d=this._layer.toGeoJSON(),h=d.features,u=[],o=0,i=h.length;i>o;o++)c=h[o],p=$.extend(!0,{},c),n(p.geometry.coordinates),s[o]&&(p.properties=$.extend({},s[o]),delete p.properties.measure_form,u.push(p));d.features=u;var m=JSON.stringify(d);m=this._compressJson(m);var f=encodeURIComponent(this.options.saveMode+","+m);f=f.replace(/%3A/g,":"),f=f.replace(/%3A/g,":"),t.md=f}},_onApplyParams:function(e,t){if(t.MD){var n=decodeURIComponent(t.MD),a=n.search(","),o=n.substring(0,a),i=n.substring(a+1);if("url"===o){i=this._uncompressJson(i);var r,s=JSON.parse(i),l=L.geoJson(s),c=window.getQueryParameters("hidedrawinfo");if(c.length>0)if("true"===c){if(l&&l._layers)for(key in l._layers)l._layers[key].feature&&l._layers[key].feature.properties&&"undefined"!=typeof l._layers[key].feature.properties.popupIsOpen&&null!==l._layers[key].feature.properties.popupIsOpen&&l._layers[key].feature.properties.popupIsOpen&&(l._layers[key].feature.properties.popupIsOpen=!1)}else if("false"===c&&l&&l._layers){var d=0;for(key in l._layers)l._layers[key].feature&&l._layers[key].feature.properties&&"undefined"!=typeof l._layers[key].feature.properties.popupIsOpen&&null!==l._layers[key].feature.properties.popupIsOpen&&l._layers[key].feature.properties.popupIsOpen&&d++;if(0===d)for(key in l._layers)l._layers[key].feature&&l._layers[key].feature.properties&&("undefined"!=typeof l._layers[key].feature.properties.popupIsOpen&&null!==l._layers[key].feature.properties.popupIsOpen?l._layers[key].feature.properties.popupIsOpen||(l._layers[key].feature.properties.popupIsOpen=!0):l._layers[key].feature.properties.measure_text.length>0&&(l._layers[key].feature.properties.popupIsOpen=!0))}p=this,l.eachLayer(function(e){var t={Point:"marker",LineString:"polyline",Polygon:"polygon"};if("Point"===e.feature.geometry.type){var n=e.feature.geometry.coordinates;r=L.marker([n[1],n[0]]),r.properties=$.extend(!0,{},e.feature.properties)}else r=e;p.onCreated({_silent:!0,layerType:t[e.feature.geometry.type],layer:r})})}}},_proxyListeners:function(){this.__onRowClick=$.proxy(this._onRowClick,this)},onRemove:function(){},readableDistance:function(e,t){t=t||1;var n="m",a=0;if(1===t&&e>=1e3||2===t&&e>=1e5){var o=Math.pow(1e3,t-1);e/=o,e/=1e3,a=3,n="km"}return n=1===t?n:n+t,utils.round(e,a)+" "+n},_renderLabel:function(e,t){this._labels=this._labels||[];var n=utils.createLabel(e,this.readableDistance(t,1),"leaflet-maplabel leaflet-maplabel-small");this._layer.addLayer(n),this._labels.push(n);var a=$(".leaflet-maplabel.leaflet-maplabel-small:last");a.css({"margin-left":-a.width()/2+"px"})},onNodeClick:function(e){this._nodes=this._nodes||[];var t=e.latlng||null,n=this._nodes;if(t&&n.push(t),n.length>1){var a=n.slice(n.length-2),o=utils.getLength(a);if(o<=0)return!1;var i=L.latLng((a[0].lat+a[1].lat)/2,(a[0].lng+a[1].lng)/2);this._renderLabel(i,o)}console.log("node click")},_createCoordsHtml:function(e,t){t=t||!1;var n=utils.projectLatLng(e,"EPSG:4326","EPSG:3006"),a=utils.projectLatLng(e,"EPSG:4326","EPSG:3008"),o=utils.projectLatLng(e,"EPSG:4326","EPSG:3021"),i="",r="",s="";return t||(i=" hidden",r='<div style="margin-bottom:1em;">['+this.lang.draggableMarker+"]</div>",s='<br><button ondrag="return false;" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i>&nbsp;&nbsp;'+this.lang.moreCoords+"</button></div></div>"),html=r+"<div><strong>WGS 84 (EPSG:4326)</strong><br>Lat: &nbsp;"+utils.round(e.lng,5)+"<br>Lon: &nbsp;"+utils.round(e.lat,5)+"<div>"+s,html+="<br><div class='measuredraw-morecoords"+i+"'><strong>Sweref99 TM (EPSG:3006)</strong><br>East: &nbsp;"+utils.round(n.lng)+"<br>North: &nbsp;"+utils.round(n.lat)+"<br><br><strong>Sweref99 13 30 (EPSG:3008)</strong><br>East: &nbsp;"+utils.round(a.lng)+"<br>North: &nbsp;"+utils.round(a.lat)+"<br><br><strong>RT90 2.5 gon V (EPSG:3021)</strong><br>East: &nbsp;"+utils.round(o.lng)+"<br>North: &nbsp;"+utils.round(o.lat)+"</div>",html},_getLabel:function(e){var t;return this._layer.eachLayer(function(n){n._parentFeature&&n._parentFeature===e&&(t=n)}),t},onCreated:function(e){var t=this;this._deactivateAll();var n=e.layerType,a=e.layer;if(a.properties&&a.properties.radius){var o=a.properties;n="circle",a=L.circle(a._latlng,a.properties.radius),a.properties=o}if(a.setStyle)switch(n){case"polyline":a.setStyle(this.options.stylePolyline);break;default:a.setStyle(this.options.stylePolygon)}"marker"===n&&(a.options.draggable=!0,a.on("dragstart",function(e){var t=e.target;t.closePopup()}),a.on("drag",function(e){var n=e.target,a=t._getLabel(n);a.setLatLng(n.getLatLng());var o=t._createCoordsHtml(n.getLatLng());$(a._icon).html(o);var i=$(".alert");if(i.length){var r=smap.cmd.notify(t._createCoordsHtml(n.getLatLng(),!0),"blank");r.addClass("notify-transition notify-visible")}})),this._layer.addLayer(a),a.options.layerId=a._leaflet_id,a.feature&&(a.properties=a.feature.properties||a.properties,delete a.feature),a.properties&&(a.properties.measure_form||a.properties.measure_text)||(a.properties={id:a._leaflet_id,measure_form:'<div class="measuredraw-popup-div-save"><textarea class="form-control" placeholder="'+this.lang.clickToAddText+'" rows="3"></textarea></div>',measure_text:""}),a.properties.id=a._leaflet_id,a._measureDrawFeature=!0,this._layer.fire("load"),a.unbindPopup();var i,r,s,l="";switch(n){case"marker":var p=i=a.getLatLng();l=this._createCoordsHtml(p);break;case"polyline":var c=a.getLatLngs();i=c[parseInt(c.length/2)],r=utils.getLength(c),l=this.lang.len+": &nbsp;"+this.readableDistance(r,1)+"<br>";break;case"polygon":i=a.getBounds().getCenter();var c=a.getLatLngs();c.push(c[0]);var s=L.GeometryUtil.geodesicArea(c);r=utils.getLength(c),l=this.lang.circumference+": &nbsp;"+this.readableDistance(r,1)+"<br>"+this.lang.area+": &nbsp;"+this.readableDistance(s,2);break;case"circle":i=a.getBounds().getCenter();var d=a.getRadius();s=d*d*Math.PI,r=2*d*Math.PI,l=this.lang.circumference+": &nbsp;"+this.readableDistance(r,1)+"<br>"+this.lang.radius+": &nbsp;"+this.readableDistance(d,1)+"<br>"+this.lang.area+": &nbsp;"+this.readableDistance(s,2);break;case"rectangle":i=a.getBounds().getCenter();var c=a.getLatLngs();c.push(c[0]);var s=L.GeometryUtil.geodesicArea(c);r=utils.getLength(c),l=this.lang.circumference+": &nbsp;"+this.readableDistance(r,1)+"<br>"+this.lang.area+": &nbsp;"+this.readableDistance(s,2)}var h=a._leaflet_id,u="measuredrawlabel_"+h+"_",m="leaflet-maplabel "+u;if(L.Browser.touch);else{(e._silent||"rectangle"===n)&&a.getLatLngs&&(this._nodes=[],$.each(a.getLatLngs(),function(e,n){t.onNodeClick({latlng:n})}));var f=utils.createLabel(i,l,m);if(this._layer.addLayer(f),a.on("mouseover",this.onMouseOver),a.on("mouseout",this.onMouseOut),f.options.clickable=!0,"marker"===n){var g=function(){if(t.options.moreCoordsAsModal){var e=t._createCoordsHtml(a.getLatLng(),!0);smap.cmd.notify(e,"blank",{fade:!0})}else{var n=$(this),o=n.parent().parent().parent();o.find(".measuredraw-morecoords").toggleClass("hidden"),n.parent().remove()}return!1},_=function(){var e=$(this);e.find("button").off("click",g).on("click",g)};$(f._icon).on("mouseenter",_),$(f._icon).on("click",function(){return!1})}this._labels=this._labels||[],this._labels.push(f);for(var v=this._labels||[],y=0,b=v.length;b>y;y++)v[y]._parentFeature=a;this._labels=[];var w=$(".leaflet-maplabel:last");"marker"===n&&w.css("transition","none"),w.css({"margin-left":-w.width()/2-15+"px"})}e._silent?a.properties&&a.properties.popupIsOpen&&(delete a.properties.popupIsOpen,this.map.fire("selected",{feature:a,selectedFeatures:[],layer:this._layer})):w&&(w.addClass("leaflet-maplabel-hover"),setTimeout(function(){w.removeClass("leaflet-maplabel-hover")},2e3))},onMouseOver:function(e){var t=$(".measuredrawlabel_"+e.target._leaflet_id+"_");t.addClass("leaflet-maplabel-hover")},onMouseOut:function(e){$(".measuredrawlabel_"+e.target._leaflet_id+"_").removeClass("leaflet-maplabel-hover")},_setLabels:function(){var e=L.drawLocal.draw;$.extend(!0,e.handlers,this.lang.handlers||{})},_selection:function(e){var t,n,a=[smap.cmd.getControl("L.Control.SelectWMS"),smap.cmd.getControl("L.Control.SelectVector")];for(n=0;n<a.length;n++)t=a[n],t&&(e===!0?t.activate():t.deactivate())},_initDraw:function(){this._layer=L.featureGroup(),this._layer.options={layerId:this.options.layerName,popup:"${measure_text}${measure_form}",uniqueKey:"id"},this.map.addLayer(this._layer),this._drawControl=new L.Control.Draw({draw:{marker:!1,polyline:!1,polygon:!1,rectangle:!1,circle:!1},edit:null}),this._onCreated=this._onCreated||$.proxy(this.onCreated,this),this._onNodeClick=this._onNodeClick||$.proxy(this.onNodeClick,this),this._onPopupOpen=this._onPopupOpen||$.proxy(this.onPopupOpen,this),this.map.on("draw:created",this._onCreated);var e=this;e.map.on("click",function(){this._removeAlerts()},this);var t=function(e){this.onNodeClick(e)}.bind(this);this.map.on("draw:drawstart",function(){e._nodes=[],e._selection(!1),e._map.on("draw:vertexchanged",t)}),this.map.on("draw:drawstop",function(n){e._map.off("draw:vertexchanged",t),e._nodes&&_.indexOf(["polygon","rectangle"],n.layerType)>-1&&e._onNodeClick({latlng:e._nodes[0]}),setTimeout(function(){e._selection(!0)},50)}),this.map.on("popupopen",this._onPopupOpen)},_removeFeature:function(e){var t=this;this.map.fire("unselected",{}),this.map._popup&&this.map.closePopup(),this._labels,e.off(),this._layer.eachLayer(function(n){n._parentFeature&&n._parentFeature===e&&(n.off(),t.map.removeLayer(n))}),this._layer.removeLayer(e)},onPopupOpen:function(e){var t=this;this._removeAlerts();var a=e.popup&&e.popup._source?e.popup._source:null;if(a&&a._measureDrawFeature){var o=smap.cmd.getControl("L.Control.SelectWMS");o._dblclickWasRegistered=!0,o&&setTimeout(function(){o._dblclickWasRegistered=!1},400);var r=$(".measuredraw-popup-div-save textarea"),l=window.getQueryParameters("hidedrawdeletebutton");if(l.length>0&&"true"===l?n='<br><br><button style="display:none!important;" class="btn btn-default btn-sm measuredraw-btn-popupremove">'+this.lang.remove+"</button>":n='<br><br><button class="btn btn-default btn-sm measuredraw-btn-popupremove">'+this.lang.remove+"</button>",s=e.popup,i=s.getContent(),-1===i.search("measuredraw-btn-popupremove")&&(i+=n,s.setContent(i),s.update(),r=$(".measuredraw-popup-div-save textarea")),$(".leaflet-popup-content").find(".measuredraw-btn-popupremove").on("click",function(){return t._removeFeature(a),!1}),r.length){r.placeholder(),r.tooltip({placement:"top",title:this.lang.helpTextSavePopup,container:".leaflet-popup",trigger:"manual"}),r.on("keypress",function(){$(".tooltip:visible").length||$(this).tooltip("show")});var p=utils.getBrowser();r.on("focus",function(){$(".measuredraw-btn-popupremove").prop("disabled",!0),(p.ie10||p.ie11)&&$(this).val("")}),this.lang.clickToAddText,r.on("blur",function(){$(".measuredraw-btn-popupremove").prop("disabled",!1),$(this).tooltip("hide");var t=e.popup._source,n=$(this).val();""===n||(t.properties.measure_text=n,t.properties.measure_form="",t.closePopup())})}}},_getDrawToolbar:function(e){var t;for(var n in this._drawControl._toolbars)if(t=this._drawControl._toolbars[n],t&&t._modes&&t._modes[e])return t._modes[e];return null},_deactivateAll:function(){var e=this._tools;for(var t in e)e[t].disable(),this.$container.find(".dropdown-menu li.active").removeClass("active");this._removeAlerts()},_removeAlerts:function(){var e=$(".alert");e.length&&(e.removeClass("notify-visible"),setTimeout(function(){e.remove()},500))},_onRowClick:function(e){var t="li"===e.target.tagName?$(e.target):$(e.target).parents("li"),n=t.data("geomType");return t.hasClass("active")?(t.removeClass("active"),this._tools[n].disable()):(this._deactivateAll(),t.toggleClass("active"),this._tools[n].enable(),setTimeout(function(){$(".leaflet-control-measuredraw .dropdown-menu").dropdown("toggle")},200)),!1},_createRow:function(e){var t="";"marker"==e.geomType&&(t='id="drawMarker"');var n=$("<li><a "+t+'><div><span class="drawicons '+e.cl+'"></span><span>'+e.label+"</span></div></a></li>");n.data("geomType",e.geomType),n.on("click",this.__onRowClick);var a=L.Draw[utils.capitalize(e.geomType)],o=new a(this.map,this._drawControl.options.draw[e.geomType]);o.options.shapeOptions=o.options.shapeOptions||{};var i={};switch(e.geomType){case"polyline":i=this.options.stylePolyline;break;default:i=this.options.stylePolygon}return $.extend(o.options.shapeOptions,i),this._tools[e.geomType]=o,n},_createBtn:function(){var e=[{label:this.lang.drawPoint,cl:"leaflet-draw-draw-marker",geomType:"marker"},{label:this.lang.drawLine,cl:"leaflet-draw-draw-polyline",geomType:"polyline"},{label:this.lang.drawPolygon,cl:"leaflet-draw-draw-polygon",geomType:"polygon"},{label:this.lang.drawCircle,cl:"leaflet-draw-draw-circle",geomType:"circle"},{label:this.lang.drawRectangle,cl:"leaflet-draw-draw-rectangle",geomType:"rectangle"}],t=$('<div class="btn-group"><button type="button" title="'+this.lang.btnTitle+'" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><svg class="fa leaflet-draw-draw-marker measuredraw-btntoggle-image" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" y="0" x="0" enable-background="new 0 0 100 100" viewBox="0 0 100 100"><style>.s0{fill:#4d4d4d;}.s1{fill:#666;stroke-width:2;stroke:#fff;}</style><path d="m51.1 28.2-2.8-2.9-18.9-18.8c-1.9-2-5.2-2-7.2 0l-15.7 15.7c-2 2-2 5.2 0 7.2l2.5 2.5 11.5-11.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-11.5 11.5 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8" fill="#4d4d4d"/><path d="m7.5 74.9c-1.4 1.4-2.5 4.1-2.5 6.1v10.5 3.5h14.1c1.9 0 4.7-1.1 6-2.5l68.9-68.9c1.4-1.4 1.4-3.6 0-5l-12.6-12.6c-1.4-1.3-3.7-1.3-5 0.1l-68.9 68.8z" fill="#b3b3b3"/><path d="m71.8 48.9-0.9 0.9-22 22 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8 11.5-11.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-11.5 11.5 2.5 2.5c2 2 5.2 2 7.2 0l15.7-15.7c2-2 2-5.2 0-7.2l-21.7-21.7z" fill="#4d4d4d"/><path d="m79.7 11.4-69.5 68.3" class="s1"/><path d="m84.3 15.9-69.5 68.2" class="s1"/><path d="m88.6 20.6-69.5 68.2" class="s1"/><style xmlns="http://www.w3.org/1999/xhtml" type="text/css" charset="utf-8" class="firebugResetStyles">.firebugResetStyles {z-index: 2147483646 !important;top: 0 !important;left: 0 !important;display: block !important;border: 0 none !important;margin: 0 !important;padding: 0 !important;outline: 0 !important;min-width: 0 !important;max-width: none !important;min-height: 0 !important;max-height: none !important;position: fixed !important;transform: rotate(0deg) !important;transform-origin: 50% 50% !important;border-radius: 0 !important;box-shadow: none !important;background: transparent none !important;pointer-events: none !important;white-space: normal !important;}style.firebugResetStyles {display: none !important;}.firebugBlockBackgroundColor {background-color: transparent !important;}.firebugResetStyles:before, .firebugResetStyles:after {content: &quot;&quot;!important;}.firebugCanvas {display: none !important;}.firebugLayoutBox {width: auto !important;position: static !important;}.firebugLayoutBoxOffset {opacity: 0.8 !important;position: fixed !important;}.firebugLayoutLine {opacity: 0.4 !important;background-color: #000000 !important;}.firebugLayoutLineLeft, .firebugLayoutLineRight {width: 1px !important;height: 100% !important;}.firebugLayoutLineTop, .firebugLayoutLineBottom {width: 100% !important;height: 1px !important;}.firebugLayoutLineTop {margin-top: -1px !important;border-top: 1px solid #999999 !important;}.firebugLayoutLineRight {border-right: 1px solid #999999 !important;}.firebugLayoutLineBottom {border-bottom: 1px solid #999999 !important;}.firebugLayoutLineLeft {margin-left: -1px !important;border-left: 1px solid #999999 !important;}.firebugLayoutBoxParent {border-top: 0 none !important;border-right: 1px dashed #E00 !important;border-bottom: 1px dashed #E00 !important;border-left: 0 none !important;position: fixed !important;width: auto !important;}.firebugRuler{position: absolute !important;}.firebugRulerH {top: -15px !important;left: 0 !important;width: 100% !important;height: 14px !important;background: url(&quot;data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%13%88%00%00%00%0E%08%02%00%00%00L%25a%0A%00%00%00%04gAMA%00%00%D6%D8%D4OX2%00%00%00%19tEXtSoftware%00Adobe%20ImageReadyq%C9e%3C%00%00%04%F8IDATx%DA%EC%DD%D1n%E2%3A%00E%D1%80%F8%FF%EF%E2%AF2%95%D0D4%0E%C1%14%B0%8Fa-%E9%3E%CC%9C%87n%B9%81%A6W0%1C%A6i%9A%E7y%0As8%1CT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AATE9%FE%FCw%3E%9F%AF%2B%2F%BA%97%FDT%1D~K(%5C%9D%D5%EA%1B%5C%86%B5%A9%BDU%B5y%80%ED%AB*%03%FAV9%AB%E1%CEj%E7%82%EF%FB%18%BC%AEJ8%AB%FA&apos;%D2%BEU9%D7U%ECc0%E1%A2r%5DynwVi%CFW%7F%BB%17%7Dy%EACU%CD%0E%F0%FA%3BX%FEbV%FEM%9B%2B%AD%BE%AA%E5%95v%AB%AA%E3E5%DCu%15rV9%07%B5%7F%B5w%FCm%BA%BE%AA%FBY%3D%14%F0%EE%C7%60%0EU%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5JU%88%D3%F5%1F%AE%DF%3B%1B%F2%3E%DAUCNa%F92%D02%AC%7Dm%F9%3A%D4%F2%8B6%AE*%BF%5C%C2Ym~9g5%D0Y%95%17%7C%C8c%B0%7C%18%26%9CU%CD%13i%F7%AA%90%B3Z%7D%95%B4%C7%60%E6E%B5%BC%05%B4%FBY%95U%9E%DB%FD%1C%FC%E0%9F%83%7F%BE%17%7DkjMU%E3%03%AC%7CWj%DF%83%9An%BCG%AE%F1%95%96yQ%0Dq%5Dy%00%3Et%B5&apos;%FC6%5DS%95pV%95%01%81%FF&apos;%07%00%00%00%00%00%00%00%00%00%F8x%C7%F0%BE%9COp%5D%C9%7C%AD%E7%E6%EBV%FB%1E%E0(%07%E5%AC%C6%3A%ABi%9C%8F%C6%0E9%AB%C0&apos;%D2%8E%9F%F99%D0E%B5%99%14%F5%0D%CD%7F%24%C6%DEH%B8%E9rV%DFs%DB%D0%F7%00k%FE%1D%84%84%83J%B8%E3%BA%FB%EF%20%84%1C%D7%AD%B0%8E%D7U%C8Y%05%1E%D4t%EF%AD%95Q%BF8w%BF%E9%0A%BF%EB%03%00%00%00%00%00%00%00%00%00%B8vJ%8E%BB%F5%B1u%8Cx%80%E1o%5E%CA9%AB%CB%CB%8E%03%DF%1D%B7T%25%9C%D5(%EFJM8%AB%CC&apos;%D2%B2*%A4s%E7c6%FB%3E%FA%A2%1E%80~%0E%3E%DA%10x%5D%95Uig%15u%15%ED%7C%14%B6%87%A1%3B%FCo8%A8%D8o%D3%ADO%01%EDx%83%1A~%1B%9FpP%A3%DC%C6&apos;%9C%95gK%00%00%00%00%00%00%00%00%00%20%D9%C9%11%D0%C0%40%AF%3F%EE%EE%92%94%D6%16X%B5%BCMH%15%2F%BF%D4%A7%C87%F1%8E%F2%81%AE%AAvzr%DA2%ABV%17%7C%E63%83%E7I%DC%C6%0Bs%1B%EF6%1E%00%00%00%00%00%00%00%00%00%80cr%9CW%FF%7F%C6%01%0E%F1%CE%A5%84%B3%CA%BC%E0%CB%AA%84%CE%F9%BF)%EC%13%08WU%AE%AB%B1%AE%2BO%EC%8E%CBYe%FE%8CN%ABr%5Dy%60~%CFA%0D%F4%AE%D4%BE%C75%CA%EDVB%EA(%B7%F1%09g%E5%D9%12%00%00%00%00%00%00%00%00%00H%F6%EB%13S%E7y%5E%5E%FB%98%F0%22%D1%B2&apos;%A7%F0%92%B1%BC%24z3%AC%7Dm%60%D5%92%B4%7CEUO%5E%F0%AA*%3BU%B9%AE%3E%A0j%94%07%A0%C7%A0%AB%FD%B5%3F%A0%F7%03T%3Dy%D7%F7%D6%D4%C0%AAU%D2%E6%DFt%3F%A8%CC%AA%F2%86%B9%D7%F5%1F%18%E6%01%F8%CC%D5%9E%F0%F3z%88%AA%90%EF%20%00%00%00%00%00%00%00%00%00%C0%A6%D3%EA%CFi%AFb%2C%7BB%0A%2B%C3%1A%D7%06V%D5%07%A8r%5D%3D%D9%A6%CAu%F5%25%CF%A2%99%97zNX%60%95%AB%5DUZ%D5%FBR%03%AB%1C%D4k%9F%3F%BB%5C%FF%81a%AE%AB&apos;%7F%F3%EA%FE%F3z%94%AA%D8%DF%5B%01%00%00%00%00%00%00%00%00%00%8E%FB%F3%F2%B1%1B%8DWU%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*UiU%C7%BBe%E7%F3%B9%CB%AAJ%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5*%AAj%FD%C6%D4%5Eo%90%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5%86%AF%1B%9F%98%DA%EBm%BBV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%AD%D6%E4%F58%01%00%00%00%00%00%00%00%00%00%00%00%00%00%40%85%7F%02%0C%008%C2%D0H%16j%8FX%00%00%00%00IEND%AEB%60%82&quot;) repeat-x !important;border-top: 1px solid #BBBBBB !important;border-right: 1px dashed #BBBBBB !important;border-bottom: 1px solid #000000 !important;}.firebugRulerV {top: 0 !important;left: -15px !important;width: 14px !important;height: 100% !important;background: url(&quot;data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0E%00%00%13%88%08%02%00%00%00%0E%F5%CB%10%00%00%00%04gAMA%00%00%D6%D8%D4OX2%00%00%00%19tEXtSoftware%00Adobe%20ImageReadyq%C9e%3C%00%00%06~IDATx%DA%EC%DD%D1v%A20%14%40Qt%F1%FF%FF%E4%97%D9%07%3BT%19%92%DC%40(%90%EEy%9A5%CB%B6%E8%F6%9Ac%A4%CC0%84%FF%DC%9E%CF%E7%E3%F1%88%DE4%F8%5D%C7%9F%2F%BA%DD%5E%7FI%7D%F18%DDn%BA%C5%FB%DF%97%BFk%F2%10%FF%FD%B4%F2M%A7%FB%FD%FD%B3%22%07p%8F%3F%AE%E3%F4S%8A%8F%40%EEq%9D%BE8D%F0%0EY%A1Uq%B7%EA%1F%81%88V%E8X%3F%B4%CEy%B7h%D1%A2E%EBohU%FC%D9%AF2fO%8BBeD%BE%F7X%0C%97%A4%D6b7%2Ck%A5%12%E3%9B%60v%B7r%C7%1AI%8C%BD%2B%23r%00c0%B2v%9B%AD%CA%26%0C%1Ek%05A%FD%93%D0%2B%A1u%8B%16-%95q%5Ce%DCSO%8E%E4M%23%8B%F7%C2%FE%40%BB%BD%8C%FC%8A%B5V%EBu%40%F9%3B%A72%FA%AE%8C%D4%01%CC%B5%DA%13%9CB%AB%E2I%18%24%B0n%A9%0CZ*Ce%9C%A22%8E%D8NJ%1E%EB%FF%8F%AE%CAP%19*%C3%BAEKe%AC%D1%AAX%8C*%DEH%8F%C5W%A1e%AD%D4%B7%5C%5B%19%C5%DB%0D%EF%9F%19%1D%7B%5E%86%BD%0C%95%A12%AC%5B*%83%96%CAP%19%F62T%86%CAP%19*%83%96%CA%B8Xe%BC%FE)T%19%A1%17xg%7F%DA%CBP%19*%C3%BA%A52T%86%CAP%19%F62T%86%CA%B0n%A9%0CZ%1DV%C6%3D%F3%FCH%DE%B4%B8~%7F%5CZc%F1%D6%1F%AF%84%F9%0F6%E6%EBVt9%0E~%BEr%AF%23%B0%97%A12T%86%CAP%19%B4T%86%CA%B8Re%D8%CBP%19*%C3%BA%A52huX%19%AE%CA%E5%BC%0C%7B%19*CeX%B7h%A9%0C%95%E1%BC%0C%7B%19*CeX%B7T%06%AD%CB%5E%95%2B%BF.%8F%C5%97%D5%E4%7B%EE%82%D6%FB%CF-%9C%FD%B9%CF%3By%7B%19%F62T%86%CA%B0n%D1R%19*%A3%D3%CA%B0%97%A12T%86uKe%D0%EA%B02*%3F1%99%5DB%2B%A4%B5%F8%3A%7C%BA%2B%8Co%7D%5C%EDe%A8%0C%95a%DDR%19%B4T%C66%82fA%B2%ED%DA%9FC%FC%17GZ%06%C9%E1%B3%E5%2C%1A%9FoiB%EB%96%CA%A0%D5qe4%7B%7D%FD%85%F7%5B%ED_%E0s%07%F0k%951%ECr%0D%B5C%D7-g%D1%A8%0C%EB%96%CA%A0%A52T%C6)*%C3%5E%86%CAP%19%D6-%95A%EB*%95q%F8%BB%E3%F9%AB%F6%E21%ACZ%B7%22%B7%9B%3F%02%85%CB%A2%5B%B7%BA%5E%B7%9C%97%E1%BC%0C%EB%16-%95%A12z%AC%0C%BFc%A22T%86uKe%D0%EA%B02V%DD%AD%8A%2B%8CWhe%5E%AF%CF%F5%3B%26%CE%CBh%5C%19%CE%CB%B0%F3%A4%095%A1%CAP%19*Ce%A8%0C%3BO*Ce%A8%0C%95%A12%3A%AD%8C%0A%82%7B%F0v%1F%2FD%A9%5B%9F%EE%EA%26%AF%03%CA%DF9%7B%19*Ce%A8%0C%95%A12T%86%CA%B8Ze%D8%CBP%19*Ce%A8%0C%95%D1ae%EC%F7%89I%E1%B4%D7M%D7P%8BjU%5C%BB%3E%F2%20%D8%CBP%19*Ce%A8%0C%95%A12T%C6%D5*%C3%5E%86%CAP%19*Ce%B4O%07%7B%F0W%7Bw%1C%7C%1A%8C%B3%3B%D1%EE%AA%5C%D6-%EBV%83%80%5E%D0%CA%10%5CU%2BD%E07YU%86%CAP%19*%E3%9A%95%91%D9%A0%C8%AD%5B%EDv%9E%82%FFKOee%E4%8FUe%A8%0C%95%A12T%C6%1F%A9%8C%C8%3D%5B%A5%15%FD%14%22r%E7B%9F%17l%F8%BF%ED%EAf%2B%7F%CF%ECe%D8%CBP%19*Ce%A8%0C%95%E1%93~%7B%19%F62T%86%CAP%19*Ce%A8%0C%E7%13%DA%CBP%19*Ce%A8%0CZf%8B%16-Z%B4h%D1R%19f%8B%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1%A2%A52%CC%16-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2EKe%98-Z%B4h%D1%A2EKe%D02%5B%B4h%D1%A2EKe%D02%5B%B4h%D1%A2E%8B%96%CA0%5B%B4h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%16-%95a%B6h%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-Z*%C3l%D1%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z%B4T%86%D9%A2E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4h%A9%0C%B3E%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%D1R%19f%8B%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1%A2%A52%CC%16-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2EKe%98-Z%B4h%D1%A2EKe%D02%5B%B4h%D1%A2EKe%D02%5B%B4h%D1%A2E%8B%96%CA0%5B%B4h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%16-%95a%B6h%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-Z*%C3l%D1%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z%B4T%86%D9%A2E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4h%A9%0C%B3E%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%D1R%19f%8B%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1%A2%A52%CC%16-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2EKe%98-Z%B4h%D1%A2EKe%D02%5B%B4h%D1%A2EKe%D02%5B%B4h%D1%A2E%8B%96%CA0%5B%B4h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%16-%95a%B6h%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-Z*%C3l%D1%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z%B4T%86%D9%A2E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4%AE%A4%F5%25%C0%00%DE%BF%5C&apos;%0F%DA%B8q%00%00%00%00IEND%AEB%60%82&quot;) repeat-y !important;border-left: 1px solid #BBBBBB !important;border-right: 1px solid #000000 !important;border-bottom: 1px dashed #BBBBBB !important;}.overflowRulerX &gt;.firebugRulerV {left: 0 !important;}.overflowRulerY &gt;.firebugRulerH {top: 0 !important;}.fbProxyElement {position: fixed !important;pointer-events: auto !important;}</style></svg></button><ul class="dropdown-menu" role="menu"></ul></div>');
utils.getBrowser().ie&&t.find(".measuredraw-btntoggle-image").css({"background-position":"-120px 0"});for(var n,a,o=t.find(".dropdown-menu"),i=0,r=e.length;r>i;i++)a=e[i],n=this._createRow(a),o.append(n);return this.$container.append(t),t}}),L.control.measureDraw=function(e){return new L.Control.MeasureDraw(e)},L.Draw.Polyline.addInitHook(function(){this._vertexChanged=function(e,t){this._updateFinishHandler(),this._updateRunningMeasure(e,t),this._clearGuides(),this._updateTooltip(),this._map.fire("draw:vertexchanged",{latlng:e})}}),L.Control.MalmoHeader=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-MalmoHeader"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container);var t='<!--[if IE]><meta content="IE=edge" http-equiv="X-UA-Compatible" /><![endif]-->    <!--[if lte IE 8]><script src="//assets.malmo.se/external/v4/html5shiv-printshiv.js" type="text/javascript"></script><![endif]-->    <link href="//assets.malmo.se/external/v4/masthead_standalone.css" media="all" rel="stylesheet" type="text/css"/>    <!--[if lte IE 8]><link href="//assets.malmo.se/external/v4/legacy/ie8.css" media="all" rel="stylesheet" type="text/css"/><![endif]-->    <noscript><link href="//assets.malmo.se/external/v4/icons.fallback.css" rel="stylesheet"></noscript>    <link rel="icon" type="image/x-icon" href="//assets.malmo.se/external/v4/favicon.ico" />';return $("head").prepend(t),$("body").addClass("mf-v4 no-footer"),$("body").append('<script src="//assets.malmo.se/external/v4/masthead_standalone_without_jquery.js"></script>'),this._container},onRemove:function(){$("#malmo-masthead").remove()}}),L.control.malmoHeader=function(e){return new L.Control.MalmoHeader(e)},L.Control.KristianstadHeader=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-KristianstadHeader"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container);var t='<!--[if IE]><meta content="IE=edge" http-equiv="X-UA-Compatible" /><![endif]-->    <!--[if lte IE 8]><script src="v4/html5shiv-printshiv.js" type="text/javascript"></script><![endif]-->    <link href="v4/masthead_standalone.css" media="all" rel="stylesheet" type="text/css"/>    <!--[if lte IE 8]><link href="v4/ie8.css" media="all" rel="stylesheet" type="text/css"/><![endif]-->    <noscript><link href="v4/icons.fallback.css" rel="stylesheet"></noscript>    <link rel="icon" type="image/x-icon" href="http://kartor.kristianstad.se/kkarta4/img/favicon.png" />';return $("head").prepend(t),$("body").addClass("mf-v4 no-footer"),$("body").append('<script src="v4/masthead_standalone_without_jquery.js"></script>'),this._container},onRemove:function(){$("#malmo-masthead").remove()}}),L.control.kristianstadHeader=function(e){return new L.Control.KristianstadHeader(e)},L.Control.Menu=L.Control.extend({options:{position:"topright",btnID:"my-btn"},_lang:{sv:{caption:"Exempeltext som jag ändrar"},en:{caption:"Share position link"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Menu"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createMenu();var t="";return this.options.btnID&&(t=this.options.btnID),this.addButton(t,"My button","fa fa-link",function(){return!1}),this._container},addButton:function(e,t,n,a,o){o=o||{};var i=e||"",r=$('<li><a id="'+i+'" href="btn btn-default"><span class="'+n+'"></span> '+t+"</a></li>");o.proxy&&(a=$.proxy(a,o.proxy)),r.on("click",a),$("#btns").append(r),o.callback&&o.callback(r)},_createMenu:function(){var e=$('<header id="smap-menu-div" class="navbar navbar-static-top bs-docs-nav" role="banner"><div class="container"><div class="navbar-header">    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">      <span class="sr-only">Toggle navigation</span>      <span class="fa fa-bars"></span>    </button><a class="navbar-brand" href="#">Stadsatlas</a>  </div>  <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">    <ul id="btns" class="nav navbar-nav navbar-right">    </ul>  </nav></div></header>');$("#maindiv").prepend(e)},onRemove:function(){}}),L.control.menu=function(e){return new L.Control.Menu(e)},L.Control.Opacity=L.Control.extend({options:{position:"bottomright",addToMenu:!1},_lang:{sv:{caption:"Ändra genomskinlighet på lager",close:"Stäng",collapsebtn:"visa/dölj lagerlista",btntitle:"Justera transparens",prefTxt:"Spara inställningar"},en:{caption:"Transparency tool",close:"Close",collapsebtn:"show/hide layers",btntitle:"Adjust transparency",prefTxt:"Save settings"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){var t=this;return t.allNamesInGui=[],e.on("layeradd layerremove",function(e){if(e.layer.options&&e.layer.options.layerId&&!e.layer.feature){var n=e.layer.options.layerId;if(-1==$.inArray(n,t.allNamesInGui))t.allNamesInGui.push(n);else if("layerremove"===e.type){var a=$.inArray(n,t.allNamesInGui);t.allNamesInGui.splice(a,1),$("#op-rowsdiv").find("#"+n).remove()}}}),t._container=L.DomUtil.create("div","leaflet-control-Opacity"),L.DomEvent.disableClickPropagation(t._container),t.$container=$(t._container),t._createBtn(),t._container},_setOp100:function(){if(L.Control.Opacity.prototype.SliderList&&L.Control.Opacity.prototype.SliderList.length>0)for(var e=0;e<L.Control.Opacity.prototype.SliderList.length;e++)L.Control.Opacity.prototype.SliderList[e].slider("setValue",100,!1,!0)},_addLayers:function(e){L.Control.Opacity.prototype.SliderList=[];var t=$("<div class='op-opdiv'><button style='display:none;' id='op-collapsebtn' type='button' class='btn' data-toggle='collapse' data-target='#op-rowsdiv'>"+this.lang.collapsebtn+"</button><div id='op-rowsdiv' class='collapse in'></div></div>"),n=t.children("#op-rowsdiv");return a=0,$.each(e,function(){var e=smap.core.layerInst._getLayer(this);if(null!=e&&"measurelayer"!=e.options.layerId&&("undefined"==typeof e.options.isMultipleBaseLayer||null===e.options.isMultipleBaseLayer&&e.options.isMultipleBaseLayer!==!0)){var t=null!=e.options.opacity?e.options.opacity:1,o=Math.round(100*t),i=$("<div class='op-rows' id='"+e.options.layerId+"' ><span class='op-mapname'>"+e.options.displayName+"</span><input class='op-sliderdiv' data-slider-tooltip='hide'data-slider-id='slider"+a+"' type='text' data-slider-min='0' data-slider-max='100' data-slider-value='"+o+"' data-slider-step='1'/><span class='op-values'>"+o+"</span>"),r=i.children("input").slider();L.Control.Opacity.prototype.SliderList.push(r),r.on("change",function(e){var t=$(this).closest("div.op-rows"),n=t.get(0).id,a=smap.core.layerInst._getLayer(n);if(a&&a.options&&a.options.mergeLayers&&a.options.mergeLayers.length>0&&smap.cmd.mergeLayers&&smap.cmd.mergeLayers.mergeLayers)for(mglg in smap.cmd.mergeLayers.mergeLayers)if(mglg.split("_mergedLayer_")[1]===n){var o=smap.core.layerInst._getLayer(mglg);o.setOpacity?o.setOpacity(e.value.newValue/100):o.options.style&&o.setStyle({opacity:e.value.newValue/100,fillOpacity:e.value.newValue/100}),t.children("span.op-values").text(e.value.newValue)}var o=smap.core.layerInst._getLayer(n);o.setOpacity?o.setOpacity(e.value.newValue/100):o.options.style&&o.setStyle({opacity:e.value.newValue/100,fillOpacity:e.value.newValue/100}),t.children("span.op-values").text(e.value.newValue)}).on("slideStart",function(){$("#op-modal").addClass("op-modal-slideeffect")}).on("slideStop",function(){$("#op-modal").removeClass("op-modal-slideeffect")}),a+=1,n.append(i)}}),t},_onClose:function(){this.options.savePrefBox&&0==$("#op-prefs").is(":checked")&&$.each($("div.op-rows"),function(){smap.core.layerInst._getLayer(this.id).setOpacity?smap.core.layerInst._getLayer(this.id).setOpacity(1):theLyr.options.style&&theLyr.setStyle({opacity:1,fillOpacity:1}),$(this).children("span.op-values").text(100)})},activate:function(){var e=this,t=e._addLayers(e.allNamesInGui);if(!e._$dialog){if(e.options.savePrefBox&&1==e.options.savePrefBox)var n="<div id='op-prefdiv'><label for='op-prefs'>"+e.lang.prefTxt+"</label><input id='op-prefs' type='checkbox'  name='saveprefs' checked /></div><button type='button' class='btn btn-default' data-dismiss='modal'>"+this.lang.close+"</button>";else var n='<button id="_setOP100" class="btn btn-default" onclick="L.Control.Opacity.prototype._setOp100();">Sätt alla på 100</button><button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";e._$dialog=utils.drawDialog(e.lang.caption,t,n),e._$dialog.attr("id","op-modal"),$("#_setOP100").on("click",function(){e._setOp100()}),e._$dialog.on("hidden.bs.modal",function(){e._onClose(),e._$dialog.empty().remove(),e._$dialog=null})}e._$dialog.modal("show"),$(".modal-backdrop.fade.in")&&$(".modal-backdrop.fade.in").length>0&&($(".modal-backdrop.fade.in")[0].style.opacity=0)},_createBtn:function(){var e=this;if(e.options.addToMenu)smap.cmd.addToolButton("","fa fa-adjust",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-opacity-btn" title="'+e.lang.btntitle+'" class="btn btn-default"><span class="fa fa-opacity"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAAXNSR0IArs4c6QAAAHBJREFUKM+VkkEOgCAMBKfEh+nLqi+Tn+EBSCxYgT0BmexuaCWRddUDACoYSeqQLzR4kH0PTEnOxiua212CNx+pwSomNOJ3nOwWRl7Zb9VtgLVjeWtfduvH3HuV0QMcyUMM5q8AqKx/iNdRxYT+bfEDEF4eXRN1RNoAAAAASUVORK5CYII="></span></button>');t.on("click",function(){return e.activate(),!1}),e.$container.append(t)}},onRemove:function(){}}),L.control.opacity=function(e){return new L.Control.Opacity(e)},L.Control.Print=L.Control.extend({options:{position:"topleft",printUrl:"//localhost/print-servlet/print",compactConditions:!1},_lang:{sv:{caption:"Skriv ut",mTitle:"Skriv ut/Exportera",header:"Rubrik",tip_header:"Rubrik (valfritt)",descript:"Beskrivning",tip_descript:"Beskrivning (valfritt)",layout:"Pappersformat",resolution:"Upplösning",orientation:"Orientering",portrait:"Stående",landscape:"Liggande",create:"Skapa bild",close:"Stäng",loading:"Laddar…",processingPrint:"Skapar bild…",northarrow:"Nordpil",scale:"Skala",misc:"Övrigt",legend:"Teckenförklaring",couldNotLoadCapabilities:"Kan inte skriva ut/exportera. Fick inget/felaktigt svar från servern.",conditionsHeader:"Jag godkänner <span>användarvillkoren</span>",conditions:'För utdrag från kartan/flygfotot till tryck eller annan publicering, krävs tillstånd från Kristianstads kommun miljö- och samhällsbyggnadsförvaltningen. Vid frågor om tillstånd, användningsområden eller kartprodukter kontakta miljö- och samhällsbyggnadsförvaltningen kartförsäljning:<br>044-13 50 00 eller <a href="mailto:msf@kristianstad.se?subject=Best%E4lla karta">msf@kristianstad.se</a>.',conditionsTip:"För att kunna skriva ut måste du godkänna användarvillkoren.",confirm:"Kom ihåg mitt val"},en:{caption:"Print",mTitle:"Print/Export",header:"Rubrik",tip_header:"Header (optional)",descript:"Description",tip_descript:"Description (optional)",layout:"Layout",resolution:"Resolution",orientation:"Orientation",portrait:"Portrait",landscape:"landscape",create:"Create image",close:"Close",loading:"Loading…",processingPrint:"Creating image…",northarrow:"North arrow",scale:"Scale",misc:"Miscellaneous",legend:"Legend",couldNotLoadCapabilities:"Cannot print/export. Bad response from the server.",conditionsHeader:"I agree to these <span>terms</span>",conditions:'For excerpts from the map or aerial photo for commercial printing or other types of publication, permission is required from the City Planning Office. For questions about these terms or map products, please contact our sales office: <br> +46 40 34 24 35 or <a href="mailto:sbk.sma@malmo.se?subject=Best%E4lla karta">sbk.sma@malmo.se</a>.',conditionsTip:"To print you must agree to the user terms.",confirm:"Remember my choice"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Print"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._initPrint(),this._drawModal(),this._container},onRemove:function(){this._removeBtn(),this._destroyPrint()},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-print-btn" title="'+e.lang.caption+'" class="btn btn-default"><span class="fa fa-print"></span></button>'),this.$btn.on("click touchstart",function(){return window.printRelatedPopup_closed_once=!1,e.show(),!1}),this.$container.append(this.$btn)},_removeBtn:function(){this.$btn.remove()},_initPrint:function(){function e(){smap.cmd.notify(t.lang.couldNotLoadCapabilities,"error",{parent:$(".modal-body")}),t._modal.off("shown.bs.modal",e)}var t=this;L.mapbox=L.mapbox||{TileLayer:L.Class.extend({})},this.printProvider=L.print.provider({method:"POST",url:this.options.printUrl,autoLoad:!0,copy:"© Geodatasamverkan, © Kristianstads kommun",layout:"A4_Portrait_NoArrow_NoBar",outputFormat:"pdf",map:this.map}),this.printProvider.on("printexception printsuccess",function(){var e=t._modal.find("button[type='submit']");e.button("reset"),smap.cmd.loading(!1)}),this.printProvider.on("oncapabilitiesloaderror",function(){t._modal&&($(".modal-body").length?e():t._modal.on("shown.bs.modal",e))}),this.printOptions={paperFormat:"A4",orientation:"Portrait",arrow:!1,scalebar:!1,dpi:96,legends:[]},this.printProvider.on("capabilitiesload",function(e){e.capabilities.printURL=e.capabilities.printURL.replace(/localhost:8080/g,"localhost").replace(document.domain,"localhost"),e.capabilities.createURL=e.capabilities.createURL.replace(/localhost:8080/g,"localhost").replace(document.domain,"localhost"),L.Control.Print.prototype._savedPrintCapabilities=e.capabilities})},_destroyPrint:function(){this.printProvider.destroy(),this.printProvider=null,this._modal.remove()},_getMercatorScaleForLat:function(){var e=this.map.getCenter().lat,t=this.printProvider._getScale(),n=1/Math.cos(e*Math.PI/180);return t=parseInt(Math.round(t/n))},_makeLegends:function(){var e,t,n,a,o=[],i=this.map._layers;for(lid in i)e=i[lid],a=e.options,!a||void 0!==a.printLegend&&a.printLegend===!1||(a.isBaseLayer?delete a.printLegend:a&&(a.printLegend||e instanceof L.TileLayer.WMS||e instanceof L.GeoJSON.WFS)&&(t=a.printLegend,t&&t.length||(t=-1===e._url.search(/\?/)?e._url+"?":e._url,t=t+"request=GetLegendGraphic&format=image/png&width=20&height=20&layer="+a.layers),t&&(n=a.displayName||"Unnamed layer"),o.push({name:n,icon:t})));var r=[{name:"Teckenförklaring",classes:o}];return r},_preprocessPrintOptions:function(e){var t={mapTitle:e.mapTitle,comment:e.comment,dpi:e.dpi,legends:this._makeLegends(),displayscale:this.lang.scale+" 1:",layout:[e.paperFormat,e.orientation,e.legend?"Legend":"NoLegend"].join("_")};return t},_preprocessLayers:function(){var e,t,n=this.map;for(e in n._layers){var a=n._layers[e];if(a.options&&a.options.layerId){if(t=smap.cmd.getLayerConfig(a.options.layerId),!t)continue;if(a instanceof L.NonTiledLayer.WMS&&!t.options.printLayer){var o=$.extend(!0,{},t.options);o.layerId+="1",t.options.printLayer={url:t.url,init:"L.TileLayer.WMS",options:o},a.options.printLayer=$.extend(!0,{},t.options.printLayer)}}}},print:function(e){if(!this.printProvider._capabilities)return!1;var t=this._modal.find("button[type='submit']");if(t.attr("data-loading-text",this.lang.processingPrint),t.button("loading"),smap.cmd.loading(!0),this._preprocessLayers(),document.getElementById("select_scale")){var n=document.getElementById("select_scale").value;this.options.currentScale=n}this.printProvider.print(e,this.options)},_drawModal:function(){var e=this,t="resources/PrintModal.html";document.URL.search(/\/dev.html/)>-1&&(t="plugins/Print/"+t);var n=L.Browser.touch?"tap":"click";$.get(t,function(t){t=utils.extractToHtml(t,e.lang),e._modal=utils.drawDialog(e.lang.mTitle,t,null,null,"LControlPrint");var a=e._modal.find(".print-conditions");e.conditionsCheckbox=e._modal.find('[name="conditions"]'),e.submitDiv=e._modal.find("#submitDiv");var o=e._modal.find("button[type=submit]"),i=e._modal.find("#conditionsLink span"),r=e._modal.find('[name="storeAnswer"]');if(e.options.compactConditions?("yes"===localStorage.getItem("smapConditionsAgreed")?(e.conditionsCheckbox.prop("checked",!0),r.prop({checked:!0,disabled:!1}),o.prop("disabled",!1)):e.conditionsCheckbox.prop("checked",!1),i.addClass("link"),r.change(function(){e._storeConditions(r.prop("checked"))}),r.next().on(n,function(){var e=$(this).prev();return e.prop("checked",!e.prop("checked")),!1}),a.hide(),i.on(n,function(){a.slideToggle(250)})):(i.append(":"),e._modal.find("#store").hide()),e.conditionsCheckbox.change(function(){e._setButtonState(e.conditionsCheckbox.prop("checked"))}),e.submitDiv.on(n,function(t){e.conditionsCheckbox.prop("checked")||(e.conditionsCheckbox=$("#printmodal").find('[name="conditions"]'),e.conditionsCheckbox.popover({content:e.lang.conditionsTip,trigger:"manual",placement:"right",animation:"false"}),e.conditionsCheckbox.popover("show"),t.stopPropagation(),e._modal.one(n,function(){e.conditionsCheckbox.popover("destroy")}))}),e._modal.attr("id","printmodal"),e._modal.addClass("printmodal"),e._modal.find("form").submit(function(){var t=utils.paramsStringToObject($(this).serialize(),!1);return t=e._preprocessPrintOptions(t),e.printProvider.setDpi(t.dpi),e.print(t),!1}),smap.event.trigger("smap:print:modaldrawn"),e._modal.find("[placeholder]").placeholder(),e.sprint_a3_responsive=e._modal.find("#sprint_a3"),e.sprint_a4_responsive=e._modal.find("#sprint_a4"),e.sprint_a5_responsive=e._modal.find("#sprint_a5"),e.sprint_portrait_responsive=e._modal.find("#sprint_portrait"),e.sprint_landscape_responsive=e._modal.find("#sprint_landscape"),e._print_adjust_selectScale=e._modal.find("#select_scale"),e.sprint_a3_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_a4_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_a5_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_portrait_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_landscape_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e._print_adjust_selectScale.on("change",function(t){if(e._drawCaptureBox(),e._print_scale_header&&e._print_scale_header.options.length>0)for(var t=0;t<e._print_scale_header.options.length;t++)if(e._print_scale_header.options[t].value===e._print_adjust_selectScale[0].value){e._print_scale_header.options[t].selected=!0;break}}),e._modal.on("shown.bs.modal",function(){$("#select_scale_header")?$("#select_scale_header").hide():"",e._drawCaptureBox(),$("#printmodal")[0].style.opacity=1,window._print_scale_header_eventRegistered||$("#select_scale_header").on("change",$.proxy(function(){if(e._print_adjust_selectScale&&e._print_adjust_selectScale[0].options.length>0)for(var t=0;t<e._print_adjust_selectScale[0].options.length;t++)if(e._print_adjust_selectScale[0].options[t].value===e._print_scale_header.value){e._print_adjust_selectScale[0].options[t].selected=!0,e._drawCaptureBox();break}},e._print_scale_header)),window._print_scale_header_eventRegistered=!0,$("#modalDialogMinimizeID_LControlPrint").on("click touchstart",function(){"none"===$(".modal-body")[0].style.display?$("#select_scale_header")[0].style.display="table-row":$("#select_scale_header").hide()})}),e._modal.on("hidden.bs.modal",function(){e._removeCaptureBox(),"undefined"!=typeof window.popup_print&&null!==window.popup_print&&smap.map.removeLayer(window.popup_print),document.getElementById("anvandarvillkoren")&&(document.getElementById("anvandarvillkoren").style.display="table"),document.getElementById("conditions")&&(document.getElementById("conditions").style.display="none")}),e._print_adjust_left=e._modal.find("#print_adjust_left"),e._print_adjust_right=e._modal.find("#print_adjust_right"),e._print_adjust_plus=e._modal.find("#print_adjust_plus"),e._print_adjust_up=e._modal.find("#print_adjust_up"),e._print_adjust_down=e._modal.find("#print_adjust_down"),e._print_adjust_minus=e._modal.find("#print_adjust_minus"),e._print_adjust_left.on(n,function(e){smap.map.panBy([-100,0])}),e._print_adjust_right.on(n,function(e){smap.map.panBy([100,0])}),e._print_adjust_plus.on(n,function(e){$("#zoombar-plus").click()}),e._print_adjust_up.on(n,function(e){smap.map.panBy([0,-100])}),e._print_adjust_down.on(n,function(e){smap.map.panBy([0,100])}),e._print_adjust_minus.on(n,function(e){$("#zoombar-minus").click()}),e._print_minimize_alternative=e._modal.find("#minimize_alternative"),e._print_anvandarvillkoren=e._modal.find("#anvandarvillkoren"),e._print_conditions=e._modal.find("#conditions"),e._print_minimize_alternative.on(n,function(e){var t=L.Browser.touch?"tap":"click";"click"===t?window.setTimeout(function(){$("#modalDialogMinimizeID_LControlPrint").click(),$("#select_scale_header")[0].style.display="table-row"},200):"tap"===t&&window.setTimeout(function(){$("#modalDialogMinimizeID_LControlPrint").tap(),$("#select_scale_header")[0].style.display="table-row"},200)}),e._print_anvandarvillkoren.on(n,function(t){this.style.display="none",e._print_conditions[0].style.display="block"}),smap.map.on("zoomend",function(){if($("#printmodal").hasClass("in")&&document.getElementById("select_scale")){var e=document.getElementById("select_scale").value;0===e.length&&L.Control.Print.prototype._drawCaptureBox()}}),smap.map.on("dragend",function(){$("#printmodal").hasClass("in")&&L.Control.Print.prototype._drawCaptureBox()}),e._print_scale_header=document.createElement("select"),e._print_scale_header.id="select_scale_header",e._print_scale_header.style.width="35px",e._print_scale_header.style.height="32px",e._print_scale_header.style["float"]="right",e._print_scale_header.style.marginTop="-3px",e._print_scale_header.style.marginRight="3px",e._print_scale_header.style.display="table-row",e._print_scale_header.className="form-control",e._print_scale_header.style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAgCAYAAACYTcH3AAADKUlEQVR42s3YXWyLURgH8Ee2LD4yxkRGh4hvG8MYso52QzAShPiKuCCYjwvqgo0gvjLfJhPZDVN2oTapjrDYdJZITElEiMXH3LhAJIi13Szmf97+t7xpYlNtk/ckv3R71/f06TnPOc/ZKyLihlOwC+7AVlgBVbAe1kEN7IWdcJbyYRtUgA2y4Qb7Wc2+DrO/I1DE3zdAGeyHqXAJimEjyCFYDCmQA2NgKMyBETAc5sIEGMcOlPF8r5X3JoGFPw9jX5NgNF8z+Kr6zII0SIRMfqkLwm+rOo9G68EPXw4rYZXOUgbchwEdEA55TpSCGcAp98ALaID38BkaOZVqtE1gjnYwsTCIUz4f1nAEXsM3qIeJkAtX1A07ojhNqsVBX+aWWgTVTPpaeMY8ms4FoWV4VhSDiYdUBnITHsAerqD2YNTo5Kk3l8OSMD8wBrozYWN119W1yXAUnnIbyeMoFfCaCmQm36P9YUiYwZg41LMgWXddJeVJJuxt2MzVM4rT4gkO5jj3h3BaOmyB3dxP+jFpL8JDcMJa7j/tU2fmKCXpp6kwAsFYmHvF3FOs3FlVkjpgGUdP33rDYCZ4RwJnR2CaLNzyS7h0j8EHLle1uXXr4v6OpV0RgQS2MDfUsn0Odaw96hv3+secM7fXpqwIBHMe3nFE1PQcZKGdx3oV38n9HeUgM2gF/E+bwn3kMTziaJ+D08yFhUzUvzWzNiilTWK66pVkF15DdR3sTTIwNVfGsrIXMHf0bMyJzoJRp4TZgs7uO/xS4/KLO1S3/FJ9zSvOki9azenJbT8xSAL/FtNFAtul3C+NVS3yqa5VvofK/Uu+On3y0uGTTWFOc2BpVzbLx9pW+eFpk7ZQ1f+W5rst8qayJbBhhdHStJOeQYLJ1LYCgwRj1fYpgwSjKvt2owRjqAReAKVGCSZJO/oaJJgZsM8owQRqk0GCCdQmgwQTqE2GWtqqUN6LTKGM47konYfyBD4sUGed/rw+jYfyFP6/pK6N5NLOF7tPXjm80uDyydtQIZCGMq88ufxTe8yhPnwRnIAzfEpRwMctGTz4F/FxiY0H+EI+IlGnTdcfGqCd0GGmQbMAAAAASUVORK5CYII=)",e._print_scale_header.style.backgroundRepeat="no-repeat",e._print_modal_header=e._modal.find(".modal-header"),e._print_adjust_selectScale&&e._print_adjust_selectScale[0].options.length>0){for(b=0;b<e._print_adjust_selectScale[0].options.length;b+=1)option=document.createElement("option"),option.value=e._print_adjust_selectScale[0].options[b].value,option.text=e._print_adjust_selectScale[0].options[b].text,e._print_scale_header.appendChild(option);e._print_modal_header[0].appendChild(e._print_scale_header)}})},_setButtonState:function(e){var t=$("#printmodal").find("button[type=submit]"),n=$("#printmodal").find('[name="storeAnswer"]');t.prop("disabled",!e),n.prop({disabled:!e})},_storeConditions:function(e){if("undefined"!=typeof Storage){var t=localStorage.getItem("smapConditionsAgreed");if("yes"===t&&e)return!1;t&&!e?localStorage.removeItem("smapConditionsAgreed"):e&&localStorage.setItem("smapConditionsAgreed","yes")}},_loadCapabilities:function(){},show:function(){var e=this;this.printProvider._capabilities||this._loadCapabilities(),this._modal?this._modal.modal("show"):smap.event.off("smap:print:modaldrawn").on("smap:print:modaldrawn",function(){e._modal.modal("show")})},_drawCaptureBox:function(){this._removeCaptureBox();var _getScale_current=function(){for(var e,t,n=smap.map,a=n.getBounds(),o=1e3*L.print.Provider.INCHES_PER_METER,i=L.Control.Print.prototype._savedPrintCapabilities.scales,r=a.getSouthWest(),s=a.getNorthEast(),l=(r.lat+s.lat)/2,p=L.latLng(l,r.lng),c=L.latLng(l,s.lng),d=p.distanceTo(c),h=n.getSize().x,u=d/h/1e3,m=(u||1e-6)*o*L.print.Provider.DPI,f=Number.POSITIVE_INFINITY,g=i.length;g--;)e=Math.abs(m-i[g].value),e<f&&(f=e,t=parseInt(i[g].value,10));return t},current_mapPrintCapableScale=_getScale_current();if(document.getElementById("select_scale")){var n=document.getElementById("select_scale").value;n.length>0&&(current_mapPrintCapableScale=1.7888404922734575*eval(n))}var center_point_3857=utils.projectLatLng(smap.map.getCenter(),"EPSG:3857"),paperWidth=0,paperHeight=0,layerId="noPrintID";document.getElementById("sprint_a3").checked===!0?document.getElementById("sprint_portrait").checked===!0?(paperWidth=297,paperHeight=420,layerId="A3_Portrait"):document.getElementById("sprint_landscape").checked===!0&&(paperWidth=420,paperHeight=297,layerId="A3_Landscale"):document.getElementById("sprint_a4").checked===!0?document.getElementById("sprint_portrait").checked===!0?(paperWidth=210,paperHeight=297,layerId="A4_Portrait"):document.getElementById("sprint_landscape").checked===!0&&(paperWidth=297,paperHeight=210,layerId="A4_Landscale"):document.getElementById("sprint_a5").checked===!0&&(document.getElementById("sprint_portrait").checked===!0?(paperWidth=148,paperHeight=210,layerId="A5_Portrait"):document.getElementById("sprint_landscape").checked===!0&&(paperWidth=210,paperHeight=148,layerId="A5_Landscale"));var size_width=paperWidth/1e3/2,size_height=paperHeight/1e3/2,offset_height_top=21,offset_width=13.5,offset_width_bottom=20.5,SW_point=utils.projectPoint(center_point_3857.lng-(size_width-offset_width/1e3)*current_mapPrintCapableScale,center_point_3857.lat-(size_height-offset_width_bottom/1e3)*current_mapPrintCapableScale,"EPSG:3857","EPSG:4326"),SW_point_LatLng=L.latLng(SW_point[1],SW_point[0]),NE_point=utils.projectPoint(center_point_3857.lng+(size_width-offset_width/1e3)*current_mapPrintCapableScale,center_point_3857.lat+(size_height-offset_height_top/1e3)*current_mapPrintCapableScale,"EPSG:3857","EPSG:4326"),NE_point_LatLng=L.latLng(NE_point[1],NE_point[0]),bounds=L.latLngBounds(SW_point_LatLng,NE_point_LatLng);L.rectangle(bounds,{color:"#228B22",fillColor:"#90EE90",fillOpacity:.3,weight:7,layerId:layerId,_noprint:!0}).addTo(smap.map),"undefined"!=typeof window.popup_print&&null!==window.popup_print&&smap.map.removeLayer(window.popup_print),window.popup_print=L.popup({keepInView:!1}).setLatLng(smap.map.getCenter()).setContent("<p>Panorera eller zooma in/ut för att ändra utskriftsområde.</p>"),"undefined"!=typeof window.printRelatedPopup_closed_once&&null!==window.printRelatedPopup_closed_once?window.printRelatedPopup_closed_once||(window.popup_print.openOn(smap.map),window.popup_print._wrapper.style.background="rgba(255,255,255,0.2)",window.popup_print._closeButton.onclick=function(){"undefined"!=typeof window.printRelatedPopup_closed_once&&null!==window.printRelatedPopup_closed_once&&(window.printRelatedPopup_closed_once=!0)}):(window.popup_print.openOn(smap.map),window.popup_print._wrapper.style.background="rgba(255,255,255,0.2)",window.popup_print._closeButton.onclick=function(){"undefined"!=typeof window.printRelatedPopup_closed_once&&null!==window.printRelatedPopup_closed_once&&(window.printRelatedPopup_closed_once=!0)});var SW_point_3857=utils.projectPoint(center_point_3857.lng-(size_width-offset_width/1e3)*current_mapPrintCapableScale,center_point_3857.lat-(size_height-offset_width_bottom/1e3)*current_mapPrintCapableScale,"EPSG:3857","EPSG:3857"),NE_point_3857=utils.projectPoint(center_point_3857.lng+(size_width-offset_width/1e3)*current_mapPrintCapableScale,center_point_3857.lat+(size_height-offset_height_top/1e3)*current_mapPrintCapableScale,"EPSG:3857","EPSG:3857");this._drawScaleBar(center_point_3857,SW_point_3857,NE_point_3857)},_drawScaleBar:function(center_point_3857,SW_point_3857,NE_point_3857){var _getScale_current=function(){for(var e,t,n=smap.map,a=n.getBounds(),o=1e3*L.print.Provider.INCHES_PER_METER,i=L.Control.Print.prototype._savedPrintCapabilities.scales,r=a.getSouthWest(),s=a.getNorthEast(),l=(r.lat+s.lat)/2,p=L.latLng(l,r.lng),c=L.latLng(l,s.lng),d=p.distanceTo(c),h=n.getSize().x,u=d/h/1e3,m=(u||1e-6)*o*L.print.Provider.DPI,f=Number.POSITIVE_INFINITY,g=i.length;g--;)e=Math.abs(m-i[g].value),e<f&&(f=e,t=parseInt(i[g].value,10));return t},currentMapScale=null,scaleBarDistanceOnPrint=2,selected_scale=document.getElementById("select_scale").value;selected_scale.length>0?(currentMapScale=1.7888404922734575*eval(selected_scale),scaleBarDistanceOnPrint=currentMapScale<=636.6521476820373?5:currentMapScale>636.6521476820373&&currentMapScale<=1250.2244365318331?10:currentMapScale>1250.2244365318331&&currentMapScale<=2436.050615341822?30:currentMapScale>2436.050615341822&&currentMapScale<=4722.101230683644?50:currentMapScale>4722.101230683644&&currentMapScale<=9244.202461367287?100:currentMapScale>9244.202461367287&&currentMapScale<=18327.759413564592?200:currentMapScale>18327.759413564592&&currentMapScale<=36548.713600294715?500:currentMapScale>36548.713600294715&&currentMapScale<=72799.2160410817?1e3:currentMapScale>72799.2160410817&&currentMapScale<=145448.8697510817?2e3:currentMapScale>145448.8697510817&&currentMapScale<=298897.7395021634?3e3:currentMapScale>298897.7395021634&&currentMapScale<=608474.8567431993?5e3:currentMapScale>608474.8567431993&&currentMapScale<=1216949.7134863986?1e4:currentMapScale>1216949.7134863986&&currentMapScale<=2353901.2158132894?3e4:35e3):(currentMapScale=_getScale_current(),scaleBarDistanceOnPrint=currentMapScale<=400?5:currentMapScale>400&&currentMapScale<=743?10:currentMapScale>743&&currentMapScale<=1450?30:currentMapScale>1450&&currentMapScale<=2750?50:currentMapScale>2750&&currentMapScale<=5300?100:currentMapScale>5300&&currentMapScale<=10422?200:currentMapScale>10422&&currentMapScale<=20652?500:currentMapScale>20652&&currentMapScale<=41005?1e3:currentMapScale>41005&&currentMapScale<=81750?2e3:currentMapScale>81750&&currentMapScale<=171500?3e3:currentMapScale>171500&&currentMapScale<=348970?5e3:currentMapScale>348970&&currentMapScale<=697940?1e4:currentMapScale>697940&&currentMapScale<=1315881?3e4:35e3);var someFactor=0,someFactor_side=0,scaleTextPositionFactor_x=0,scaleTextPositionFactor_y=0;document.getElementById("sprint_a3").checked===!0?(document.getElementById("sprint_portrait").checked===!0?(someFactor=(NE_point_3857[1]-SW_point_3857[1])/27.5,
someFactor_side=someFactor/3.3):document.getElementById("sprint_landscape").checked===!0&&(someFactor=(NE_point_3857[1]-SW_point_3857[1])/18.64,someFactor_side=someFactor/2.8),scaleTextPositionFactor_x=8,scaleTextPositionFactor_y=14):document.getElementById("sprint_a4").checked===!0?(document.getElementById("sprint_portrait").checked===!0?(someFactor=(NE_point_3857[1]-SW_point_3857[1])/65,someFactor_side=someFactor/1.4):document.getElementById("sprint_landscape").checked===!0&&(someFactor=(NE_point_3857[1]-SW_point_3857[1])/46,someFactor_side=someFactor/1.125),scaleTextPositionFactor_x=2,scaleTextPositionFactor_y=8):document.getElementById("sprint_a5").checked===!0&&(document.getElementById("sprint_portrait").checked===!0?(someFactor=-((NE_point_3857[1]-SW_point_3857[1])/55),someFactor_side=Math.abs(someFactor/1.4)):document.getElementById("sprint_landscape").checked===!0&&(someFactor=-((NE_point_3857[1]-SW_point_3857[1])/32),someFactor_side=Math.abs(someFactor/1.125)),scaleTextPositionFactor_x=2,scaleTextPositionFactor_y=8),console.log(NE_point_3857[1]+"_______"+SW_point_3857[1]+"__________"+(NE_point_3857[1]-SW_point_3857[1])+"_________"+someFactor);var scaleBarCenter_x=center_point_3857.lng,scaleBarCenter_y=SW_point_3857[1]+someFactor,scaleBarLeftPoint_x=scaleBarCenter_x-scaleBarDistanceOnPrint/2*1.7888404922734575,scaleBarLeftPoint_y=scaleBarCenter_y,scaleBarRightPoint_x=scaleBarCenter_x+scaleBarDistanceOnPrint/2*1.7888404922734575,scaleBarRightPoint_y=scaleBarCenter_y,scaleBarLeftPoint=utils.projectPoint(scaleBarLeftPoint_x,scaleBarLeftPoint_y,"EPSG:3857","EPSG:4326"),scaleBarLeftPointLatLng=L.latLng(scaleBarLeftPoint[1],scaleBarLeftPoint[0]),scaleBarRightPoint=utils.projectPoint(scaleBarRightPoint_x,scaleBarRightPoint_y,"EPSG:3857","EPSG:4326"),scaleBarRightPointLatLng=L.latLng(scaleBarRightPoint[1],scaleBarRightPoint[0]),scaleBarLeftPointUpp=utils.projectPoint(scaleBarLeftPoint_x,scaleBarLeftPoint_y+someFactor_side,"EPSG:3857","EPSG:4326"),scaleBarLeftPointUppLatLng=L.latLng(scaleBarLeftPointUpp[1],scaleBarLeftPointUpp[0]),scaleBarRightPointUpp=utils.projectPoint(scaleBarRightPoint_x,scaleBarRightPoint_y+someFactor_side,"EPSG:3857","EPSG:4326"),scaleBarRightPointUppLatLng=L.latLng(scaleBarRightPointUpp[1],scaleBarRightPointUpp[0]),scaleBarPoints=[scaleBarLeftPointUppLatLng,scaleBarLeftPointLatLng,scaleBarRightPointLatLng,scaleBarRightPointUppLatLng];"undefined"==typeof L.Control.Print.prototype.scaleBarLayerToPrint&&null==L.Control.Print.prototype.scaleBarLayerToPrint||L.Control.Print.prototype.scaleBarLayerToPrint.clearLayers(),"undefined"!=typeof L.Control.Print.prototype.scaleBarLayerToPrint&&null!==L.Control.Print.prototype.scaleBarLayerToPrint||(L.Control.Print.prototype.scaleBarLayerToPrint=L.layerGroup(),L.Control.Print.prototype.scaleBarLayerToPrint.id="scalebarlayertoprint_id",smap.map.addLayer(L.Control.Print.prototype.scaleBarLayerToPrint));var scaleBarTest=L.polyline(scaleBarPoints,{color:"black",opacity:"1",fillOpacity:"1",lineCap:"square",weight:1}).addTo(L.Control.Print.prototype.scaleBarLayerToPrint),scaleBarText=null;scaleBarText=scaleBarDistanceOnPrint<1e3?scaleBarDistanceOnPrint+"m":scaleBarDistanceOnPrint/1e3+"km";var scaleBarMarkerIcon=L.divIcon({className:"height-div-icon",html:'<p style="position:relative;left:8px;top:-2px;font-size:7pt;font-family:Arial;font-weight:normal;color:black;text-shadow:0 0 5px #fff;"><b>'+scaleBarText+"&nbsp;</b></p>"}),scaleBarMarkerOptions={icon:scaleBarMarkerIcon,clickable:!1,externalGraphic:"http://"+window.location.host+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1)+"img/legend/empty.png",label:scaleBarText,fontColor:"black",fontSize:10.5,fontFamily:"Arial",fontWeight:"normal",labelAlign:"lb"},scaleBarTextPosition=utils.projectPoint(scaleBarLeftPoint_x+Math.abs(someFactor)/scaleTextPositionFactor_x,scaleBarLeftPoint_y+Math.abs(someFactor)/scaleTextPositionFactor_y,"EPSG:3857","EPSG:4326"),scaleBarTextPositionLatLng=L.latLng(scaleBarTextPosition[1],scaleBarTextPosition[0]),scaleBarMarker=L.marker([scaleBarTextPositionLatLng.lat,scaleBarTextPositionLatLng.lng],scaleBarMarkerOptions);scaleBarMarker.addTo(L.Control.Print.prototype.scaleBarLayerToPrint)},_removeCaptureBox:function(){for(v in smap.map._layers)smap.map._layers[v].options&&("A3_Portrait"===smap.map._layers[v].options.layerId||"A3_Landscale"===smap.map._layers[v].options.layerId||"A4_Portrait"===smap.map._layers[v].options.layerId||"A4_Landscale"===smap.map._layers[v].options.layerId||"A5_Portrait"===smap.map._layers[v].options.layerId||"A5_Landscale"===smap.map._layers[v].options.layerId)?smap.map.removeLayer(smap.map._layers[v]):"";"undefined"==typeof L.Control.Print.prototype.scaleBarLayerToPrint&&null==L.Control.Print.prototype.scaleBarLayerToPrint||L.Control.Print.prototype.scaleBarLayerToPrint.clearLayers()},hide:function(){this._modal.modal("hide")}}),L.control.Print=function(e){return new L.Control.Print(e)},L.Control.Printer=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-printer"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._container},onRemove:function(){}}),L.Control.RedirectClick=L.Control.extend({options:{position:"topright"},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this._lang=$.extend(!0,this._lang,this.options._lang),this.lang=this._lang?this._lang[e]:null)},initialize:function(e){this._lang={sv:{},en:{}},L.setOptions(this,e),this._setLang(e.langCode)},_setURL:function(e){var t=this;t.options.url=e?e||t.options.url:null},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-RedirectClick"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createButton(),this._container},addHooks:function(){this.map.on("click",this.onMapClick,this),L.Browser.touch?(this.staticTooltip=$('<div class="rclick-static-tooltip">'+this.lang.hoverText+"</div>"),$("#mapdiv").append(this.staticTooltip)):L.Browser.touch||(this._tooltip={},this._tooltip.text=this.lang.hoverText,this.tooltip=new L.Tooltip(this.map).updateContent(this._tooltip),this.map.on("mousemove mouseup",this._onMouseMove,this))},removeHooks:function(){this.map.off("click",this.onMapClick,this),this.tooltip&&(this.map.off("mousemove mouseup",this._onMouseMove,this),this.tooltip.dispose())},_projectEPSG:function(e){var t=new Proj4js.Proj("EPSG:4326"),n=new Proj4js.Proj("EPSG:3008"),a=(L.Proj,new Proj4js.Point(e.latlng.lng,e.latlng.lat));return Proj4js.transform(t,n,a),e.latlng.lat=a.x,e.latlng.lng=a.y,e},_onMouseMove:function(e){this.tooltip.updatePosition(e.latlng)},onMapClick:function(e){this.onDone(e),this._deactivate()},_createButton:function(){var e=this,t=$('<button title="'+this.lang.name+'" class="btn btn-default"><span class="'+this.options.btnClass+'"></span></button>');t.on("click touchstart",function(){return e.active&&e.active!==!1?(e._deactivate(),$("#mapdiv").focus(),e.active=!1):(e._deactivate(),e._activate(),e.active=!0),!1}),this.$btn=t,e.$container.append(t)},_activate:function(){return!this.active&&(this._deactivateAll(),this.$btn.addClass("active"),this.$btn.blur(),void(this.options.url?(this.removeHooks(),this.addHooks(),$("#mapdiv").css({cursor:this.options.cursor})):(this._deactivate(),$("#mapdiv").focus(),utils.log("RedirectClick error: Redirect URL missing. Check config-file."))))},_deactivate:function(){this.active=!1,this.$btn.removeClass("active"),this.removeHooks(),this.staticTooltip&&this.staticTooltip.remove(),$("#mapdiv").css({cursor:""})},_deactivateAll:function(){for(var e=smap.cmd.getControls("RedirectClick"),t=0;t<e.length;t++)e[t]._deactivate()},onRemove:function(){this.$container.empty(),this.staticTooltip&&this.staticTooltip.remove()},onDone:function(e){var t=this,n=t.options.url,a=new proj4.Proj("EPSG:4326"),o=new proj4.Proj("EPSG:3008"),i={x:e.latlng.lng,y:e.latlng.lat};this.staticTooltip&&this.staticTooltip.remove(),proj4.transform(a,o,i),n=n.replace(/\${x}/g,i.x).replace(/\${y}/g,i.y),window.open(n,this.lang.name)}}),L.control.redirectclick=function(e){return new L.Control.RedirectClick(e)},L.Control.Search=L.Control.extend({options:{whitespace:"%20",wsOrgProj:"EPSG:3006",pxDesktop:992,clearEntryAfterSearch:!1,funcSetPosition:function(){var e=smap.cmd.getControl("L.Control.LayerSwitcher");e||$("#smap-search-div").css("left","10px")},gui:!1,addToMenu:!1,zoom:15,iconOptions:$.extend({},(new L.Icon.Default).options,{iconUrl:L.Icon.Default.imagePath+"/marker-icon.png"}),source:null,acHeight:null,autoScrollAcOnRowNbr:2,acOptions:{items:100}},_lang:{sv:{search:"Sök adress",addressNotFound:"Den sökta adressen hittades inte",remove:"Ta bort"},en:{search:"Search address",addressNotFound:"The searched address was not found",remove:"Remove"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode);var t=this.options.funcSetPosition;t&&smap.event.on("smap.core.pluginsadded",function(){t()})},onAdd:function(e){function t(){this._cacheLayer(l,!1,this.options.wfsSearch),l.off("load",t)}var n=this;if(this.map=e,this._container=L.DomUtil.create("div","leaflet-control-search"),L.DomEvent.disableClickPropagation(this._container),this._searchLayer=L.layerGroup(),L.Control.Search.prototype._searchLayer=this._searchLayer,this.map.addLayer(this._searchLayer),(void 0===this.options.gui||this.options.gui===!0)&&(this.$container=$(this._container),this.$container.css("display","none"),this._makeSearchField(),this.map.on("click",this._blurSearch)),this.options.vectorSearch&&(this._cachedFeatures=this._cachedFeatures||{},this.map.on("layeradd",this._onLayerAdd,this),this.map.on("layerremove",this._onLayerRemove,this)),this.options.wfsSearch){this._cachedFeatures=this._cachedFeatures||{};var a=this.options.wfsSearch;this._setACOptions(a);var o,i;this._wfsLayerGroup=L.layerGroup();for(var r=0,s=a.layerIds.length;s>r;r++)if(o=smap.cmd.getLayerConfig(a.layerIds[r])){i=$.extend(!0,{},o),i.options.layerId+=1;var l=smap.core.layerInst._createLayer(i);this._initVectorSearch(l),this._wfsLayerGroup.addLayer(l),n.map.whenReady(function(){l._map=e,l.on("load",t,n),l._refresh({force:!0,bounds:!1}),l._map=null},1e3)}}return this.__onApplyParams=this.__onApplyParams||$.proxy(this._onApplyParams,this),smap.event.on("smap.core.applyparams",this.__onApplyParams),this.__onCreateParams=this.__onCreateParams||$.proxy(this._onCreateParams,this),smap.event.on("smap.core.createparams",this.__onCreateParams),$(".leaflet-top.leaflet-left").addClass("with-search-bar"),n._container},_blurSearch:function(){$(".smap-search-div input").blur()},onRemove:function(){smap.event.off("smap.core.applyparams",this.__onApplyParams),smap.event.off("smap.core.createparams",this.__onCreateParams),this.map.off("click",this._blurSearch),$(".leaflet-top.leaflet-left").removeClass("with-search-bar")},_onLayerAdd:function(e){var t=e.layer||{};t.options&&!t.options._silent&&t.options.layerId&&!t.feature&&this.options.vectorSearch&&$.inArray(t.options.layerId,this.options.vectorSearch.layerIds)>-1&&(this._setACOptions(this.options.vectorSearch),this._initVectorSearch(t))},_onLayerRemove:function(e){var t=e.layer||{};t.options&&!t.options._silent&&t.options.layerId&&!t.feature&&this.options.vectorSearch&&$.inArray(t.options.layerId,this.options.vectorSearch.layerIds)>-1&&this._cacheLayer(t,!0)},_cacheProperties:function(e,t,n){var a,o,i=[];o=$.extend(!0,{},{name:e[t[0]]}),i=[];for(var r=0,s=t.length;s>r;r++)a=e[t[r]],a&&a.length&&i.push(n[r]+"=="+a);return o.searchWords=i.join("&&"),o},_cacheLayer:function(e,t,n){t=t||!1,n=n||{},this._acVector=this._acVector||[];var a,o,i=[],r=this._cacheProperties,s=n.keyVals,l=this._acVector,p=[],c=[];for(var d in s)p.push(d),c.push(s[d]);e.eachLayer(function(e){a=e.feature.properties,o=r(a,p,c),l.splice(o),t||i.push(o)}),this._acVector=this._acVector.concat(i),$("#smap-search-div input").prop("disabled",!1)},_initVectorSearch:function(e){function t(){this._cacheLayer(e,!1,this.options.vectorSearch),e.off("load",t)}var n=e.options;return!!n&&($("#smap-search-div input").prop("disabled",!0),void($.isEmptyObject(e._layers)?e.on("load",t,this):this._cacheLayer(e,!1,this.options.vectorSearch)))},_setACOptions:function(e){var t=this;for(var n in e.keyVals)break;var a=e.keyVals[n],o=e.suffix,i=this.options.suffix;this.options.typeaheadOptions=$.extend(!0,{},this.options.typeaheadOptions,{source:$.proxy(function(e,t){e=encodeURIComponent(e);var n=this.options.wsAcUrl;n?(this.options.whitespace&&(e=e.replace(/%20/g,this.options.whitespace)),this._proxyInst&&this._proxyInst.abort(),smap.cmd.loading(!0),this._proxyInst=$.ajax({type:"GET",url:this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(n+"?q=")+e:n+"?q="+e,dataType:"text",context:this,success:function(e){for(var n,a=e.split("\n"),o=[],i=0,r=a.length;r>i;i++)n=$.trim(a[i]),n.length&&o.push({name:n,searchWords:"Adress=="+n});o=this._acVector.concat(o),t(o)},error:function(){},complete:function(){smap.cmd.loading(!1)}})):t(this._acVector)},this),displayText:function(e){return e.searchWords},highlighter:function(e){for(var t,n={},a=e.split("&&"),o=0,i=a.length;i>o;o++)t=a[o].split("=="),n[t[0]]=t[1];var r="",o=0;for(var s in n)r+=0===o?'<div style="font-size:1.2em;">'+n[s]+"</div>":"<div><span>"+s+"</span>:&nbsp;<span>"+n[s]+"</span></div>",o++;return r},updater:function(e){for(var t,n={},r=e.searchWords.split("&&"),s=0,l=r.length;l>s;s++)t=r[s].split("=="),n[t[0]]=t[1];return n[a]?e.name+" "+o:e.name+" "+i},afterSelect:function(n){if(t._searchLayer.clearLayers(),t.options.clearEntryAfterSearch&&$(".smap-search-div input").val(null),encodeURIComponent(n).search(encodeURIComponent(i))>-1)n=$.trim(n.replace(i,"")),t._geoLocate(n,"");else if(encodeURIComponent(n).search(encodeURIComponent(o))>-1){n=$.trim(n.replace(o,""));for(var a in e.keyVals)break;var r,s,l,p,c=t.map;for(p in c._layers)if(r=c._layers[p],r._layers)for(l in r._layers)if(s=r._layers[l],s.feature&&s.feature.properties[a]===n){var d;return d=s.getLatLng?s.getLatLng():s.getBounds().getCenter(),c.setView(d,17),void c.fire("selected",{feature:s.feature,selectedFeatures:[s],layer:r,latLng:d,shiftKeyWasPressed:!1})}t._wfsLayerGroup.eachLayer(function(e){e.eachLayer(function(o){if(o.feature&&o.feature.properties[a]===n){t._searchLayer.addLayer(o),this.marker=o;var i;return i=o.getLatLng?o.getLatLng():o.getBounds().getCenter(),c.setView(i,17),void c.fire("selected",{feature:o.feature,selectedFeatures:[o],layer:e,latLng:i,shiftKeyWasPressed:!1})}})})}}});var r=$("#smap-search-div input");r.typeahead("destroy"),this._initAutoComplete(r)},_onApplyParams:function(e,t){if("undefined"!=typeof t.QL&&null!==t.QL&&"undefined"!=typeof t.QA&&null!==t.QA);else if(t.POI){var s=t.POI instanceof Array?t.POI[0]:t.POI;s=s.replace(/--c--/g,",");var o=t.POI instanceof Array&&t.POI.length>1&&t.POI[1],a=!1,r=smap.core.paramInst.getWebParamsAsObject(),n=config.params,i=r.ZOOM||this.options.zoom;r.CENTER||(a=!0,!r.POI&&n.CENTER&&(a=!1,i=t.ZOOM)),this._geoLocate(decodeURIComponent(s),{setView:a,zoom:i,showPopup:o})}else if(t.POIM){var diainfo="";if(t.DIAINFO)try{diainfo=t.DIAINFO instanceof Array?t.DIAINFO:t.DIAINFO,diainfo.length>0&&(diainfo instanceof Array?diainfo=eval(diainfo.join()):(dia_str=eval(diainfo),dia_str instanceof Array&&(diainfo=dia_str)))}catch(e){diainfo=""}var s=t.POIM instanceof Array?t.POIM:t.POIM;if(s instanceof Array){for(var features_all={type:"FeatureCollection",features:[]},i=0;i<s.length;i++){s[i]=s[i].replace(/--c--/g,",");var e=s[i].replace(/^\s+|\s+$/g,"");e=decodeURIComponent(e),e=encodeURIComponent(e);var o=this.options.wsLocateUrl;if(this.options.useProxy){o=smap.config.ws.proxy+encodeURIComponent(o+"?q=")+e;var a=this.options.whitespace;a&&(o=o.replace(/%20/g,a))}else o=o+"?q="+e;var single_sok_xhr=new smap.cmd._xhr_handler;if(single_sok_xhr.open("GET",o,!1),single_sok_xhr.send(null),4==single_sok_xhr.readyState&&200==single_sok_xhr.status){var single_sok_xhrResponse=JSON.parse(single_sok_xhr.responseText);if(single_sok_xhrResponse instanceof Object&&single_sok_xhrResponse.features.length>0)for(var j=0;j<single_sok_xhrResponse.features.length;j++)features_all.features.push(single_sok_xhrResponse.features[j])}}if(features_all.features.length>0){if(diainfo instanceof Array)for(var ft=0;ft<features_all.features.length;ft++)try{features_all.features[ft].properties.fritext=diainfo[ft][0]}catch(e){features_all.features[ft].properties.fritext=""}if(1===features_all.features.length){var s=t.POIM instanceof Array?t.POIM[0]:t.POIM;s=s.replace(/--c--/g,",");var o=t.POIM instanceof Array&&t.POIM.length>1&&t.POIM[1],a=!1,r=smap.core.paramInst.getWebParamsAsObject(),n=config.params,i=r.ZOOM||this.options.zoom;r.CENTER||(a=!0,!r.POIM&&n.CENTER&&(a=!1,i=t.ZOOM)),diainfo=diainfo instanceof Array?diainfo[0][0]:"",this._geoLocate(decodeURIComponent(s),{setView:a,zoom:i,showPopup:o,poim:!0,diainfo:diainfo})}else{var multiGeolocate=function(s,that){function o(){$("#smap-search-popupbtn").off("click").on("click",function(){var that_marker=eval(this.getAttribute("markar_id"));return a._searchLayer.removeLayer(a._searchLayer._layers[that_marker]),a.marker=null,!1}),$(".lead")&&$(".lead").length>0&&($(".lead")[0].style.width=$(".leaflet-popup-content").width()-$(".leaflet-popup-close-button").width()+"px")}var a=that;if("undefined"!=typeof L.Control.Search.prototype.marker&&null!==L.Control.Search.prototype.marker&&(that.marker=L.Control.Search.prototype.marker),that.marker&&(that._searchLayer.clearLayers(),that.marker=null),!s.features.length)return void smap.cmd.notify(that.lang.addressNotFound,"error");window.searchLayerMarker_catch=[];for(var all_sok_pos=[],serchItems=[],ii=0;ii<s.features.length;ii++){var r=s.features[ii].geometry.coordinates,n=L.latLng(r[1],r[0]),i="EPSG:4326";if(that.options.wsOrgProj&&that.options.wsOrgProj!==i){var c=window.proj4(that.options.wsOrgProj,i,[n.lng,n.lat]);n=L.latLng(c[1],c[0])}all_sok_pos.push(n),that.map.off("popupopen",o),that.map.on("popupopen",o),that.marker=L.marker(n,{iconOptions:L.icon(that.options.iconOptions)}).addTo(that._searchLayer),that.marker.options.q=e,serchItems.push(s.features[ii].properties.name);var hideSearchDeleteButton=window.getQueryParameters("hideSDeleteButton");hideSearchDeleteButton.length>0&&"true"===hideSearchDeleteButton?"undefined"!=typeof s.features[ii].properties.fritext&&null!==s.features[ii].properties.fritext&&s.features[ii].properties.fritext.length>0?that.marker.bindPopup('<p class="lead">'+decodeURIComponent(s.features[ii].properties.fritext)+"</p><div><button markar_id="+that.marker._leaflet_id+' style="display:none;" id="smap-search-popupbtn" class="btn btn-default btn-sm">'+that.lang.remove+"</button></div>"):that.marker.bindPopup('<p class="lead">'+decodeURIComponent(s.features[ii].properties.name)+"</p><div><button markar_id="+that.marker._leaflet_id+' style="display:none;" id="smap-search-popupbtn" class="btn btn-default btn-sm">'+that.lang.remove+"</button></div>"):"undefined"!=typeof s.features[ii].properties.fritext&&null!==s.features[ii].properties.fritext&&s.features[ii].properties.fritext.length>0?that.marker.bindPopup('<p class="lead">'+decodeURIComponent(s.features[ii].properties.fritext)+"</p><div><button markar_id="+that.marker._leaflet_id+' id="smap-search-popupbtn" class="btn btn-default btn-sm">'+that.lang.remove+"</button></div>"):that.marker.bindPopup('<p class="lead">'+decodeURIComponent(s.features[ii].properties.name)+"</p><div><button markar_id="+that.marker._leaflet_id+' id="smap-search-popupbtn" class="btn btn-default btn-sm">'+that.lang.remove+"</button></div>");var p=t.zoom||that.options.zoom;t.setView=!1,t.showPopup=!1,t.setView?that.map.setView(n,p,{animate:!1}):that.marker._popup.options.autoPan=!1,that.marker._popup.options.autoPan=!0,t.showPopup&&that.marker.openPopup(),L.Control.Search.prototype.marker=that.marker,window.searchLayerMarker_catch.push(that.marker),window.setTimeout(function(){var e=window.getQueryParameters("hideSearchInfo");if(e.length>0)if("true"===e)for(var t=0;t<window.searchLayerMarker_catch.length;t++)window.searchLayerMarker_catch[t].closePopup();else{for(var t=0;t<window.searchLayerMarker_catch.length;t++)t===window.searchLayerMarker_catch.length-1&&window.searchLayerMarker_catch[t].openPopup();var n=window.getQueryParameters("hideSDeleteButton");n.length>0&&"true"===n&&($("#smap-search-popupbtn")[0].style.display="none")}else{var n=window.getQueryParameters("hideSDeleteButton");n.length>0&&"true"===n&&($("#smap-search-popupbtn")[0]?$("#smap-search-popupbtn")[0].style.display="none":"")}},300),that.options.clearEntryAfterSearch&&$(".smap-search-div input").val(null),$(".smap-search-div input").blur(),setTimeout(function(){$(".smap-search-div input").blur()},100)}serchItems.length>1&&(that.marker.options.q=serchItems),that.map.fitBounds(L.latLngBounds(all_sok_pos))};multiGeolocate(features_all,this)}}}else{var s=t.POIM instanceof Array?t.POIM[0]:t.POIM;s=s.replace(/--c--/g,",");var o=t.POIM instanceof Array&&t.POIM.length>1&&t.POIM[1],a=!1,r=smap.core.paramInst.getWebParamsAsObject(),n=config.params,i=r.ZOOM||this.options.zoom;r.CENTER||(a=!0,!r.POIM&&n.CENTER&&(a=!1,i=t.ZOOM)),diainfo=diainfo instanceof Array?diainfo[0][0]:"",this._geoLocate(decodeURIComponent(s),{setView:a,zoom:i,showPopup:o,poim:!0,diainfo:diainfo})}}},_onCreateParams:function(e,t){if(this.marker&&this.marker.options.q){var n=!!this.marker.getPopup()._isOpen;if(this.marker.options.q instanceof Array){t.poim="";for(var a=0;a<this.marker.options.q.length;a++)0===a?t.poim=[encodeURIComponent(this.marker.options.q[a].replace(/,/g,"--c--"))]:t.poim=t.poim+","+[encodeURIComponent(this.marker.options.q[a].replace(/,/g,"--c--"))];n=!1,n&&t.poim.push(1)}else t.poi=[encodeURIComponent(this.marker.options.q.replace(/,/g,"--c--"))],n&&t.poi.push(1)}},_rmAdressMarker:function(e){null!=e&&(this._searchLayer.removeLayer(e),this.addressMarker=null)},_makeSearchField:function(){function e(){var e=$(window).width();if(!(e>=a.options.pxDesktop)&&L.Browser.touch){var t=$("#smap-search-bg");t.length||(t=$('<div id="smap-search-bg" />'),o.addClass("search-active"),$("#mapdiv").append(t),setTimeout(function(){t.addClass("search-bg-visible")},1))}}function t(){var e=$(window).width();e>=a.options.pxDesktop||!L.Browser.touch||(o.removeClass("search-active"),$("#smap-search-bg").removeClass("search-bg-visible"),setTimeout(function(){$("#smap-search-bg").remove()},300))}function n(e){e.stopPropagation()}var a=this,o=$('<div id="smap-search-div" class="smap-search-div input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span><input id="searchInputDetact" autocorrect="off" autocomplete="off" data-provide="typeahead" type="text" class="form-control" placeholder="'+this.lang.search+'"></input></div>'),i=o.find("input");i.placeholder(),L.Browser.msTouch&&i.attr("pattern","[0-9]"),i.on("dblclick",n).on("mousedown",n).on("focus",function(){$(this).parent().addClass("smap-search-div-focused"),$("#mapdiv").trigger("touchstart"),e()}).on("blur",function(){$(this).parent().removeClass("smap-search-div-focused")}).on("touchstart",function(){$(this).focus()}),o.on("click touchstart",function(e){$(this).find("input").focus(),e.stopImmediatePropagation()}),i.on("blur",t),$("#maindiv").append(o),smap.event.on("smap.core.pluginsadded",function(){var e=$("#smap-menu-div nav");e.length&&o.addClass("smap-search-div-in-toolbar")});var r=this.options.whitespace,s=this.options._geoLocate||this._geoLocate,l={items:5,minLength:2,highlight:!0,hint:!0,afterSelect:function(e){return smap.cmd.loading(!0),s.call(a,e),t(),e}};$.extend(l,this.options.acOptions||{}),this.options.source?l.source=$.proxy(this.options.source,this):this.options.wsAcUrl?l.source=function(e,t){e=e.replace(/^\s+|\s+$/g,""),e=encodeURIComponent(e);var n=a.options.wsAcUrl;r&&(e=e.replace(/%20/g,r)),a._proxyInst&&a._proxyInst.abort(),a._proxyInst=$.ajax({type:"GET",url:a.options.useProxy?smap.config.ws.proxy+encodeURIComponent(n+"?q=")+e:n+"?q="+e,dataType:"text",success:function(e){var n=decodeURIComponent(e).replace(/^\s+|\s+$/g,"").split("\n");t(n)},error:function(){}})}:this.options.wsAcLocal&&this.options.wsAcLocal instanceof Array&&(l.source=this.options.wsAcLocal),this._initAutoComplete(i,l)},_initAutoComplete:function(e,t){t=t||this.options.typeaheadOptions;var n=this.options.autoScrollAcOnRowNbr;if(this._onKeyPress=this._onKeyPress||function(e){var t=38===e.which,a=40===e.which;if(t||a){var o=$(".typeahead.dropdown-menu li.active"),i=o.parent().find("li").length;if(t&&1===o.index()||a&&o.index()===i-1)o.parent().scrollTo($(".typeahead.dropdown-menu li:first"),0);else if(t&&0===o.index())o.parent().scrollTo($(".typeahead.dropdown-menu li:last"),0);else if(o.index()>=n){for(var r=o,s=0;n/2>s;s++)r=r.prev();r&&r.length&&o.parent().scrollTo(r,0)}}if("undefined"!=typeof e.which&&null!==e.which&&13===e.which){var l=document.getElementById("searchInputDetact").value;if(l.length>4&&isFinite(l.replace(/ /gi,"").replace(",","").replace(".",""))){l=function(){return l.indexOf(",")>-1?l:l.replace(" ",",")}();var p=l.split(",")[0],c=l.split(",")[1],d=function(e,t){var n=L.latLng(e,t);if("undefined"!=typeof L.Control.Search.prototype.marker&&null!==L.Control.Search.prototype.marker)for(key in L.Control.Search.prototype._searchLayer._layers)L.Control.Search.prototype._searchLayer.removeLayer(L.Control.Search.prototype._searchLayer._layers[key]);L.Control.Search.prototype.marker=L.marker(n,{iconOptions:L.icon(L.Control.Search.prototype.options.iconOptions)}).addTo(L.Control.Search.prototype._searchLayer),L.Control.Search.prototype.marker.on("click touchstart",function(){L.Control.Search.prototype._searchLayer.clearLayers()}),smap.map.setView(n,smap.cmd.getControls("L.Control.Search")[0].options.zoom,{animate:!1})};if(p>180||c>180)if(p<6906693.7888&&p>6120098.8505&&c<223225.0217&&c>60857.4994){var h=utils.projectLatLng(L.latLng(p,c),"EPSG:3008","EPSG:4326",!1,!1);d(h.lat,h.lng)}else alert("Du är utanför kartområdet.\nKoordinat sökningen exempel:\n 1. För WGS 84 decimal (lat, lon) (GPS):\n 56.03079 14.15312\n Eller\n 56.03079,14.15312\n  2. För Sweref99 13 30 (X, Y):\n 6212180.214 190711.885\n Eller\n 6212180.214,190711.885\n");else p>55.11294&&p<57.38874&&c>11.86523&&c<17.20459?d(p,c):alert("Du är utanför kartområdet.\nKoordinat sökningen exempel:\n 1. För WGS 84 decimal (lat, lon) (GPS):\n 56.03079 14.15312\n Eller\n 56.03079,14.15312\n  2. För Sweref99 13 30 (X, Y):\n 6212180.214 190711.885\n Eller\n 6212180.214,190711.885\n")}}},e.off("keydown",this._onKeyPress).on("keydown",this._onKeyPress),e.typeahead(t),this.options.acHeight){var a=e.data("typeahead").$menu;a.css({"max-height":this.options.acHeight})}},_geoLocate:function(e,t){t=t||{};var n={setView:!0,showPopup:!0};t=$.extend({},n,t),this.options.qPattern&&(e=utils.extractToHtml(this.options.qPattern,{q:e}));var e=e.replace(/^\s+|\s+$/g,"");e=encodeURIComponent(e);var a=this.options.wsLocateUrl;if(this.options.useProxy){a=smap.config.ws.proxy+encodeURIComponent(a+"?q=")+e;var o=this.options.whitespace;o&&(a=a.replace(/%20/g,o))}else a=a+"?q="+e;var i={success:function(n){function a(){$("#smap-search-popupbtn").off("click").on("click",function(){return o._searchLayer.removeLayer(o.marker),o.marker=null,!1}),$(".lead")&&$(".lead").length>0&&($(".lead")[0].style.width=$(".leaflet-popup-content").width()-$(".leaflet-popup-close-button").width()+"px")}var o=this;if("undefined"!=typeof L.Control.Search.prototype.marker&&null!==L.Control.Search.prototype.marker&&(this.marker=L.Control.Search.prototype.marker),this.marker){for(key in this._searchLayer._layers)this._searchLayer.removeLayer(this._searchLayer._layers[key]);this.marker=null}if(!n.features.length)return void smap.cmd.notify(this.lang.addressNotFound,"error");var i=n.features[0].geometry.coordinates,r=L.latLng(i[1],i[0]),s="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==s){var l=window.proj4(this.options.wsOrgProj,s,[r.lng,r.lat]);r=L.latLng(l[1],l[0])}this.map.off("popupopen",a),this.map.on("popupopen",a),this.marker=L.marker(r,{iconOptions:L.icon(this.options.iconOptions)}).addTo(this._searchLayer),this.marker.options.q=e;var p=window.getQueryParameters("hideSDeleteButton");p.length>0&&"true"===p?"undefined"!=typeof t.poim&&null!==t.poim&&t.poim&&t.diainfo.length>0?this.marker.bindPopup('<p class="lead">'+decodeURIComponent(t.diainfo)+'</p><div><button style="display:none;" id="smap-search-popupbtn" class="btn btn-default btn-sm">'+this.lang.remove+"</button></div>"):this.marker.bindPopup('<p class="lead">'+decodeURIComponent(e)+'</p><div><button style="display:none;" id="smap-search-popupbtn" class="btn btn-default btn-sm">'+this.lang.remove+"</button></div>"):"undefined"!=typeof t.poim&&null!==t.poim&&t.poim&&t.diainfo.length>0?this.marker.bindPopup('<p class="lead">'+decodeURIComponent(t.diainfo)+'</p><div><button id="smap-search-popupbtn" class="btn btn-default btn-sm">'+this.lang.remove+"</button></div>"):this.marker.bindPopup('<p class="lead">'+decodeURIComponent(e)+'</p><div><button id="smap-search-popupbtn" class="btn btn-default btn-sm">'+this.lang.remove+"</button></div>");var c=t.zoom||this.options.zoom;t.setView?this.map.setView(r,c,{animate:!1}):this.marker._popup.options.autoPan=!1,t.showPopup&&this.marker.openPopup(),L.Control.Search.prototype.marker=this.marker,window.searchLayerMarker_catch=this.marker,window.setTimeout(function(){window.searchLayerMarker_catch.closePopup(),window.searchLayerMarker_catch.openPopup();var e=window.getQueryParameters("hideSearchInfo");if(e.length>0)if("true"===e){window.searchLayerMarker_catch.closePopup();var t=smap.core.Param.prototype.getWebParamsAsObject();smap.map.setView(window.searchLayerMarker_catch.getLatLng(),t.ZOOM||16,{animate:!1})}else{var n=window.getQueryParameters("hideSDeleteButton");n.length>0&&"true"===n&&($("#smap-search-popupbtn")[0].style.display="none")}else{var n=window.getQueryParameters("hideSDeleteButton");n.length>0&&"true"===n&&($("#smap-search-popupbtn")[0].style.display="none")}},300),this.options.clearEntryAfterSearch&&$(".smap-search-div input").val(null),$(".smap-search-div input").blur(),setTimeout(function(){$(".smap-search-div input").blur()},100)},complete:function(){smap.cmd.loading(!1)}};$.ajax({url:a,type:"GET",dataType:"json",context:this,success:this.options.onLocateSuccess||i.success,complete:i.complete})},CLASS_NAME:"L.Control.Search"}),L.control.search=function(e){return new L.Control.Search(e)},L.Control.SelectVector=L.Control.extend({options:{position:"bottomright",selectStyle:{weight:5,color:"#00FFFF",fillColor:"#00FFFF",opacity:1,fillOpacity:.5}},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_selectedFeatures:[],_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode);var t=this;this._onFeatureClick=function(e){var n=200;t._clickWasRegistered||(t.onFeatureClick(e),t._clickWasRegistered=!0,setTimeout(function(){t._clickWasRegistered=!1},n))}},activate:function(){this._active=!0},deactivate:function(){this._active=!1},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-selectvector"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),
this._bindEvents(),this.activate(),this._container},onRemove:function(){this.map.off("layeradd",this._onLayerAdded),this.map.off("click",this._onMapClick),this.deactivate()},_bindEvents:function(){this._onLayerAdded=$.proxy(this.onLayerAdded,this),this._onLayerRemoved=$.proxy(this.onLayerRemoved,this),this._onMapClick=$.proxy(this.onMapClick,this),this.map.on("layeradd",this._onLayerAdded),this.map.on("layerremove",this._onLayerRemoved),this.map.on("click",this._onMapClick)},onMapClick:function(){this._selectedFeatures=[]},_vectorLayers:[],onLayerAdded:function(e){var t=this,n=e.layer,a=n.hasOwnProperty("_layers");a&&n.on&&(n.on("load",function(){var e=function(e){e.options=e.options||{},e.options.layerId=n.options.layerId,e.off("click",t._onFeatureClick),e.on("click",t._onFeatureClick)};this.eachLayer&&this.eachLayer(e),this.off("dblclick",t._onFeatureClick).on("dblclick",t._onFeatureClick)}),this._vectorLayers.push(n))},onLayerRemoved:function(e){if(e.layer.options&&e.layer.options.layerId){var t=e.layer.options.layerId;if(t&&e.layer._layers){var n=$.inArray(e.layer,this._vectorLayers);n>-1&&this._vectorLayers.splice(n,1)}}},_layerFromFeature:function(e,t){var n=t._layers;for(var a in n){var o=n[a];if(o.feature&&o.feature.id===e.id)return o}return null},unselect:function(e){var t=e.layerId,n=smap.cmd.getLayer(t),a=$.inArray(e,this._selectedFeatures);this._selectedFeatures.splice(a,1);var o=utils.getLayerFromFeature(e,n)||n;n.resetStyle.call(n,o),this._map.fire("unselected",{feature:e})},onFeatureClick:function(e){if(!this._active)return!1;var t=e.layer&&e.layer.feature?e.layer.feature:e.target.feature||e.target,n=!!e.originalEvent&&(e.originalEvent.shiftKey||!1),a=e.target,o=a.options.layerId||e.layer.options.layerId,i=smap.core.layerInst._getLayer(o);if(n===!1&&(this._selectedFeatures=[],i&&i.resetStyle)){var r=i.resetStyle;i.eachLayer(function(e){r.call(i,e)});for(var s=this._vectorLayers,l=0,p=s.length;p>l;l++)d=s[l],d.resetStyle&&d!==i&&d.resetStyle(d)}var c=$.inArray(t,this._selectedFeatures);if(n===!0&&c>-1){this._selectedFeatures.splice(c,1),this._map.fire("unselected",{feature:t});var d=this._layerFromFeature(t,i);i.resetStyle.call(i,d)}else{if(t.layerId=o,t.uniqueKey=i&&i.options?i.options.uniqueKey:t.layerId,this._selectedFeatures.push(t),i){var h=this._layerFromFeature(t,i);h&&h.setStyle&&h.setStyle(i.options.selectStyle||this.options.selectStyle)}this._map.fire("selected",{feature:t,selectedFeatures:this._selectedFeatures,layer:i||t,latLng:e.latlng,shiftKeyWasPressed:!!e.originalEvent&&(e.originalEvent.shiftKey||!1)})}}}),L.control.selectVector=function(e){return new L.Control.SelectVector(e)},L.Control.SelectWMS=L.Control.extend({options:{wmsVersion:"1.3.0",info_format:"text/plain",maxFeatures:20,buffer:12,useProxy:!1},_layers:[],_selectedFeatures:[],initialize:function(e){L.setOptions(this,e)},onAdd:function(e){return this.map=e,this.activate(),this._container=L.DomUtil.create("div","leaflet-control-selectwms"),$(this._container).css("display","none"),L.DomEvent.disableClickPropagation(this._container),this._container},onRemove:function(){this.deactivate()},onSuccess:function(e){e=e||[];for(var t,n,a,o,i,r,s,l,p=0,c=e.length;c>p;p++)if(t=e[p],r=t[0],s=t[1],l=s.params,n=r.features,r)if(r.features){var a,o,i,n=r.features;if(!n.length)continue;for(var d=0,h=n.length;h>d;d++){if(a=n[d],o=smap.cmd.getLayerConfigBy("options.layers",l.layers)||smap.cmd.getLayerConfigBy("options.selectOptions.layers",l.layers),!o&&a.id){var u=a.id.split(".")[0];if(l.layers.search(u)>-1)for(var m=l.layers.split(","),f=0,g=m.length;g>f;f++)if(m[f].search(u)>-1){var _=m[f];o=smap.cmd.getLayerConfigBy("options.layers",_)||smap.cmd.getLayerConfigBy("options.selectOptions.layers",_)}}if(!o)break;i=o.options,i.selectOptions&&i.selectOptions.srs&&"EPSG:4326"!==i.selectOptions.srs&&utils.projectFeature(a,"EPSG:4326",{});var v=a.geometry.type;if("Point"===v||"MultiPoint"===v){var y=[];switch(v){case"Point":y=a.geometry.coordinates;break;case"MultiPoint":y=a.geometry.coordinates[0]}a.latLng=L.latLng([y[1],y[0]])}else a.latLng=s.latLng;a.options=$.extend({},i),n[d]=a}this._selectedFeatures=this._selectedFeatures.concat(n)}else{var b,w,C=s.latLng;for(var k in r){b=r[k];var A=k.split(":"),P=A[A.length-1],o=smap.cmd.getLayerConfigBy("layers",P,{inText:!0});if(o&&o.options&&o.options.layerId)for(var x=o.options.layerId,d=0,h=b.length;h>d;d++){w=b[d];var a={geometry:{coordinates:[C.lng,C.lat]},latLng:L.latLng([C.lat,C.lng]),properties:w,layerId:x,options:o.options};w&&$.isEmptyObject(w)===!1&&this._selectedFeatures.push(a)}}}this._selectedFeatures.length&&this.map.fire("selected",{layer:this,feature:this._selectedFeatures.length?this._selectedFeatures[0]:null,selectedFeatures:this._selectedFeatures})},_applyParam:function(e){var t,n,a,o,i,r=JSON.parse(decodeURIComponent(e)),s=[];for(n in r)a=r[n],a.xy&&(t=smap.core.layerInst.showLayer(n),s.push(t));o=a.xy&&a.xy.length?a.xy[0]:null,o&&(i=L.latLng(o[1],o[0]),this.onMapClick({latlng:i,_layers:s}))},onApplyParams:function(e,t){t.SEL&&this._applyParam(decodeURIComponent(t.SEL))},activate:function(){return!this._active&&(this._active=!0,void this._bindEvents())},deactivate:function(){this._active=!1,this._unbindEvents()},_bindEvents:function(){this._onApplyParams=this._onApplyParams||$.proxy(this.onApplyParams,this),smap.event.on("smap.core.applyparams",this._onApplyParams),this.map.on("layeradd",this.onLayerAdd,this).on("layerremove",this.onLayerRemove,this).on("click",this.onMapClick,this).on("dblclick",this.onMapDblClick,this)},_unbindEvents:function(){smap.event.off("smap.core.applyparams",this._onApplyParams),this.map.off("layeradd",this.onLayerAdd,this).off("layerremove",this.onLayerRemove,this).off("click",this.onMapClick,this).off("dblclick",this.onMapDblClick,this)},onLayerAdd:function(e){var t=e.layer;this._layerShouldBeAdded(t)===!0&&this._layers.push(t)},onLayerRemove:function(e){var t=e.layer,n=this._hasLayer(t);n!==!1&&this._layers.splice(n,1)},onMapDblClick:function(){this._dblclickWasRegistered=!0,this.xhr&&this.xhr.abort(),setTimeout($.proxy(function(){this._dblclickWasRegistered=!1},this),400)},onMapClick:function(e){this._selectedFeatures=[];var t=e.latlng;this.xhr&&this.xhr.abort();var n=e._layers||this._layers;if(n.length){var a,o,i,r,s,l=this,p={},c=0;$.each(n,function(e,t){if(s=t.options||{},o=t._url||t._wmsUrl,i=o.toUpperCase()+"&randomversion="+Math.random(),p[i]){var n=p[i].selectOptions||{},a=s.selectOptions||{},d=n.info_format||l.options.info_format;r=d&&a.info_format&&d!==a.info_format,r&&(i+="_1")}p[i]={layerNames:[],url:o,wmsVersion:t._wmsVersion,layerId:s.layerId,selectOptions:s.selectOptions||{}},c+=1,p[i].layerNames.push(s.selectOptions&&s.selectOptions.layers?s.selectOptions.layers:s.layers)});var d;setTimeout($.proxy(function(){if(this._dblclickWasRegistered===!0);else{var e=[];for(var n in p){a=p[n],d=this._makeParams({layers:a.layerNames.join(","),version:a._wmsVersion||this.options.wmsVersion,info_format:a.selectOptions.info_format||this.options.info_format,request:a.selectOptions.request||this.options.request,query_layers:a.selectOptions.query_layers||a.layerNames.join(","),service:a.selectOptions.service||this.options.service,buffer:a.selectOptions.buffer||this.options.buffer,outputFormat:a.selectOptions.outputFormat||this.options.outputFormat,latLng:t,srs:a.selectOptions.srs||"EPSG:4326"},a.selectOptions),"text/plain"===d.info_format&&(d.version="1.1.1");var o=this.onSuccess;this.request(a.selectOptions.url||a.url,d,{onSuccess:function(t,n){c-=1,e.push([t,n]),0>=c&&o.call(this,e)},onError:function(){c-=1},layerId:a.layerId,latLng:t})}}},this),100)}},_layerShouldBeAdded:function(e){var t=!!e.wmsParams;return!(!e.options||!e.options.selectable||e.options.selectable!==!0||this._hasLayer(e)!==!1||t!==!0)},_hasLayer:function(e){for(var t=this._layers,n=0,a=t.length;a>n;n++)if(e===t[n])return n;return!1},_makeParams:function(e,t){t=t||{};var n=this.map.latLngToContainerPoint(e.latLng),a=e.buffer,o=new OpenLayers.Pixel(n.x-a,n.y+a),i=new OpenLayers.Pixel(n.x+a,n.y-a),r=L.point(o.x,o.y),s=L.point(i.x,i.y),l=this.map.containerPointToLatLng(r),p=this.map.containerPointToLatLng(s),c=L.latLngBounds(l,p),d=c.toBBoxString();if(t.srs&&"EPSG:4326"!==e.srs){var h=c.getSouthWest(),u=c.getNorthEast();h=utils.projectLatLng(h,"EPSG:4326",e.srs,!1,!1),u=utils.projectLatLng(u,"EPSG:4326",e.srs,!1,!1),c=L.latLngBounds(h,u),d=c.toBBoxString()}if(t.reverseAxisBbox){var m=d.split(",");d=[m[1],m[0],m[3],m[2]].join(",")}var f=$.extend({},{service:"WMS",request:"GetFeatureInfo",version:this.options.version,bbox:d,layers:null,styles:"",typename:e.layers,query_layers:e.layers,info_format:e.info_format,feature_count:this.options.maxFeatures,x:utils.round(n.x),y:utils.round(n.y),buffer:this.options.buffer,width:utils.round(this.map.getSize().x),height:utils.round(this.map.getSize().y),srs:"EPSG:4326",exceptions:"application%2Fvnd.ogc.se_xml"},e);return delete f.latLng,f},_parseText:function(e){for(var t,n,a,o,i,r,s={},l={},p=e.split("\n"),c=0,d=p.length;d>c;c++)if(t=p[c],0!==$.trim(t).length)if(-1!==t.search("=")){if(n=t.split("="),n.length>2){var h=n.slice(1);o=h.join("=")}else o=n[1];o=$.trim(o),"null"==o.toLowerCase()&&(o="");var u=/^[0-9.]+$/.test(o),m=o.split("."),f=m.length<=2&&m[0].length>0&&(1===m.length||2===m.length&&m[1].length>0);if(u===!0&&f){try{switch(m.length){case 1:i=parseInt(o);break;case 2:i=parseFloat(o)}}catch(g){}i&&isNaN(i)===!1&&(o=i)}a=$.trim(n[0]),l[a]=o}else{var _=t.search(/'/);if(_>-1){t=t.substring(_+1),_=t.search(/'/),r&&s[r]&&$.isEmptyObject(l)===!1&&(s[r].push($.extend({},l)),l={}),r=t.substring(0,_),s[r]||(s[r]=[]);continue}r&&s[r]&&$.isEmptyObject(l)===!1&&t.search(/\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-/gi)>-1?(s[r].push($.extend({},l)),l={}):a&&o&&(l[a]=o+" "+t)}return r&&s[r]&&$.isEmptyObject(l)===!1&&s[r].push($.extend({},l)),s},request:function(e,t,n){t=t||{},n=n||{};var a=null;this.options.useProxy?e=smap.config.ws.proxy+encodeURIComponent(e+"?"+$.param(t)):a=t,this.xhr=$.ajax({url:e,data:a,type:"GET",dataType:"text",context:this,success:function(e){var a,o=t.info_format;if("text/plain"===o)a=this._parseText(e);else{if("application/json"!==o)return!1;a=JSON.parse(e.replace(/(?:\r\n|\r|\n)/g,""))}n.onSuccess.call(this,a,{latLng:n.latLng,map:this.map,context:this,params:t})},error:n.onError})},CLASS_NAME:"L.Control.SelectWMS"}),L.control.selectWMS=function(e){return new L.Control.SelectWMS(e)},L.Control.SearchLund=L.Control.extend({options:{whitespace:"%2B",wsOrgProj:"EPSG:3006",pxDesktop:992,addToMenu:!1},_lang:{sv:{search:"Sök",addressNotFound:"Den sökta adressen hittades inte",remove:"Ta bort"},en:{search:"Search property",addressNotFound:"The searched address was not found",remove:"Remove"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){var t=this;return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-searchlund"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),this._makeSearchField(),this.__onApplyParams=this.__onApplyParams||$.proxy(this._onApplyParams,this),smap.event.on("smap.core.applyparams",this.__onApplyParams),this.__onCreateParams=this.__onCreateParams||$.proxy(this._onCreateParams,this),smap.event.on("smap.core.createparams",this.__onCreateParams),this.map.on("click",this._blurSearch),t._container},_blurSearch:function(){$("#smap-searchlund-div input").blur()},onRemove:function(){smap.event.off("smap.core.applyparams",this.__onApplyParams),smap.event.off("smap.core.createparams",this.__onCreateParams),this.map.off("click",this._blurSearch)},_onApplyParams:function(e,t){if(t.POI){var n=t.POI instanceof Array?t.POI[0]:t.POI;n=n.replace(/--c--/g,",");var a=t.POI instanceof Array&&t.POI.length>1&&t.POI[1];this._geoLocate(decodeURIComponent(n),{setView:!1,showPopup:a})}},_onCreateParams:function(e,t){if(this.marker&&this.marker.options.q){var n=!!this.marker.getPopup()._isOpen;t.POI=[encodeURIComponent(this.marker.options.q.replace(/,/g,"--c--"))],n&&t.POI.push(1)}},_rmAdressMarker:function(e){null!=e&&(this.map.removeLayer(e),this.addressMarker=null)},_makeSearchField:function(){function e(){var e=$(window).width();if(!(e>=a.options.pxDesktop)&&L.Browser.touch){var t=$("#smap-searchlund-bg");t.length||(t=$('<div id="smap-searchlund-bg" />'),o.addClass("searchlund-active"),$("#mapdiv").append(t),setTimeout(function(){t.addClass("searchlund-bg-visible")},1))}}function t(){var e=$(window).width();e>=a.options.pxDesktop||!L.Browser.touch||(o.removeClass("searchlund-active"),$("#smap-searchlund-bg").removeClass("searchlund-bg-visible"),setTimeout(function(){$("#smap-searchlund-bg").remove()},300))}function n(e){e.stopPropagation()}var a=this,o=$('<div id="smap-searchlund-div" class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span><input autocorrect="off" autocomplete="off" data-provide="typeahead" type="text" class="form-control" placeholder="'+this.lang.search+'"></input></div>'),r=o.find("input");L.Browser.msTouch&&r.attr("pattern","[0-9]"),r.on("keypress",e).on("dblclick",n).on("mousedown",n).on("focus",function(){$(this).parent().addClass("smap-searchlund-div-focused")}).on("blur",function(){$(this).parent().removeClass("smap-searchlund-div-focused")}).on("touchstart",function(){$(this).focus()}),o.on("click touchstart",function(e){$(this).find("input").focus(),e.stopImmediatePropagation()}),r.on("blur",t),$("#mapdiv").append(o),smap.event.on("smap.core.pluginsadded",function(){var e=$("#smap-menu-div nav");e.length&&o.addClass("smap-searchlund-div-in-toolbar")});var s=this.options.whitespace,l=this.options._geoLocate||this._geoLocate,p={items:10,minLength:2,highlight:!0,hint:!0,updater:function(e){return smap.cmd.loading(!0),l.call(a,e),t(),e}};this.options.wsAcUrl?p.source=function(e,t){var n=encodeURIComponent(a.options.wsAcUrl+"?format=json&prefix="+e);s&&(n=n.replace(/%20/g,s)),a.proxyInst&&a.proxyInst.abort(),a.proxyInst=$.ajax({type:"GET",url:smap.config.ws.proxy+n,dataType:"text",success:function(e){var n=$.parseJSON(e),a=[];for(i=0,len=n.items.length;i<len;i++)a[i]=n.items[i].name;t(a)},error:function(){}})}:this.options.wsAcLocal&&this.options.wsAcLocal instanceof Array&&(p.source=this.options.wsAcLocal),r.typeahead(p)},_geoLocate:function(e,t){t=t||{};var n={setView:!0,showPopup:!0};t=$.extend({},n,t),this.options.qPattern&&(e=utils.extractToHtml(this.options.qPattern,{q:e}));var a=encodeURIComponent(this.options.wsLocateUrl+"?format=json&objectname="+e),o=this.options.whitespace;o&&(a=a.replace(/%20/g,o));var i={success:function(n){function a(){$("#smap-searchlund-popupbtn").off("click").on("click",function(){return o.map.removeLayer(o.marker),o.marker=null,o.polyLayerGroup.clearLayers(),o.map.removeLayer(o.polyLayerGroup),!1})}var o=this;if(this.marker&&(this.map.removeLayer(this.marker),this.marker=null,this.polyLayerGroup&&(this.polyLayerGroup.clearLayers(),o.map.removeLayer(this.polyLayerGroup))),!n.items.length)return void smap.cmd.notify(this.lang.addressNotFound,"error");for(var i=[],r=0,s=n.items.length;s>r;r++)i[r]=$.parseJSON(n.items[r].geometry);if("MultiPoint"==i[0].type){var l=L.latLng(i[0].coordinates[0][1],i[0].coordinates[0][0]),p="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==p){var c=window.proj4(this.options.wsOrgProj,p,[l.lng,l.lat]);l=L.latLng(c[1],c[0])}}if("Polygon"==i[0].type){for(var l,d=[],h=0;h<i.length;h++)d[h]=[];for(var u=0,m=i.length;m>u;u++)for(var h=0,f=i[u].coordinates[0].length;f>h;h++){var l=L.latLng(i[u].coordinates[0][h][1],i[u].coordinates[0][h][0]),p="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==p){var c=window.proj4(this.options.wsOrgProj,p,[l.lng,l.lat]);l=L.latLng(c[1],c[0])}d[u].push(l)}}if(this.map.off("popupopen",a),this.map.on("popupopen",a),"MultiPoint"==i[0].type&&(this.marker=L.marker(l).addTo(this.map),this.marker.options.q=e,this.marker.bindPopup('<p class="lead">'+e+'</p><div><button id="smap-searchlund-popupbtn" class="btn btn-default">'+this.lang.remove+"</button></div>"),t.setView&&this.map.setView(l,17,{animate:!1})),"Polygon"==i[0].type){this.polyLayerGroup=new L.LayerGroup;for(var h=0;h<i.length;h++)this.mapPolygon=L.polygon(d[h]),this.polyLayerGroup.addLayer(this.mapPolygon);this.map.addLayer(this.polyLayerGroup);var g=this.mapPolygon.getBounds().getCenter();this.marker=L.marker(g).addTo(this.map),this.marker.options.q=e,this.marker.bindPopup('<p class="lead">'+e+'</p><div><button id="smap-searchlund-popupbtn" class="btn btn-default">'+this.lang.remove+"</button></div>"),t.setView&&this.map.setView(l,17,{animate:!1})}t.showPopup&&this.marker.openPopup(),$("#smap-searchlund-div input").val(null),$("#smap-searchlund-div input").blur(),setTimeout(function(){$("#smap-searchlund-div input").blur()},100)},complete:function(){smap.cmd.loading(!1)}};$.ajax({url:smap.config.ws.proxy+a,type:"GET",dataType:"json",context:this,success:this.options.onLocateSuccess||i.success,complete:i.complete})},CLASS_NAME:"L.Control.SearchLund"}),L.control.searchLund=function(e){return new L.Control.SearchLund(e)},L.Control.ShareLink=L.Control.extend({options:{position:"bottomright",addToMenu:!1,maxLen:2083,root:null},_lang:{sv:{caption:"Länk till kartan",close:"Stäng",tooLong:"För lång länk",tooLongUrl:"Notera! Länken är för lång för att fungera i en del äldre webbläsare. Ta bort ett eller flera ritade objekt för att göra länken kortare."},en:{caption:"Share link",close:"Close",tooLong:"Too long link",tooLongUrl:"Note! The link may not work in some older browsers. Please remove one or more drawn features to make it shorter."}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-ShareLink"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._container},activate:function(){function t(){s.find("input[type=text]").prop("disabled",!0),s.off("shown.bs.modal",t)}var n=this,o=smap.cmd.createParams(this.options.root||!0),i=$('<div class="form-group"><input id="share_link_main_id" type="text" class="form-control" placeholder="'+this.lang.caption+'"></br><div id="qrcode_shortlink_id" style ="display:none;"><span><b style="color:#428bca;">Kort länk:</b></span></br><a id ="short_link_id" href="" target="_blank"></a></br></br><span>  <a id="download_qrcode_id" href="" download><b>Hämta QR-kod:  </b><span class="glyphicon glyphicon-download"></span></a> </span><div id="qrcode" style="width:150px; height:150px; margin-top:15px;"></div></div></div>'),a=i.find("input");a.val(o);var e=function(e){e.setSelectionRange?e.setSelectionRange(0,9999):$(e).select()};if(!this._$dialog){L.Control.ShareLink.prototype.qrcode_shortlink={},window.sendMail={},window.sendMail.upd_link=o,window.sendMail.shareLinkByMail=function(){var e=document.getElementById("short_link_id")[getTextContent(document.getElementById("short_link_id"))],t=document.createElement("a");e.length>0?t.href="mailto:?body="+encodeURIComponent(window.sendMail.upd_link)+"%0D%0A Kort länk: %0D%0A"+e:t.href="mailto:?body="+encodeURIComponent(window.sendMail.upd_link),t.click()},window.sendMail.shareLinkBySocialMedia=function(){L.Control.ShareLink.prototype._createShareDialog(),$(".sharer-container").sharer()},L.Control.ShareLink.prototype.qrcode_shortlink._randomTextAndNumberParameter=function(){for(var e="",t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxuz0123456789",a=0;a<5;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return t="&"+e+"="+Math.floor(Math.random()*Math.pow(10,18))},L.Control.ShareLink.prototype.qrcode_shortlink.registerShortLink=function(e){var t="/kortlank/linkregister.php",n="linkname="+e;n+="&link="+encodeURIComponent(window.sendMail.upd_link),n+=L.Control.ShareLink.prototype.qrcode_shortlink._randomTextAndNumberParameter();var a=new smap.cmd._xhr_handler;if(a.open("POST",t,!1),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(n),4==a.readyState&&200==a.status){var o=JSON.parse(a.responseText);return"undefined"!=typeof o.save_status.match("Resource id #")&&null!==o.save_status.match("Resource id #")&&o.save_status.match("Resource id #").indexOf("Resource id #")>=0?"success":"fail"}return"fail"},L.Control.ShareLink.prototype.qrcode_shortlink.isLinkInDBPlusLinkName=function(){var e=[],t="/kortlank/getlinknameby_link.php?link="+encodeURIComponent(window.sendMail.upd_link)+L.Control.ShareLink.prototype.qrcode_shortlink._randomTextAndNumberParameter(),n=new smap.cmd._xhr_handler;if(n.open("GET",t,!1),n.send(null),4==n.readyState&&200==n.status){var a=JSON.parse(n.responseText);return a.linkname}return e},L.Control.ShareLink.prototype.qrcode_shortlink.shortLinkAndQRCode=function(e){var t=window.location.protocol+"//"+window.location.host+"/kortlank/?id="+e,n=document.getElementById("short_link_id");if(n.href=t,n[getTextContent(n)]=t,"undefined"!=typeof L.Control.ShareLink.prototype.qrcode_shortlink.qrcode&&null!==L.Control.ShareLink.prototype.qrcode_shortlink.qrcode){L.Control.ShareLink.prototype.qrcode_shortlink.qrcode.clear();for(var a=L.Control.ShareLink.prototype.qrcode_shortlink.qrcode._el.childNodes.length-1;a>-1;a--)L.Control.ShareLink.prototype.qrcode_shortlink.qrcode._el.removeChild(L.Control.ShareLink.prototype.qrcode_shortlink.qrcode._el.childNodes[a])}L.Control.ShareLink.prototype.qrcode_shortlink.qrcode=new QRCode(document.getElementById("qrcode"),{width:150,height:150}),L.Control.ShareLink.prototype.qrcode_shortlink.qrcode.makeCode(t),window.currentQRCode="",L.Control.ShareLink.prototype.qrcode_shortlink.downloadQRCode=setInterval(function(){window.currentQRCode.length>0&&(document.getElementById("download_qrcode_id").href=window.currentQRCode,document.getElementById("download_qrcode_id").download=e,clearInterval(L.Control.ShareLink.prototype.qrcode_shortlink.downloadQRCode))},100)},L.Control.ShareLink.prototype.qrcode_shortlink.createShortLinkAndQRCode=function(){if(window.sendMail.upd_link.length>L.Control.ShareLink.prototype.options.maxLen)alert("Notera! Länken är för lång för att fungera i en del äldre webbläsare. Ta bort ett eller flera ritade objekt för att göra länken kortare.");else{var datum=new Date,uniqueLinkName=datum.getFullYear()+"-"+(eval(datum.getMonth())+1)+"-"+datum.getDate()+"-"+datum.getHours()+"-"+datum.getMinutes()+"-"+datum.getSeconds()+"-"+datum.getMilliseconds(),isLinkInDBPlusLinkName=L.Control.ShareLink.prototype.qrcode_shortlink.isLinkInDBPlusLinkName();if(isLinkInDBPlusLinkName.length>0){var linkNameFromDB=isLinkInDBPlusLinkName[0].linkname;L.Control.ShareLink.prototype.qrcode_shortlink.shortLinkAndQRCode(linkNameFromDB),document.getElementById("qrcode_shortlink_id").style.display="block"}else"success"===L.Control.ShareLink.prototype.qrcode_shortlink.registerShortLink(uniqueLinkName)?(L.Control.ShareLink.prototype.qrcode_shortlink.shortLinkAndQRCode(uniqueLinkName),document.getElementById("qrcode_shortlink_id").style.display="block"):alert("Failed to create short link and qr code")}};var l='<button  style="margin-top:5px;margin-bottom:5px;" class="btn btn-default" onclick="L.Control.ShareLink.prototype.qrcode_shortlink.createShortLinkAndQRCode();">Skapa QR-kod och kort länk</button> <button style="margin-top:5px;margin-bottom:5px;"  class="btn btn-default" onclick="window.sendMail.shareLinkBySocialMedia();">Dela länk</button><button style="margin-top:5px;margin-bottom:5px;" class="btn btn-default" onclick="window.sendMail.shareLinkByMail();">Skicka e-post</button><button style="margin-top:5px;margin-bottom:5px;" type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";this._$dialog=utils.drawDialog(this.lang.caption,i,l),this._$dialog.attr("id","slink-modal"),a.on("tap click",function(){e(this)}),this._$dialog.on("shown.bs.modal",function(){e(a[0])}),this._$dialog.on("hide.bs.modal",function(){$(this).find("input[type=text]").blur()}),this._$dialog.on("hidden.bs.modal",function(){n._$dialog.empty().remove(),n._$dialog=null})}if(o.length>this.options.maxLen){var s=this._$dialog,r=smap.cmd.notify(this.lang.tooLongUrl,"warning",{parent:i.parent()});r.removeClass("map-alert"),s.find("input[type=text]").val(this.lang.tooLong),s.on("shown.bs.modal",t)}this._$dialog.modal("show")},_createShareDialog:function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=document.createElement("div"),a=e,o=t;n.id="socialSiteShare_Id",n.style.width=a+"px",n.style.height=o+"px",n.style.left=e/2-a/2+"px",n.style.top=t/2-o/2+"px",n.style.background="rgba(0,0,0,0.5)",n.style.zIndex="10000",n.style.position="fixed",n.style.border="5px solid white",n.style.borderRadius="15px";var i=document.createElement("div");i.id="closeSpan_div_id",i.style.position="relative",i.style.paddingBottom="13px";var r=document.createElement("span");r.id="closeSpan_text_id",r.style.color="white",r[getTextContent(r)]=" X ",r.style.position="relative",r.style.borderRadius="20px",r.style.background="rgba(0,0,0,1)",r.style.fontSize="25px",r.style.top="10px",r.style.left=a/2-10+"px",r.onclick=function(){var e=document.getElementById("socialSiteShare_Id");e&&document.body.removeChild(e)},i.appendChild(r),n.appendChild(i);var s=document.createElement("div");if(s.className="sharer-container",s.style.display="block",a<=400)var l=0;else var l=a/2-200;s.style.marginLeft=l+"px",s.id="sharer-bottom",n.appendChild(s),document.body.appendChild(n),smap.map.on("resize onorientationchange",function(){var e=document.getElementById("socialSiteShare_Id");if(e){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e.style.width=t+"px",e.style.height=n+"px";var a=document.getElementById("sharer-bottom");if(t<=400)var o=0;else var o=t/2-200;a.style.marginLeft=o+"px";var i=document.getElementById("closeSpan_text_id");i.style.left=t/2-10+"px"}})},_createBtn:function(){var e=this,t=$('<button id="smap-sharelink-btn" title="'+this.lang.caption+'" class="btn btn-default"><span class="fa fa-link"></span></button>');t.on("click touchstart",function(){return e.activate(),!1}),this.$container.append(t)},onRemove:function(){}}),L.control.sharePos=function(e){return new L.Control.SharePos(e)},L.Control.SharePosition=L.Control.extend({options:{position:"bottomright",autoActivate:!1,wfsSource:"//kartor.malmo.se:8081/geoserver/wfs",wfsFeatureType:"sandbox:sharedpositions",wfsUri:"//www.malmo.se/sandbox/",useProxy:!0,maxAge:15,_refreshIntervalMs:1e4,_storeIntervalMs:1e4},_lang:{sv:{dTitle:"Dela position",dShare:"Dela!",yourName:"Ditt namn",stopSharing:"Sluta dela",btnCancel:"Avbryt"},en:{dTitle:"Share position",dShare:"Share!",yourName:"Your name",stopSharing:"Stop sharing",btnCancel:"Cancel"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},deactivate:function(){this._stopRefresh(),$("#smap-share-btn").removeClass("btn-danger"),this.dialog.find("input").val(null),$("#smap-share-btn").hide(),this.map.removeLayer(this.layer)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-shareposition"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawGui(),this._bindEvents(),this._container},onRemove:function(e){e.stopLocate()},_drawGui:function(){var e=$('<button id="smap-share-btn" class="btn btn-default" type="button"><span class="fa fa-user"></span></button>');e.hide(),this.$container.append(e);var t=this;smap.event.on("smap.core.pluginsadded",function(){$(".leaflet-control-Geolocate").before(t.$container)});var n='<div class="form-group"><label>'+this.lang.yourName+'</label><input type="text" class="form-control" placeholder="'+this.lang.yourName+'"></input></div>',a=$('<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.btnCancel+'</button><button type="button" class="btn btn-primary">'+this.lang.dShare+"</button>");this.dialog=utils.drawDialog(this.lang.dTitle,n,a)},_makeFilter:function(){var e=this.options.maxAge,t=new Date,n=t.getTime(),a=n-60*e*1e3,o=new Date(a),i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN,property:"datetime_changed",value:o}),r=new OpenLayers.Format.Filter({version:"1.1.0"}),s=new OpenLayers.Format.XML,l=s.write(r.write(i));return l},_addLayer:function(){var e=this;this.layer=smap.core.layerInst._createLayer({init:"L.GeoJSON.WFS",url:this.options.wfsSource,options:{noBindZoom:!0,noBindDrag:!0,layerId:"_shareposition",displayName:"Shared locations",featureType:this.options.wfsFeatureType,attribution:"Malmö stads WFS",inputCrs:"EPSG:4326",selectable:!0,popup:'<span><strong>${text_username}</strong>&nbsp;&nbsp;(<span style="white-space:nowrap;">${function(p) {var d = new Date(p.datetime_changed);var dNow = new Date(); var dDiff = new Date( Math.abs(dNow.getTime() - d.getTime()) ); return dDiff.getMinutes(); }}</span> min ago)</span>',hoverColor:"#FF0",zIndex:350,reverseAxis:!1,reverseAxisBbox:!0,uniqueKey:"id",params:{typeName:"sandbox:sharedpositions",version:"1.1.0",maxFeatures:1e4,format:"text/geojson",outputFormat:"json"}}}),this.layer.options.params.filter=this._makeFilter(),this.layer.off("load"),this.layer.on("load",function(){e.layer.eachLayer(function(t){var n=L.userMarker(t.getLatLng(),{pulsing:!0,smallIcon:!0});if(e.layer.removeLayer(t),t.feature){var a=parseInt(t.feature.id.split(".")[1]),o=e.uid||localStorage.share_uid||null;o=parseInt(o),(!o||o&&o!==a)&&e.layer.addLayer(n);var i=utils.extractToHtml(e.layer.options.popup,t.feature.properties);n.bindLabel(i,{noHide:!0,direction:"right"}).showLabel()}}),smap.cmd.loading(!1)}),this.map.addLayer(this.layer);var e=this},_bindEvents:function(){var e=this;smap.event.on("smap.core.pluginsadded",function(){$("#smap-glocate-btn").on("click",function(){return $(this).hasClass("btn-primary")?($("#smap-share-btn").show(),e._addLayer(),e._startRefresh()):(e._stopShare(),e.deactivate()),!1}),$("#smap-share-btn").on("click",function(){var t=$(this).hasClass("btn-danger");t?($(this).removeClass("btn-danger"),e._stopShare()):e.dialog.modal("show")})}),this.dialog.find("input").on("click",function(){$(this).focus()}),this.dialog.find(".modal-footer .btn-primary").on("click",function(){$("#smap-share-btn").addClass("btn-danger"),e.dialog.modal("hide");var t=$.trim(e.dialog.find("input[type='text']").val());e._startShare(t)})},_onLocationFound:function(e){this._location=e},_onLocationError:function(){smap.cmd.loading(!1)},_setLocateSettings:function(){var e={watch:!0,timeout:3e4,enableHighAccuracy:!0,frequency:3e3};$.extend(this.map._locateOptions,e)},_startShare:function(e){return!this._storeInterval&&(utils.log("START sharing"),this.uName=e,this.__onLocationFound=this.__onLocationFound||$.proxy(this._onLocationFound,this),this.__onLocationError=this.__onLocationError||$.proxy(this._onLocationError,this),this.map.on("locationfound",this.__onLocationFound),this.map.on("locationerror",this.__onLocationFound),this.uid=localStorage.share_uid||null,this.__store=this.__store||$.proxy(this._store,this),this._storeInterval=setInterval(this.__store,this.options._storeIntervalMs),this._setLocateSettings(),void this.map.fire("drag"))},_startRefresh:function(){return!this._refreshInterval&&(utils.log("start refreshing"),
this.__refresh=this.__refresh||$.proxy(this._refresh,this),void(this._refreshInterval=setInterval(this.__refresh,this.options._refreshIntervalMs)))},_stopRefresh:function(){utils.log("stop refreshing"),clearInterval(this._refreshInterval),this._refreshInterval=null},_stopShare:function(){smap.cmd.loading(!1),utils.log("stop sharing"),this._stopRefresh(),clearInterval(this._storeInterval),this._storeInterval=null,this.map.off("locationfound",this.__onLocationFound,this),this.map.off("locationerror",this.__onLocationError,this),this._location=null,this.uid=null,this.uName=null},uid:null,_store:function(){return!(this._working||!this._location)&&(this._working=!0,void $.ajax({url:this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(this.options.wfsSource):this.options.wfsSource,type:"POST",context:this,data:this._getXml(this._location.latlng,this._location.accuracy,this.uName,this.uid),contentType:"text/xml",dataType:"text",error:function(e,t){utils.log("SharePosition: Error storing coordinates because of: "+t)},success:function(e){var t=$.xml2json(e),n=t?t.TransactionResponse||t["wfs:TransactionResponse"]:null;if(n){var a=n?n.TransactionSummary||n["wfs:TransactionSummary"]:null;if(a){var o=parseInt(a.totalInserted||a["wfs:totalInserted"]),i=parseInt(a.totalUpdated||a["wfs:totalUpdated"]);if(!this.uid&&o>0){var r=n.InsertResults||n["wfs:InsertResults"],s=r.Feature||r["wfs:Feature"],l=s.FeatureId||s["ogc:FeatureId"],p=l.fid||l.$.fid;this.uid=parseInt(p.split(".")[1]),localStorage.share_uid=this.uid}else 0===o&&0===i&&(this.uid=null,delete localStorage.share_uid)}}},complete:function(){this._working=!1}}))},_refresh:function(){this.layer.options.params.filter=this._makeFilter(),this.layer._refresh({force:!0})},_getXml:function(e,t,n,a){var o="",i=this.options.wfsFeatureType.split(":")[1];return o=a?'<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="'+this.options.wfsUri+'"\n  xmlns:wfs="//www.opengis.net/wfs"\n  xmlns:ogc="//www.opengis.net/ogc"\n  xmlns:gml="//www.opengis.net/gml"\n  xmlns:xsi="//www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="//www.opengis.net/wfs\n                      //schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd">\n  <wfs:Update typeName="grp:'+i+'">\n\t <wfs:Property><wfs:Name>text_username</wfs:Name><wfs:Value>'+n+"</wfs:Value></wfs:Property>\t <wfs:Property><wfs:Name>int_accuracy</wfs:Name><wfs:Value>"+t+'</wfs:Value></wfs:Property>    <wfs:Property>\n      <wfs:Name>the_geom</wfs:Name>\n      <wfs:Value>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+e.lat+","+e.lng+"</gml:coordinates>\n        </gml:Point>\n      </wfs:Value>\n    </wfs:Property>\n    <ogc:Filter>\n      <PropertyIsEqualTo>\n        <PropertyName>id</PropertyName>\n        <Literal>"+a+"</Literal>\n      </PropertyIsEqualTo>\n    </ogc:Filter>\n  </wfs:Update>\n</wfs:Transaction>":'<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="'+this.options.wfsUri+'"\n  xmlns:wfs="//www.opengis.net/wfs"\n  xmlns:gml="//www.opengis.net/gml"\n  xmlns:xsi="//www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="//www.opengis.net/wfs\n                      //schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd\n                      '+this.options.wfsSource+"/DescribeFeatureType?typename="+this.options.wfsFeatureType+'">\n  <wfs:Insert>\n    <grp:'+i+'>\n      <grp:the_geom>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+e.lat+","+e.lng+"</gml:coordinates>\n        </gml:Point>\n      </grp:the_geom>\n      <grp:int_accuracy>"+t+"</grp:int_accuracy>\n      <grp:text_username>"+n+"</grp:text_username>\n    </grp:"+i+">\n  </wfs:Insert>\n  </wfs:Transaction>"}}),L.control.sharePosition=function(e){return new L.Control.SharePosition(e)},L.Control.ShareTweet=L.Control.extend({options:{position:"topright",wfsSource:"//localhost:8080/geoserver/wfs",wfsFeatureType:"local:tweets"},_lang:{sv:{btnAdd:"Lägg till",btnUnshare:"Sluta dela position",titleDialog:"Skriv nånting",btnCancel:"Avbryt",btnSubmit:"Skicka",loading:"Arbetar..."},en:{btnAdd:"Add tweet",btnUnshare:"Stop sharing position",titleDialog:"Write something",btnCancel:"Cancel",btnSubmit:"Submit",loading:"Working..."}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-sharetweet"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._addWfsLayer();var t=this;return this.map.on("zoomend moveend",function(){t.layer._refresh()}),this._container},onRemove:function(){},_notify:function(e,t){switch(t){case"success":t="alert-success";break;case"error":t="alert-danger"}var n=$('<div class="alert '+t+' alert-dismissable"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e+"</div>");n.css({"margin-top":"20px"}),$(".modal-body").find(".alert").remove(),$(".modal-body .sharetweet-footer").before(n)},_addWfsLayer:function(){this.cluster=new L.MarkerClusterGroup,this.layer=smap.core.layerInst._createLayer({init:"L.GeoJSON.WFS",url:this.options.wfsSource,options:{layerId:"sharetweet-wfstlayer",displayName:"Tweets",featureType:this.options.wfsFeatureType,attribution:"Malmö stads WFS",inputCrs:"EPSG:4326",reverseAxis:!0,selectable:!0,popup:'<p class="lead">${text_text}</p><p>Skrivet den: <strong>${function(p) {var d = new Date(p.dtime_created);return d.toLocaleString();}}</strong></p>',uniqueAttr:null,hoverColor:"#FF0",style:{weight:6,color:"#F00",dashArray:"",fillOpacity:.5}}});var e=this;this.layer._map=this.map,this.layer.on("load",function(t){t.layer.eachLayer(function(t){e.cluster.addLayer(t)}),t.layer.clearLayers(),e.map.removeLayer(e.cluster),e.map.addLayer(e.cluster),smap.cmd.loading(!1)}),this.map.addLayer(this.cluster)},_onLocationFound:function(e){smap.cmd.loading(!1);var t=6;this.modal&&(this.modal.find('form td[name="easting"]').empty().text(utils.round(e.latlng.lng,t)),this.modal.find('form td[name="northing"]').empty().text(utils.round(e.latlng.lat,t)),this.modal.find('form td[name="accuracy"]').empty().text(utils.round(e.accuracy,1)+" m"),this.modal.find(".btn-primary").button("reset"))},_onLocationError:function(){var e=this;this._notify("Your position could not be determined","error"),setTimeout(function(){e.deactivate()},3e3)},deactivate:function(){this.modal&&this.modal.modal("hide")},shareTweet:function(){$("#sharetweet-btn").button(this.lang.btnUnshare),smap.cmd.loading(!0),this.modal=this._showDialog(),this.modal.find(".btn-primary").button("loading");var e=smap.cmd.getControl("Geolocate");e&&e.deactivate(),this.map.on("locationfound",$.proxy(this._onLocationFound,this)),this.map.on("locationerror",$.proxy(this._onLocationError,this)),this.map.locate({watch:!0,setView:!0,enableHighAccuracy:!0}),smap.cmd.loading(!1)},unShareTweet:function(){$("#sharetweet-btn").button(this.lang.btnAdd),this.map.off("locationfound",$.proxy(this._onLocationFound,this)),this.map.off("locationerror",$.proxy(this._onLocationError,this))},_showDialog:function(){var e=$('<form id="sharetweet-form" role="form"><textarea class="form-control" rows="4" name="text" minlength="5" maxlength="140" required></textarea><table><tr><td>Easting:</td><td name="easting"></td></tr><tr><td>Northing:</td><td name="northing"></td></tr><tr style="font-weight:bold;"><td>Felmarginal:</td><td name="accuracy"></td></tr></table><div class="row sharetweet-footer"><button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.btnCancel+'</button><button type="submit" class="btn btn-primary" data-loading-text="'+this.lang.loading+'">'+this.lang.btnSubmit+"</button></div></form>"),t=this;e.on("submit",function(){var e=$(this).serializeArray(),n={};return $.each(e,function(e,t){n[t.name]=t.value}),n.easting=parseFloat($(this).find('[name="easting"]').text()),n.northing=parseFloat($(this).find('[name="northing"]').text()),t._save(L.latLng(n.northing,n.easting),n.text),!1}),e.find("tr").each(function(){var e=$(this).find("td:eq(1)");e.text(""),t._addSpin(e)});var n=utils.drawDialog(this.lang.titleDialog,e,null,{size:"sm"});return e.find(".btn-default").on("click",function(){return n.modal("hide"),!1}).find(".btn-primary").on("click",function(){return!1}),n.modal("show"),n.on("hidden.bs.modal",function(){t.map.stopLocate(),t.modal.empty().remove(),t.modal=null,$("#sharetweet-btn").button(this.lang.btnAdd),$("#sharetweet-btn").removeClass("btn-primary"),delete t.modal}),n},_addSpin:function(e){var t={length:5,width:1,radius:3},n=new Spinner(t).spin();$(e).append(n.el)},_drawBtn:function(){var e=this,t=$('<button id="sharetweet-btn" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;<span>'+this.lang.btnAdd+"</span></button>");t.on("click",function(){$(this).hasClass("btn-primary")?($(this).removeClass("btn-primary"),e.unShareTweet()):($(this).addClass("btn-primary"),e.shareTweet())}),this.$container.append(t)},_createRequest:function(e,t){var n='<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="//localhost/"\n  xmlns:wfs="//www.opengis.net/wfs"\n  xmlns:gml="//www.opengis.net/gml"\n  xmlns:xsi="//www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="//www.opengis.net/wfs\n                      //schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd\n                      '+this.options.wfsSource+"/DescribeFeatureType?typename="+this.options.wfsFeatureType+'">\n  <wfs:Insert>\n    <grp:tweets>\n      <grp:text_text>'+t.text+'</grp:text_text>\n      <grp:the_geom>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+e.lat+","+e.lng+"</gml:coordinates>\n        </gml:Point>\n      </grp:the_geom>\n    </grp:tweets>\n  </wfs:Insert>\n</wfs:Transaction>";return n},_save:function(e,t){if(this.submitting)return!1;this.map.stopLocate(),this.submitting=!0,smap.cmd.loading(!0),this.modal.find(".btn-primary").button("loading");var n=this._createRequest(e,{text:t});$.ajax({url:smap.config.ws.proxy+encodeURIComponent(this.options.wfsSource),type:"POST",context:this,data:n,contentType:"text/xml",dataType:"text",success:function(e){smap.cmd.loading(!1);var t=$.xml2json(e);parseInt(t.TransactionSummary.totalInserted)>0&&(this.deactivate(),this._reload())},error:function(e,t){this._notify("Kunde inte spara. Fel: <strong>"+t+"</strong>","error"),smap.cmd.loading(!1)},complete:function(){this.modal.find(".btn-primary").button("reset"),this.submitting=!1}})},_reload:function(e){e=e||{},smap.cmd.loading(!0),this.layer._refresh()}}),L.control.shareTweet=function(e){return new L.Control.ShareTweet(e)},L.Control.ToolHandler=L.Control.extend({options:{position:"bottomright",showPopoverTitle:!1,breakpoint:991},_lang:{sv:{popoverTitle:"Verktyg"},en:{popoverTitle:"Tools"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(){return this._container=L.DomUtil.create("div","leaflet-control-toolhandler"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),utils.getBrowser().ie8||(this._makeToolHandler(),smap.event.on("smap.core.pluginsadded",function(){$(".thandler-container .leaflet-control button").each(function(){$(this).tooltip({placement:"bottom",container:"#maindiv"})})})),this._onWinResize=$.proxy(this.onWinResize,this),$(window).on("resize",this._onWinResize),this.checkCollapsePoint(),this._container},onWinResize:function(){this.checkCollapsePoint()},checkCollapsePoint:function(){var e=$(window).width();e<=this.options.breakpoint?$("#mapdiv").addClass("thandler-collapsed"):$("#mapdiv").removeClass("thandler-collapsed")},activate:function(){},_makeToolHandler:function(){function e(e){var t=$(".thandler-popover").length&&parseInt($(".thandler-popover").css("opacity")||0)>0,n=$(".popover-content");o.data("bs.popover")&&t&&n.children().length&&(utils.getBrowser().ie9&&i(),o.popover("hide")),smap.event.trigger("smap.toolhandler.hide",e),$(".thandler-container .leaflet-control button").each(function(){$(this).trigger("blur")}),$(".tooltip:visible").hide()}function t(){var e=$(".thandler-container").children(":has('button')");e.length&&o.popover("show")}var n=this,a=$(".leaflet-top.leaflet-right");this.$thCont=a,a.addClass("thandler-container");var o=$('<div class="thandler-btn popover-dismiss"><button type="button" class="btn btn-default thbtn"><span class="fa fa-th"></span></button></div>');$("#mapdiv").append(o),this._map.on("click dragstart",e),$(window).on("orientationchange",e);var i=function(){$(window).off("resize",e);var t=$(".popover-content");setTimeout(function(){t.children().each(function(){$(".thandler-container").prepend(this)})},150)};o.on("click",function(){var a=$(this);if(a.data("bs.popover")){var o=$(".thandler-popover").length&&parseInt($(".thandler-popover").css("opacity")||0)>0;if(o)return utils.getBrowser().ie9&&i(),a.popover("hide"),!1}else a.popover({content:null,placement:"bottom",title:n.lang.popoverTitle,trigger:"manual"}),a.on("shown.bs.popover",function(){var t=$(".popover"),a=$(".popover-content");n.options.showPopoverTitle||t.find("h3").remove(),t.addClass("thandler-popover");var o=$(".thandler-container").children(".leaflet-control:has('button')").detach();a.empty(),o.each(function(){a.prepend(this)}),$(window).on("resize",e)}),a.on("hidden.bs.popover",i);return t(),!1}),o.on("tap",function(){return!1}),o.on("dblclick",function(){return!1})},onRemove:function(){$(window).off("resize",this._onWinResize)}}),L.control.toolhandler=function(e){return new L.Control.ToolHandler(e)},L.Control.VspuHeaderLund=L.Control.extend({options:{position:"topright",btnID:"vspu-btn"},_lang:{sv:{caption:"Genvägar"},en:{caption:"Themes"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-VspuHeaderLund"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createMenu();var t="";return this.options.btnID&&(t=this.options.btnID),this.addButton(t,"Genvägar","fa fa-plus-circle",function(){return!1}),this._container},addButton:function(e,t,n,a,o){o=o||{};var i=$('<div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Genvägar <span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button><ul class="dropdown-menu" role="menu"><li><a href="http://kartor.lund.se/vspu/?zoom=14&center=13.6306,55.65929&ol=Avrinningsområde,Kommungränser,VA_vattenskyddsområde,Dammdatabas&bl=binglayer">Björkaprojektet</a></li><li><a href="http://kartor.lund.se/vspu/?zoom=12&center=13.64777,55.71735&ol=Avrinningsområde,Vattendrag-huvud,Vattendrag-mellan,Vattendrag-sma,Kommungränser,Dammdatabas&bl=mapboxlund">Torpsbäcken</a></li><li><a href="http://kartor.lund.se/vspu/?zoom=10&center=13.3717,55.66209&ol=Avrinningsområde,VATTENFOREKOMSTER,Kommungränser,Plan-pågående,OP_nybyggnad,OP_omvandling,OP_linje,Simrishamnsbanan&bl=mapboxlund">Pågående planering</a></li><li><a href="http://kartor.lund.se/vspu/?zoom=12&center=13.03768,55.73929&ol=Avrinningsområde,Kommungränser,OP_nybyggnad,OP_omvandling,Havsnivåökning3m,Havsnivåökning1m,OP_linje&bl=mapboxlund">Översvämningsrisker</a></li></ul></div>');o.proxy,$("#btns").append(i),o.callback&&o.callback(i)},_createMenu:function(){var e=$('<header id="smap-vspuHeaderLund-div" class="navbar navbar-static-top bs-docs-nav" role="banner"><div class="container"><div class="navbar-header">    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">      <span class="sr-only">Toggle navigation</span>      <span class="fa fa-bars"></span>    </button><a class="navbar-brand" href="localhost:8080/karta/dev.html?config=configVspu.js">Kävlingeåns vattenstrategiska planeringsunderlag</a>  </div>  <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">    <ul id="btns" class="nav navbar-nav navbar-right">    </ul>  </nav></div></header>');$("#maindiv").prepend(e),$("body").addClass("mf-v4 no-footer")},onRemove:function(){}}),L.control.vspuHeaderLund=function(e){return new L.Control.VspuHeaderLund(e)},L.Control.Zoombar=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-zoombar"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.addClass("btn-group-vertical"),this.$container.on("mousedown",function(){return!1}),this._createButtonZoomIn(),this._createButtonZoomUt(),this.__onZoomEnd=this.__onZoomEnd||$.proxy(this._onZoomEnd,this),this.map.on("zoomend",this.__onZoomEnd),this._container},_onZoomEnd:function(){this.map.getZoom()>=this.map.getMaxZoom()?this.$container.find("#zoombar-plus").addClass("disabled"):this.map.getZoom()<=this.map.getMinZoom()?this.$container.find("#zoombar-minus").addClass("disabled"):this.$container.find("button").removeClass("disabled")},_createButtonZoomIn:function(){var e=$('<button id="zoombar-plus" class="btn btn-default"><span class="fa fa-plus"></span></button>');this.$container.append(e),e.on("click touchstart dblclick",function(){return smap.map.zoomIn(),!1})},_createButtonZoomUt:function(){var e=$('<button id="zoombar-minus" class="btn btn-default"><span class="fa fa-minus"></span></button>');this.$container.append(e),e.on("click touchstart dblclick",function(){return smap.map.zoomOut(),!1})},onRemove:function(){}}),L.control.zoombar=function(e){return new L.Control.Zoombar(e)},L.Control.Osmbuildings=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{errorOsmbuildings:"Kunde inte visa 3D byggnader",notSupported:"Din webbläsare stödjer 3D byggnader"},en:{errorOsmbuildings:"Can´t visualize 3D buildings",notSupported:"Your browser does not support 3D buildings"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Osmbuildings"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawButton(),this._container},onRemove:function(){},_drawButton:function(){var e=$('<button id="smap-glocate-btn" class="btn btn-default"><span class="fa fa-cube"></span></button>');this.$container.append(e),this.btn=e,e.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this))},activate:function(){return!this.active&&(this.active=!0,this.btn.addClass("btn-primary"),void(osmb=new OSMBuildings(this.map).load()))},deactivate:function(){return!!this.active&&(this.active=!1,this.map.removeLayer(this.map._layers[osmb._leaflet_id]),void this.btn.removeClass("btn-primary"))}}),L.control.osmbuildings=function(e){return new L.Control.Osmbuildings(e)},L.Control.GetFeatureInfo=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",buffer:12,_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Markhöjder"},en:{btntitle:"Markhöjder"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-featureinfo"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this.featureInfoPanel={},this._container},onRemove:function(){},activate:function(){this.active=!0,this.btn.addClass("btn-primary");var e=smap.cmd.getControl("L.Control.SelectWMS");e.deactivate();var t=smap.cmd.getControl("L.Control.SelectVector");t.deactivate(),this.featureInfoPanel.selectionPanelCreated?this._updateSelectionPanel():this._drawSelectionPanel(),this.map.on("click",this._onMapClick,this),$(".mapdiv")[0].style.cursor="crosshair"},deactivate:function(){this.active=!1,this.btn.removeClass("btn-primary");var e=smap.cmd.getControl("L.Control.SelectWMS");e.activate();var t=smap.cmd.getControl("L.Control.SelectVector");t.activate(),this.map.off("click",this._onMapClick,this),this._hideSelectionPanel(),"undefined"!=typeof this.heightLayer&&null!==this.heightLayer,$(".mapdiv")[0].style.cursor=""},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-selection-info",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-getFeatureinfo-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="fa fa-selection-info"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAUCAQAAAAua3X8AAAAAXNSR0IArs4c6QAAAAlwSFlzAAARKgAAESoB/3Si4QAAAAd0SU1FB+ACBQkGM3HV728AAAACYktHRAD/h4/MvwAAAdxJREFUGBkFwU9olnUcAPDP9/c877Ze5xzqQMfAdkjsD74oKhJ0UC8dMiX0Ktgh0tElPAR5CjzWqSjw5KVAIoMui4koSgaZf1CC8KAyVzidurV3ub3P8/z8fILrO+b6QggZbFy+eXF2kGWVLceDqZmbo40EWl7Y6ooF/f5xP38UJaPn1q6NeP76D50jl4ce1qu3fXh2ZqE17wVB3NIB3+dvLL977Vc4/GxhuKvRmJA6gFuq/MYkj4OWfo1AIwGsGFC6fXsk96bG83ZJVkoS/IH9n6+KiS9fu/M8F7PznshoUMJOl3K/ibtPt/w2tutCFNMWNUo9lDD9yWGHnNh84OpgZ2+ZJ9tq/6tRSDD2da+62pzK1e6VPFN51JcWH2SBLIGByrxpXSlu7LBu2AZkhSyBoYi96bvo/72Xt13ztG5amwgkJcSjr4rVX3Boqa3URE9SyGq1BN/6NN5MB/O+Ex+caT9OFj2RhUIhwTH8ebLr5+sDn9UjjREdoVFblgD+9swv7r8/HOnH+bgnBLIE8JbCUeOniZ+6MaeSlV6RJjHzDmMnX9V9G/59b3BNWympLAmm/vtrkMqcjZIVm6fO71pac0PI+eMoae8Z6mthVC3L1vd2Xpg1rrESAxMvAXiEtvkQFNikAAAAAElFTkSuQmCC"></img></span></button>');t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this)),this.btn=t,this.$container.append(t)}},_drawSelectionPanel:function(){this.featureInfoPanel.maxWidth=300,this.featureInfoPanel.maxHeight=250,this.featureInfoPanel.minHeight=150,window.featureInfoPanel_state?0==window.featureInfoPanel_state?window.featureInfoPanel_state=1:1==window.featureInfoPanel_state&&(window.featureInfoPanel_state=0):window.featureInfoPanel_state=0,this.featureInfoPanel.selectionPanelCreated=!0;var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.featureInfoPanel.getfeatureInfoPanel_div=document.createElement("div"),this.featureInfoPanel.getfeatureInfoPanel_div.id="getfeatureInfoPanel_div",this.featureInfoPanel.getfeatureInfoPanel_div.style.background="white",this.featureInfoPanel.getfeatureInfoPanel_div.style.position="fixed",this.featureInfoPanel.getfeatureInfoPanel_div.style.top="0px",this.featureInfoPanel.getfeatureInfoPanel_div.style.zIndex="2005",this.featureInfoPanel.getfeatureInfoPanel_div.style.width=70*e/100+"px",this.featureInfoPanel.getfeatureInfoPanel_div.style.maxWidth=this.featureInfoPanel.maxWidth+"px",this.featureInfoPanel.getfeatureInfoPanel_div.style.minHeight=this.featureInfoPanel.minHeight+"px",this.featureInfoPanel.getfeatureInfoPanel_div.style.display="block",this.featureInfoPanel.getfeatureInfoPanel_div.style.background="rgba(255,255,255,0)",this.featureInfoPanel.getfeatureInfoPanel_div.style.className="modal-dialog";var n=e/2-this.featureInfoPanel.maxWidth/2;this.featureInfoPanel.getfeatureInfoPanel_div.style.right=n+"px",n<40&&(this.featureInfoPanel.getfeatureInfoPanel_div.style.right="40px",n=40);var a=document.createElement("button");a.id="docSelectionpanelButtonID",a.className="minimize",a.onclick=function(){document.getElementById("selectionPanelDocImg");$("#getfeatureInfoPanel_div")[0].style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="block",window.featureInfoPanel_state=1};var o=document.createElement("span");o.id="selectionPanelDocImg",o.className="glyphicon glyphicon-minus",a.appendChild(o),this.featureInfoPanel.getfeatureInfoPanel_div.appendChild(a);var i=document.createElement("button");i.id="StopGetInfoWidget",i.className="close";var r=document.createElement("span");r.id="selectionPanelDocImg2",r.className="glyphicon glyphicon-remove",i.appendChild(r),this.featureInfoPanel.getfeatureInfoPanel_div.appendChild(i),this.featureInfoPanel.getfeatureInfoPanel_body_div=document.createElement("div"),this.featureInfoPanel.getfeatureInfoPanel_body_div.id="getfeatureInfoPanel_body_div",this.featureInfoPanel.getfeatureInfoPanel_body_div.className="modal-body",this.featureInfoPanel.getfeatureInfoPanel_body_div.style.background="white",this.featureInfoPanel.getfeatureInfoPanel_body_div.style.height="100%",this.featureInfoPanel.getfeatureInfoPanel_body_div.style.overflow="auto";var s=$('<div><h4 class="modal-header" style="position:absolute; top:-10px; left:0; border-bottom: solid 1px #ccc; width:100%; margin-bottom: 5px;">Markhöjder</h4><div class="row" style="padding-top:35px"><div class=".col-sm-12"><div class="btn-group" role="group" aria-label="..."><button id="deleteAllHeightPoints" type="button" class="btn btn-default">Radera alla</button></div></div></div>  <div style="margin-top: 0.2em;" class="row"><div class=".col-sm-8">            <table><tr><td>Behåll gamla punkter</td> <td> <input checked type="checkbox" id="keepOldPoints_id" name="keepOldPoints" aria-label="..."></td></tr><tr><td colspan="2"><button class="btn btn-default btn-sm he-tog">Mer info</button></td></tr> <tr style="display:none;" class="he-ogt"> <td colspan="2"> <b>Höjddata RH2000:</b> Med detta verktyget klickar du kartan och får reda på höjdvärdet i RH2000. NNH-data med 2m upplösning. Klicka på punkten för att få mer information.</td> </tr></table>                 </div>')[0];this.featureInfoPanel.getfeatureInfoPanel_body_div.appendChild(s),this.featureInfoPanel.getfeatureInfoPanel_div.appendChild(this.featureInfoPanel.getfeatureInfoPanel_body_div),document.body.appendChild(this.featureInfoPanel.getfeatureInfoPanel_div),this.featureInfoPanel.getfeatureInfoPanel_div_alt=document.createElement("div"),this.featureInfoPanel.getfeatureInfoPanel_div_alt.id="getfeatureInfoPanel_div_alt_id",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.background="#fff",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.position="fixed",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.top="0px",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.zIndex="2005",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.width="195px",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.height="45px",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.display="none",n+=42.5,this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.right=n+"px";var s=$('<div><h4 class="modal-header" style="position:absolute; top:-10px; left:0; width:100%; margin-bottom: 5px; border:0">Markhöjder</h4></div>')[0];this.featureInfoPanel.getfeatureInfoPanel_div_alt.appendChild(s);var l=document.createElement("button");l.id="docSelectionpanelAltButtonID",l.className="minimize",l.onclick=function(){window.featureInfoPanel_state=0;document.getElementById("selectionPanelDocImg");$("#getfeatureInfoPanel_div")[0].style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"};var p=document.createElement("span");p.id="selectionPanelDocImg",p.className="glyphicon glyphicon-plus",l.appendChild(p),this.featureInfoPanel.getfeatureInfoPanel_div_alt.appendChild(l);var c=document.createElement("button");c.id="StopGetInfoWidget_alt",c.className="close";var d=document.createElement("span");d.id="selectionPanelDocImg_alt2",d.className="glyphicon glyphicon-remove",c.appendChild(d),this.featureInfoPanel.getfeatureInfoPanel_div_alt.appendChild(c),document.body.appendChild(this.featureInfoPanel.getfeatureInfoPanel_div_alt),this.featureInfoPanel.selectionPanelVisible=!0,smap.map.on("resize onorientationchange",$.proxy(function(){this._adjustResize_orientationChange()},this)),$("[name='keepOldPoints']").bootstrapSwitch(),$("#deleteAllHeightPoints").on("click",function(){window.heightLayer.clearLayers()}),$("#StopGetInfoWidget").on("click",function(){document.getElementById("smap-getFeatureinfo-btn").click()}),$("#StopGetInfoWidget_alt").on("click",function(){document.getElementById("smap-getFeatureinfo-btn").click()}),$(".btn.btn-default.btn-sm.he-tog").on("touchstart click",$.proxy(function(){$(".btn.btn-default.btn-sm.he-tog")[0].style.display="none",$(".he-ogt")[0].style.display="block",this.featureInfoPanel.getfeatureInfoPanel_div.style.height=35*t/100+"px"},this))},_toggleSelectionPanel:function(){"fa fa-2x fa-chevron-left"===$("#lswitch-btn")[0].childNodes[0].className?($("#getfeatureInfoPanel_div_alt_id")[0].style.display="none",$("#getfeatureInfoPanel_div")[0].style.display="none"):"fa fa-bars fa-2x"===$("#lswitch-btn")[0].childNodes[0].className?window.featureInfoPanel_state?1===window.featureInfoPanel_state?($("#getfeatureInfoPanel_div")[0].style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="block"):0===window.featureInfoPanel_state&&(window.featureInfoPanel_state=0):($("#getfeatureInfoPanel_div")[0].style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"):"fa fa-2x fa-bars"===$("#lswitch-btn")[0].childNodes[0].className&&(window.featureInfoPanel_state?1===window.featureInfoPanel_state?($("#getfeatureInfoPanel_div")[0].style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="block"):0===window.featureInfoPanel_state&&(window.featureInfoPanel_state=0):($("#getfeatureInfoPanel_div")[0].style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"))},_showSelectionPanel:function(){this.featureInfoPanel.selectionPanelVisible||(window.featureInfoPanel_state=0,this.featureInfoPanel.getfeatureInfoPanel_div.style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none",this.featureInfoPanel.selectionPanelVisible=!0)},_hideSelectionPanel:function(){window.featureInfoPanel_state=1,this.featureInfoPanel.selectionPanelVisible=!1,this.featureInfoPanel.getfeatureInfoPanel_div.style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"},_updateSelectionPanel:function(){this._showSelectionPanel();var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;$(".btn.btn-default.btn-sm.he-tog")[0].style.display="block",$(".he-ogt")[0].style.display="none",this.featureInfoPanel.getfeatureInfoPanel_div.style.height=13*e/100+"px"},_adjustResize_orientationChange:function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e/2-this.featureInfoPanel.maxWidth/2);this.featureInfoPanel.getfeatureInfoPanel_div.style.left=t+"px",t<30&&(this.featureInfoPanel.getfeatureInfoPanel_div.style.left="30px"),this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.left=t+"px",t<30&&(this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.left="30px")},_onMapClick:function(e){this._updateSelectionPanel();var getHeightValue=this._getFeatureInfo(e);"undefined"!=typeof this.heightLayer&&null!==this.heightLayer||(this.heightLayer=L.layerGroup(),window.heightLayer=this.heightLayer,
this.heightLayer.id="heightLayer",this.map.addLayer(this.heightLayer));var keepOldPointsState=document.getElementById("keepOldPoints_id").checked;keepOldPointsState||window.heightLayer.clearLayers();var mapLabel_pr=function(){if(getHeightValue.mapLabel){if(isNaN(getHeightValue.mapLabel))return getHeightValue.mapLabel;var local_label=eval(getHeightValue.mapLabel);return local_label=local_label>=0?"+"+(Math.round(100*local_label)/100).toString():(Math.round(100*local_label)/100).toString()}return"fel"}(),labelUnit="Ingen data"===mapLabel_pr?"":"m",markerIcon=L.divIcon({className:"height-div-icon",html:'<p style="position:relative;bottom:3px;font-size:10.5pt;font-family:Arial;font-weight:normal;color:#000;text-shadow:0 0 5px #fff"><b>'+mapLabel_pr+"&nbsp;"+labelUnit+"</b></p>"}),markerOptions={icon:markerIcon,clickable:!0,externalGraphic:"http://"+window.location.host+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1)+"img/legend/empty.png",label:mapLabel_pr+" "+labelUnit,fontColor:"#000000",fontSize:10.5,fontFamily:"Arial",fontWeight:"bold",labelAlign:"lb",labelXOffset:-4,labelYOffset:-4},createRandomNumber=Math.random().toString().split(".")[1],heightMarker=L.marker([e.latlng.lat,e.latlng.lng],markerOptions);heightMarker.id="heightMarkerId_"+createRandomNumber;var heightPopupOptions={keepInView:!1},heightPopup=L.popup(heightPopupOptions),popupContent="<div><div><b>Koordinatsystem:</b> </br> WGS 84 decimal (lat, lon)</div><div><b>Latitud: </b>"+Math.round(1e4*e.latlng.lat)/1e4+"</div><div><b>Longitud: </b>"+Math.round(1e4*e.latlng.lng)/1e4+"</div><div><b>Höjd </b>: "+mapLabel_pr+" "+labelUnit+"</div></div>",parentHeightDiv=document.createElement("div");parentHeightDiv.appendChild($(popupContent)[0]);var deleteSingleMarker_div=document.createElement("div");deleteSingleMarker_button=document.createElement("button"),deleteSingleMarker_button.id="smap-height-popupbtn_"+createRandomNumber,deleteSingleMarker_button.className="btn btn-default btn-sm",deleteSingleMarker_button.value="Ta bort",deleteSingleMarker_button[getTextContent(deleteSingleMarker_button)]="Ta bort",deleteSingleMarker_button.onclick=function(){var e=null,t="heightMarkerId_"+this.id.split("_")[1],n=window.heightLayer._layers;if(n)for(lay in n)n[lay].id===t&&(e=n[lay]);window.heightLayer.removeLayer(e)},deleteSingleMarker_div.appendChild(deleteSingleMarker_button),parentHeightDiv.childNodes[0].appendChild(deleteSingleMarker_div),heightPopup.setContent(parentHeightDiv),heightMarker.bindPopup(heightPopup),heightMarker.addTo(this.heightLayer),0===window.featureInfoPanel_state?document.getElementById("docSelectionpanelButtonID").click():""},_createHeightSymbol:function(e){var t=document.createElement("canvas");t.id="heightData",t.width="55",t.height="25";var n=t.getContext("2d");return n.font="15px serif",n.fillText(e,0,15),t.toDataURL()},_getFeatureInfo:function(e){var t={},n="";if(this.options.selectOptions){for(v in this.options.selectOptions)"URL"!==v&&(n=n+v+"="+this.options.selectOptions[v]+"&");if(this.options.selectOptions.URL)if(this.options.selectOptions.URL.indexOf("?")>=0){var a=this.options.selectOptions.URL.split("?"),o=a[0],i=a[1];n=o+"?"+n+i}else n=this.options.selectOptions.URL+"?"+n;var r=this.map.latLngToContainerPoint(e.latlng),s=this.options.buffer,l=new OpenLayers.Pixel(r.x-s,r.y+s),p=new OpenLayers.Pixel(r.x+s,r.y-s),c=L.point(l.x,l.y),d=L.point(p.x,p.y),h=this.map.containerPointToLatLng(c),u=this.map.containerPointToLatLng(d),m=L.latLngBounds(h,u),f=m.toBBoxString();if(this.options.selectOptions.SRS&&"EPSG:4326"!==this.options.selectOptions.SRS){var g=m.getSouthWest(),_=m.getNorthEast();g=utils.projectLatLng(g,"EPSG:4326",this.options.selectOptions.SRS,!1,!1),_=utils.projectLatLng(_,"EPSG:4326",this.options.selectOptions.SRS,!1,!1),m=L.latLngBounds(g,_),f=m.toBBoxString()}n=n+"&BBOX="+f+"&X="+utils.round(r.x)+"&Y="+utils.round(r.y)+"&WIDTH="+utils.round(this.map.getSize().x)+"&HEIGHT="+utils.round(this.map.getSize().y)+"&exceptions=application%2Fvnd.ogc.se_xml";var y=new this._xhr_handler;if(y.open("GET",n,!1),y.send(null),4==y.readyState&&200==y.status)var b=y.responseText;if("text/html"==this.options.selectOptions.INFO_FORMAT){var w=document.createElement("html");jQuery(w).html(b),mapLabel=this.options.mapLbelColumn,catchAll_th=w.getElementsByTagName("th"),catchAll_td=w.getElementsByTagName("td"),mapLabel_index=function(){for(var e=0;e<catchAll_th.length;e++)if(catchAll_th[e][getTextContent(catchAll_th[e])]===mapLabel)return e}(),mapLabelValue=mapLabel_index?catchAll_td[mapLabel_index][getTextContent(catchAll_td[mapLabel_index])]:"Ingen data",t.mapLabel=mapLabelValue,t.fullResponse=w}}return t},_showSplashMessage:function(e){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,a=document.createElement("div"),o=300,i=300;a.id="generalSplashID",a.style.width=o+"px",a.style.height=i+"px",a.style.left=t/2-o/2+"px",a.style.top=n/2-i/2+"px",a.style.background="rgba(0,0,0,0.8)",a.style.zIndex="4000",a.style.position="fixed",a.style.border="5px solid white",a.style.borderRadius="15px";var r=document.createElement("div");r.id="closeSpan_div_id",r.style.position="relative";var s=document.createElement("span");s.style.color="white",s[getTextContent(s)]=" X ",s.style.position="relative",s.style.borderRadius="20px",s.style.background="rgba(0,0,0,1)",s.style.fontSize="25px",s.style.top="10px",s.style.left=o/2-10+"px",s.onclick=function(){var e=document.getElementById("generalSplashID");e&&document.body.removeChild(e)},r.appendChild(s),a.appendChild(r);var l=document.createElement("div");l.style.marginTop="20px",l.style.marginLeft="10px",l.style.color="white",l[getTextContent(l)]=e+" Meddelandet kommer att stängas i 10 sekunder.",a.appendChild(l),document.body.appendChild(a),window.setTimeout(function(){var e=document.getElementById("generalSplashID");e&&document.body.removeChild(e)},1e4)},_xhr_handler:function(e,t){try{return new XMLHttpRequest}catch(n){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(n){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}return alert("XMLHttpRequest not supported"),null}}),L.Control.DrawMarker=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",buffer:12,_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Placera markör"},en:{btntitle:"Place marker"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-drawmarker"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this.featureInfoPanel={},this._container},onRemove:function(){},activate:function(){$("#drawMarker").click(),$("#smap-drawMarker-btn").removeClass("btn-default"),$("#smap-drawMarker-btn").addClass("btn-primary")},deactivate:function(){},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-map-marker",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-drawMarker-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="fa fa-map-marker"><img class=""></img></span></button>');t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this)),this.btn=t,this.$container.append(t)}}}),L.control.getFeatureInfo=function(e){return new L.Control.GetFeatureInfo(e)},L.Control.ShowHideSearch=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Visa/dölj sök"},en:{btntitle:"Show/hide search"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-showhidesearch"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._hideSearchPanelOnload(),this._container},onRemove:function(){},activate:function(){this.active=!0,this.btn.addClass("btn-primary");var e=document.getElementById("smap-search-div");e&&(e.style.display="table",$("#searchInputDetact").focus(),$(".popover.fade.bottom.in.thandler-popover")&&$(".popover.fade.bottom.in.thandler-popover").length>0&&($(".thandler-btn.popover-dismiss").click(),$(".tooltip.fade.bottom.in")[0]?$(".tooltip.fade.bottom.in")[0].style.display="none":""))},deactivate:function(){this.active=!1,this.btn.removeClass("btn-primary");var e=document.getElementById("smap-search-div");e&&(e.style.display="none")},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","glyphicon glyphicon-search",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-showhidesearch-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button>');t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this)),this.btn=t,this.$container.append(t)}},_hideSearchPanelOnload:function(){var e=document.getElementById("smap-search-div");e?e.style.display="none":window.setTimeout(function(){var e=document.getElementById("smap-search-div");e&&(e.style.display="none")},2e3)}}),L.Control.showHideSearch=function(e){return new L.Control.ShowHideSearch(e)},L.Control.ShowHidePlainLegend=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Visa/dölj teckenförklaring"},en:{btntitle:"Show/hide legend"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-showhideplainlegend"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._container},onRemove:function(){},activate:function(){this.active=!0,this.btn.addClass("btn-primary"),"undefined"==typeof L.Control.ShowHidePlainLegend.prototype._model||null===L.Control.ShowHidePlainLegend.prototype._model?this.createPlainLegend():L.Control.ShowHidePlainLegend.prototype._model.modal("show")},deactivate:function(){this.active=!1,this.btn.removeClass("btn-primary")},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","glyphicon glyphicon-barcode",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-showhideplainlegend-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="glyphicon glyphicon-barcode"></span></button>');t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this)),this.btn=t,this.$container.append(t)}},createPlainLegend:function(){var e='<button type="button" class="btn btn-default" data-dismiss="modal">Stäng</button>',t="";t+='<div id="plainlegend_content_div_id" class="row">  </div>';window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;L.Control.ShowHidePlainLegend.prototype._model=utils.drawDialog(this.options.displayName,t,e,{size:"lg"}),L.Control.ShowHidePlainLegend.prototype._model.attr("id","plainlegend_dialog_id"),L.Control.ShowHidePlainLegend.prototype._model.modal("show"),L.Control.ShowHidePlainLegend.prototype.options=this.options,L.Control.ShowHidePlainLegend.prototype._model.on("shown.bs.modal",function(){smap.cmd.showAllMapLayerLegendTogether();var e=document.getElementById("plainlegend_content_div_id");if(smap.cmd.allActiveLayersLegend.length>0){var t=function(){for(var e="",t=0;t<smap.cmd.allActiveLayersLegend.length;t++)e=t===smap.cmd.allActiveLayersLegend.length-1?e+'"'+smap.cmd.allActiveLayersLegend[t]+'"':e+'"'+smap.cmd.allActiveLayersLegend[t]+'",';var n='{"legends": ['+e+"]}",a="",o=new smap.cmd._xhr_handler;if(o.open("POST",L.Control.ShowHidePlainLegend.prototype.options.serviceURL,!1),o.send(n),4==o.readyState&&200==o.status&&(a=o.responseText),"undefined"!=typeof a.match("data:image/png;base64")&&null!==a.match("data:image/png;base64"))if(a.match("data:image/png;base64").indexOf("data:image/png;base64")>=0)var i=$('<div id = "legendContainerDiv_id"><div class="col-xs-12 col-sm-12"><img style="max-width:85%;" class="" src="'+a+'" ></img></div></div>');else{for(var r="",t=0;t<smap.cmd.allActiveLayersLegendWithDisplayName.length;t++)r=r+"<span><b>"+smap.cmd.allActiveLayersLegendWithDisplayName[t].split("legend_saperator")[0]+':</b></span><img style ="max-widtg:85%" src ='+smap.cmd.allActiveLayersLegendWithDisplayName[t].split("legend_saperator")[1]+">";var i=$('<div id = "legendContainerDiv_id"><div class="col-xs-12 col-sm-12">'+r+"</div></div>")}else{for(var r="",t=0;t<smap.cmd.allActiveLayersLegendWithDisplayName.length;t++)r=r+"<span><b>"+smap.cmd.allActiveLayersLegendWithDisplayName[t].split("legend_saperator")[0]+':</b></span><img style ="max-widtg:85%" src ='+smap.cmd.allActiveLayersLegendWithDisplayName[t].split("legend_saperator")[1]+">";var i=$('<div id = "legendContainerDiv_id"><div class="col-xs-12 col-sm-12">'+r+"</div></div>")}return i};if("undefined"!=typeof L.Control.ShowHidePlainLegend.prototype.options.frClient&&null!==L.Control.ShowHidePlainLegend.prototype.options.frClient)if(L.Control.ShowHidePlainLegend.prototype.options.frClient){for(var n="",a=0;a<smap.cmd.allActiveLayersLegendWithDisplayName.length;a++)n=n+"<span><b>"+smap.cmd.allActiveLayersLegendWithDisplayName[a].split("legend_saperator")[0]+':</b></span><img style ="max-widtg:85%" src ='+smap.cmd.allActiveLayersLegendWithDisplayName[a].split("legend_saperator")[1]+">";var o=$('<div id = "legendContainerDiv_id"><div class="col-xs-12 col-sm-12">'+n+"</div></div>")}else var o=t();else var o=t()}else var o=$('<div id = "legendContainerDiv_id"><div class="col-xs-12 col-sm-12"><span>Ingen kartlager har vält i kartan</span></div></div>');e.appendChild(o[0])}),L.Control.ShowHidePlainLegend.prototype._model.on("hidden.bs.modal",function(){var e=document.getElementById("plainlegend_content_div_id"),t=document.getElementById("legendContainerDiv_id");e.removeChild(t),document.getElementById("smap-showhideplainlegend-btn").click()})}}),L.Control.showHidePlainLegend=function(e){return new L.Control.ShowHidePlainLegend(e)},window.loadedPopup_image_Height=0,window.loadedPopup_image_Width=0,window.getTextContent=function(e){var t="innerText"in e?"innerText":"textContent";return t},window.adj_lswitch_btn=function(){document.getElementById("lswitch-panel_unselectable")&&($("#lswitch-btn")[0].style.left=document.getElementById("lswitch-panel_unselectable").getBoundingClientRect().right+"px")},smap.event.on("smap.core.applyparams",function(){smap.cmd.advSearch(smap.map)}),smap.event.on("smap.core.applyparams",function(){smap.cmd.mergeLayers()}),smap.event.on("smap.core.applyparams",function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;e&&(e<375||window!=window.top)&&$(".lswitch-btnhide.btn.btn-default")&&$(".lswitch-btnhide.btn.btn-default").length>0&&$(".lswitch-btnhide.btn.btn-default")[0].click()}),smap.event.on("smap.core.applyparams",function(){var e={};e.hideAllModules=window.getQueryParameters("hideallmodules"),e.hideSearchModule=window.getQueryParameters("hidesearchmodule"),e.hideOpacityModule=window.getQueryParameters("hideopacitymodule"),e.hideMeasureModule=window.getQueryParameters("hidemeasuremodule"),e.hideShareModule=window.getQueryParameters("hidesharemodule"),e.hideHeightModule=window.getQueryParameters("hideheightmodule"),e.hidePrintModule=window.getQueryParameters("hideprintmodule"),e.hideAboutMapModule=window.getQueryParameters("hideaboutmapmodule"),e.hideLocateModule=window.getQueryParameters("hideLocateModule"),e.hideLegendModule=window.getQueryParameters("hideLegendModule");var t=function(e){e.hideSearchModule.length>0&&"true"===e.hideSearchModule&&document.getElementById("smap-showhidesearch-btn")&&($("#smap-showhidesearch-btn")[0].style.display="none"),e.hideOpacityModule.length>0&&"true"===e.hideOpacityModule&&document.getElementById("smap-opacity-btn")&&($("#smap-opacity-btn")[0].style.display="none"),e.hideMeasureModule.length>0&&"true"===e.hideMeasureModule&&$(".leaflet-control-measuredraw.leaflet-control")[0]&&($(".leaflet-control-measuredraw.leaflet-control")[0].style.display="none"),e.hideShareModule.length>0&&"true"===e.hideShareModule&&document.getElementById("smap-sharelink-btn")&&($("#smap-sharelink-btn")[0].style.display="none"),e.hideHeightModule.length>0&&"true"===e.hideHeightModule&&document.getElementById("smap-getFeatureinfo-btn")&&($("#smap-getFeatureinfo-btn")[0].style.display="none"),e.hidePrintModule.length>0&&"true"===e.hidePrintModule&&document.getElementById("smap-print-btn")&&($("#smap-print-btn")[0].style.display="none"),e.hideAboutMapModule.length>0&&"true"===e.hideAboutMapModule&&document.getElementById("smap-info-btn")&&($("#smap-info-btn")[0].style.display="none"),e.hideLocateModule.length>0&&"true"===e.hideLocateModule&&document.getElementById("smap-glocate-btn")&&($("#smap-glocate-btn")[0].style.display="none"),e.hideLegendModule.length>0&&"true"===e.hideLegendModule&&document.getElementById("smap-showhideplainlegend-btn")&&($("#smap-showhideplainlegend-btn")[0].style.display="none")};if(e.hideAllModules.length>0)if("true"===e.hideAllModules){for(key in e)"hideLocateModule"===key&&(e[key].length>0?"true"===e[key]||(e[key]="false"):e[key]="false"),"false"!==e[key]&&(e[key]="true");t(e);var n="true";for(key in e)"hideLocateModule"===key||"false"===e[key]&&(n="false");"true"===n&&$(".thandler-btn.popover-dismiss")&&$(".thandler-btn.popover-dismiss").length>0&&($(".thandler-btn.popover-dismiss")[0].style.display="none")}else t(e);else t(e);var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;(a<257||o<361)&&$("#kristianstad_logo_id")&&$("#kristianstad_logo_id").length>0&&($("#kristianstad_logo_id")[0].style.display="none")});