function resizeIframeHeight(e){e.height=e.contentWindow.document.body.scrollHeight+14+"px"}!function(){var e=this;if(!e.localStorage){if(e.globalStorage){try{e.localStorage=e.globalStorage}catch(t){}return}var n=document.createElement("div"),a="localStorage";if(n.style.display="none",document.getElementsByTagName("head")[0].appendChild(n),n.addBehavior){n.addBehavior("#default#userdata");var i=e.localStorage={length:0,setItem:function(e,t){n.load(a),e=o(e),n.getAttribute(e)||this.length++,n.setAttribute(e,t),n.save(a)},getItem:function(e){return n.load(a),e=o(e),n.getAttribute(e)},removeItem:function(e){n.load(a),e=o(e),n.removeAttribute(e),n.save(a),this.length--,this.length<0&&(this.length=0)},clear:function(){n.load(a);for(var e=0;attr=n.XMLDocument.documentElement.attributes[e++];)n.removeAttribute(attr.name);n.save(a),this.length=0},key:function(e){return n.load(a),n.XMLDocument.documentElement.attributes[e]}},o=function(e){return e.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-")};n.load(a),i.length=n.XMLDocument.documentElement.attributes.length}}}(),window.getQueryParameters=function(e){var t="",n=window.location.href;if(n.indexOf("?")>-1)for(var a=n.substr(n.indexOf("?")).toLowerCase(),i=a.split("&"),o=0;o<i.length;o++)if(i[o].indexOf(e.toLowerCase()+"=")>-1){var s=i[o].split("=");t=s[1];break}return unescape(t)};var smap={core:{},event:$("<div />"),copyright:"© 2014 Malmö stad, Kristianstad kommun, Helsingborg stad, Lunds kommun"};smap.core.Div=L.Class.extend({initialize:function(){this.parentTag=$("body"),this.draw()},draw:function(){var e=$("#mapdiv");if(!e.length){var e=$('<div id="mapdiv" class="mapdiv" />'),t=$('<div id="maindiv" class="maindiv" />');t.append(e),this.parentTag.append(t)}L.Browser.touch&&$(window).on("orientationchange",function(){window.scrollTo(0,0)}),smap.event.on("smap.core.pluginsadded",function(){($("body > header").length||smap.cmd.getControl("MalmoHeader"))&&t.addClass("map-with-header");var e=utils.getBrowser();e.ie&&e.ieVersion<=8&&$(".leaflet-top.leaflet-right").addClass("map-with-header-ie8")})},CLASS_NAME:"smap.core.Div"}),smap.core.Init=L.Class.extend({_selectedFeatures:[],initialize:function(){this.defineProjs(),smap.core.divInst=new smap.core.Div,smap.cmd.loading(!0),this.init()},_checkBrowserSupport:function(){var e=utils.getBrowser();e.ie&&e.ieVersion<=8&&smap.cmd.notify("Obs! Applikationen stödjer inte din webbläsare. Använd en nyare version.","warning")},init:function(e){e=e||{};var t=this;this.drawMap(),this._checkBrowserSupport(),smap.core.layerInst=new smap.core.Layer(this.map),smap.core.selectInst=new smap.core.Select(this.map),smap.core.paramInst=new smap.core.Param(this.map),smap.core.pluginHandlerInst=new smap.core.PluginHandler(this.map);var n=e.params||smap.core.paramInst.getParams();this.loadConfig(n.CONFIG).done(function(){function e(){var e=window.getQueryParameters("parkeditable");if("false"===e&&(besiktninglager.v_lekplatsredskap&&(besiktninglager.v_lekplatsredskap.options.editable=!1),besiktninglager.v_lekplatsredskap_utforare&&(besiktninglager.v_lekplatsredskap_utforare.options.editable=!1),besiktninglager.plats&&(besiktninglager.plats.options.editable=!1)),config)for(var a=0;a<config.ol.length;a++)"v_lekplatsredskap"===config.ol[a].options.layerId?config.ol[a]=besiktninglager.v_lekplatsredskap:"v_lekplatsredskap_utforare"===config.ol[a].options.layerId?config.ol[a]=besiktninglager.v_lekplatsredskap_utforare:"plats"===config.ol[a].options.layerId&&(config.ol[a]=besiktninglager.plats);if(smap.config)for(var a=0;a<smap.config.ol.length;a++)"v_lekplatsredskap"===smap.config.ol[a].options.layerId?smap.config.ol[a]=besiktninglager.v_lekplatsredskap:"v_lekplatsredskap_utforare"===smap.config.ol[a].options.layerId?smap.config.ol[a]=besiktninglager.v_lekplatsredskap_utforare:"plats"===smap.config.ol[a].options.layerId&&(smap.config.ol[a]=besiktninglager.plats);if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&"undefined"!=typeof n.QL&&null!==n.QL&&n.QL.length>0){var i=n.QL.split(",");"undefined"!=typeof n.OL&&null!==n.OL?"object"==typeof n.OL||(n.OL=n.OL.split(",")):n.OL=[];for(var o=0;o<i.length;o++)n.OL.push(i[o])}if("undefined"!=typeof n.OL&&null!==n.OL)if("object"==typeof n.OL){if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&n.OL.length>0){for(var s=[],l=0;l<n.OL.length;l++)for(var r=0;r<config.ol.length;r++)n.OL[l].toUpperCase()===config.ol[r].options.layerId.toUpperCase()?s.push(config.ol[r].options.layerId):"undefined"!=typeof config.ol[r].options.alias&&null!==config.ol[r].options.alias&&n.OL[l].toUpperCase()===config.ol[r].options.alias.toUpperCase()&&(s.contains||s.push(config.ol[r].options.layerId));n.OL=s}}else if("ALL"===n.OL.toUpperCase())n.OL=smap.core.Init.prototype._createOLArrayForParamAll();else if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&n.OL.length>0){for(var p=0,a=0;a<config.ol.length;a++)if(config.ol[a].options.layerId.toUpperCase()===n.OL.toUpperCase()){p++;break}if(0===p)for(var d=0;d<config.ol.length;d++)"undefined"!=typeof config.ol[d].options.alias&&null!==config.ol[d].options.alias&&config.ol[d].options.alias.toUpperCase()===n.OL.toUpperCase()&&(n.OL=config.ol[d].options.layerId)}if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&"undefined"!=typeof n.BL&&null!==n.BL&&n.BL.length>0){for(var c=0,a=0;a<config.bl.length;a++)if(config.bl[a].options.layerId.toUpperCase()===n.BL.toUpperCase()){c++;break}if(0===c)for(var d=0;d<config.bl.length;d++)"undefined"!=typeof config.bl[d].options.alias&&null!==config.bl[d].options.alias&&config.bl[d].options.alias.toUpperCase()===n.BL.toUpperCase()&&(n.BL=config.bl[d].options.layerId)}smap.config.configName=n.CONFIG,smap.config.langCode=smap.cmd.getLang();var m=window.getQueryParameters("hlp"),u=window.getQueryParameters("hideallmodules");if(u.length>0&&"true"===u&&(m.length>0||(m="true")),m.length>0&&"true"===m){if(config)for(var h=0;h<config.plugins.length;h++)"L.Control.LayerSwitcher"===config.plugins[h].init&&(config.plugins[h].options.showBgLabel=!1,config.plugins[h].options.showBgLayer=!1,config.plugins[h].options.showOvLabel=!1,config.plugins[h].options.showOvLayer=!1);if(smap.config)for(var h=0;h<smap.config.plugins.length;h++)"L.Control.LayerSwitcher"===smap.config.plugins[h].init&&(smap.config.plugins[h].options.showBgLabel=!1,smap.config.plugins[h].options.showBgLayer=!1,smap.config.plugins[h].options.showOvLabel=!1,smap.config.plugins[h].options.showOvLayer=!1)}if(config)for(var h=0;h<config.plugins.length;h++)"L.Control.ShareLink"===config.plugins[h].init&&config.plugins[h].options&&config.plugins[h].options.root&&(config.plugins[h].options.root=config.plugins[h].options.root.replace("abk kartan","kkarta_abk"));if(smap.config)for(var h=0;h<smap.config.plugins.length;h++)"L.Control.ShareLink"===smap.config.plugins[h].init&&smap.config.plugins[h].options&&smap.config.plugins[h].options.root&&(smap.config.plugins[h].options.root=smap.config.plugins[h].options.root.replace("abk kartan","kkarta_abk"));t.applyConfig(smap.config),n=$.extend({},utils.objectToUpperCase(smap.config.params||{}),n),smap.core.paramInst.applyParams(n),smap.cmd.loading(!1)}if(smap.config=config||window.config,smap.config.onLoad){var a=smap.config.onLoad(smap.config);a.done(e)}else e(smap.config)}).fail(function(){smap.cmd.loading(!1)})},applyConfig:function(e){this.preProcessConfig(e);var t=e.coreConfig||{};$.extend(smap.core.selectInst.options,t.select||{}),$.extend(this.map.options,e.mapConfig||{}),$.extend(smap.core.mainConfig.smapOptions,e.smapOptions||{});var n=smap.core.mainConfig.smapOptions,a=utils.getBrowser();a.ie&&a.ieVersion<=8||$("title").text(n.title);var i=n.favIcon;if(i&&!(a.ie&&a.ieVersion<=8)){var o=$('<link rel="shortcut icon" type="image/x-icon" href="'+i+'" />');$("[rel=shortcut]").remove(),$("title").after(o)}this.map.options.maxBounds&&this.map.setMaxBounds(this.map.options.maxBounds),smap.core.pluginHandlerInst.addPlugins(e.plugins)},resetMap:function(){smap.map.off();for(var e=smap.core.controls,t=0,n=e.length;n>t;t++)try{smap.map.removeControl(e[t])}catch(a){}this.map.remove(),this.map=null,delete this.map,smap.map=null,delete smap.map,window.config=null;try{delete window.config}catch(a){}smap.config=null,delete smap.config,smap.event.off(),smap.core.controls=[],smap.core.layerInst=null,smap.core.modInst=null,smap.core.paramInst=null,delete smap.core.layerInst,delete smap.core.modInst,delete smap.core.paramInst},drawMap:function(e){e=e||{},L.Browser.touch&&L.Browser.ie&&(e.tapTolerance=30);var t=smap.core.mainConfig.mapConfig||{},n=$.extend(t,e);this.map=L.map("mapdiv",n),smap.map=this.map;var a=this.map.attributionControl;a.addAttribution(""),n.disabledRightClick&&this.map.on("contextmenu",function(e){e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()}),utils.getBrowser().ie9&&$(".leaflet-bottom.leaflet-right").addClass(".leaflet-bottom-right-ie9")},loadConfig:function(e){return e=e||"empty",-1===e.search(/\//g)&&(e=document.URL.split("?")[0].search("dev.html")>-1?"dist/configs/"+e:"configs/"+e),$.ajax({url:e,context:this,dataType:"script"})},preProcessConfig:function(e){e.ws&&e.ws.hasOwnProperty(document.domain)&&(e.ws=e.ws[document.domain]);for(var t=e.bl||[],n=0,a=t.length;a>n;n++)t[n].options=t[n].options||{},t[n].options.isBaseLayer=!0;for(var i,o=e.bl.concat(e.ol||[]),s=this._createLegendUrl,n=0,a=o.length;a>n;n++)i=o[n],void 0===i.options.legend&&i.options.layers&&_.indexOf(["L.TileLayer.WMS","L.NonTiledLayer.WMS"],i.init)>-1&&(i.options.legend=s(i.url,i.options.layers))},_createLegendUrl:function(e,t){t.split(",").length>1&&(t=t.split(",")[0]);var n="version=1.1.1&request=GetLegendGraphic&format=image/png&width=20&height=20&layer="+t;return utils.urlAppend(e,n)},_createOLArrayForParamAll:function(){var e=[];if("undefined"!=typeof smap.config.ol&&null!==smap.config.ol)for(var t=smap.config.ol,n=0;n<t.length;n++)e.push(t[n].options.layerId);else e=null;return e},defineProjs:function(){window.proj4&&(proj4=window.proj4,proj4.defs([["EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"],["EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"],["EPSG:3008","+proj=tmerc +lat_0=0 +lon_0=13.5 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3006","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3021","+proj=tmerc +lat_0=0 +lon_0=15.8062845294444 +k=1.00000561024+x_0=1500064.274 +y_0=-667.711 +ellps=GRS80 +units=m"]]))},CLASS_NAME:"smap.core.Init"}),smap.core.Layer=L.Class.extend({options:{defaultStyle:{color:"#00F",fillColor:"#00F",opacity:1,fillOpacity:.3,radius:8,weight:1},selectStyle:{weight:5,color:"#00DDFF",dashArray:"",fillOpacity:.8,strokeOpacity:1}},_layers:{},_bindEvents:function(){var e=this.map;this._onLayerAdd=this._onLayerAdd||$.proxy(this.onLayerAdd,this),this._onLayerRemove=this._onLayerRemove||$.proxy(this.onLayerRemove,this),e.on("layeradd",this._onLayerAdd),e.on("layerremove",this._onLayerRemove),smap.event.on("smap.core.applyparams",$.proxy(function(t,n){var a;if(n.BL&&(a=smap.cmd.getLayerConfig(n.BL)),a=a||smap.config.bl[0],a&&a.options&&(a.options.isBaseLayer=!0,e.addLayer(this._createLayer(a))),n.OL){var i,o,s=n.OL instanceof Array?n.OL:n.OL.split(",");for(i=0,o=s.length;o>i;i++)this._addLayerWithConfig(smap.cmd.getLayerConfig(s[i]))}},this))},initialize:function(e){this.map=e,this._bindEvents()},addOverlays:function(e){this._addLayers(e)},_addLayers:function(e){e=e||[];var t,n;for(t=0,len=e.length;t<len;t++)n=e[t],this._addLayerWithConfig(n)},_addLayerWithConfig:function(e){if(!e||!e.options)return!1;var t=this._createLayer(e);if(!t)return!1;var n=e.options.parentLayerId?this._getLayer(e.options.parentLayerId)||this.map:this.map;return n.addLayer(t),t},onLayerAdd:function(e){var t=e.layer;if(t.options&&!t.options._silent&&t.options.layerId&&!t.feature&&(t instanceof L.NonTiledLayer||t._tileContainer||t._layers)){var n=t.options.layerId;this._layers[n]=t,t._layers&&this._wfsLayers.push(t)}},onLayerRemove:function(e){var t=e.layer;t._layers&&this._wfsLayers.splice(t,1)},_getLayer:function(e){return this._layers[e]||null},_wfsLayers:[],_createLayer:function(t){var layerAlreadyAdded=this._getLayer(t.options.layerId);if(layerAlreadyAdded)return layerAlreadyAdded;var init=eval(t.init);init.options=init.options||{},t.options.zIndex=t.options.isBaseLayer?t.options.zIndex||0:t.options.zIndex||10;var layer;if(t.params)layer=Object.create(init.prototype),init.apply(layer,t.params),t.options&&t.options instanceof Object&&$.extend(layer.options,t.options);else{if(t.url){var opts=t.options;if(init===L.TileLayer.WMS){var newOpts=$.extend(!0,{},opts);newOpts=_.pick(newOpts,["tileSize","service","request","version","layers","styles","format","width","height","bbox","angle","buffer","cql_filter","env","featureid","filter","format_options","maxfeatures","namespace","palette","propertyname","tiled","tilesorigin","scalemethod","srs","map_resolution","transparent"]),layer=new init(t.url,newOpts),$.extend(layer.wmsParams,newOpts),$.extend(layer.options,opts),layer.setZIndex(opts.zIndex)}else layer=new init(t.url,opts)}else t.key?(layer=new init(t.key,t.options),layer.options.layerid=t.options.layerId,this._layers[t.options.layerId]=layer):layer=new init(t.options);layer instanceof L.esri.DynamicMapLayer&&(this._layers[t.options.layerId]=layer)}var self=this;return layer.on&&layer.options&&(layer._layers?(layer.options.style=!layer.options.style&&(!layer.options.geomType||layer.options.geomType&&layer.options.geomType.search(/POINT/gi))>-1?null:layer.options.style||$.extend({},self.options.defaultStyle),layer.on("loadcancel loaderror",function(){smap.cmd.loading(!1)})):layer.on("load",function(){smap.cmd.loading(!1)}),layer.on&&(layer.on("load",function(){smap.cmd.loading(!1)}),layer.on("loading",function(){smap.cmd.loading(!0)}))),layer},showLayer:function(e){var t=e instanceof Object?e:smap.cmd.getLayerConfig(e);if(t){var n=this._getLayer(e);n||(n=this._createLayer(t));var a=t.options.parentLayerId?this._getLayer(t.options.parentLayerId)||this.map:this.map;return a.hasLayer(n)===!1&&a.addLayer(n),n}},hideLayer:function(e){var t=e instanceof Object?e:this._getLayer(e);t.fire&&t.fire("loadcancel",{layer:this});var n=t.options.parentLayerId?this._getLayer(t.options.parentLayerId)||this.map:this.map;return n.removeLayer(t),t},CLASS_NAME:"smap.core.Layer"}),smap.core.Param=L.Class.extend({initialize:function(e){this.map=e},_lang:{sv:{remove:"Ta bort"},en:{remove:"Remove"}},_setLang:function(){langCode=smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[langCode]:null)},getParams:function(){var e=this._cachedParams||null;return e||(e=this.getWebParamsAsObject(),smap.config&&(configParams=smap.config.params||{},e=$.extend({},utils.objectToUpperCase(configParams),e),this._cachedParams=e)),e},getWebParamsAsObject:function(e){e=e||"?";var t=location.href.split(e),n=t.length>1?t[1]:"";return paramsObject=utils.paramsStringToObject(n,!0),paramsObject},getHashParamsAsObject:function(){return this.getWebParamsAsObject("#")},createParamsAsObject:function(){var e,t,n,a=this.map.getCenter(),i=this.map._layers,o=[];for(var s in i)t=i[s],t&&t.options&&t.options.layerId&&t.options.layerId.split("_mergedLayer_").length<2&&(n=t.options.layerId,t.options.isBaseLayer?e=n:-1===$.inArray(t.options.layerId,o)&&o.push(n));var l={zoom:this.map.getZoom(),center:[utils.round(a.lng,5),utils.round(a.lat,5)],ol:o,bl:e};return smap.config.configName&&(l.config=smap.config.configName),smap.event.trigger("smap.core.createparams",l),l},createParams:function(e){e=e||!1;var t,n=this.createParamsAsObject(),a="";for(var i in n){if(t=n[i],t instanceof Array){if(!t.length)continue;t=t.join(",")}a+="&"+i+"="+t}if(a=a.substring(1),e){var o="";e===!0?o=document.URL.split("?")[0]+"?":"string"==typeof e&&(o=e),a=o+a}return a},applyParams:function(e){function t(){$(".smap-core-btn-popup").on("click",function(){return n.map.removeLayer(u),!1})}e=e||{};var n=this;smap.event.trigger("smap.core.beforeapplyparams",e),this._setLang();var a=e.ZOOM?parseInt(e.ZOOM):0,i=e.CENTER?L.latLng([parseFloat(e.CENTER[1]),parseFloat(e.CENTER[0])]):null;if(("193.17.67.229"===window.location.host||"kartor.kristianstad.se"===window.location.host)&&(Math.abs(i.lat)>90||Math.abs(i.lng)>180)){var o=utils.projectPoint(i.lng,i.lat,"EPSG:3008","EPSG:4326");i.lng=o[0],i.lat=o[1]}if(a||0===a||(a=this.map.options.minZoom||0),i?this.map.setView(i,a,{animate:!1}):this.map.fitWorld(),e.XY){var s=this.getWebParamsAsObject(),l=parseFloat(e.XY[1]),r=parseFloat(e.XY[0]),p=null;if(e.XY.length>2){var d=e.XY[2];if(p="<p>"+d+'</p><button class="btn btn-default smap-core-btn-popup">'+this.lang.remove+"</button>",e.XY.length>3){var c=e.XY[3];1!=/^EPSG:/.test(c)&&(c="EPSG:"+c);var m=utils.projectPoint(r,l,c,"EPSG:4326");r=m[0],l=m[1]}}var u=L.marker([l,r]);this.map.addLayer(u),s.CENTER||this.map.setView(u.getLatLng(),s.ZOOM||16,{animate:!1}),p&&(this.map.off("popupopen",t).on("popupopen",t),u.bindPopup(p).openPopup())}smap.event.trigger("smap.core.applyparams",e)},CLASS_NAME:"smap.core.Param"}),smap.core.PluginHandler=L.Class.extend({initialize:function(e){this.map=e;var t=this;smap.event.on("smap.core.pluginsadded",function(){t._processQueue()})},getPlugin:function(){for(var e,t=smap.core.controls||[],n=0,a=t.length;a>n;n++)if(e=t[n],e instanceof L.Control[controlName])return e;return null},addPlugins:function(arr){var t,init,autoActivates=[];smap.core.controls=smap.core.controls||[];for(var i=0,len=arr.length;len>i;i++)t=arr[i],init=eval(t.init),init&&(init=new init(t.options||{}),this.map.addControl(init),smap.core.controls.push(init),init.options.autoActivate&&autoActivates.push(init));smap.event.trigger("smap.core.pluginsadded"),smap.event.pluginsadded=!0;for(var i=0,len=autoActivates.length;len>i;i++)autoActivates[i].activate();$(".leaflet-bottom.leaflet-right button").tooltip({placement:"left",container:"#mapdiv"})},_callQueue:[],callPlugin:function(e,t,n,a){n=n||[];var i=L.Control[e];smap.event.pluginsadded?this._callPlugin(i,t,n,a):this._callQueue.push([i,t,n,a])},_callPlugin:function(e,t,n,a){if(!e)return null;for(var i,o=smap.core.controls||[],s=null,l=0,r=o.length;r>l;l++)if(i=o[l],i instanceof e){s=i[t].apply(i,n||[]);break}return a?a(s):s},_processQueue:function(){var e,t,n,a=this._callQueue||[];for(t=0,len=a.length;t<len;t++)e=a[t],n=this._callPlugin.apply(this,e);return this._callQueue=[],n},CLASS_NAME:"smap.core.PluginHandler"}),smap.core.Select=L.Class.extend({options:{manyUseDialog:!0},_selectedFeaturesVector:[],_selectedFeaturesWms:[],initialize:function(e){this.map=e,this._bindEvents(e),this._wfsLayers=smap.core.layerInst._wfsLayers},_getVectorVal:function(e,t){var n,e=e||{};if(paramVal=null,t.split(";").length>1){var a=t.split(";");n=e[a[0]]+";"+e[a[1]]}else n=e[t];return n},_setSelectStyle:function(e){var t=e.target;t.setStyle&&t.setStyle(this.options.selectStyle),!t.bringToFront||L.Browser.ie||L.Browser.opera||t.bringToFront()},_resetStyle:function(e){e.resetStyle&&e.eachLayer(function(t){e.resetStyle(t)})},_processHtml:function(e){var t=$("<div>"+e+"</div>");return t.find("a").each(function(){var e=$(this),t=e.attr("href"),n=e.text();if(t&&t.length>=4&&-1===$.inArray(t,["null","undefined"]))if("undefined"!=typeof t.match("mailto")&&null!==t.match("mailto"))if(t.match("mailto").indexOf("mailto")>=0){window.customMailOpen||(window.customMailOpen=function(e){var t=document.createElement("a");t.href=e,t.click()}),"HTTP"!==t.substring(0,4).toUpperCase()&&(t=t);var a=$('<button class="btn btn-default btn-sm">'+n+"</button>");a.attr("onclick",'window.customMailOpen("'+t+'");'),e.after(a),e.remove()}else{"HTTP"!==t.substring(0,4).toUpperCase()&&(t="http://"+t);var a=$('<button class="btn btn-default btn-sm">'+n+"</button>");a.attr("onclick",'window.open("'+t+'", "_blank")'),e.after(a),e.remove()}else{"HTTP"!==t.substring(0,4).toUpperCase()&&(t="http://"+t);var a=$('<button class="btn btn-default btn-sm">'+n+"</button>");a.attr("onclick",'window.open("'+t+'", "_blank")'),e.after(a),e.remove()}else e.remove()}),t.html()},_extractAllAttributes:function(e,t){t=t||{};var n="",a="<div><strong>_key_:</strong>&nbsp;<span>_val_</span></div>";for(var i in t)n+=a.replace(/_key_/g,i).replace(/_val_/g,"${"+i+"}");var o="*";return e.search(/\$\{\*\}/)>-1&&(o=/\$\{\*\}/g),e.replace(o,n)},_bindEvents:function(e){function t(){var t=$(".leaflet-popup-close-button"),n='<a class="leaflet-popup-close-button leaflet-popup-minimize-button" href="#">–</a>';t.before(n),$(".leaflet-popup-minimize-button").on("click",function(){return smap.map.closePopup(),!1}),t.on("click",function(){return e.fire("unselected",{}),!1})}var n=this;e.on("popupopen",t),e.on("layerremove",function(t){var a=void 0!==t.layer._tip;return a?!1:void(n._rasterFeature&&(e.removeLayer(n._rasterFeature),n._rasterFeature=null))}),e.on("click",function(){for(var t=n._wfsLayers,a=0,i=t.length;i>a;a++)n._resetStyle(t[a]);e.fire("unselected",{})}),e.on("unselected",function(e){n._rasterFeature&&(n.map.removeLayer(n._rasterFeature),n._rasterFeature=null),e.feature?$.each(n._selectedFeaturesVector,function(t,a){return e.feature.id===a.id?(n._selectedFeaturesVector.splice(t,1),!1):void 0}):(n._selectedFeaturesVector=[],n._selectedFeaturesWms=[])}),e.on("selected",function(t){function a(e,t,n){var a="",i="";return i+='<div style="width:inherit;" class="'+a+'"><h4 class="popup-layertitle">'+n+"</h4>",i+=utils.extractToHtml(e,t)+"</div>"}function i(){n._rasterFeature&&(n._rasterFeature.resetStyle(),n.map.removeLayer(n._rasterFeature),n._rasterFeature=null)}function o(e){return i(),e.geometry.type&&"Point"!==e.geometry.type&&"MultiPoint"!==e.geometry.type&&(n._rasterFeature=L.geoJson(e.geometry),n._rasterFeature.options=$.extend({},e.options),n._rasterFeature.options._silent=!0,n._rasterFeature.latLng=e.latLng,n._rasterFeature.setStyle({color:"#0FF",fillColor:"#0FF",weight:10,opacity:.9,fillOpacity:.3}),n._rasterFeature.options.selectable=!1,n._rasterFeature.eachLayer(function(e){e.eachLayer&&e.eachLayer(function(e){e.options.clickable=!1}),e.options&&(e.options.clickable=!1)}),n.map.addLayer(n._rasterFeature),n._rasterFeature.setZIndex(900)),n._rasterFeature}function s(){var e=$(this).data("index"),t=n._selectedFeaturesWms[e];if(smap.core.selectInst.lastSelectedFeatureSingle=t,$(".leaflet-popup-pane").change(),o(t),"undefined"!=typeof t.options.editable&&null!==t.options.editable&&"undefined"!=typeof t.options.pointInPolygon&&null!==t.options.pointInPolygon){if(!t.options.editable){var i=L.popup(),s=a(t.options.popup,t.properties,t.options.displayName);if(s=n._processHtml(s),i.setContent(s),n._rasterFeature&&n._rasterFeature.getBounds&&1===t.geometry.coordinates.length){var l=n._rasterFeature.getBounds(),r=l.getCenter();i.setLatLng(r)}else i.setLatLng(t.latLng);i.openOn(n.map);var p=$(".leaflet-popup-content:visible");return p.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})}),$(this).trigger("mouseenter"),n._selectManyModal.modal("hide"),!1}t.options.pointInPolygon&&(smap.inv.panel.travellingSalesManIndex=0,smap.cmd._showSplashMessage_wait("Processering...........\n Vänta lite",6e4),smap.cmd.crInvMultiple(t,"multiple"),smap.cmd._hideSplashMessage_wait())}else{if("undefined"==typeof t.options.editable||null===t.options.editable){var i=L.popup(),s=a(t.options.popup,t.properties,t.options.displayName);if(s=n._processHtml(s),i.setContent(s),n._rasterFeature&&n._rasterFeature.getBounds&&1===t.geometry.coordinates.length){var l=n._rasterFeature.getBounds(),r=l.getCenter();i.setLatLng(r)}else i.setLatLng(t.latLng);i.openOn(n.map);var p=$(".leaflet-popup-content:visible");return p.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})}),$(this).trigger("mouseenter"),n._selectManyModal.modal("hide"),!1}if(!t.options.editable){var i=L.popup(),s=a(t.options.popup,t.properties,t.options.displayName);if(s=n._processHtml(s),i.setContent(s),n._rasterFeature&&n._rasterFeature.getBounds&&1===t.geometry.coordinates.length){var l=n._rasterFeature.getBounds(),r=l.getCenter();i.setLatLng(r)}else i.setLatLng(t.latLng);i.openOn(n.map);var p=$(".leaflet-popup-content:visible");return p.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})}),$(this).trigger("mouseenter"),n._selectManyModal.modal("hide"),!1}smap.cmd.crInv(t,"single")}$(this).trigger("mouseenter"),n._selectManyModal.modal("hide"),!1}var l=t.layer,r=l.hasOwnProperty("_layers")||l.options&&l.options.clickable,p=(l.options.layerId,t.feature),d=t.selectedFeatures||[],c=(l.options.uniqueKey||"-",t.shiftKeyWasPressed),m=p.properties,u=t.latLng;if(r?(n._selectedFeaturesWms=[],c?(n._selectedFeaturesVector=utils.makeUniqueArr(n._selectedFeaturesVector.concat(d)),$.each(n._wfsLayers,function(e,t){t.eachLayer(function(e){e.unbindPopup&&e.unbindPopup(),e._layers&&$.each(e._layers,function(e,t){t.unbindPopup&&t.unbindPopup()})})})):n._selectedFeaturesVector=[].concat(d)):(n._selectedFeaturesVector=[],n._selectedFeaturesWms=utils.makeUniqueArr(n._selectedFeaturesWms.concat(d))),r&&!c&&n._selectedFeaturesVector.length<=1){for(var h,_=n._wfsLayers,v=0,g=_.length;g>v;v++)h=_[v],h!==l&&(h.resetStyle&&h.resetStyle(h),h._selectedFeatures=[]);var f=l.options.popup;(l.options.popup&&"*"===l.options.popup||l.options.popup.search(/\$\{\*\}/)>-1)&&(f=n._extractAllAttributes(f,m));var b=utils.extractToHtml(f,m);b=n._processHtml(b);var h=utils.getLayerFromFeature(p,l)||p;if(h._popup&&h.unbindPopup(),h.bindPopup(b,{autoPan:!0,keepInView:!1,autoPanPadding:L.point(smap.core.mainConfig.smapOptions.popupAutoPanPadding)}),h._map){h.openPopup(u);var y=$(".leaflet-popup-content:visible");y.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})})}}if(!r){var k=L.popup(),w=n._selectedFeaturesWms[0];if(1===n._selectedFeaturesWms.length)o(w);else{if(n.options.manyUseDialog){if(!n._selectManyModal){var m,C,A=$('<button type="button" class="btn btn-default">Stäng</button>'),x=$('<div class="list-group"></div>');A.on("tap click",function(){return i(),n._selectManyModal.modal("hide"),!1}),n._selectManyModal=utils.drawDialog("Flera träffar: Välj ett objekt",x,A,{size:"sm"}),n._selectManyModal.find(".modal-header").addClass("panel-heading"),n._selectManyModal.on("hidden.bs.modal",function(){$(this).find(".list-group").empty()}),n._selectManyModal.on("shown.bs.modal",function(){$(this).scrollTop(0)}),n._selectManyModal.addClass("core-select-modal")}for(var I,B,P=n._selectManyModal.find(".list-group"),v=0,g=d.length;g>v;v++)I=d[v],m=I.properties,B=utils.extractToHtml(I.options.popup,m),(B&&"*"===B||B.search(/\$\{\*\}/)>-1)&&(B=n._extractAllAttributes(B,m)),B=n._processHtml(B),C=$('<a href="#" class="list-group-item"><span><strong style="display:none;">'+I.options.displayName+"</strong>"+B+'</span><div class="btn btn-success select-btn-zoom-to-feature">Zooma hit</div></a>'),C.data("index",v),L.Browser.touch&&C.addClass("select-row-touch"),P.append(C);var D=P.find(".list-group-item");return D.find(".select-btn-zoom-to-feature").on("touchend click",function(){if(s.call($(this).parent()[0]),n._rasterFeature){var e=n._rasterFeature.getBounds(),t=L.Browser.touch?[100,100]:[200,150];n.map.fitBounds(e,{paddingTopLeft:t,paddingBottomRight:[100,100]})}else{var a=($(this).parent().data("index"),15);a=n.map.getZoom()<a?a:n.map.getZoom()+1,n.map.setZoomAround(w.latLng,a)}return n._selectManyModal.modal("hide"),!1}),L.Browser.touch?D.on("tap",function(){var e=$(this).data("index"),t=n._selectedFeaturesWms[e];return o(t),s.call(this),!1}):D.on("click",s),n._selectManyModal.modal("show"),!0}for(var S,E=n._selectedFeaturesWms||[],v=0,g=E.length;g>v;v++)if(w=E[v],w.geometry&&w.geometry.type&&w.geometry.type.search(/point/gi)>-1){S=w;break}if(!S){var T=parseInt(n._selectedFeaturesWms.length/2);S=n._selectedFeaturesWms[T]}o(S),w=S}var b="",m=w.properties;if("undefined"!=typeof w.options.editable&&null!==w.options.editable&&"undefined"!=typeof w.options.pointInPolygon&&null!==w.options.pointInPolygon)if(w.options.editable)w.options.pointInPolygon&&(smap.inv.panel.travellingSalesManIndex=0,smap.cmd.crInvMultiple(w,"multiple"));else{var f=w.options.popup;(f&&"*"===f||f.search(/\$\{\*\}/)>-1)&&(f=n._extractAllAttributes(f,m)),b=a(f,w.properties,w.options.displayName),b=n._processHtml(b),e.closePopup(),k.setContent(b),k.setLatLng(w.latLng),setTimeout(function(){var t=smap.cmd.getControl("SelectWMS");if(t&&t._dblclickWasRegistered===!0)return!1;k.openOn(e);var n=$(".leaflet-popup-content:visible");n.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})})},100)}else if("undefined"!=typeof w.options.editable&&null!==w.options.editable)if(w.options.editable)smap.cmd.crInv(w,"single");else{var f=w.options.popup;(f&&"*"===f||f.search(/\$\{\*\}/)>-1)&&(f=n._extractAllAttributes(f,m)),b=a(f,w.properties,w.options.displayName),b=n._processHtml(b),e.closePopup(),k.setContent(b),k.setLatLng(w.latLng),setTimeout(function(){var t=smap.cmd.getControl("SelectWMS");if(t&&t._dblclickWasRegistered===!0)return!1;k.openOn(e);var n=$(".leaflet-popup-content:visible");n.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})})},100)}else{var f=w.options.popup;(f&&"*"===f||f.search(/\$\{\*\}/)>-1)&&(f=n._extractAllAttributes(f,m)),b=a(f,w.properties,w.options.displayName),b=n._processHtml(b),e.closePopup(),k.setContent(b),k.setLatLng(w.latLng),setTimeout(function(){var t=smap.cmd.getControl("SelectWMS");if(t&&t._dblclickWasRegistered===!0)return!1;k.openOn(e);var n=$(".leaflet-popup-content:visible");n.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"100px"})})},100)}smap.core.selectInst.lastSelectedFeatureSingle=w,$(".leaflet-popup-pane").change()}}),smap.event.on("smap.core.createparams",function(e,t){function a(e,t,n){e&&(l[e]||(l[e]={}),l[e][t]||(l[e][t]=[]),l[e][t].push(n))}var i,o,s,l={};if(n._selectedFeaturesVector&&n._selectedFeaturesVector.length){s=n._selectedFeaturesVector;for(var r=0,p=s.length;p>r;r++)i=s[r],i.properties&&i.uniqueKey&&(o=n._getVectorVal(i.properties,i.uniqueKey),a(i.layerId,"vals",o),l[i.layerId].key=i.uniqueKey)}if(n._selectedFeaturesWms&&n._selectedFeaturesWms.length){s=n._selectedFeaturesWms;for(var r=0,p=s.length;p>r;r++)i=s[r],o=[i.latLng.lng,i.latLng.lat],a(i.options.layerId,"xy",o)}$.isEmptyObject(l)===!1&&(t.sel=encodeURIComponent(JSON.stringify(l)))}),smap.event.on("smap.core.applyparams",$.proxy(function(e,t){function n(){var e,t,i,o,r,p,d=this,c=this.options.layerId,m=this.options.uniqueKey,u=s[c],h=u.vals;for(i=0,len=h.length;i<len;i++)t=h[i],e=null,$.each(d._layers,function(n,a){if(a.feature){if(o=a.feature.properties,m.split(";").length>1?(r=m.split(";"),p=o[r[0]]+";"+o[r[1]]):p=a.feature.properties[m],!p)return!1;if(p===t)return e=a,!1}}),e&&e.fire("click",{properties:e.feature.properties,latlng:a,originalEvent:{shiftKey:l}});d.off("load",n)}if(t.SEL){var a,i,o,s=JSON.parse(decodeURIComponent(t.SEL)),l=!1,r=0;for(var p in s)if(r+=1,r>1||s[p].vals&&s[p].vals.length>1){l=!0;break}for(o in s)if(i=s[o],i.key){var d=smap.core.layerInst.showLayer(o);d&&d.on("load",n)}}}))}}),smap.cmd={createParams:function(e){return smap.core.paramInst.createParams(e)},createParamsAsObject:function(){return smap.core.paramInst.createParamsAsObject()},removeAllMapLayer:function(){smap.map.eachLayer(function(e){"undefined"!=typeof e.options&&null!==e.options&&"undefined"!=typeof e.options.isBaseLayer&&null!==e.options.isBaseLayer&&e.options.isBaseLayer===!1?smap.map.removeLayer(e):""},this)},getControl:function(e){var t=this.getControls(e);return t.length?t[0]:null},getControls:function(e){e.search(/\./)>-1&&(e=e.split(".").slice(2).join("."));

for(var t,n=smap.core.controls||[],a=[],i=0,o=n.length;o>i;i++)t=n[i],t instanceof L.Control[e]&&a.push(t);return a},notify:function(e,t,n){switch(n=n||{},n.parent=n.parent||$("body"),t){case"success":t="alert-success";break;case"warning":t="alert-danger";break;case"info":t="alert-info";break;case"error":t="alert-danger";break;default:t="alert-"+t}var a=$('<div class="alert map-alert '+t+' alert-dismissable"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e+"</div>");return n.parent.find(".alert").remove(),n.parent.append(a),n.fade&&(a.addClass("notify-transition"),setTimeout(function(){a.addClass("notify-visible")},1)),this._notifyTimeOut&&clearTimeout(this._notifyTimeOut),n.fadeOut&&(this._notifyTimeOut=setTimeout(function(){$(".alert").remove()},n.fadeOut||7e3)),a},showLayer:function(e){return smap.core.layerInst.showLayer(e)},hideLayer:function(e){return smap.core.layerInst.hideLayer(e)},addLayerWithConfig:function(e){return smap.core.layerInst._addLayerWithConfig(e)},getLayer:function(e){return smap.core.layerInst._getLayer(e)},getLayerConfig:function(e){return this.getLayerConfigBy("layerId",e)},getLayerConfigBy:function(key,val,options){options=options||{};var arr=smap.config.bl.concat(smap.config.ol||[]),i,t,compVal;for(i=0,len=arr.length;i<len;i++){if(t=arr[i],-1!==key.search(/\./))try{compVal=eval("t."+key)}catch(e){continue}else compVal=t.options[key];if(options.inText){if(void 0!==compVal&&compVal.search(val)>-1)return t}else if(void 0!==compVal&&compVal===val)return t}return null},getLang:function(){var e=smap.core.mainConfig.smapOptions.defaultLanguage||"en",t=smap.core.paramInst?smap.core.paramInst.getParams().LANG:e,n=t?t.split("-")[0]:e;return n},reloadCore:function(e){e=e||{},smap.core.initInst.resetMap(),smap.core.initInst.init(e)},loading:function(e,t){if(t=t||{},!window.Spinner)return!1;var n={sv:{loading:"Laddar"},en:{loading:"Loading"}},a=this.getLang(),i=n.hasOwnProperty(a)?n[a]:n.en,o=t.text;if(o instanceof Object&&(o=o[i]),e&&e===!0){if(!this.spinner){var s={lines:12,length:4,width:6,radius:40};this.spinner=new Spinner(s).spin()}this.spinner.spin(),$("#mapdiv").append(this.spinner.el),$("div .spinner").css({top:"50%",left:"50%"}),$(this.spinner.el).append('<div id="loadingText">'+(o||i.loading)+"</div>")}else this.spinner.stop()},mergeLayers:function(){smap.cmd.mergeLayers.mergeLayers={},smap.cmd.mergeLayers.tmp_memove_lg_list=[],smap.map.on("layeradd",function(e){if(e.layer&&e.layer.options&&e.layer.options.mergeLayers&&e.layer.options.mergeLayers.length>0)for(var t=0;t<e.layer.options.mergeLayers.length;t++){if("object"==typeof e.layer.options.mergeLayers[t])var n=JSON.parse(JSON.stringify(e.layer.options.mergeLayers[t]));else if("string"==typeof e.layer.options.mergeLayers[t])var n=JSON.parse(JSON.stringify(smap.cmd.getLayerConfig(e.layer.options.mergeLayers[t])));if("undefined"!=typeof n&&null!==n){n.options.isBaseLayer=!0,n.options.isMultipleBaseLayer=!0,n.options.layerId=n.options.layerId+"_mergedLayer_"+e.layer.options.layerId;var a=smap.core.layerInst._createLayer(n);"undefined"!=typeof a&&null!==a&&(smap.cmd.mergeLayers.mergeLayers[n.options.layerId]=a,smap.map.addLayer(a))}}}),smap.map.on("layerremove",function(e){if("undefined"!=typeof smap.cmd.mergeLayers.mergeLayers&&null!==smap.cmd.mergeLayers.mergeLayers&&e.layer&&e.layer.options&&e.layer.options.layerId){var t=e.layer.options.layerId;for(mglg in smap.cmd.mergeLayers.mergeLayers)mglg.split("_mergedLayer_")[1]===t&&(smap.cmd.mergeLayers.tmp_memove_lg_list.push(mglg),smap.map.removeLayer(smap.cmd.mergeLayers.mergeLayers[mglg]));for(var n=0;n<smap.cmd.mergeLayers.tmp_memove_lg_list.length;n++)delete smap.cmd.mergeLayers.mergeLayers[smap.cmd.mergeLayers.tmp_memove_lg_list[n]];smap.cmd.mergeLayers.tmp_memove_lg_list=[]}})},getLayerConfigAlias:function(e){return this.getLayerConfigBy("alias",e)},getLayerConfigAliasBy:function(key,val,options){options=options||{};var arr=smap.config.bl.concat(smap.config.ol||[]),i,t,compVal;for(i=0,len=arr.length;i<len;i++){if(t=arr[i],-1!==key.search(/\./))try{compVal=eval("t."+key)}catch(e){continue}else compVal=t.options[key];if(options.inText){if(void 0!==compVal&&compVal.search(val)>-1)return t}else if(void 0!==compVal&&compVal===val)return t}return null},_xhr_handler:function(e,t){try{return new XMLHttpRequest}catch(n){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(n){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}return alert("XMLHttpRequest not supported"),null},createGetFeatureURL:function(e,t,n,a){var i=e.options.layers,o=a,s=e.init;"L.TileLayer.WMS"===s&&(o=i+"."+o);var l=e.url.split("?")[0]+"?service=WFS&version=1.3.0&request=GetFeature&outputFormat=GeoJSON&typename="+i+"&featureid="+o;return l},getSingleGeoJSON:function(e,t,n){var a=this.getLayerConfigAlias(e);if("undefined"!=typeof a&&null!==a)var i=this.createGetFeatureURL(a,e,t,n);else{var a=this.getLayerConfig(e);if("undefined"!=typeof a&&null!==a)var i=this.createGetFeatureURL(a,e,t,n);else var i=null}if(null!==i){var o=new this._xhr_handler;if(o.open("GET",i,!1),o.send(null),4==o.readyState&&200==o.status)var s=JSON.parse(o.responseText);return[s,a]}return null},getPopHTML:function(e,t,n){var a="",i="";return i+='<div id="advSokCatDiv" style="width:inherit;" class="'+a+'"><h4 class="popup-layertitle">'+n+"</h4>",i+=utils.extractToHtml(e,t)+"</div>"},advSearch:function(e){var t=smap.core.paramInst.getParams();if("undefined"!=typeof t.QL&&null!==t.QL&&"undefined"!=typeof t.QA&&null!==t.QA&&"undefined"!=typeof t.POI&&null!==t.POI&&t.QL.length>0&&t.QA.length>0&&t.POI.length>0){var n=this.getSingleGeoJSON(t.QL,t.QA,t.POI),a=n[0],i=n[1];if(null!==a)if(a.features.length>0){("undefined"==typeof smap.map.avdSearchLg||null===smap.map.avdSearchLg)&&(smap.map.avdSearchLg=L.layerGroup(),window.avdSearchLg=smap.map.avdSearchLg,smap.map.avdSearchLg.id="avdSearchLg",smap.map.addLayer(smap.map.avdSearchLg));var o={stroke:!0,color:"#00FFFF",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},s=L.latLng(a.features[0].geometry.coordinates[1],a.features[0].geometry.coordinates[0]);window.advSolcreateRandomNumber=Math.random().toString().split(".")[1];var l=new L.Circle(s,10,o);l.id="advSokMarkerId_"+window.advSolcreateRandomNumber;var r={keepInView:!0};smap.map.setView(s,15,{animate:!1});var p=document.createElement("div");p.style.display="none";var d=document.createElement("button");d.id="smapadvsokpopupbtn_"+window.advSolcreateRandomNumber,d.className="btn btn-default btn-sm",d.value="Ta bort kartsymbol",d[getTextContent(d)]="Ta bort kartsymbol",d.onclick=function(){var e=null,t="advSokMarkerId_"+this.id.split("_")[1],n=smap.map.avdSearchLg._layers;if(n)for(lay in n)n[lay].id===t&&(e=n[lay]);smap.map.avdSearchLg.removeLayer(e)},p.appendChild(d);var c=smap.core.Select.prototype._processHtml(this.getPopHTML(i.options.popup,a.features[0].properties,i.options.displayName)),m=document.createElement("html");m.innerHTML=c;var u=m.getElementsByTagName("body")[0],h=u.childNodes[0].childNodes[u.childNodes[0].childNodes.length-1],_=h.tagName;(_="IMG")?u.childNodes[0].insertBefore(p,h):u.childNodes[0].appendChild(p),c=u.childNodes[0],window.avdSokPopup=L.popup(r);var v=c;window.avdSokPopup.setContent(v),window.avdSokPopup.setLatLng(s),l.bindPopup(window.avdSokPopup),window.avdSokPopup.openOn(smap.map),l.addTo(smap.map.avdSearchLg),smap.map.on("popupclose",$.proxy(function(){d.click()},d)),window.setTimeout(function(){$(".lswitch-btnhide.btn.btn-default")[0].click()},500)}else smap.cmd.notify("Den sökta fråga hittades inte","error");else smap.cmd.notify("Den sökta fråga hittades inte","error")}},_dataURLToBlob:function(e){var t=";base64,";if(-1==e.indexOf(t)){var n=e.split(","),a=n[0].split(":")[1],i=n[1];return new Blob([i],{type:a})}for(var n=e.split(t),a=n[0].split(":")[1],i=window.atob(n[1]),o=i.length,s=new Uint8Array(o),l=0;o>l;++l)s[l]=i.charCodeAt(l);return new Blob([s],{type:a})},_randomTextAndNumberParameter:function(){for(var e="",t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxuz0123456789",a=0;5>a;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return t="&"+e+"="+Math.floor(Math.random()*Math.pow(10,18))},randomText:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxuz0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},_showSplashMessage_wait:function(e,t){var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=document.createElement("div"),o=n,s=a;i.id="generalSplashID_wait",i.style.width=o+"px",i.style.height=s+"px",i.style.left=n/2-o/2+"px",i.style.top=a/2-s/2+"px",i.style.background="rgba(0,0,0,0.5)",i.style.zIndex="4000",i.style.position="fixed",i.style.border="5px solid white",i.style.borderRadius="15px";var l=document.createElement("div");l.id="closeSpan_div_id",l.style.position="relative";var r=document.createElement("span");r.style.color="white",r[getTextContent(r)]=" X ",r.style.position="relative",r.style.borderRadius="20px",r.style.background="rgba(0,0,0,1)",r.style.fontSize="25px",r.style.top="10px",r.style.left=o/2-10+"px",r.onclick=function(){var e=document.getElementById("generalSplashID_wait");e&&document.body.removeChild(e)},l.appendChild(r),i.appendChild(l);var p=document.createElement("img");p.src="data:image/gif;base64,R0lGODlhIAAgAPMAAP///wAAAMbGxoSEhLa2tpqamjY2NlZWVtjY2OTk5Ly8vB4eHgQEBAAAAAAAAAAAACH5BAkKAAAAIf4aQ3JlYXRlZCB3aXRoIGFqYXhsb2FkLmluZm8AIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOw==",p.style.position="relative",p.style.top=(a-64)/2+"px",p.style.left=n/2+"px",i.appendChild(p);var d=document.createElement("div");d.style.marginTop=a/2+"px",d.style.textAlign="center",d.style.color="white",d[getTextContent(d)]=e,i.appendChild(d),document.body.appendChild(i)},_hideSplashMessage_wait:function(){var e=document.getElementById("generalSplashID_wait");e&&document.body.removeChild(e)},_showSplashMessage:function(e,t){var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=document.createElement("div"),o=300,s=150;i.id="generalSplashID",i.style.width=o+"px",i.style.height=s+"px",i.style.left=n/2-o/2+"px",i.style.top=a/2-s/2+"px",i.style.background="rgba(0,0,0,0.8)",i.style.zIndex="4000",i.style.position="fixed",i.style.border="5px solid white",i.style.borderRadius="15px";var l=document.createElement("div");l.id="closeSpan_div_id",l.style.position="relative";var r=document.createElement("span");r.style.color="white",r[getTextContent(r)]=" X ",r.style.position="relative",r.style.borderRadius="20px",r.style.background="rgba(0,0,0,1)",r.style.fontSize="25px",r.style.top="10px",r.style.left=o/2-10+"px",r.onclick=function(){var e=document.getElementById("generalSplashID");e&&document.body.removeChild(e)},l.appendChild(r),i.appendChild(l);var p=document.createElement("div");p.style.marginTop="20px",p.style.marginLeft="10px",p.style.color="white",p[getTextContent(p)]=e,i.appendChild(p),document.body.appendChild(i),window.setTimeout(function(){var e=document.getElementById("generalSplashID");e&&document.body.removeChild(e)},t)},_showLabelTipMessage:function(e,t,n,a,i,o,s,l){var r=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,"generalSplashID"+(smap.inv.panel._showLabelTipMessage_counter-1));"undefined"!=typeof document.getElementById(r)&&null!==document.getElementById(r)&&document.body.removeChild(document.getElementById(r));var p=document.createElement("div"),d=t,c=n;p.id="generalSplashID"+smap.inv.panel._showLabelTipMessage_counter,p.style.width=d+"px",p.style.height=c+"px",p.style.left=o+"px",p.style.top=s+"px",p.style.background=l,p.style.zIndex="4000",p.style.position="fixed",p.style.borderRadius="2px";var m=document.createElement("div");m.style.marginTop="5px",m.style.marginLeft="5px",m.style.color=i,m[getTextContent(m)]=e,p.appendChild(m),document.body.appendChild(p),window.setTimeout($.proxy(function(){var e=p.id,t=document.getElementById(e);t&&document.body.removeChild(t)},p),3e3),smap.inv.panel._showLabelTipMessage_counter++},_showSplashMessage_wait_button:function(e,t,n,a,i,o,s,l){var r=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,document.createElement("div")),p=e,d=t;r.id="generalSplashID_wait_button",r.style.width=p+"px",r.style.height=d+"px",r.style.left=i+"px",r.style.top=o+"px",r.style.background=s,r.style.zIndex="4000",r.style.position="fixed",r.style.border="0px solid white",r.style.borderRadius="next"===l?"0px 5px 5px 0px":"pre"===l?"5px 0px 0px 5px":"5px 5px 5px 5px";var c=document.createElement("img");c.src="data:image/gif;base64,R0lGODlhIAAgAPMAAP///wAAAMbGxoSEhLa2tpqamjY2NlZWVtjY2OTk5Ly8vB4eHgQEBAAAAAAAAAAAACH5BAkKAAAAIf4aQ3JlYXRlZCB3aXRoIGFqYXhsb2FkLmluZm8AIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOw==",c.style.position="relative",c.style.top="0px",c.style.left="0px",r.appendChild(c),document.body.appendChild(r),window.setTimeout(function(){var e=document.getElementById("generalSplashID_wait_button");e&&document.body.removeChild(e)},3e5)},_hideSplashMessage_wait_button:function(){var e=document.getElementById("generalSplashID_wait_button");e&&document.body.removeChild(e)},singleCrInv:function(e,t,n){var a={},i={};i=smap.comfig?smap.comfig:config;for(var o=0;o<i.ol.length;o++)i.ol[o].options.layerId===e.options.pointInPolygonOptions.PIP_LayerName&&(a=i.ol[o].options);var s=e.options.pointInPolygonOptions.pointFetchURL+"&FEATUREID="+t.id+smap.cmd._randomTextAndNumberParameter(),l=new smap.cmd._xhr_handler;if(l.open("GET",s,!1),l.send(null),4==l.readyState&&200==l.status){var r=JSON.parse(l.responseText),p={};r.features.length>0?(p=r.features[0],p.options=a,p.latLng=utils.projectLatLng(L.latLng(r.features[0].geometry.coordinates[0][1],r.features[0].geometry.coordinates[0][0]),e.options.pointInPolygonOptions.srs,"EPSG:4326",!1,!1),"MultiPoint"===p.geometry.type&&(p.geometry.coordinates[0][0]=p.latLng.lng,p.geometry.coordinates[0][1]=p.latLng.lat),this.crInv(p,n)):smap.cmd._showSplashMessage("Server fel. Försöka igen eller Ring upp: Mohammad Amin: 044136212",2e3)}},order_lekplatsredskap:function(e,t,n){var a={};a.bbox=e.bbox,a.type=e.type,a.features=[],a.all_latlng=[];var i=function(e,t,n,a){return Math.pow(e-n,2)+Math.pow(t-a,2)},o=1e25,s=null;if(e.features.length>0){var l=0;do{for(var r=0;r<e.features.length;r++)if("undefined"!=typeof e.features[r].checkedout&&null!==e.features[r].checkedout);else if("MultiPoint"===e.features[r].geometry.type){var p=i(e.features[r].geometry.coordinates[0][0],e.features[r].geometry.coordinates[0][1],t.x,t.y);o>p&&(o=p,s=r)}e.features[s].checkedout=!0,e.features[s].feature_order=l,t.x=e.features[s].geometry.coordinates[0][0],t.y=e.features[s].geometry.coordinates[0][1],a.features.push(e.features[s]);var d=utils.projectLatLng(L.latLng(t.y,t.x),n.options.pointInPolygonOptions.srs,"EPSG:4326",!1,!1);a.all_latlng.push(d),l++,o=1e25}while(l<e.features.length)}return a},crInvMultiple:function(e,t){smap.inv.panel.polygon_feature=e,smap.map.fire("unselected");var n=utils.projectLatLng(e.latLng,"EPSG:4326",e.options.pointInPolygonOptions.srs,!1,!1);n.x=n.lng,n.y=n.lat;var a=e.options.pointInPolygonOptions.pointFetchURL+smap.cmd._randomTextAndNumberParameter()+"&PROPERTYNAME="+e.options.pointInPolygonOptions.PIP_PropertyName+'&FILTER=<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsEqualTo><ogc:PropertyName>'+e.options.pointInPolygonOptions.PIP_PropertyName+"</ogc:PropertyName><ogc:Literal>"+e.properties[e.options.pointInPolygonOptions.PIP_PropertyName]+"</ogc:Literal></ogc:PropertyIsEqualTo></ogc:Filter>",i=new smap.cmd._xhr_handler;if(i.open("GET",a,!1),i.send(null),4==i.readyState&&200==i.status)var o=JSON.parse(i.responseText);smap.inv.panel.ordered_lekplatsredskap=this.order_lekplatsredskap(o,n,e),("undefined"==typeof smap.inv.panel.parkRouteLayerkap||null===smap.inv.panel.parkRouteLayerkap)&&(smap.inv.panel.parkRouteLayerkap=L.layerGroup(),smap.inv.panel.parkRouteLayerkap.id="parkroutelayer",smap.map.addLayer(smap.inv.panel.parkRouteLayerkap));for(var s=(L.polyline(smap.inv.panel.ordered_lekplatsredskap.all_latlng,{color:"#72bf44",opacity:"0.5",fillOpacity:"0.5"}).addTo(smap.inv.panel.parkRouteLayerkap),0);s<smap.inv.panel.ordered_lekplatsredskap.all_latlng.length;s++){var l=s+1,r=L.divIcon({className:"height-div-icon",html:'<p style="position:relative;left:8px;top:-8px;font-size:11.5pt;font-family:Arial;font-weight:normal;color:red;text-shadow:0 0 5px #fff;"><b>'+l+"&nbsp;</b></p>"}),p={icon:r,clickable:!0,externalGraphic:"http://"+window.location.host+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1)+"img/legend/empty.png",label:l,fontColor:"#000000",fontSize:10.5,fontFamily:"Arial",fontWeight:"bold",labelAlign:"lb"},d=(Math.random().toString().split(".")[1],L.marker([smap.inv.panel.ordered_lekplatsredskap.all_latlng[s].lat,smap.inv.panel.ordered_lekplatsredskap.all_latlng[s].lng],p));d.addTo(smap.inv.panel.parkRouteLayerkap)}this.singleCrInv(e,smap.inv.panel.ordered_lekplatsredskap.features[smap.inv.panel.travellingSalesManIndex],t)},crInv:function(options,single_or_multiple){smap.inv.panel.single_or_multiple_besiktning=single_or_multiple,smap.inv.panel.feature=options,"undefined"!=typeof smap.inv.panel._drawInvPanelCreated&&null!==smap.inv.panel._drawInvPanelCreated||(smap.inv.panel._drawInvPanelCreated=!1);var innerWidth_custom=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,innerHeight_custom=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;smap.inv.panel.maxWidth=700,smap.inv.panel.minHeight=50,smap.inv.panel.maxHeight=innerHeight_custom-60,smap.cmd.mainPanelDiv=function(){if(smap.inv.panel._drawInvPanel_div=document.createElement("div"),smap.inv.panel._drawInvPanel_div.className="invPanelWithModal",smap.inv.panel._drawInvPanel_div.id="invPanelWithModalId",smap.inv.panel._drawInvPanel_div.style.maxWidth=smap.inv.panel.maxWidth+"px",smap.inv.panel._drawInvPanel_div.style.minHeight=smap.inv.panel.minHeight+"px",smap.inv.panel._drawInvPanel_div.style.maxHeight=smap.inv.panel.maxHeight+"px",smap.inv.panel._drawInvPanel_div.style.width=95*innerWidth_custom/100+"px",95*innerWidth_custom/100<smap.inv.panel.maxWidth)var e=innerWidth_custom/2-95*innerWidth_custom/100/2;else var e=innerWidth_custom/2-smap.inv.panel.maxWidth/2;smap.inv.panel._drawInvPanel_div.style.right=e+"px"},smap.inv.panel.content_div=function(){smap.inv.panel._drawInvPanel_content_div=document.createElement("div"),smap.inv.panel._drawInvPanel_content_div.className="modal-content",smap.inv.panel._drawInvPanel_content_div.id="_drawInvPanel_content_div_id",smap.inv.panel._drawInvPanel_content_div.style.position="relative"},smap.inv.panel.header_div=function(){smap.inv.panel._drawInvPanel_contentin_header_div=document.createElement("div"),smap.inv.panel._drawInvPanel_contentin_header_div.className="modal-header",smap.inv.panel._drawInvPanel_contentin_header_div.id="_drawInvPanel_contentin_header_div_id",smap.inv.panel._drawInvPanel_contentin_header_div.style.position="relative"},smap.inv.panel.minimize_B=function(){smap.inv.panel.minimizeButton=document.createElement("button"),smap.inv.panel.minimizeButton.id="minimizeInvPanelButtonID",smap.inv.panel.minimizeButton.className="minimize",smap.inv.panel.minimizeButton.onclick=function(){this.style.display="none",smap.inv.panel.maximizeButton.style.display="block",smap.inv.panel._drawInvPanel_contentin_body_div.style.display="none",smap.inv.panel._drawInvPanel_contentin_footer_div.style.display="none"},smap.inv.panel.minimizeImg=document.createElement("span"),smap.inv.panel.minimizeImg.id="invPanelMinimizeImg",smap.inv.panel.minimizeImg.className="glyphicon glyphicon-minus",smap.inv.panel.minimizeButton.appendChild(smap.inv.panel.minimizeImg)},smap.inv.panel.maximize_B=function(){smap.inv.panel.maximizeButton=document.createElement("button"),smap.inv.panel.maximizeButton.id="minimizeInvPanelButtonID",smap.inv.panel.maximizeButton.className="minimize",smap.inv.panel.maximizeButton.style.display="none",smap.inv.panel.maximizeButton.onclick=function(){this.style.display="none",smap.inv.panel.minimizeButton.style.display="block",smap.inv.panel._drawInvPanel_contentin_body_div.style.display="block",smap.inv.panel._drawInvPanel_contentin_footer_div.style.display="block"},smap.inv.panel.maximizeImg=document.createElement("span"),smap.inv.panel.maximizeImg.id="invPanelMaximizeImg",smap.inv.panel.maximizeImg.className="glyphicon glyphicon-plus",smap.inv.panel.maximizeButton.appendChild(smap.inv.panel.maximizeImg)},smap.inv.panel.close_B=function(){smap.inv.panel.closeButton=document.createElement("button"),smap.inv.panel.closeButton.id="closeInvPanelButtonID",smap.inv.panel.closeButton.className="close",smap.inv.panel.closeButton.onclick=function(){smap.inv.panel.hide(),"undefined"!=typeof smap.inv.panel.geometry&&null!=smap.inv.panel.geometry&&smap.inv.panel.geometryLg.removeLayer(smap.inv.panel.geometry),("undefined"!=typeof smap.inv.panel.parkRouteLayerkap||null!=smap.inv.panel.parkRouteLayerkap)&&smap.inv.panel.parkRouteLayerkap.clearLayers(),("undefined"!=typeof smap.inv.panel._tabDivContent_div_btnDiv_label_pl||null!=smap.inv.panel._tabDivContent_div_btnDiv_label_pl)&&(smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none")},smap.inv.panel.closeImg=document.createElement("span"),smap.inv.panel.closeImg.id="invPanelCloseImg",smap.inv.panel.closeImg.className="glyphicon glyphicon-remove",smap.inv.panel.closeButton.appendChild(smap.inv.panel.closeImg)},smap.inv.panel.header_T=function(){smap.inv.panel.headertext=document.createElement("h4"),smap.inv.panel.headertext.id="invHeaderText_id",smap.inv.panel.headertext.className="modal-title",smap.inv.panel.headertext[getTextContent(smap.inv.panel.headertext)]=smap.inv.panel.feature.options.editOptions.editPanelName},smap.inv.panel.appendHeaderElement=function(){smap.inv.panel._drawInvPanel_contentin_header_div.appendChild(smap.inv.panel.closeButton),smap.inv.panel._drawInvPanel_contentin_header_div.appendChild(smap.inv.panel.minimizeButton),smap.inv.panel._drawInvPanel_contentin_header_div.appendChild(smap.inv.panel.maximizeButton),smap.inv.panel._drawInvPanel_contentin_header_div.appendChild(smap.inv.panel.headertext)},smap.inv.panel.mainBody=function(){smap.inv.panel.is_next_previousbutton_click=!1,smap.inv.panel._drawInvPanel_contentin_body_div=document.createElement("div"),smap.inv.panel._drawInvPanel_contentin_body_div.id="_drawInvPanel_contentin_body_div_id",smap.inv.panel._drawInvPanel_contentin_body_div.style.position="relative",smap.inv.panel._drawInvPanel_contentin_body_tab_div=document.createElement("div"),smap.inv.panel._drawInvPanel_contentin_body_tab_div.className="modal-body",smap.inv.panel._drawInvPanel_contentin_body_tab_div.id="_drawInvPanel_contentin_body_div_tab_id",smap.inv.panel._drawInvPanel_contentin_body_tab_div.style.position="relative",smap.inv.panel._tabDivContent=document.createElement("div"),smap.inv.panel._tabDivContent_div=document.createElement("div"),smap.inv.panel._tabDivContent_div_btnDiv=document.createElement("div"),smap.inv.panel._tabDivContent_div_btnDiv.className="btn-group",smap.inv.panel._tabDivContent_div_btnDiv.setAttribute("data-toggle","buttons"),smap.inv.panel._tabDivContent_div_btnDiv_label_p=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_p.className="btn btn-default",
smap.inv.panel._tabDivContent_div_btnDiv_label_p.id="park_previous_tab_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_p.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_p.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_input_p=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_p.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_input_p.value="Previous",smap.inv.panel._tabDivContent_div_btnDiv_label_input_p.id="park_previous_tab_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_p.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_p.onclick=function(){smap.cmd._showSplashMessage_wait_button(34,34,"1px solid black","black",this.getBoundingClientRect().left,this.getBoundingClientRect().top,"rgba(0,0,0,0.1)","pre")},smap.inv.panel._tabDivContent_div_btnDiv_label_input_p.onchange=function(){smap.inv.panel.is_next_previousbutton_click=!0,smap.cmd.loading(!0),smap.inv.panel.travellingSalesManIndex--,-1===smap.inv.panel.travellingSalesManIndex?(smap.inv.panel.travellingSalesManIndex=smap.inv.panel.ordered_lekplatsredskap.features.length,smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="block",smap.inv.panel._tabDivContent_div_btnDiv_label_pl.click(),smap.inv.panel.geometryLg.removeLayer(smap.inv.panel.geometry)):-2===smap.inv.panel.travellingSalesManIndex?(smap.inv.panel.travellingSalesManIndex=smap.inv.panel.ordered_lekplatsredskap.features.length-1,smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none",smap.cmd.singleCrInv(smap.inv.panel.polygon_feature,smap.inv.panel.ordered_lekplatsredskap.features[smap.inv.panel.travellingSalesManIndex],"multiple"),"utfora"===besiktninglager.appName&&smap.inv.panel._tabDivContent_div_btnDiv_label_t.click()):(smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none",smap.cmd.singleCrInv(smap.inv.panel.polygon_feature,smap.inv.panel.ordered_lekplatsredskap.features[smap.inv.panel.travellingSalesManIndex],"multiple"),"utfora"===besiktninglager.appName&&smap.inv.panel._tabDivContent_div_btnDiv_label_t.click()),smap.cmd.loading(!1),smap.inv.panel.is_next_previousbutton_click=!1,window.setTimeout(smap.cmd._hideSplashMessage_wait_button,500)},smap.inv.panel._tabDivContent_div_btnDiv_label_p[getTextContent(smap.inv.panel._tabDivContent_div_btnDiv_label_p)]=" < ",smap.inv.panel._tabDivContent_div_btnDiv_label_p.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_p),smap.inv.panel._tabDivContent_div_btnDiv_label_l=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_l.className="btn btn-default",smap.inv.panel._tabDivContent_div_btnDiv_label_l.id="park_loggain_tab_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_l.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_input_l=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_l.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_input_l.value="loggain",smap.inv.panel._tabDivContent_div_btnDiv_label_input_l.id="park_loggain_tab_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_l.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_l.onchange=smap.inv.panel._drawInvPropertyDiv,smap.inv.panel._tabDivContent_div_btnDiv_label_l.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_l),smap.inv.panel._tabDivContent_div_btnDiv_label_span_l=document.createElement("span"),smap.inv.panel._tabDivContent_div_btnDiv_label_span_l.className="glyphicon glyphicon-log-in",smap.inv.panel._tabDivContent_div_btnDiv_label_span_l.onclick=function(){smap.cmd._showLabelTipMessage("Logga in",100,30,"1px solid black","black",this.getBoundingClientRect().left-13,this.getBoundingClientRect().top-40,"rgba(221,221,221,1)")},smap.inv.panel._tabDivContent_div_btnDiv_label_l.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_span_l),smap.inv.panel._tabDivContent_div_btnDiv_label_u=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_u.className="btn btn-default",smap.inv.panel._tabDivContent_div_btnDiv_label_u.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_u.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_u.id="park_loggaut_tab_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_u=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_u.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_input_u.value="loggain",smap.inv.panel._tabDivContent_div_btnDiv_label_input_u.id="park_loggaut_tab_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_u.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_u.onchange=smap.inv.panel._drawInvPropertyDiv,smap.inv.panel._tabDivContent_div_btnDiv_label_u.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_u),smap.inv.panel._tabDivContent_div_btnDiv_label_input_span_u=document.createElement("span"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_span_u.className="glyphicon glyphicon-log-out",smap.inv.panel._tabDivContent_div_btnDiv_label_input_span_u.onclick=function(){smap.cmd._showLabelTipMessage("Logga ut",100,30,"1px solid black","black",this.getBoundingClientRect().left-13,this.getBoundingClientRect().top-40,"rgba(221,221,221,1)")},smap.inv.panel._tabDivContent_div_btnDiv_label_u.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_span_u),smap.inv.panel._tabDivContent_div_btnDiv_label_b=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_b.className="btn btn-default active",smap.inv.panel._tabDivContent_div_btnDiv_label_b.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_b.id="park_besiktning_tab_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_b=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_b.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_input_b.value="Besiktning",smap.inv.panel._tabDivContent_div_btnDiv_label_input_b.id="park_besiktning_tab_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_b.setAttribute("checked",""),smap.inv.panel._tabDivContent_div_btnDiv_label_input_b.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_b.onchange=smap.inv.panel._drawInvPropertyDiv,smap.inv.panel._tabDivContent_div_btnDiv_label_b.onclick=function(){smap.cmd._showLabelTipMessage("Besiktning",100,30,"1px solid black","black",this.getBoundingClientRect().left,this.getBoundingClientRect().top-30,"rgba(221,221,221,1)")},smap.inv.panel._tabDivContent_div_btnDiv_label_b[getTextContent(smap.inv.panel._tabDivContent_div_btnDiv_label_b)]="BS.",smap.inv.panel._tabDivContent_div_btnDiv_label_b.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_b),smap.inv.panel._tabDivContent_div_btnDiv_label_t=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_t.className="btn btn-default",smap.inv.panel._tabDivContent_div_btnDiv_label_t.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_t.id="park_previous_objects_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_t_input=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_t_input.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_t_input.value="Tidigare inspektioner",smap.inv.panel._tabDivContent_div_btnDiv_label_t_input.id="park_previous_objects_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_t_input.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_t_input.onchange=smap.inv.panel._drawInvPropertyDiv,smap.inv.panel._tabDivContent_div_btnDiv_label_t.onclick=function(){"utfora"===besiktninglager.appName?smap.cmd._showLabelTipMessage("Alla besiktad och meddela åtgärda",150,60,"1px solid black","black",this.getBoundingClientRect().left,this.getBoundingClientRect().top-60,"rgba(221,221,221,1)"):smap.cmd._showLabelTipMessage("Alla Besiktning",120,30,"1px solid black","black",this.getBoundingClientRect().left,this.getBoundingClientRect().top-30,"rgba(221,221,221,1)")},smap.inv.panel._tabDivContent_div_btnDiv_label_t[getTextContent(smap.inv.panel._tabDivContent_div_btnDiv_label_t)]="utfora"===besiktninglager.appName?"ABS&Å.":"ABS.",smap.inv.panel._tabDivContent_div_btnDiv_label_t.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_t_input),smap.inv.panel._tabDivContent_div_btnDiv_label_s=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_s.className="btn btn-default",smap.inv.panel._tabDivContent_div_btnDiv_label_s.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_s.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_s.id="park_senast_tab_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_s=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_s.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_input_s.value="senastBesiktning",smap.inv.panel._tabDivContent_div_btnDiv_label_input_s.id="park_senastb_tab_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_s.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_s.onchange=smap.inv.panel._drawInvPropertyDiv,smap.inv.panel._tabDivContent_div_btnDiv_label_s.onclick=function(){smap.cmd._showLabelTipMessage("Senast Besiktning",140,30,"1px solid black","black",this.getBoundingClientRect().left,this.getBoundingClientRect().top-30,"rgba(221,221,221,1)")},smap.inv.panel._tabDivContent_div_btnDiv_label_s[getTextContent(smap.inv.panel._tabDivContent_div_btnDiv_label_s)]="SBS.",smap.inv.panel._tabDivContent_div_btnDiv_label_s.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_s),smap.inv.panel._tabDivContent_div_btnDiv_label_pl=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_pl.className="btn btn-default",smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_pl.id="park_plats_tab_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_pl=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_pl.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_input_pl.value="platsBesiktning",smap.inv.panel._tabDivContent_div_btnDiv_label_input_pl.id="park_plats_tab_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_pl.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_pl.onchange=smap.inv.panel._drawInvPropertyDiv,smap.inv.panel._tabDivContent_div_btnDiv_label_pl.onclick=function(){smap.cmd._showLabelTipMessage("Plats Besiktning",200,30,"1px solid black","black",this.getBoundingClientRect().left,this.getBoundingClientRect().top-30,"rgba(221,221,221,1)")},smap.inv.panel._tabDivContent_div_btnDiv_label_pl[getTextContent(smap.inv.panel._tabDivContent_div_btnDiv_label_pl)]="PBS.",smap.inv.panel._tabDivContent_div_btnDiv_label_pl.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_pl),smap.inv.panel._tabDivContent_div_btnDiv_label_N=document.createElement("label"),smap.inv.panel._tabDivContent_div_btnDiv_label_N.className="btn btn-default",smap.inv.panel._tabDivContent_div_btnDiv_label_N.id="park_next_tab_label_id",smap.inv.panel._tabDivContent_div_btnDiv_label_N.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_N.style.color="#72bf44",smap.inv.panel._tabDivContent_div_btnDiv_label_input_N=document.createElement("input"),smap.inv.panel._tabDivContent_div_btnDiv_label_input_N.type="radio",smap.inv.panel._tabDivContent_div_btnDiv_label_input_N.value="Next",smap.inv.panel._tabDivContent_div_btnDiv_label_input_N.id="park_next_tab_input_id",smap.inv.panel._tabDivContent_div_btnDiv_label_input_N.setAttribute("name","besiktning"),smap.inv.panel._tabDivContent_div_btnDiv_label_N.onclick=function(){smap.cmd._showSplashMessage_wait_button(34,34,"1px solid black","black",this.getBoundingClientRect().left,this.getBoundingClientRect().top,"rgba(0,0,0,0.1)","next")},smap.inv.panel._tabDivContent_div_btnDiv_label_input_N.onchange=function(){smap.inv.panel.is_next_previousbutton_click=!0,smap.cmd.loading(!0),smap.inv.panel.travellingSalesManIndex++,smap.inv.panel.travellingSalesManIndex===smap.inv.panel.ordered_lekplatsredskap.features.length?(smap.inv.panel.travellingSalesManIndex=-1,smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="block",smap.inv.panel._tabDivContent_div_btnDiv_label_pl.click(),smap.inv.panel.geometryLg.removeLayer(smap.inv.panel.geometry)):smap.inv.panel.travellingSalesManIndex===smap.inv.panel.ordered_lekplatsredskap.features.length+1?(smap.inv.panel.travellingSalesManIndex=0,smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none",smap.cmd.singleCrInv(smap.inv.panel.polygon_feature,smap.inv.panel.ordered_lekplatsredskap.features[smap.inv.panel.travellingSalesManIndex],"multiple"),"utfora"===besiktninglager.appName&&smap.inv.panel._tabDivContent_div_btnDiv_label_t.click()):(smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none",smap.cmd.singleCrInv(smap.inv.panel.polygon_feature,smap.inv.panel.ordered_lekplatsredskap.features[smap.inv.panel.travellingSalesManIndex],"multiple"),"utfora"===besiktninglager.appName&&smap.inv.panel._tabDivContent_div_btnDiv_label_t.click()),smap.cmd.loading(!1),smap.inv.panel.is_next_previousbutton_click=!1,window.setTimeout(smap.cmd._hideSplashMessage_wait_button,500)},smap.inv.panel._tabDivContent_div_btnDiv_label_N[getTextContent(smap.inv.panel._tabDivContent_div_btnDiv_label_N)]=" > ",smap.inv.panel._tabDivContent_div_btnDiv_label_N.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_input_N),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_p),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_u),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_l),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_b),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_t),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_s),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_pl),smap.inv.panel._tabDivContent_div_btnDiv.appendChild(smap.inv.panel._tabDivContent_div_btnDiv_label_N),smap.inv.panel._tabDivContent_div.appendChild(smap.inv.panel._tabDivContent_div_btnDiv),smap.inv.panel._tabDivContent.appendChild(smap.inv.panel._tabDivContent_div),smap.inv.panel._drawInvPanel_contentin_body_tab_div.appendChild(smap.inv.panel._tabDivContent),smap.inv.panel._drawInvPanel_contentin_body_div.appendChild(smap.inv.panel._drawInvPanel_contentin_body_tab_div),smap.inv.panel._drawInvPanel_contentin_body_property_div=document.createElement("div"),smap.inv.panel._drawInvPanel_contentin_body_property_div.className="modal-body",smap.inv.panel._drawInvPanel_contentin_body_property_div.id="_drawInvPanel_contentin_body_property_div_id",smap.inv.panel._drawInvPanel_contentin_body_property_div.style.position="relative",smap.inv.panel._drawInvPanel_contentin_body_div.appendChild(smap.inv.panel._drawInvPanel_contentin_body_property_div)},smap.inv.panel.actionDiv=function(){smap.inv.panel._drawInvPanel_contentin_footer_div=document.createElement("div"),smap.inv.panel._drawInvPanel_contentin_footer_div.className="modal-footer",smap.inv.panel._drawInvPanel_contentin_footer_div.id="_drawInvPanel_contentin_footer_div_id",smap.inv.panel._drawInvPanel_contentin_footer_div.style.position="relative"},smap.inv.panel._drawGeometry=function(){"undefined"!=typeof smap.inv.panel.geometry&&null!=smap.inv.panel.geometry&&smap.inv.panel.geometryLg.removeLayer(smap.inv.panel.geometry),("undefined"==typeof smap.inv.panel.geometryLg||null===smap.inv.panel.geometryLg)&&(smap.inv.panel.geometryLg=L.layerGroup(),smap.inv.panel.geometryLg.id="geometryLg_id",smap.map.addLayer(smap.inv.panel.geometryLg));var e={stroke:!0,color:"yellow",weight:4,opacity:.8,fill:!0,fillColor:null,fillOpacity:.5,clickable:!1};if(smap.inv.panel.feature&&smap.inv.panel.feature.geometry&&smap.inv.panel.feature.geometry.coordinates.length>0){var t=L.latLng(smap.inv.panel.feature.geometry.coordinates[0][1],smap.inv.panel.feature.geometry.coordinates[0][0]);smap.inv.panel.geometry=new L.Circle(t,3,e),smap.inv.panel.geometry.addTo(smap.inv.panel.geometryLg)}},smap.inv.panel.next_previous_button_show=function(){"multiple"===smap.inv.panel.single_or_multiple_besiktning?(smap.inv.panel._tabDivContent_div_btnDiv_label_N.style.display="block",smap.inv.panel._tabDivContent_div_btnDiv_label_p.style.display="block"):smap.inv.panel.next_previous_button_hide()},smap.inv.panel.next_previous_button_hide=function(){smap.inv.panel._tabDivContent_div_btnDiv_label_N.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_p.style.display="none"},smap.inv.panel._drawInvPanel=function(){smap.cmd.mainPanelDiv(),smap.inv.panel.content_div(),smap.inv.panel.header_div(),smap.inv.panel.minimize_B(),smap.inv.panel.maximize_B(),smap.inv.panel.close_B(),smap.inv.panel.header_T(),smap.inv.panel.appendHeaderElement(),smap.inv.panel.mainBody(),smap.inv.panel.actionDiv(),smap.inv.panel._drawInvPanel_content_div.appendChild(smap.inv.panel._drawInvPanel_contentin_header_div),smap.inv.panel._drawInvPanel_content_div.appendChild(smap.inv.panel._drawInvPanel_contentin_body_div),smap.inv.panel._drawInvPanel_content_div.appendChild(smap.inv.panel._drawInvPanel_contentin_footer_div),smap.inv.panel._drawInvPanel_div.appendChild(smap.inv.panel._drawInvPanel_content_div),document.body.appendChild(smap.inv.panel._drawInvPanel_div),smap.inv.panel._drawInvPanelCreated=!0},smap.inv.panel._resetBesiktningForm=function(){smap.inv.panel.photo.takePhotoButton.value="",smap.inv.panel.photo.allTempPhotos={},document.getElementById("lekplatsredskap_bedomt").value="",document.getElementById("lekplatsredskap_fel").value="",document.getElementById("lekplatsredskap_fritext").value="",document.getElementById("lekplatsredskap_atgardsforslag").value="";for(var e=document.getElementById("show_captured_photos"),t=e.childNodes.length-1;t>-1;t--)e.removeChild(e.childNodes[t])},smap.inv.panel._drawInvPropertyDiv_besiktning=function(e){if(smap.inv.panel._drawInvPanel_contentin_footer_div.style.display="block",smap.inv.panel.feature.options.editOptions.mainAttribute&&smap.inv.panel.feature.properties&&smap.inv.panel.feature.properties[smap.inv.panel.feature.options.editOptions.mainAttribute]){if("multiple"===smap.inv.panel.single_or_multiple_besiktning){var t=smap.inv.panel.travellingSalesManIndex+1,n='<div class="form-group" style="text-align: center;margin-bottom:20px;"> <div><b>Redskap: </b>'+smap.inv.panel.feature.properties.kod+"  "+smap.inv.panel.feature.properties.text+"</br><b>Fabrikat: </b>"+smap.inv.panel.feature.properties.fabrikat+" "+smap.inv.panel.feature.properties.nr+"</br><b>Egentext: </b>"+smap.inv.panel.feature.properties.fritext+"</br><b>Utförare: </b>"+smap.inv.panel.feature.properties.utforare+"</br><b>Id på kartan: </b>"+t+"</div> </div>";smap.inv.panel.point_identification_content='<div class="row"><div class="col-xs-12 col-sm-12"> <div><b>Redskap: </b>'+smap.inv.panel.feature.properties.kod+"  "+smap.inv.panel.feature.properties.text+"<b> Fabrikat: </b>"+smap.inv.panel.feature.properties.fabrikat+" "+smap.inv.panel.feature.properties.nr+"<b> Egentext: </b>"+smap.inv.panel.feature.properties.fritext+"<b> Utförare: </b>"+smap.inv.panel.feature.properties.utforare+"<b> Id på kartan: </b>"+t+"</div> </div></div>"}else{var n='<div class="form-group" style="text-align: center;margin-bottom:20px;"> <div><b>Redskap: </b>'+smap.inv.panel.feature.properties.kod+"  "+smap.inv.panel.feature.properties.text+"</br><b>Fabrikat: </b>"+smap.inv.panel.feature.properties.fabrikat+" "+smap.inv.panel.feature.properties.nr+"</br><b>Egentext: </b>"+smap.inv.panel.feature.properties.fritext+"<b>Utförare: </b>"+smap.inv.panel.feature.properties.utforare+"</div> </div>";smap.inv.panel.point_identification_content='<div class="row"><div class="col-xs-12 col-sm-12"> <div><b>Redskap: </b>'+smap.inv.panel.feature.properties.kod+"  "+smap.inv.panel.feature.properties.text+"<b> Fabrikat: </b>"+smap.inv.panel.feature.properties.fabrikat+" "+smap.inv.panel.feature.properties.nr+"<b> Egentext: </b>"+smap.inv.panel.feature.properties.fritext+"<b> Utförare: </b>"+smap.inv.panel.feature.properties.utforare+"</div> </div></div>"}smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(n)[0])}for(var a=smap.inv.panel.feature.options.editOptions.create.docs[0].editableProperties,i=0;i<a.length;i++){var o="";if(0===i&&(smap.inv.panel.photo={},smap.inv.panel.photo.photo_control=document.createElement("div"),smap.inv.panel.photo.photo_control.className="form-group",smap.inv.panel.photo.takePhotoDiv=document.createElement("div"),smap.inv.panel.photo.label_div=document.createElement("div"),smap.inv.panel.photo.label_div.innerHTML="<b>Bilder</b>",smap.inv.panel.photo.imageDiv=document.createElement("div"),smap.inv.panel.photo.imageDiv.id="show_captured_photos",smap.inv.panel.photo.imageDiv.style.display="table-cell",smap.inv.panel.photo.takePhotoButton=document.createElement("input"),smap.inv.panel.photo.takePhotoButton.type="file",smap.inv.panel.photo.takePhotoButton.multiple=!0,smap.inv.panel.photo.takePhotoButton.style.marginBottom="10px",smap.inv.panel.photo.takePhotoButton.accept=decodeURIComponent("image%2F*%3Acapture%3Dcamera"),smap.inv.panel.photo.allTempPhotos={},smap.inv.panel.photo.takePhotoButton.onchange=function(){var e=this;if(e.files&&e.files[0])for(var t=0;t<e.files.length;t++){e.files[t].id=Math.random()*Math.pow(10,20);var n=new FileReader;n.id=e.files[t].id,n.onload=function(e){var t=document.createElement("div");t.style["float"]="left",t.style.height="111px";var n=document.createElement("img");n.style.padding="10px",n.src=e.target.result,n.width="102",n.height="102";var a=document.createElement("div");a.id=this.id,a.innerText="X",a.className="deleteButton",a.onclick=function(){this.parentNode.parentNode.removeChild(this.parentNode),delete smap.inv.panel.photo.allTempPhotos[this.id]},t.appendChild(n),t.appendChild(a),smap.inv.panel.photo.imageDiv.appendChild(t)},n.readAsDataURL(e.files[t]),smap.inv.panel.photo.allTempPhotos[e.files[t].id.toString()]=e.files[t]}},smap.inv.panel.photo.takePhotoDiv.appendChild(smap.inv.panel.photo.label_div),smap.inv.panel.photo.takePhotoDiv.appendChild(smap.inv.panel.photo.imageDiv),smap.inv.panel.photo.takePhotoDiv.appendChild(smap.inv.panel.photo.takePhotoButton),smap.inv.panel.photo.photo_control.appendChild(smap.inv.panel.photo.takePhotoDiv),smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild(smap.inv.panel.photo.photo_control)),"text"===a[i].type)o=a[i].visible?o+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a[i].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=lekplatsredskap_'+a[i].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2"></textarea></div></div> </div>':o+'<div style="display:none;" class="row"> <div class="col-xs-12 col-sm-6"><b>'+a[i].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=lekplatsredskap_'+a[i].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2"></textarea></div></div> </div>',smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(o)[0]);else if("select"===a[i].type){if(o="",a[i].selectSettings.length>0){o=a[i].visible?o+'<div class="row" ><div  class="col-xs-12 col-sm-6"><b>'+a[i].alias+'</b></div><div  class="col-xs-12 col-sm-6"><select style="margin-bottom: 10px;" id=lekplatsredskap_'+a[i].property+'  class="form-control">':o+'<div style="display:none;" class="row" ><div  class="col-xs-12 col-sm-6"><b>'+a[i].alias+'</b></div><div  class="col-xs-12 col-sm-6"><select style="margin-bottom: 10px;" id=lekplatsredskap_'+a[i].property+'  class="form-control">';for(var s=0;s<a[i].selectSettings.length;s++)o=o+'<option value="'+a[i].selectSettings[s].value+'">'+a[i].selectSettings[s].text+"</option>";o+="</select></div></div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(o)[0])}}else if("date"===a[i].type){var l=new Date,r=l.getDate(),p=l.getMonth()+1;10>r&&(r="0"+r),10>p&&(p="0"+p),year=l.getFullYear(),date=year+"-"+p+"-"+r,o=a[i].visible?o+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a[i].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=lekplatsredskap_'+a[i].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2" disabled>'+date+"</textarea></div></div> </div>":o+'<div style="display:none;" class="row"> <div class="col-xs-12 col-sm-6"><b>'+a[i].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=lekplatsredskap_'+a[i].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2" disabled>'+date+"</textarea></div></div> </div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(o)[0])}}},smap.inv.panel._bodyContentByBesiktningId=function(e){"undefined"!=typeof document.getElementById("bodyContentByBesiktning_Id_image")&&null!==document.getElementById("bodyContentByBesiktning_Id_image")&&document.getElementById("bodyContentByBesiktning_Id_image").parentNode.removeChild(document.getElementById("bodyContentByBesiktning_Id_image"));var t='<div id="bodyContentByBesiktning_Id_image">',n=e,a=smap.inv.panel.feature.options.editOptions.lekplatsredskap_lastBesiktning_url+n+smap.cmd._randomTextAndNumberParameter(),i=new smap.cmd._xhr_handler;if(i.open("GET",a,!1),i.send(null),4==i.readyState&&200==i.status)if(smap.inv.panel.lastBesiktning_row=JSON.parse(i.responseText),smap.inv.panel.lastBesiktning_row.besiktninglista)if(smap.inv.panel.lastBesiktning_row.besiktninglista.length>0){t=t+'<div class="row"><div class="col-xs-12 col-sm-12">'+smap.inv.panel.point_identification_content.replace("</br>"," ")+"</div></div>",t+="utfora"===besiktninglager.appName?'<div class="modal-body" id="" style="position: relative;"><div><div><div class="btn-group" data-toggle="buttons"><label style="margin-top:10px" class="btn btn-default" id="besiktning_image_show_lb_id"><input type="radio" name="besiktning_utfora" value="Portrait" id="besiktning_image_show_input_id">Bilder besiktning</label><label style="margin-top:10px" class="btn btn-default active" id="utfora_image_show_lb_id"><input type="radio" name="besiktning_utfora" value="Landscape" id="utfora_image_show_input_id" checked="">Bilder åtgärd</label></div></div></div></div>':'<div class="modal-body" id="" style="position: relative;"><div><div><div class="btn-group" data-toggle="buttons"><label style="margin-top:10px" class="btn btn-default active" id="besiktning_image_show_lb_id"><input type="radio" name="besiktning_utfora" value="Portrait" id="besiktning_image_show_input_id" checked="">Bilder besiktning</label><label style="margin-top:10px" class="btn btn-default" id="utfora_image_show_lb_id"><input type="radio" name="besiktning_utfora" value="Landscape" id="utfora_image_show_input_id">Bilder åtgärd</label></div></div></div></div>',smap.inv.panel.lastBesiktning_row=JSON.parse(i.responseText);var o="park_besikting_"+n,s=smap.inv.panel._getListOfSavedImagesByNyckelord_By_besiktning_id(o);if(null!==s&&s.length>0){t+='<div style="margin-bottom:10px;" id="myCarousel" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">';for(var l=0;l<s.length;l++)t=t+'<li data-target="#myCarousel" data-slide-to='+l.toString()+"></li>";t+="</ol>",t+='<div class="carousel-inner" role="listbox">';for(var l=0;l<s.length;l++)t=0===l?t+'<div class="item active"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>':t+'<div class="item"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>';t+="</div>",t+='<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="right carousel-control" href="#myCarousel" role="button" data-slide="next"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span class="sr-only">Next</span></a></div>'}var r="park_utfora_"+n,p=smap.inv.panel._getListOfSavedImagesByNyckelord_By_besiktning_id(r);if(null!==p&&p.length>0){t+='<div style="margin-bottom:10px;" id="myCarousel_utfora" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">';for(var l=0;l<p.length;l++)t=t+'<li data-target="#myCarousel_utfora" data-slide-to='+l.toString()+"></li>";t+="</ol>",t+='<div class="carousel-inner" role="listbox">';for(var l=0;l<p.length;l++)t=0===l?t+'<div class="item active"><img style="width:70%;margin:auto;" src='+p[l].img_lg+' alt="'+p[l].id+'"></div>':t+'<div class="item"><img style="width:70%;margin:auto;" src='+p[l].img_lg+' alt="'+p[l].id+'"></div>';t+="</div>",t+='<a class="left carousel-control" href="#myCarousel_utfora" role="button" data-slide="prev"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="right carousel-control" href="#myCarousel_utfora" role="button" data-slide="next"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></br>'}t+="</div></br>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(t)[0]),$("#besiktning_image_show_input_id").on("change",function(){document.getElementById("myCarousel")&&(document.getElementById("myCarousel").style.display="block"),document.getElementById("myCarousel_utfora")&&(document.getElementById("myCarousel_utfora").style.display="none")}),$("#utfora_image_show_input_id").on("change",function(){document.getElementById("myCarousel")&&(document.getElementById("myCarousel").style.display="none"),document.getElementById("myCarousel_utfora")&&(document.getElementById("myCarousel_utfora").style.display="block")}),"utfora"===besiktninglager.appName?$("#utfora_image_show_input_id").change():$("#besiktning_image_show_input_id").change(),"undefined"!=typeof document.getElementById("bodyContentByBesiktning_Id_attribute")&&null!==document.getElementById("bodyContentByBesiktning_Id_attribute")&&document.getElementById("bodyContentByBesiktning_Id_attribute").parentNode.removeChild(document.getElementById("bodyContentByBesiktning_Id_attribute")),"undefined"!=typeof document.getElementById("bodyContentByBesiktning_Id_attribute_editable")&&null!==document.getElementById("bodyContentByBesiktning_Id_attribute_editable")&&document.getElementById("bodyContentByBesiktning_Id_attribute_editable").parentNode.removeChild(document.getElementById("bodyContentByBesiktning_Id_attribute_editable"));var t='<div id="bodyContentByBesiktning_Id_attribute">';t=t+'<button id="show_image_site_id" class="btn btn-default btn-sm" onclick="window.open(&quot;'+smap.inv.panel.feature.options.editOptions._image_handeling_url+'&quot;, &quot;_blank&quot;)">Mer bild hantering</button> </br>';for(var d=0;d<smap.inv.panel.feature.options.editOptions.read.docs[0].editableProperties.length;d++){var c=smap.inv.panel.feature.options.editOptions.read.docs[0].editableProperties[d];

if(c.visible)for(key in smap.inv.panel.lastBesiktning_row.besiktninglista[0])key===c.property&&(t=t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+c.alias+':</b></div> <div  class="col-xs-12 col-sm-6">'+smap.inv.panel.lastBesiktning_row.besiktninglista[0][key]+"</div> </div>")}t+="</div>",t=t+"<div besiktning_id="+smap.inv.panel.lastBesiktning_row.besiktninglista[0].id+' style="display:none;" id="bodyContentByBesiktning_Id_attribute_editable">';for(var d=0;d<smap.inv.panel.feature.options.editOptions.update.docs[0].editableProperties.length;d++){0===d&&(smap.inv.panel.photo_edit_besiktning={},smap.inv.panel.photo_edit_besiktning.photo_control=document.createElement("div"),smap.inv.panel.photo_edit_besiktning.photo_control.className="form-group",smap.inv.panel.photo_edit_besiktning.takePhotoDiv=document.createElement("div"),smap.inv.panel.photo_edit_besiktning.label_div=document.createElement("div"),smap.inv.panel.photo_edit_besiktning.label_div.innerHTML="<b>Bilder</b>",smap.inv.panel.photo_edit_besiktning.imageDiv=document.createElement("div"),smap.inv.panel.photo_edit_besiktning.imageDiv.id="show_captured_photos_edit_besiktning",smap.inv.panel.photo_edit_besiktning.imageDiv.style.display="table-cell",smap.inv.panel.photo_edit_besiktning.takePhotoButton=document.createElement("input"),smap.inv.panel.photo_edit_besiktning.takePhotoButton.type="file",smap.inv.panel.photo_edit_besiktning.takePhotoButton.multiple=!0,smap.inv.panel.photo_edit_besiktning.takePhotoButton.style.marginBottom="10px",smap.inv.panel.photo_edit_besiktning.takePhotoButton.accept=decodeURIComponent("image%2F*%3Acapture%3Dcamera"),smap.inv.panel.photo_edit_besiktning.allTempPhotos={},smap.inv.panel.photo_edit_besiktning.takePhotoButton.onchange=function(){var e=this;if(e.files&&e.files[0])for(var t=0;t<e.files.length;t++){e.files[t].id=Math.random()*Math.pow(10,20);var n=new FileReader;n.id=e.files[t].id,n.onload=function(e){var t=document.createElement("div");t.style["float"]="left",t.style.height="111px";var n=document.createElement("img");n.style.padding="10px",n.src=e.target.result,n.width="102",n.height="102";var a=document.createElement("div");a.id=this.id,a.innerText="X",a.className="deleteButton",a.onclick=function(){this.parentNode.parentNode.removeChild(this.parentNode),delete smap.inv.panel.photo_edit_besiktning.allTempPhotos[this.id]},t.appendChild(n),t.appendChild(a),smap.inv.panel.photo_edit_besiktning.imageDiv.appendChild(t)},n.readAsDataURL(e.files[t]),smap.inv.panel.photo_edit_besiktning.allTempPhotos[e.files[t].id.toString()]=e.files[t]}},smap.inv.panel.photo_edit_besiktning.takePhotoDiv.appendChild(smap.inv.panel.photo_edit_besiktning.label_div),smap.inv.panel.photo_edit_besiktning.takePhotoDiv.appendChild(smap.inv.panel.photo_edit_besiktning.imageDiv),smap.inv.panel.photo_edit_besiktning.takePhotoDiv.appendChild(smap.inv.panel.photo_edit_besiktning.takePhotoButton),smap.inv.panel.photo_edit_besiktning.photo_control.appendChild(smap.inv.panel.photo_edit_besiktning.takePhotoDiv));var c=smap.inv.panel.feature.options.editOptions.update.docs[0].editableProperties[d];if(c.visible)for(key in smap.inv.panel.lastBesiktning_row.besiktninglista[0])if(key===c.property)if(t=t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+c.alias+":</b></div>","text"===c.type)t=t+'<div  class="col-xs-12 col-sm-6"><div class="form-group"> <textarea maxlength="256"  type="text" class="form-control" id=besiktning_edit_id_'+key+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2">'+smap.inv.panel.lastBesiktning_row.besiktninglista[0][key]+"</textarea></div></div>",t+="</div>";else if("select"===c.type&&c.selectSettings.length>0){t=t+'<div  class="col-xs-12 col-sm-6"><select style="margin-bottom: 10px;" id=besiktning_edit_id_'+key+'  class="form-control">';for(var m=0;m<c.selectSettings.length;m++)t=c.selectSettings[m].value===smap.inv.panel.lastBesiktning_row.besiktninglista[0][key]?t+'<option selected value="'+c.selectSettings[m].value+'">'+c.selectSettings[m].text+"</option>":t+'<option value="'+c.selectSettings[m].value+'">'+c.selectSettings[m].text+"</option>";t+="</select></div></div>"}}t+="</div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(t)[0]),smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(t)[1]),document.getElementById("bodyContentByBesiktning_Id_attribute_editable").insertBefore(smap.inv.panel.photo_edit_besiktning.photo_control,document.getElementById("bodyContentByBesiktning_Id_attribute_editable").firstChild)}else setTimeout(function(){smap.inv.panel._tabDivContent_div_btnDiv_label_b.click()},500),smap.cmd._showSplashMessage("Ingen gamla besiktning",2e3);else setTimeout(function(){smap.inv.panel._tabDivContent_div_btnDiv_label_b.click()},500),smap.cmd._showSplashMessage("Ingen gamla besiktning",2e3)},smap.inv.panel._bodyContentByPlatsId_forOverview=function(e){"undefined"!=typeof document.getElementById("_bodyContentByPlatsId_forOverview_image")&&null!==document.getElementById("_bodyContentByPlatsId_forOverview_image")&&document.getElementById("_bodyContentByPlatsId_forOverview_image").parentNode.removeChild(document.getElementById("_bodyContentByPlatsId_forOverview_image"));var t='<div id="_bodyContentByPlatsId_forOverview_image">',n=e,a=smap.inv.panel.feature.options.editOptions._getPlats_overview_text_url+n+smap.cmd._randomTextAndNumberParameter(),i=new smap.cmd._xhr_handler;if(i.open("GET",a,!1),i.send(null),4==i.readyState&&200==i.status){smap.inv.panel.platsText=JSON.parse(i.responseText);var o="park_plats_overview_"+n,s=smap.inv.panel._getListOfSavedImagesByNyckelord_By_besiktning_id(o);if(null!==s&&s.length>0){t+='<div style="margin-bottom:10px;" id="myCarousel" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">';for(var l=0;l<s.length;l++)t=t+'<li data-target="#myCarousel" data-slide-to='+l.toString()+"></li>";t+="</ol>",t+='<div class="carousel-inner" role="listbox">';for(var l=0;l<s.length;l++)t=0===l?t+'<div class="item active"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>':t+'<div class="item"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>';t+="</div>",t+='<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="right carousel-control" href="#myCarousel" role="button" data-slide="next"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></div></br>',smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(t)[0])}"undefined"!=typeof document.getElementById("_bodyContentByPlatsId_forOverview_attribute")&&null!==document.getElementById("_bodyContentByPlatsId_forOverview_attribute")&&document.getElementById("_bodyContentByPlatsId_forOverview_attribute").parentNode.removeChild(document.getElementById("_bodyContentByPlatsId_forOverview_attribute"));var t='<div id="_bodyContentByPlatsId_forOverview_attribute">';for(key in smap.inv.panel.platsText.besiktninglista[0])t=t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+key+':</b></div> <div  class="col-xs-12 col-sm-6">'+smap.inv.panel.platsText.besiktninglista[0][key]+"</div> </div>";t+="<div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(t)[0])}},smap.inv.panel._drawInvPropertyDiv_previousBesiktning=function(e){var t="";if("multiple"===smap.inv.panel.single_or_multiple_besiktning)if(smap.inv.panel.travellingSalesManIndex!=smap.inv.panel.ordered_lekplatsredskap.features.length&&smap.inv.panel.travellingSalesManIndex!=smap.inv.panel.ordered_lekplatsredskap.features.length+1&&-1!=smap.inv.panel.travellingSalesManIndex&&-2!=smap.inv.panel.travellingSalesManIndex){var n=smap.inv.panel.feature.properties.skotselobj_id;smap.inv.panel.allPreBesiktning_By_Skotselobj_id=[];var a=smap.inv.panel.feature.options.editOptions.lekplatsredskap_allBesiktning_Bysko_id_url+n+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),i=new smap.cmd._xhr_handler;if(i.open("GET",a,!1),i.send(null),4==i.readyState&&200==i.status){var o=JSON.parse(i.responseText);smap.inv.panel.allPreBesiktning_By_Skotselobj_id=o.besiktninglista}for(var s="",l=0,r=smap.inv.panel.allPreBesiktning_By_Skotselobj_id.length-1;r>-1;r--)s===smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum?l+=1:l=1,s=smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum,smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum_modified=smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum+" ("+l+")";t+='<div class="row" ><div  class="col-xs-12 col-sm-6"><b>Välj ett besiktningsdatum</b></div><div  class="col-xs-12 col-sm-6"><select style="margin-bottom: 10px;" id="allPreBesiktning_By_Skotselobj_id"  class="form-control">';for(var p=0;p<smap.inv.panel.allPreBesiktning_By_Skotselobj_id.length;p++)t=t+'<option value="'+smap.inv.panel.allPreBesiktning_By_Skotselobj_id[p].id+'">'+smap.inv.panel.allPreBesiktning_By_Skotselobj_id[p].datum_modified+"</option>";t+="</select></div></div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(t)[0]),smap.inv.panel._bodyContentByBesiktningId($("#allPreBesiktning_By_Skotselobj_id")[0].value),$("#allPreBesiktning_By_Skotselobj_id").on("change",function(){smap.inv.panel._bodyContentByBesiktningId(this.value)})}else smap.inv.panel._bodyContentByPlatsId_forOverview(smap.inv.panel.feature.properties.plats_id);else{var n=smap.inv.panel.feature.properties.skotselobj_id;smap.inv.panel.allPreBesiktning_By_Skotselobj_id=[];var a=smap.inv.panel.feature.options.editOptions.lekplatsredskap_allBesiktning_Bysko_id_url+n+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),i=new smap.cmd._xhr_handler;if(i.open("GET",a,!1),i.send(null),4==i.readyState&&200==i.status){var o=JSON.parse(i.responseText);smap.inv.panel.allPreBesiktning_By_Skotselobj_id=o.besiktninglista}for(var s="",l=0,r=smap.inv.panel.allPreBesiktning_By_Skotselobj_id.length-1;r>-1;r--)s===smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum?l+=1:l=1,s=smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum,smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum_modified=smap.inv.panel.allPreBesiktning_By_Skotselobj_id[r].datum+" ("+l+")";t+='<div class="row" ><div  class="col-xs-12 col-sm-6"><b>Välj ett besiktningsdatum</b></div><div  class="col-xs-12 col-sm-6"><select style="margin-bottom: 10px;" id="allPreBesiktning_By_Skotselobj_id"  class="form-control">';for(var p=0;p<smap.inv.panel.allPreBesiktning_By_Skotselobj_id.length;p++)t=t+'<option value="'+smap.inv.panel.allPreBesiktning_By_Skotselobj_id[p].id+'">'+smap.inv.panel.allPreBesiktning_By_Skotselobj_id[p].datum_modified+"</option>";t+="</select></div></div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(t)[0]),smap.inv.panel._bodyContentByBesiktningId($("#allPreBesiktning_By_Skotselobj_id")[0].value),$("#allPreBesiktning_By_Skotselobj_id").on("change",function(){smap.inv.panel._bodyContentByBesiktningId(this.value)})}},smap.inv.panel._drawInvLoginDiv=function(){smap.inv.panel._drawInvPanel_contentin_footer_div.style.display="block",smap.inv.panel.loginPanel=$('<div class="" data-example-id="simple-horizontal-form"><form class="form-horizontal"><div class="form-group"> <label for="inputEmail3" class="col-sm-2 control-label"><b>Användare</b></label> <div class="col-sm-10"> <input type="text" class="form-control" id="username_inv_login" placeholder="Användare" autocapitalize="off" autocorrection="off"> </div> </div><div class="form-group"> <label for="inputPassword3" class="col-sm-2 control-label"><b>Lösenord</b></label> <div class="col-sm-10"> <input type="password" class="form-control" id="password_inv_login" placeholder="Lösenord"> </div> </div></form> </div>'),smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild(smap.inv.panel.loginPanel[0])},smap.inv.panel._drawInvLogoutDiv=function(){smap.inv.panel._drawInvPanel_contentin_footer_div.style.display="block";var e="<div > <p> Du är inloggad som "+localStorage.getItem("username")+"</p></div>";smap.inv.panel.logoutPanel=$(e),smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild(smap.inv.panel.logoutPanel[0])},smap.inv.panel._drawInvPlatsDiv=function(){if("multiple"===smap.inv.panel.single_or_multiple_besiktning){if(smap.inv.panel._drawInvPanel_contentin_footer_div.style.display="block",smap.inv.panel.polygon_feature&&smap.inv.panel.polygon_feature.options.editOptions.mainAttribute&&smap.inv.panel.polygon_feature.properties[smap.inv.panel.polygon_feature.options.editOptions.mainAttribute]){var e='<div class="form-group" style="text-align: center;margin-bottom:20px;"> <div><b>Lägg en sista kommentar för </b><b style="color:red;">'+smap.inv.panel.polygon_feature.properties[smap.inv.panel.polygon_feature.options.editOptions.secondaryAttribute]+'</b><b> Plats ID: </b><b style="color:red;">'+smap.inv.panel.polygon_feature.properties[smap.inv.panel.polygon_feature.options.editOptions.mainAttribute]+"</b></div> </div>";smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(e)[0])}for(var t=smap.inv.panel.polygon_feature.options.editOptions.create.docs[0].editableProperties,n=0;n<t.length;n++){var a="";if(0===n&&(smap.inv.panel.photo_plats={},smap.inv.panel.photo_plats.photo_control=document.createElement("div"),smap.inv.panel.photo_plats.photo_control.className="form-group",smap.inv.panel.photo_plats.takePhotoDiv=document.createElement("div"),smap.inv.panel.photo_plats.label_div=document.createElement("div"),smap.inv.panel.photo_plats.label_div.innerHTML="<b>Bilder</b>",smap.inv.panel.photo_plats.imageDiv=document.createElement("div"),smap.inv.panel.photo_plats.imageDiv.id="show_captured_photos_plats",smap.inv.panel.photo_plats.imageDiv.style.display="table-cell",smap.inv.panel.photo_plats.takePhotoButton=document.createElement("input"),smap.inv.panel.photo_plats.takePhotoButton.type="file",smap.inv.panel.photo_plats.takePhotoButton.multiple=!0,smap.inv.panel.photo_plats.takePhotoButton.style.marginBottom="10px",smap.inv.panel.photo_plats.takePhotoButton.accept=decodeURIComponent("image%2F*%3Acapture%3Dcamera"),smap.inv.panel.photo_plats.allTempPhotos={},smap.inv.panel.photo_plats.takePhotoButton.onchange=function(){var e=this;if(e.files&&e.files[0])for(var t=0;t<e.files.length;t++){e.files[t].id=Math.random()*Math.pow(10,20);var n=new FileReader;n.id=e.files[t].id,n.onload=function(e){var t=document.createElement("div");t.style["float"]="left",t.style.height="111px";var n=document.createElement("img");n.style.padding="10px",n.src=e.target.result,n.width="102",n.height="102";var a=document.createElement("div");a.id=this.id,a.innerText="X",a.className="deleteButton",a.onclick=function(){this.parentNode.parentNode.removeChild(this.parentNode),delete smap.inv.panel.photo_plats.allTempPhotos[this.id]},t.appendChild(n),t.appendChild(a),smap.inv.panel.photo_plats.imageDiv.appendChild(t)},n.readAsDataURL(e.files[t]),smap.inv.panel.photo_plats.allTempPhotos[e.files[t].id.toString()]=e.files[t]}},smap.inv.panel.photo_plats.takePhotoDiv.appendChild(smap.inv.panel.photo_plats.label_div),smap.inv.panel.photo_plats.takePhotoDiv.appendChild(smap.inv.panel.photo_plats.imageDiv),smap.inv.panel.photo_plats.takePhotoDiv.appendChild(smap.inv.panel.photo_plats.takePhotoButton),smap.inv.panel.photo_plats.photo_control.appendChild(smap.inv.panel.photo_plats.takePhotoDiv),smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild(smap.inv.panel.photo_plats.photo_control)),"text"===t[n].type)a=t[n].visible?a+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+t[n].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=plats_'+t[n].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2"></textarea></div></div> </div>':a+'<div style="display:none;" class="row"> <div class="col-xs-12 col-sm-6"><b>'+t[n].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=plats_'+t[n].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2"></textarea></div></div> </div>',smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(a)[0]);else if("select"===t[n].type){if(a="",t[n].selectSettings.length>0){a=t[n].visible?a+'<div class="row" ><div  class="col-xs-12 col-sm-6"><b>'+t[n].alias+'</b></div><div  class="col-xs-12 col-sm-6"><select style="margin-bottom: 10px;" id=plats_'+t[n].property+'  class="form-control">':a+'<div style="display:none;" class="row" ><div  class="col-xs-12 col-sm-6"><b>'+t[n].alias+'</b></div><div  class="col-xs-12 col-sm-6"><select style="margin-bottom: 10px;" id=plats_'+t[n].property+'  class="form-control">';for(var i=0;i<t[n].selectSettings.length;i++)a=a+"<option value="+t[n].selectSettings[i].value+">"+t[n].selectSettings[i].text+"</option>";a+="</select></div></div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(a)[0])}}else if("div"===t[n].type)a="",a=t[n].visible?'<div style="margin-bottom:20px;" class="row"> <div class="col-xs-12 col-sm-6"><b>'+t[n].alias+':</b></div> <div class="col-xs-12 col-sm-6" id=plats_'+t[n].property+">"+smap.inv.panel.polygon_feature.properties[t[n].property]+"</div> </div>":'<div style="display:none;margin-bottom:20px;" class="row"> <div class="col-xs-12 col-sm-6"><b>'+t[n].alias+':</b></div> <div class="col-xs-12 col-sm-6" id=plats_'+t[n].property+">"+smap.inv.panel.polygon_feature.properties[t[n].property]+"</div> </div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(a)[0]);else if("date"===t[n].type){a="";var o=new Date,s=o.getDate(),l=o.getMonth()+1;10>s&&(s="0"+s),10>l&&(l="0"+l),year=o.getFullYear(),date=year+"-"+l+"-"+s,a=t[n].visible?a+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+t[n].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=plats_'+t[n].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2" disabled>'+date+"</textarea></div></div> </div>":a+'<div style="display:none;" class="row"> <div class="col-xs-12 col-sm-6"><b>'+t[n].alias+':</b></div> <div  class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256"  type="text" class="form-control" id=plats_'+t[n].property+' name="mapTitle" placeholder="Begränsa 256 teken" rows="2" disabled>'+date+"</textarea></div></div> </div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(a)[0])}}}},smap.inv.panel._getListOfSavedImagesByNyckelord_By_besiktning_id=function(e){var t=e,n=null,a=smap.inv.panel.feature.options.editOptions.ListOfSavedImagesByNyckelord_By_besiktning_id_url+t+smap.cmd._randomTextAndNumberParameter(),i=new smap.cmd._xhr_handler;i.open("GET",a,!1);try{i.send(null),4==i.readyState&&200==i.status&&i.responseText.length>0&&(n=JSON.parse(i.responseText))}catch(o){return n}return n},smap.inv.panel._drawInvSenastaBesiktningDiv=function(){var e="";if("multiple"===smap.inv.panel.single_or_multiple_besiktning)if(smap.inv.panel.travellingSalesManIndex!=smap.inv.panel.ordered_lekplatsredskap.features.length&&smap.inv.panel.travellingSalesManIndex!=smap.inv.panel.ordered_lekplatsredskap.features.length+1&&-1!=smap.inv.panel.travellingSalesManIndex&&-2!=smap.inv.panel.travellingSalesManIndex){var t=smap.inv.panel.feature.properties.besiktning_id,n=smap.inv.panel.feature.options.editOptions.lekplatsredskap_lastBesiktning_url+t+smap.cmd._randomTextAndNumberParameter(),a=new smap.cmd._xhr_handler;if(a.open("GET",n,!1),a.send(null),4==a.readyState&&200==a.status){var i=JSON.parse(a.responseText),o="park_besikting_"+t,s=smap.inv.panel._getListOfSavedImagesByNyckelord_By_besiktning_id(o);if(null!==s&&s.length>0){e='<div style="margin-bottom:10px;" id="myCarousel" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">';for(var l=0;l<s.length;l++)e=e+'<li data-target="#myCarousel" data-slide-to='+l.toString()+"></li>";e+="</ol>",e+='<div class="carousel-inner" role="listbox">';for(var l=0;l<s.length;l++)e=0===l?e+'<div class="item active"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>':e+'<div class="item"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>';e+="</div>",e+='<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="right carousel-control" href="#myCarousel" role="button" data-slide="next"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></br>',smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(e)[0])}for(var r=0;r<smap.inv.panel.feature.options.editOptions.read.docs[0].editableProperties.length;r++)if(smap.inv.panel.feature.options.editOptions.read.docs[0].editableProperties[r].visible){var p=smap.inv.panel.feature.options.editOptions.read.docs[0].editableProperties[r].property,d=smap.inv.panel.feature.options.editOptions.read.docs[0].editableProperties[r].alias;for(key in i.besiktninglista[0])if(key===p){var e="";e=e+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+d+':</b></div> <div  class="col-xs-12 col-sm-6">'+i.besiktninglista[0][key]+"</div> </div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(e)[0])}}}}else smap.inv.panel._bodyContentByPlatsId_forOverview(smap.inv.panel.feature.properties.plats_id);else{var t=smap.inv.panel.feature.properties.besiktning_id,n=smap.inv.panel.feature.options.editOptions.lekplatsredskap_lastBesiktning_url+t+smap.cmd._randomTextAndNumberParameter(),a=new smap.cmd._xhr_handler;if(a.open("GET",n,!1),a.send(null),4==a.readyState&&200==a.status){var i=JSON.parse(a.responseText),o="park_besikting_"+t,s=smap.inv.panel._getListOfSavedImagesByNyckelord_By_besiktning_id(o);if(null!==s&&s.length>0){e='<div style="margin-bottom:10px;" id="myCarousel" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">';for(var l=0;l<s.length;l++)e=e+'<li data-target="#myCarousel" data-slide-to='+l.toString()+"></li>";e+="</ol>",e+='<div class="carousel-inner" role="listbox">';for(var l=0;l<s.length;l++)e=0===l?e+'<div class="item active"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>':e+'<div class="item"><img style="width:70%;margin:auto;" src='+s[l].img_lg+' alt="'+s[l].id+'"></div>';e+="</div>",e+='<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="right carousel-control" href="#myCarousel" role="button" data-slide="next"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></br>',smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(e)[0])}for(key in i.besiktninglista[0]){var e="";e=e+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+key+':</b></div> <div  class="col-xs-12 col-sm-6">'+i.besiktninglista[0][key]+"</div> </div>",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.appendChild($(e)[0])}}}},smap.inv.panel._drawInvPropertyDiv_byTab=function(e){null!==e&&("park_besiktning_tab_input_id"===e||"besikting"===e?smap.inv.panel._drawInvPropertyDiv_besiktning(e):"park_previous_objects_input_id"===e?smap.inv.panel._drawInvPropertyDiv_previousBesiktning(e):"park_loggain_tab_input_id"===e?smap.inv.panel._drawInvLoginDiv(e):"park_loggaut_tab_input_id"===e?smap.inv.panel._drawInvLogoutDiv(e):"park_plats_tab_input_id"===e?smap.inv.panel._drawInvPlatsDiv(e):"park_senastb_tab_input_id"===e&&smap.inv.panel._drawInvSenastaBesiktningDiv(e))},smap.inv.panel._drawInvPropertyDiv=function(){this.id&&"park_besiktning_tab_input_id"===this.id&&(smap.inv.panel.is_next_previousbutton_click||smap.inv.panel.travellingSalesManIndex&&(smap.inv.panel.travellingSalesManIndex===smap.inv.panel.ordered_lekplatsredskap.features.length||smap.inv.panel.travellingSalesManIndex===smap.inv.panel.ordered_lekplatsredskap.features.length+1?(smap.inv.panel.travellingSalesManIndex=0,smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none"):(-1===smap.inv.panel.travellingSalesManIndex||-2===smap.inv.panel.travellingSalesManIndex)&&(smap.inv.panel.travellingSalesManIndex=smap.inv.panel.ordered_lekplatsredskap.features.length-1,smap.inv.panel._tabDivContent_div_btnDiv_label_pl.style.display="none"))),"undefined"!=typeof smap.inv.panel._drawInvPanel_contentin_body_property_container_div&&null!==smap.inv.panel._drawInvPanel_contentin_body_property_container_div&&smap.inv.panel._drawInvPanel_contentin_body_property_div.removeChild(smap.inv.panel._drawInvPanel_contentin_body_property_container_div),smap.inv.panel._drawInvPanel_contentin_body_property_container_div=document.createElement("div"),smap.inv.panel._drawInvPanel_contentin_body_property_container_div.className="modal-body",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.id="_drawInvPanel_contentin_body_property_container_div_id",smap.inv.panel._drawInvPanel_contentin_body_property_container_div.style.position="relative",smap.inv.panel._drawInvPanel_contentin_body_property_div.appendChild(smap.inv.panel._drawInvPanel_contentin_body_property_container_div);var e=null;e=this.id?this.id:"besikting",smap.inv.panel._drawInvPropertyDiv_byTab(e),smap.inv.panel._drawInvActionDiv(e),("park_besiktning_tab_input_id"===e||"besikting"===e)&&smap.inv.panel._drawGeometry()},smap.inv.panel._uploadLekplatsredskap_images=function(e){if(smap.inv.panel.photo.allTempPhotos)for(key in smap.inv.panel.photo.allTempPhotos){files=smap.inv.panel.photo.allTempPhotos[key];var t=new FormData,n=0;files instanceof File&&(files=[files]);for(var a=0;a<files.length;a++){var i=files[a];if(i.type.match("image.*")){var o=new FileReader;o.onload=function(a){var o=new Image;o.onload=function(a){function s(e,t,n,a){r("GET",e,t,n,a)}function l(e,t,n,a){r("POST",e,t,n,a)}function r(e,t,n,a,i){var o=new XMLHttpRequest;if("POST"===e)var s=smap.inv.panel.feature.options.editOptions._upload_images+smap.cmd._randomTextAndNumberParameter().replace("&","");else if("GET"===e)var s=smap.inv.panel.feature.options.editOptions._publish_images+t+smap.cmd._randomTextAndNumberParameter();o.open(e,s,!0),"POST"===e?(o.setRequestHeader("Session",localStorage.getItem("inv_session_id")+".session"),o.setRequestHeader("Authentication_required","true"),o.setRequestHeader("Authenticated_user",smap.inv.panel.feature.options.editOptions.user_email[localStorage.getItem("username")])):"GET"===e&&(o.setRequestHeader("Session",localStorage.getItem("inv_session_id")+".session"),o.setRequestHeader("Authentication_required","true")),o.responseType="json",null!==n&&o.send(n),o.onload=function(e){e=o,i(e)}}var p=document.createElement("canvas"),d=1250,c=o.width,m=o.height;c>m?c>d&&(m*=d/c,c=d):m>d&&(c*=d/m,m=d),p.width=c,p.height=m,p.getContext("2d").drawImage(o,0,0,c,m);var u=p.toDataURL("image/jpeg",.8),h=smap.cmd._dataURLToBlob(u);t.append("file",h,i.name),n||l("",t,"json",function(t){var n=smap.inv.panel.feature.properties;if(200===t.status){var a={user:smap.inv.panel.feature.options.editOptions.user_email[localStorage.getItem("username")],items:[{field:"rubrik",value:"Park"},{field:"kommentar",value:localStorage.getItem("username")},{field:"kategori",value:smap.inv.panel.feature.options.editOptions.image_catagory},{field:"nyckelord",value:"park_omr_"+n.omrade_id+",park_plats_"+n.plats_id+",park_redskap_"+n.skotselobj_id+",park_besikting_"+e}],publish_all:!1,objects:[t.response.id]};a=$.param(a),s("data="+a,{},"json",function(e){})}})},o.src=a.target.result},o.readAsDataURL(i)}else n=1}}},smap.inv.panel._saveLekplatsredskap=function(){var post_method=smap.inv.panel.feature.options.editOptions.post_method,post_params=[],base_url=smap.inv.panel.feature.options.editOptions.url,all_textarea=smap.inv.panel._drawInvPanel_contentin_body_property_container_div.getElementsByTagName("textarea"),all_select=smap.inv.panel._drawInvPanel_contentin_body_property_container_div.getElementsByTagName("select");if(all_textarea.length>0)for(var i=0;i<all_textarea.length;i++)if("textarea"===all_textarea[i].type){if("sign"===all_textarea[i].id.split("_")[1])var param=all_textarea[i].id.split("_")[1]+"="+localStorage.getItem("username");else var param=all_textarea[i].id.split("_")[1]+"="+encodeURIComponent(all_textarea[i].value);post_params.push(param)}if(all_select.length>0)for(var j=0;j<all_select.length;j++)if("select-one"==all_select[j].type){var param=all_select[j].id.split("_")[1]+"="+encodeURIComponent(all_select[j].value);post_params.push(param)}var lekplatsredskap_save_url=base_url+"?"+post_params.join("&")+"&session="+localStorage.getItem("inv_session_id")+".session&"+smap.inv.panel.feature.options.editOptions.mainAttribute+"="+smap.inv.panel.feature.id.split(".")[1]+smap.cmd._randomTextAndNumberParameter(),lekplatsredskap_save_xhr=new smap.cmd._xhr_handler;if(lekplatsredskap_save_xhr.open(post_method,lekplatsredskap_save_url,!1),lekplatsredskap_save_xhr.send(null),4==lekplatsredskap_save_xhr.readyState&&200==lekplatsredskap_save_xhr.status){var lekplatsredskap_save_xhrResponse=JSON.parse(lekplatsredskap_save_xhr.responseText);if("undefined"!=typeof lekplatsredskap_save_xhrResponse.save_status.match("lastid=")&&null!==lekplatsredskap_save_xhrResponse.save_status.match("lastid="))if(lekplatsredskap_save_xhrResponse.save_status.match("lastid=").indexOf("lastid=")>=0){var lastInserted_id=eval(lekplatsredskap_save_xhrResponse.save_status.split("lastid=")[1]);smap.inv.panel._uploadLekplatsredskap_images(lastInserted_id),"multiple"===smap.inv.panel.single_or_multiple_besiktning?(smap.cmd._showSplashMessage("Lekplatsredskap har sparat.",2e3),smap.inv.panel._resetBesiktningForm()):(smap.cmd._showSplashMessage("Lekplatsredskap har sparat.",2e3),smap.inv.panel._resetBesiktningForm()),smap.cmd.hideLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers)),smap.cmd.showLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers))}else smap.cmd._showSplashMessage("Lekplatsredskap har inte sparat and försöka igen.",4e3);else smap.cmd._showSplashMessage("Lekplatsredskap har inte sparat and försöka igen.",4e3)}},smap.inv.panel._drawInvActionDiv_besiktning=function(e){smap.inv.panel.invActionDiv=document.createElement("div"),smap.inv.panel.invActionDiv.className="row",smap.inv.panel.invActionButtonDiv=document.createElement("div"),smap.inv.panel.invActionButtonDiv.className="col-xs-12",smap.inv.panel.invActionButtonDiv.id="invSubmitDiv",smap.inv.panel.invActionButton=document.createElement("button"),smap.inv.panel.invActionButton.type="submit",smap.inv.panel.invActionButton.id="invLekplatsredskapSubmit_id",smap.inv.panel.invActionButton.disabled="",smap.inv.panel.invActionButton.setAttribute("data-loading-text","Sparar....."),smap.inv.panel.invActionButton.className="btn btn-primary btn-lg",smap.inv.panel.invActionButton.onclick=smap.inv.panel._saveLekplatsredskap,smap.inv.panel.invActionButton[getTextContent(smap.inv.panel.invActionButton)]="Spara",smap.inv.panel.invActionButtonDiv.appendChild(smap.inv.panel.invActionButton),smap.inv.panel.invActionDiv.appendChild(smap.inv.panel.invActionButtonDiv),smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.appendChild(smap.inv.panel.invActionDiv)},smap.inv.panel._uploadLekplatsredskap_images_when_infoUpdate=function(e){
if(smap.inv.panel.photo_edit_besiktning.allTempPhotos)for(key in smap.inv.panel.photo_edit_besiktning.allTempPhotos){files=smap.inv.panel.photo_edit_besiktning.allTempPhotos[key];var t=new FormData,n=0;files instanceof File&&(files=[files]);for(var a=0;a<files.length;a++){var i=files[a];if(i.type.match("image.*")){var o=new FileReader;o.onload=function(a){var o=new Image;o.onload=function(a){function s(e,t,n,a){r("GET",e,t,n,a)}function l(e,t,n,a){r("POST",e,t,n,a)}function r(e,t,n,a,i){var o=new XMLHttpRequest;if("POST"===e)var s=smap.inv.panel.feature.options.editOptions._upload_images+smap.cmd._randomTextAndNumberParameter().replace("&","");else if("GET"===e)var s=smap.inv.panel.feature.options.editOptions._publish_images+t+smap.cmd._randomTextAndNumberParameter();o.open(e,s,!0),"POST"===e?(o.setRequestHeader("Session",localStorage.getItem("inv_session_id")+".session"),o.setRequestHeader("Authentication_required","true"),o.setRequestHeader("Authenticated_user",smap.inv.panel.feature.options.editOptions.user_email[localStorage.getItem("username")])):"GET"===e&&(o.setRequestHeader("Session",localStorage.getItem("inv_session_id")+".session"),o.setRequestHeader("Authentication_required","true")),o.responseType="json",null!==n&&o.send(n),o.onload=function(e){e=o,i(e)}}var p=document.createElement("canvas"),d=1250,c=o.width,m=o.height;c>m?c>d&&(m*=d/c,c=d):m>d&&(c*=d/m,m=d),p.width=c,p.height=m,p.getContext("2d").drawImage(o,0,0,c,m);var u=p.toDataURL("image/jpeg",.8),h=smap.cmd._dataURLToBlob(u);t.append("file",h,i.name),n||l("",t,"json",function(t){var n=smap.inv.panel.feature.properties;if(200===t.status){if("utfora"===besiktninglager.appName)var a={user:smap.inv.panel.feature.options.editOptions.user_email[localStorage.getItem("username")],items:[{field:"rubrik",value:"Park"},{field:"kommentar",value:localStorage.getItem("username")},{field:"kategori",value:smap.inv.panel.feature.options.editOptions.image_catagory},{field:"nyckelord",value:"park_omr_"+n.omrade_id+",park_plats_"+n.plats_id+",park_redskap_"+n.skotselobj_id+",park_utfora_"+e}],publish_all:!1,objects:[t.response.id]};else var a={user:smap.inv.panel.feature.options.editOptions.user_email[localStorage.getItem("username")],items:[{field:"rubrik",value:"Park"},{field:"kommentar",value:localStorage.getItem("username")},{field:"kategori",value:smap.inv.panel.feature.options.editOptions.image_catagory},{field:"nyckelord",value:"park_omr_"+n.omrade_id+",park_plats_"+n.plats_id+",park_redskap_"+n.skotselobj_id+",park_besikting_"+e}],publish_all:!1,objects:[t.response.id]};a=$.param(a),s("data="+a,{},"json",function(e){})}})},o.src=a.target.result},o.readAsDataURL(i)}else n=1}}},smap.inv.panel._drawInvActionDiv_previousBesiktning=function(e){var t=function(){if("utfora"===besiktninglager.appName)var e=$('<div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button id="previous_utfora_action_edit_id" type="submit" class="btn btn-primary btn-lg">Åtgärda</button> </div> </div>');else var e=$('<div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button id="previous_besiktning_action_edit_id" type="submit" class="btn btn-primary btn-lg">Redigera</button> </div> </div>');if(smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.appendChild(e[0]),"utfora"===besiktninglager.appName)var t=$('<div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button style="display:none;" id="previous_utfora_action_cancel_id" type="submit" class="btn btn-primary btn-lg">Avbryt</button> <button style="display:none;" id="previous_utfora_action_save_id" type="submit" class="btn btn-primary btn-lg">Spara</button> </div> </div>');else var t=$('<div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button style="display:none;" id="previous_besiktning_action_cancel_id" type="submit" class="btn btn-primary btn-lg">Avbryt</button> <button style="display:none;" id="previous_besiktning_action_save_id" type="submit" class="btn btn-primary btn-lg">Spara</button> </div> </div>');smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.appendChild(t[0]),$("#previous_besiktning_action_edit_id").on("click",function(){$("#allPreBesiktning_By_Skotselobj_id")[0].parentNode.parentNode.style.display="none",$("#bodyContentByBesiktning_Id_attribute")[0].style.display="none",$("#bodyContentByBesiktning_Id_attribute_editable")[0].style.display="block",this.style.display="none",$("#previous_besiktning_action_save_id")[0].style.display="inline-block",$("#previous_besiktning_action_cancel_id")[0].style.display="inline-block"}),$("#previous_utfora_action_edit_id").on("click",function(){$.trim(smap.inv.panel.lastBesiktning_row.besiktninglista[0].utforarsign).length>0?smap.cmd._showSplashMessage("Kan inte åtgärda eftersom denna fel har redan åtgärdad",3e3):$.trim(smap.inv.panel.lastBesiktning_row.besiktninglista[0].bestallarsign).length>0?($("#allPreBesiktning_By_Skotselobj_id")[0].parentNode.parentNode.style.display="none",$("#bodyContentByBesiktning_Id_attribute")[0].style.display="none",$("#bodyContentByBesiktning_Id_attribute_editable")[0].style.display="block",this.style.display="none",$("#previous_utfora_action_save_id")[0].style.display="inline-block",$("#previous_utfora_action_cancel_id")[0].style.display="inline-block"):smap.cmd._showSplashMessage("Kan inte åtgärda eftersom denna fel är inte beställd",3e3)}),$("#previous_besiktning_action_save_id").on("click",function(){var e=smap.inv.panel.feature.options.editOptions.post_method,t=smap.inv.panel.feature.options.editOptions.redigera_besiktning_info,n=document.getElementById("besiktning_edit_id_bedomt").value,a=document.getElementById("besiktning_edit_id_fel").value,i=document.getElementById("besiktning_edit_id_fritext").value,o=document.getElementById("besiktning_edit_id_atgardsforslag").value,s=localStorage.getItem("username"),l=document.getElementById("bodyContentByBesiktning_Id_attribute_editable").getAttribute("besiktning_id"),r=t+"?bedomt="+n+"&fel="+a+"&fritext="+i+"&atgardsforslag="+o+"&anvandare="+s+"&id="+l+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),p=new smap.cmd._xhr_handler;if(p.open(e,r,!1),p.send(null),4==p.readyState&&200==p.status){var d=JSON.parse(p.responseText);"undefined"!=typeof d.save_status.match("Resource id #")&&null!==d.save_status.match("Resource id #")&&d.save_status.match("Resource id #").indexOf("Resource id #")>=0&&(smap.inv.panel._uploadLekplatsredskap_images_when_infoUpdate(l),smap.cmd._showSplashMessage("Lekplatsredskap har uppdaterat.",2e3),$("#allPreBesiktning_By_Skotselobj_id")[0].parentNode.parentNode.style.display="block",$("#bodyContentByBesiktning_Id_attribute")[0].style.display="block",$("#bodyContentByBesiktning_Id_attribute_editable")[0].style.display="none",this.style.display="none",$("#previous_besiktning_action_edit_id")[0].style.display="inline-block",$("#previous_besiktning_action_cancel_id")[0].style.display="none",$("#allPreBesiktning_By_Skotselobj_id").change(),smap.cmd.hideLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers)),smap.cmd.showLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers)))}}),$("#previous_besiktning_action_cancel_id").on("click",function(){$("#allPreBesiktning_By_Skotselobj_id")[0].parentNode.parentNode.style.display="block",$("#bodyContentByBesiktning_Id_attribute")[0].style.display="block",$("#bodyContentByBesiktning_Id_attribute_editable")[0].style.display="none",this.style.display="none",$("#previous_besiktning_action_save_id")[0].style.display="none",$("#previous_besiktning_action_edit_id")[0].style.display="inline-block",document.getElementById("besiktning_edit_id_bedomt").value=smap.inv.panel.lastBesiktning_row.besiktninglista[0].bedomt,document.getElementById("besiktning_edit_id_fel").value=smap.inv.panel.lastBesiktning_row.besiktninglista[0].fel,document.getElementById("besiktning_edit_id_fritext").value=smap.inv.panel.lastBesiktning_row.besiktninglista[0].fritext,document.getElementById("besiktning_edit_id_atgardsforslag").value=smap.inv.panel.lastBesiktning_row.besiktninglista[0].atgardsforslag}),$("#previous_utfora_action_save_id").on("click",function(){var e=smap.inv.panel.feature.options.editOptions.post_method,t=smap.inv.panel.feature.options.editOptions.atgard_plats,n=encodeURIComponent(document.getElementById("besiktning_edit_id_utforaranm").value),a=localStorage.getItem("username"),i=document.getElementById("bodyContentByBesiktning_Id_attribute_editable").getAttribute("besiktning_id"),o=new Date,s=o.getDate(),l=o.getMonth()+1;10>s&&(s="0"+s),10>l&&(l="0"+l),year=o.getFullYear();var r=year+"-"+l+"-"+s,p=t+"?&utforaranm="+n+"&utforarsign="+a+"&atgardsdatum="+r+"&id="+i+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),d=new smap.cmd._xhr_handler;if(d.open(e,p,!1),d.send(null),4==d.readyState&&200==d.status){var c=JSON.parse(d.responseText);"undefined"!=typeof c.save_status.match("Resource id #")&&null!==c.save_status.match("Resource id #")&&c.save_status.match("Resource id #").indexOf("Resource id #")>=0&&(c.update_count>0?(smap.inv.panel._uploadLekplatsredskap_images_when_infoUpdate(i),smap.cmd._showSplashMessage("Lekplatsredskap har Åtgärdad.",2e3),$("#allPreBesiktning_By_Skotselobj_id")[0].parentNode.parentNode.style.display="block",$("#bodyContentByBesiktning_Id_attribute")[0].style.display="block",$("#bodyContentByBesiktning_Id_attribute_editable")[0].style.display="none",this.style.display="none",$("#previous_utfora_action_edit_id")[0].style.display="inline-block",$("#previous_utfora_action_cancel_id")[0].style.display="none",$("#allPreBesiktning_By_Skotselobj_id").change(),smap.inv.panel.feature.options.layers&&smap.inv.panel.feature.options.layers.length>0&&smap.inv.panel.feature.options.layers.split(",").length>0&&(smap.inv.panel.feature.options.layers.split(",").length>1?(smap.cmd.hideLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers.split(",")[0])),smap.cmd.showLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers.split(",")[0]))):(smap.cmd.hideLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers)),smap.cmd.showLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers))))):(smap.cmd._showSplashMessage("Kan inte Åtgärda eftersom Lekplatsredskap har redan Åtgärdad.",2e3),$("#allPreBesiktning_By_Skotselobj_id")[0].parentNode.parentNode.style.display="block",$("#bodyContentByBesiktning_Id_attribute")[0].style.display="block",$("#bodyContentByBesiktning_Id_attribute_editable")[0].style.display="none",this.style.display="none",$("#previous_utfora_action_edit_id")[0].style.display="inline-block",$("#previous_utfora_action_cancel_id")[0].style.display="none",$("#allPreBesiktning_By_Skotselobj_id").change()))}}),$("#previous_utfora_action_cancel_id").on("click",function(){$("#allPreBesiktning_By_Skotselobj_id")[0].parentNode.parentNode.style.display="block",$("#bodyContentByBesiktning_Id_attribute")[0].style.display="block",$("#bodyContentByBesiktning_Id_attribute_editable")[0].style.display="none",this.style.display="none",$("#previous_utfora_action_save_id")[0].style.display="none",$("#previous_utfora_action_edit_id")[0].style.display="inline-block"})};"multiple"===smap.inv.panel.single_or_multiple_besiktning?smap.inv.panel.travellingSalesManIndex!=smap.inv.panel.ordered_lekplatsredskap.features.length&&smap.inv.panel.travellingSalesManIndex!=smap.inv.panel.ordered_lekplatsredskap.features.length+1&&-1!=smap.inv.panel.travellingSalesManIndex&&-2!=smap.inv.panel.travellingSalesManIndex&&t():t()},smap.inv.panel._drawInvActionDiv_login=function(){var e=$('<div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button id="inv_loggain_id" type="submit" class="btn btn-primary btn-lg">Logga in</button> </div> </div>');smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.appendChild(e[0]),$("#inv_loggain_id").on("click",function(){var e=smap.inv.panel.feature.options.editOptions.parklogin_url+$("#username_inv_login")[0].value+"&password="+$("#password_inv_login")[0].value+smap.cmd._randomTextAndNumberParameter(),t=new smap.cmd._xhr_handler;if(t.open("GET",e,!1),t.send(null),4==t.readyState&&200==t.status){var n=JSON.parse(t.responseText);if("success"===n.login_status){localStorage.removeItem("inv_session_id"),localStorage.removeItem("username"),localStorage.setItem("inv_session_id",n.session_id),localStorage.setItem("username",$("#username_inv_login")[0].value),smap.inv.panel._tabDivContent_div_btnDiv_label_u.style.display="block",smap.inv.panel._tabDivContent_div_btnDiv_label_u.click(),smap.inv.panel._tabDivContent_div_btnDiv_label_l.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_b.style.display="utfora"===besiktninglager.appName?"none":"block",smap.inv.panel._tabDivContent_div_btnDiv_label_t.style.display="block","utfora"===besiktninglager.appName?smap.inv.panel._tabDivContent_div_btnDiv_label_t.click():smap.inv.panel._tabDivContent_div_btnDiv_label_b.click(),smap.inv.panel.next_previous_button_show();var a="Välkommen du är inloggad som "+localStorage.getItem("username")+".";smap.cmd._showSplashMessage(a,3e3)}else alert(n.login_status)}})},smap.inv.panel._drawInvActionDiv_logout=function(){var e=$('<div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button id="inv_loggaut_id" type="submit" class="btn btn-primary btn-lg">Logga ut</button> </div> </div>');smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.appendChild(e[0]),$("#inv_loggaut_id").on("click",function(){var e=smap.inv.panel.feature.options.editOptions.remove_session_url+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),t=new smap.cmd._xhr_handler;if(t.open("GET",e,!1),t.send(null),4==t.readyState&&200==t.status){var n=JSON.parse(t.responseText);"yes"===n.session_status?(localStorage.removeItem("inv_session_id"),localStorage.removeItem("username"),smap.inv.panel._tabDivContent_div_btnDiv_label_l.style.display="block",smap.inv.panel._tabDivContent_div_btnDiv_label_l.click(),smap.inv.panel._tabDivContent_div_btnDiv_label_u.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_b.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_t.style.display="none",smap.inv.panel.next_previous_button_hide()):alert(loginResponse.session_status)}})},smap.inv.panel._uploadPlatsOverview_images=function(){if(smap.inv.panel.photo_plats.allTempPhotos)for(key in smap.inv.panel.photo_plats.allTempPhotos){files=smap.inv.panel.photo_plats.allTempPhotos[key];var e=new FormData,t=0;files instanceof File&&(files=[files]);for(var n=0;n<files.length;n++){var a=files[n];if(a.type.match("image.*")){var i=new FileReader;i.onload=function(n){var i=new Image;i.onload=function(n){function o(e,t,n,a){l("GET",e,t,n,a)}function s(e,t,n,a){l("POST",e,t,n,a)}function l(e,t,n,a,i){var o=new XMLHttpRequest;if("POST"===e)var s=smap.inv.panel.feature.options.editOptions._upload_images+smap.cmd._randomTextAndNumberParameter().replace("&","");else if("GET"===e)var s=smap.inv.panel.feature.options.editOptions._publish_images+t+smap.cmd._randomTextAndNumberParameter();o.open(e,s,!0),"POST"===e?(o.setRequestHeader("Session",localStorage.getItem("inv_session_id")+".session"),o.setRequestHeader("Authentication_required","true"),o.setRequestHeader("Authenticated_user",smap.inv.panel.feature.options.editOptions.user_email[localStorage.getItem("username")])):"GET"===e&&(o.setRequestHeader("Session",localStorage.getItem("inv_session_id")+".session"),o.setRequestHeader("Authentication_required","true")),o.responseType="json",null!==n&&o.send(n),o.onload=function(e){e=o,i(e)}}var r=document.createElement("canvas"),p=1250,d=i.width,c=i.height;d>c?d>p&&(c*=p/d,d=p):c>p&&(d*=p/c,c=p),r.width=d,r.height=c,r.getContext("2d").drawImage(i,0,0,d,c);var m=r.toDataURL("image/jpeg",.8),u=smap.cmd._dataURLToBlob(m);e.append("file",u,a.name),t||s("",e,"json",function(e){var t=smap.inv.panel.feature.properties;if(200===e.status){var n={user:smap.inv.panel.feature.options.editOptions.user_email[localStorage.getItem("username")],items:[{field:"rubrik",value:"Park"},{field:"kommentar",value:localStorage.getItem("username")},{field:"kategori",value:smap.inv.panel.feature.options.editOptions.image_catagory},{field:"nyckelord",value:"park_omr_"+t.omrade_id+",park_plats_"+t.plats_id+",park_plats_overview_"+t.plats_id}],publish_all:!1,objects:[e.response.id]};n=$.param(n),o("data="+n,{},"json",function(e){})}})},i.src=n.target.result},i.readAsDataURL(a)}else t=1}}},smap.inv.panel.sendmail=function(e,t,n,a){var i=encodeURIComponent(e),o=encodeURIComponent(t),s=encodeURIComponent(n),l=encodeURIComponent(a),r=smap.inv.panel.feature.options.editOptions.post_method,p=smap.inv.panel.feature.options.editOptions.sending_email.mail_service,d=p+"?&admin_adress="+o+"&receiver_address="+s+"&subject="+l+"&body="+i+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter();try{var c=new smap.cmd._xhr_handler;if(c.open(r,d,!1),c.send(null),4==c.readyState&&200==c.status){var m=JSON.parse(c.responseText);return"pass"===m.send_status?"true":"false"}}catch(u){return"false"}},smap.inv.panel._getOmradeTypeByPlats_id=function(e){var t=null;try{var n=smap.inv.panel.feature.options.editOptions._getOmradeTypeByPlats_id,a=n+"?plats_id="+e+smap.cmd._randomTextAndNumberParameter(),i=new smap.cmd._xhr_handler;if(i.open("GET",a,!1),i.send(null),4==i.readyState&&200==i.status){var o=JSON.parse(i.responseText);return t=o instanceof Object?o.omradestyp:null}}catch(s){return t=null}},smap.inv.panel._createBestallningDialog=function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=document.createElement("div"),a=e,i=t;n.id="bestallningDiv_Id",n.style.width=a+"px",n.style.height=i+"px",n.style.left=e/2-a/2+"px",n.style.top=t/2-i/2+"px",n.style.background="rgba(255,255,255,.95)",n.style.zIndex="10000",n.style.position="fixed",n.style.border="5px solid white",n.style.borderRadius="15px";var o=document.createElement("div");o.id="closeSpanBestallning_div_id",o.style.position="relative",o.style.paddingBottom="13px";var s=document.createElement("span");s.id="closeSpanBestallning_text_id",s.style.color="white",s[getTextContent(s)]=" X ",s.style.position="relative",s.style.borderRadius="20px",s.style.background="rgba(0, 0, 0,1)",s.style.fontSize="25px",s.style.top="10px",s.style.left=a/2-10+"px",s.onclick=function(){var e=document.getElementById("bestallningDiv_Id");e&&document.body.removeChild(e)},o.appendChild(s),n.appendChild(o);var l='<div class="modal-body" id="_bestallning_container_div_id" style="position: relative;"><div class="form-group" style="text-align: center;margin-bottom:20px;"><div>Beställning för plats :<b>'+smap.inv.panel.polygon_feature.properties.pl_namn+'</b></div></div><div class="row"><div class="col-xs-12 col-sm-6"><b>Beställare kommentar:</b></div><div class="col-xs-12 col-sm-6"><div class="form-group"><textarea maxlength="256" type="text" class="form-control" id="bestallare_kommentar_id" name="mapTitle" placeholder="Begränsa 256 teken" rows="2"></textarea></div></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button style="float:right;" id="inv_plats_bestalla_sendemail_action_id" type="submit" class="btn btn-primary btn-lg">Beställ och skicka E-post</button></div> </div></div>';n.appendChild($(l)[0]),document.body.appendChild(n),smap.map.on("resize onorientationchange",function(){var e=document.getElementById("bestallningDiv_Id");if(e){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e.style.width=t+"px",e.style.height=n+"px";var a=document.getElementById("closeSpanBestallning_text_id");a.style.left=t/2-10+"px"}}),$("#inv_plats_bestalla_sendemail_action_id").on("click",function(){var e=smap.inv.panel.feature.options.editOptions.post_method,t=smap.inv.panel.feature.options.editOptions.bestalla_plats,n=new Date,a=n.getDate(),i=n.getMonth()+1;10>a&&(a="0"+a),10>i&&(i="0"+i),year=n.getFullYear();var o=year+"-"+i+"-"+a,s=t+"?&fritext="+encodeURIComponent(document.getElementById("bestallare_kommentar_id").value)+"&plats_id="+smap.inv.panel.feature.properties.plats_id+"&bestallarsign="+encodeURIComponent(localStorage.getItem("username"))+"&bestallningsdatum="+o+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),l=new smap.cmd._xhr_handler;if(l.open(e,s,!1),l.send(null),4==l.readyState&&200==l.status){var r=JSON.parse(l.responseText);if("undefined"!=typeof r.save_status.match("Resource id #")&&null!==r.save_status.match("Resource id #")&&r.save_status.match("Resource id #").indexOf("Resource id #")>=0)if(smap.cmd.hideLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers)),smap.cmd.showLayer(smap.cmd.getLayer(smap.inv.panel.feature.options.layers)),r.update_count>0)if(smap.inv.panel.feature.options.editOptions.sending_email.enable){var p=smap.inv.panel.feature.options.editOptions.sending_email;if(p.utforare_site_address)var d=smap.cmd.createParams(p.utforare_site_address||!0).replace("v_lekplatsredskap","v_lekplatsredskap_utforare"),c="</br><b>Följ länken: </b><a  href="+d+' target="_blank">Länk</a>',m="<b>"+p.utforera_mail_body.split("____")[0]+' </b><b style="color:red;">'+smap.inv.panel.polygon_feature.properties.pl_namn+" </b><b>"+p.utforera_mail_body.split("____")[1]+"</b>"+c;else var m="<b>"+p.utforera_mail_body.split("____")[0]+' </b><b style="color:red;">'+smap.inv.panel.polygon_feature.properties.pl_namn+" </b><b>"+p.utforera_mail_body.split("____")[1]+"</b>";var u=p.mail_subject_for_utforera.split("____")[0]+" "+smap.inv.panel.polygon_feature.properties.pl_namn+" "+p.mail_subject_for_utforera.split("____")[1],h=smap.inv.panel._getOmradeTypeByPlats_id(smap.inv.panel.polygon_feature.properties.plats_id);"undefined"!=typeof h&&null!==h?(h=h[0].omradestyp,u=h+"mark-"+u):h=null;var _=smap.inv.panel.sendmail(m,p.admin_mail_address,p.utforera_mail_adress,u);if(document.getElementById("closeSpanBestallning_text_id").click(),"true"===_)smap.cmd._showSplashMessage("Plats har beställt nu och skickat e-post till utforera.",5e3);else{var v="Plats har beställt nu. Skicka e-post manuellt till: "+p.utforera_mail_adress.split(";").join(" ");smap.cmd._showSplashMessage(v,6e4)}}else document.getElementById("closeSpanBestallning_text_id").click(),smap.cmd._showSplashMessage("Plats har beställt nu men skickar inte e-post till utforare. Configuration sager skickar inte e-post.",5e3);else document.getElementById("closeSpanBestallning_text_id").click(),smap.cmd._showSplashMessage("Ingenting att beställa.",5e3)}})},smap.inv.panel._drawInvActionDiv_plats=function(){if("utfora"===besiktninglager.appName)var e=$('<div class="row"> <div class="col-xs-12 col-sm-10"> <button id="inv_plats_atgarda_action_id" type="submit" class="btn btn-primary btn-lg">Åtgärdad - skicka E-post</button></div>  <div class="col-xs-12 col-sm-2"> <button id="inv_plats_action_id" type="submit" class="btn btn-primary btn-lg">Spara</button> </div></div>');else var e=$('<div class="form-group"> <div class="col-xs-12 col-sm-10"> <button id="inv_plats_bestalla_action_id" type="submit" class="btn btn-primary btn-lg">Beställ och skicka E-post</button></div> <div class="col-xs-12 col-sm-2"> <button id="inv_plats_action_id" type="submit" class="btn btn-primary btn-lg">Spara</button> </div> </div>');smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.appendChild(e[0]),$("#inv_plats_action_id").on("click",function(){var e=smap.inv.panel.feature.options.editOptions.post_method,t=smap.inv.panel.feature.options.editOptions.plats_save_url,n=t+"?&fritext="+encodeURIComponent(document.getElementById("plats_fritext").value)+"&plats_id="+smap.inv.panel.feature.properties.plats_id+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),a=new smap.cmd._xhr_handler;if(a.open(e,n,!1),a.send(null),4==a.readyState&&200==a.status){var i=JSON.parse(a.responseText);"undefined"!=typeof i.save_status.match("Resource id #")&&null!==i.save_status.match("Resource id #")&&i.save_status.match("Resource id #").indexOf("Resource id #")>=0&&(smap.inv.panel._uploadPlatsOverview_images(),smap.cmd._showSplashMessage("Plats komment har sparat.",2e3),smap.inv.panel.closeButton.click())}}),$("#inv_plats_bestalla_action_id").on("click",function(){smap.inv.panel._createBestallningDialog(),$("#inv_plats_bestalla_sendemail_action_id")&&$("#inv_plats_bestalla_sendemail_action_id").click()}),$("#inv_plats_atgarda_action_id").on("click",function(){if(smap.inv.panel.feature.options.editOptions.sending_email.enable){var e={},t=smap.inv.panel.feature.options.editOptions.post_method,n=smap.inv.panel.feature.options.editOptions.atgardad_besiktning_sign_by_plats_id,a=n+"?plats_id="+smap.inv.panel.feature.properties.plats_id+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),i=new smap.cmd._xhr_handler;if(i.open(t,a,!1),i.send(null),4==i.readyState&&200==i.status){var o=JSON.parse(i.responseText);if(o.signlist&&o.signlist.length>0)for(var s=0;s<o.signlist.length;s++){var l=o.signlist[s].sign;if(e[l]){var r={};r.id=o.signlist[s].id,r.sign=o.signlist[s].sign,r.skotselobj_id=o.signlist[s].skotselobj_id,r.bedomt=o.signlist[s].bedomt,r.fel=o.signlist[s].fel,r.redskap=o.signlist[s].redskap,r.fabrikat=o.signlist[s].fabrikat,r.egentext=o.signlist[s].egentext,e[l].push(r)}else{e[l]=[];var r={};r.id=o.signlist[s].id,r.sign=o.signlist[s].sign,r.skotselobj_id=o.signlist[s].skotselobj_id,r.bedomt=o.signlist[s].bedomt,r.fel=o.signlist[s].fel,r.redskap=o.signlist[s].redskap,r.fabrikat=o.signlist[s].fabrikat,r.egentext=o.signlist[s].egentext,e[l].push(r)}}else{var p="Ingenting att skicka eller e-post har redan skickats.";smap.cmd._showSplashMessage(p,6e4)}}var d=0,c=0;for(sign in e)c+=1;for(sign in e){d+=1;for(var m=[],u=0;u<e[sign].length;u++)m.push(e[sign][u].id);var h=smap.inv.panel.feature.options.editOptions.sending_email;if(h.besiktning_site_address)var _=smap.cmd.createParams(h.besiktning_site_address||!0).replace("v_lekplatsredskap_utforare","v_lekplatsredskap"),v="<b>Följ länken: </b><a  href="+_+' target="_blank">Länk</a>',g='<b style="color:red;">'+smap.inv.panel.polygon_feature.properties.pl_namn+" </b><b>"+h.bestallare_mail_body+".</b></br>"+v;else var g='<b style="color:red;">'+smap.inv.panel.polygon_feature.properties.pl_namn+" </b><b>"+h.bestallare_mail_body+"</b></br>";var f=smap.inv.panel.polygon_feature.properties.pl_namn+" "+h.mail_subject_for_bestallare;h.bestallare_mail_adress=smap.inv.panel.feature.options.editOptions.user_email[sign];var b=smap.inv.panel.sendmail(g,h.admin_mail_address,h.bestallare_mail_adress,f);if("true"===b){if(m&&m.length>0){var t=smap.inv.panel.feature.options.editOptions.post_method,n=smap.inv.panel.feature.options.editOptions.sending_email.atgardad_epost_flag,y=localStorage.getItem("username"),k=n+"?id="+m.join(",")+"&anvandare="+y+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),w=new smap.cmd._xhr_handler;if(w.open(t,k,!1),w.send(null),4==w.readyState&&200==w.status){var C=JSON.parse(w.responseText);if("undefined"!=typeof C.save_status.match("Resource id #")&&null!==C.save_status.match("Resource id #"))if(C.save_status.match("Resource id #").indexOf("Resource id #")>=0);else{var p="E-post flag har inte sparat på databasen";smap.cmd._showSplashMessage(p,6e4)}else{var p="E-post flag har inte sparat på databasen";smap.cmd._showSplashMessage(p,6e4)}}}c===d&&(smap.cmd._showSplashMessage("Skickat e-post till beställare som platsen har åtgärdad",5e3),smap.inv.panel.closeButton.click())}else if(c===d){var p="Skicka e-post manuellt till: "+h.bestallare_mail_adress.split(";").join(" ");smap.cmd._showSplashMessage(p,6e4)}}}})},smap.inv.panel._drawInvActionDiv_byTab=function(e){null!==e&&("park_besiktning_tab_input_id"===e||"besikting"===e?smap.inv.panel._drawInvActionDiv_besiktning(e):"park_previous_objects_input_id"===e?smap.inv.panel._drawInvActionDiv_previousBesiktning(e):"park_loggain_tab_input_id"===e?smap.inv.panel._drawInvActionDiv_login(e):"park_loggaut_tab_input_id"===e?smap.inv.panel._drawInvActionDiv_logout(e):"park_plats_tab_input_id"===e&&smap.inv.panel._drawInvActionDiv_plats(e))},smap.inv.panel._drawInvActionDiv=function(e){"undefined"!=typeof smap.inv.panel._drawInvPanel_contentin_footer_div_action_div&&null!==smap.inv.panel._drawInvPanel_contentin_footer_div_action_div&&smap.inv.panel._drawInvPanel_contentin_footer_div.removeChild(smap.inv.panel._drawInvPanel_contentin_footer_div_action_div),smap.inv.panel._drawInvPanel_contentin_footer_div_action_div=document.createElement("div"),smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.className="modal-body",smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.id="_drawInvPanel_contentin_footer_div_action_div_id",smap.inv.panel._drawInvPanel_contentin_footer_div_action_div.style.position="relative",smap.inv.panel._drawInvPanel_contentin_footer_div.appendChild(smap.inv.panel._drawInvPanel_contentin_footer_div_action_div),smap.inv.panel._drawInvActionDiv_byTab(e)},smap.inv.panel.show=function(){smap.inv.panel._drawInvPanel_div.style.display="block",smap.inv.panel._drawInvPanel_contentin_body_div.style.display="block",smap.inv.panel._drawInvPanel_contentin_footer_div.style.display="block",smap.inv.panel.maximizeButton.style.display="none",smap.inv.panel.minimizeButton.style.display="block"},smap.inv.panel.hide=function(){smap.inv.panel._drawInvPanel_div.style.display="none"},smap.inv.panel.session_available=function(e){var t=smap.inv.panel.feature.options.editOptions.session_available_url+e+".session"+smap.cmd._randomTextAndNumberParameter(),n=new smap.cmd._xhr_handler;if(n.open("GET",t,!1),n.send(null),4==n.readyState&&200==n.status){var a=JSON.parse(n.responseText);return"yes"===a.session_status?!0:!1}},smap.inv.panel._drawInvPanelCreated?smap.inv.panel.show():smap.inv.panel._drawInvPanel(),smap.inv.panel._drawInvPanelCreated&&smap.inv.panel._drawInvPropertyDiv(),"undefined"!=typeof localStorage.getItem("inv_session_id")&&null!==localStorage.getItem("inv_session_id")&&localStorage.getItem("inv_session_id").length>0&&smap.inv.panel.session_available(localStorage.getItem("inv_session_id"))?(smap.inv.panel.is_next_previousbutton_click||("utfora"===besiktninglager.appName?smap.inv.panel._tabDivContent_div_btnDiv_label_t.click():smap.inv.panel._tabDivContent_div_btnDiv_label_b.click()),smap.inv.panel._tabDivContent_div_btnDiv_label_l.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_u.style.display="block",smap.inv.panel._tabDivContent_div_btnDiv_label_b.style.display="utfora"===besiktninglager.appName?"none":"block",smap.inv.panel._tabDivContent_div_btnDiv_label_t.style.display="block",smap.inv.panel.next_previous_button_show()):(smap.inv.panel._tabDivContent_div_btnDiv_label_l.click(),smap.inv.panel._tabDivContent_div_btnDiv_label_l.style.display="block",smap.inv.panel._tabDivContent_div_btnDiv_label_u.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_b.style.display="none",smap.inv.panel._tabDivContent_div_btnDiv_label_t.style.display="none",smap.inv.panel.next_previous_button_hide()),smap.inv._adjustResize_orientationChange=function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;if(smap.inv.panel._drawInvPanel_div.style.width=95*e/100+"px",95*e/100<smap.inv.panel.maxWidth)var n=e/2-95*e/100/2;else var n=e/2-smap.inv.panel.maxWidth/2;smap.inv.panel._drawInvPanel_div.style.right=n+"px",smap.inv.panel._drawInvPanel_div.style.maxHeight=t-50+"px";

},smap.map.on("resize onorientationchange",$.proxy(function(){smap.inv._adjustResize_orientationChange()},smap.inv))}},smap.core.mainConfig={mapConfig:{layers:[],crs:L.CRS.EPSG3857,attributionControl:!0,zoomControl:!1,maxZoom:12,disabledRightClick:!0},smapOptions:{title:"sMap-responsive",favIcon:"https://assets-cdn.github.com/favicon.ico",popupAutoPanPadding:[0,70],defaultLanguage:"sv"},toolbarPlugin:"Menu",defaultTheme:"smap",configFolders:["/rest/leaf/configs-1.0/"]};var utils={rmPx:function(e){return e&&e.replace?parseInt(e.replace(/px/gi,"").replace(/em/gi,"").replace(/pt/gi,"")):e},log:function(){window.console},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},addImageLoadIndicator:function(e,t){t=t||{};var n={height:"100px"};$.extend(n,t);var a=$('<div class="img-load-indicator"><i class="fa fa-spinner"></i></div>');a.css("height","100px"),e.before(a),e.addClass("hidden img-smooth-loading"),e.on("load",function(){var e=$(this);e.prev(".img-load-indicator").remove(),e.removeClass("hidden"),setTimeout(function(){e.addClass("img-fade-in"),window.loadedPopup_image_Height=e[0].height,window.loadedPopup_image_Width=e[0].width,"undefined"!=typeof smap.map._popup&&null!==smap.map._popup&&(smap.map._popup.update(),window.setTimeout(function(){var e=0,t=function(){var e=document.getElementById("smap-search-div");return e?e.getBoundingClientRect().bottom:0}(),n=function(){return toolbarDiv=document.getElementById("malmo-masthead"),toolbarDiv?toolbarDiv.getBoundingClientRect().bottom:0}(),a=0;a=t>0?t:n;var i=a;e=i>smap.map._popup._container.getBoundingClientRect().top?smap.map._popup._container.getBoundingClientRect().top-i-10:e,smap.map.panBy([0,e]),window.loadedPopup_image_Height=0,window.loadedPopup_image_Width=0},500))},200)}),1===e.length?e[0].naturalHeight>0&&e[0].naturalWidth>0?"":e.prev(".img-load-indicator").remove():""},textInsert:function(e,t){for(var n=0,a=t.length;a>n;n++)e=e.replace("%s",t[n]);return e},getBrowser:function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/),t=e?parseInt(e[1]):void 0;return{ie:e,ieVersion:t,ie8:8===t,ie9:9===t,ie10:10===t,ie11:11===t}},urlAppend:function(e,t,n){n=n||"?";var a="?"===n?/\?/g:/#/g,i=t.charAt(t.length-1);return"&"===i&&(e=i.substring(0,t.length-1)),-1===e.search(a)&&(e+=n),e+t},isInIframe:function(){return top.location!=self.location},makeUniqueArr:function(e){var t=[];return $.each(e,function(e,n){-1===$.inArray(n,t)&&t.push(n)}),t},objectToUpperCase:function(e){var t={};for(var n in e)t[n.toUpperCase()]=e[n];return t},drawDialog:function(e,t,n,a,i){a=a||{},a.size=a.size||"";var i=function(){return"undefined"!=typeof i&&null!==i?i:"ctrlNotDefined"}(),o="modalDialogCloseID_"+i,s="modalDialogMinimizeID_"+i,l=$('<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" id="'+o+'" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><button type="button" class="minimize" id="'+s+'" minimize_ctrl='+i+'  aria-hidden="true">-</button>'+(-1===e.search(/</g)?'<h4 class="modal-title">'+e+"</h4>":e)+'</div><div class="modal-body"></div></div>');if(l.find(".modal-body").append(t),n){var r=$('<div class="modal-footer"></div>');l.find(".modal-body").after(r),r.append(n)}var p=L.Browser.touch?"tap":"click";return l.find("#"+s).on(p,function(){"-"===this[window.getTextContent(this)]?(this[window.getTextContent(this)]="+",$(".modal-body").toggle(),$(".modal-footer").toggle(),"undefined"!=typeof this.getAttribute("minimize_ctrl")&&null!==this.getAttribute("minimize_ctrl")&&"LControlPrint"===this.getAttribute("minimize_ctrl")&&($(".modal").height($(".modal-dialog")[0].getBoundingClientRect().bottom),$(".modal-backdrop")[0].style.display="none")):"+"===this[window.getTextContent(this)]&&(this[window.getTextContent(this)]="-",$(".modal-body").toggle(),$(".modal-footer").toggle(),"undefined"!=typeof this.getAttribute("minimize_ctrl")&&null!==this.getAttribute("minimize_ctrl")&&"LControlPrint"===this.getAttribute("minimize_ctrl")&&($(".modal").height(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),$(".modal-backdrop")[0].style.display="block"))}),l.on("hide.bs.modal",function(){"+"===$(this).find(".minimize")[0][window.getTextContent($(this).find(".minimize")[0])]&&($(this).find(".minimize")[0][window.getTextContent($(this).find(".minimize")[0])]="-",$(".modal-body").toggle(),$(".modal-footer").toggle(),"undefined"!=typeof $(this).find(".minimize")[0].getAttribute("minimize_ctrl")&&null!==$(this).find(".minimize")[0].getAttribute("minimize_ctrl")&&"LControlPrint"===$(this).find(".minimize")[0].getAttribute("minimize_ctrl")&&($(".modal").height(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),$(".modal-backdrop")[0].style.display="block"))}),a.size&&l.find(".modal-dialog").addClass("modal-"+a.size),l},getLayerFromFeature:function(e,t){var n=t._layers;for(var a in n){var i=n[a];if(i.feature&&i.feature.id===e.id)return i}return null},round:function(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n},makeUnselectable:function(e){e.attr("unselectable","unselectable").addClass("unselectable")},extractToHtml:function(html,props){function getFunctionEnd(e){var t=1,n=!1,a=e.search(/\{/g);e=e.substring(a+1);var i=0;for(i=0,len=e.length;i<len;i++)if("{"===e.charAt(i)?t+=1:"}"===e.charAt(i)&&(t-=1),0===t){n=!0,i=i+a+2;break}return n||(i=-1),i}function extractAttribute(a,txt){var index=txt.search(/\${/g);if(-1!==index){var extractedAttribute="",attr=html.substring(index+2),endIndex=0;if(endIndex="function"===attr.substring(0,8)?getFunctionEnd(attr):attr.search(/\}/g),attr=attr.substring(0,endIndex),"function"===attr.substring(0,8)){var theFunc=attr.replace("function","function f");eval(theFunc),extractedAttribute=f.call(this,a)}else{var paramsArr=attr.split(",");if(paramsArr.length>1){var firstParam=$.trim(paramsArr[0]),secondParam=$.trim(paramsArr[1]);if(extractedAttribute=a[firstParam]||"",secondParam&&1===parseInt(secondParam))try{extractedAttribute=decodeURIComponent(extractedAttribute)}catch(e){}}else extractedAttribute=a[attr]||""}txt=txt.replace("${"+attr+"}",extractedAttribute)}return txt}if(!props)return"";if("undefined"==typeof html)return html=null;for(var index=html.search(/\${/g);-1!==index;)html=extractAttribute(props,html),index=html.search(/\${/g);return html},createLabel:function(e,t,n){n=n||"leaflet-maplabel";var a=L.marker(e,{icon:new L.DivIcon({iconSize:null,className:n,html:"<div>"+t+"</div>"})});return a.options._noprint=!0,a.options.clickable=!1,a.options.selectable=!1,a},getLength:function(e){var t,n=0;for(t=0,len=e.length-1;t<len;t++)n+=e[t].distanceTo(e[t+1]);return n},paramsStringToObject:function(e,t){t=t||!1;for(var n,a,i,o={},s=e.split(/[&;]/),l=0,r=s.length;r>l;l++)if(i=s[l].split("="),i[0]){n=i[0];try{n=decodeURIComponent(n)}catch(p){n=unescape(n)}a=(i[1]||"").replace(/\+/g," ");try{a=decodeURIComponent(a)}catch(p){a=unescape(a)}a=a.split(","),1==a.length&&(a=a[0]),t&&(n=n.toUpperCase()),o[n]=a}return o},projectPoint:function(e,t,n,a){return window.proj4(n,a,[e,t])},projectLatLng:function(e,t,n,a,i){var o=a?[e.lat,e.lng]:[e.lng,e.lat],s=window.proj4(t,n,o),l=i?L.latLng(s[0],s[1]):L.latLng(s[1],s[0]);return l},projectFeature:function(e,t,n){function a(e,t){return d(e[0],e[1],t,"EPSG:4326")}function i(e){return e=[e[1],e[0]]}n=n||{};var o,s,l,r,p,d=this.projectPoint;switch(p=e.geometry,p.type){case"Point":o=p.coordinates,n.reverseAxis&&(o=this.swapCoords(o)),l=a(o,t),p.coordinates=l;break;case"MultiPoint":for(r=0,m=p.coordinates.length;m>r;r++)o=p.coordinates[r],n.reverseAxis&&(o=this.swapCoords(o)),l=a(o,t),p.coordinates[r]=l;break;case"LineString":for(s=p.coordinates[0],r=0,lenP=s.length;r<lenP;r++)o=s[r],n.reverseAxis&&(o=this.swapCoords(o)),l=a(o,t),s[r]=l;break;case"MultiLineString":s=[];var c,m,u;for(r=0,m=p.coordinates.length;m>r;r++){for(s=p.coordinates[r],c=0,u=s.length;u>c;c++)o=s[c],n.reverseAxis&&(o=i(o)),l=a(o,t),s[c]=l;p.coordinates[r]=s}break;case"Polygon":for(s=p.coordinates[0],r=0,lenP=s.length;r<lenP;r++)o=s[r],n.reverseAxis&&(o=this.swapCoords(o)),l=a(o,t),s[r]=l;break;case"MultiPolygon":s=[];var c,h,m,u,_,v;for(r=0,m=p.coordinates.length;m>r;r++)for(s=p.coordinates[r],c=0,u=s.length;u>c;c++)for(v=s[c],h=0,_=v.length;_>h;h++)o=v[h],n.reverseAxis&&(o=i(o)),l=a(o,t),v[h]=l}}};L.Control.Editor=L.Control.extend({options:{position:"bottomright",useProxy:!1,reverseAxis:!1,encodeKeys:null,saveOnPressEnter:!1},_lang:{sv:{dTitle:"Objektets attribut",close:"Avbryt",save:"Spara",remove:"Ta bort",move:"Flytta",editProps:"Ändra",moveLP:"Ändra geometri",editPropsLP:"Ändra attribut",ruSureRemove:"Ta bort objektet? Åtgärden kan inte ångras.",saveNewMarker:"Spara",saveMove:"Spara",undo:"Ångra",cancel:"Avbryt"},en:{dTitle:"Object attributes",close:"Cancel",save:"Save",remove:"Remove",move:"Move",editProps:"Edit",moveLP:"Edit geometry",editPropsLP:"Edit attributes",doYouWantTo:"Do you want to",cannotBeUndoed:"Cannot be undoed",ruSureRemove:"Remove feature? Cannot be undoed.",saveNewMarker:"Save",saveMove:"Save",undo:"Undo",cancel:"Cancel"}},_geomTypes:{POINT:"marker",MULTIPOINT:"marker",LINESTRING:"polyline",MULTILINESTRING:"polyline",POLYGON:"polygon",MULTIPOLYGON:"polygon"},_geomType:"marker",_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode),this._inserts=[],this._updates=[],this._deletes=[]},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-editor"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawModal();var t=this;return smap.event.on("smap.core.pluginsadded",function(){t._setEditableLayer()}),this._container},onRemove:function(){},_addBtnAdd:function(){var e=this,t=$(".smap-editor-btnadd");if(!t.length){var t=$('<button class="btn btn-default btn-lg smap-editor-btnadd"><i class="glyphicon glyphicon-plus"></i></button>');$(".leaflet-top.leaflet-left").prepend(t),t.on("click touchend",function(){var t=e._getDrawToolbar();return $(this).toggleClass("btn-danger"),$(this).hasClass("btn-danger")?(t.handler.type&&"marker"===t.handler.type&&(e._onTouchHold=e._onTouchHold||function(n){var a=t.handler;e._tooltip=e._tooltip||{updatePosition:function(){}},a._onMouseMove({latlng:n.latlng}),a._onClick({latlng:n.latlng})},e.map.on("click",e._onTouchHold,e)),t.handler.enable()):(L.Browser.touch&&t.handler.type&&"marker"===t.handler.type&&(e.map.off("click",e._onTouchHold,e),$("#smap-editor-uglyhackconfirm").remove()),t.handler.disable()),!1})}},_setEditableLayer:function(){function e(){if($(this).parent().hasClass("list-group-item-danger"))s.stopEditing();else{var e=$(this).data("t")||{};e=$.extend(!0,{},e),"L.GeoJSON.WFS"===e.init&&s.startEditing(e,$(this).parent())}return!1}var t,n,a,i=smap.config.ol||[],o=smap.cmd.getControl("LayerSwitcher");if(!o)return!1;for(var s=this,l=0,r=i.length;r>l;l++)t=i[l],a=$('<i class="fa fa-edit smap-editor-switcher-icon"></i>'),t.options.isEditable&&(n=$("#"+o._makeId(t.options.layerId)),n.append(a),a.data("t",t),a.on("click",e))},_disabledRowClick:function(e){return e.stopPropagation(),e.preventDefault(),$(e.target).hasClass("smap-editor-switcher-icon")?$(".smap-editor-switcher-icon").trigger("click"):($(e.target).tooltip("show"),setTimeout(function(){$(e.target).tooltip("hide")},2e3)),!1},stopEditing:function(){if(this._editLayer){this._editLayer.options.editable=!1;var e=this._editLayer.options.layerId,t=e.substring(0,e.length-"-edit".length),n=smap.cmd.getLayer(t);n&&n.clearLayers&&n.clearLayers(),n&&n._refresh&&n._refresh({force:!0}),this.map.removeLayer(this._editLayer)}return $(".lswitch-panel-ol .list-group-item").off("click",this._disabledRowClick).removeClass("list-group-item-danger"),$(".lswitch-panel-ol .list-group-item").tooltip("destroy"),this.map.off("draw:created"),this.map.off("popupopen",this.__onPopupOpen),$(".smap-editor-btnadd").remove(),!0},_validateConfig:function(e){e=e||{};var t=e.options||{},n=[];for(var a in this._geomTypes)n.push(a);return t.geomType?-1===$.inArray(t.geomType.toUpperCase(),n)?!1:!0:!1},startEditing:function(e,t){function n(e){var t=e.layer.jsonData.features||[];if(t.length)a.options.geomType=a._geomType=a._geomTypes[e.layer.options.geomType.toUpperCase()],!a._geomType;else{var n=e.layer.options.geomType;n&&(a._geomType=a._geomTypes[n.toUpperCase()])}}var a=this,i=this.map;if(this.stopEditing()!==!0)return!1;if(this._addBtnAdd(),a._tooltip=a._tooltip||{updatePosition:function(){}},$(".lswitch-panel-ol .list-group-item.active").trigger("tap"),$(".lswitch-panel-ol .list-group-item-danger").removeClass("list-group-item-danger"),$(".lswitch-panel-ol .list-group-item").tooltip({title:"Redigering är aktiv. Deaktivera redigering för att tända lagret.",trigger:"manual",placement:"right",container:"#maindiv"}).on("click",this._disabledRowClick),t.addClass("list-group-item-danger"),this._validateConfig(e)===!1)return!1;var o=$.extend({},e.options),s=o.params.typeName;o.url=e.url,o.featureNS=s.split(":")[0],o.featureType=s.split(":")[1],o.layerId=o.layerId+"-edit";var l=o.geomType.toUpperCase(),r="POINT"===l?this.lang.move:this.lang.moveLP,p="POINT"===l?this.lang.editProps:this.lang.editPropsLP,d=this.lang.remove;o.popup='${*}<div class="popup-divider"></div><div style="white-space:nowrap;min-width:25em;" class="btn-group btn-group-sm editor-popup-edit"><button id="editor-popup-edit" type="button" class="btn btn-default">'+p+'</button><button id="editor-popup-move" type="button" class="btn btn-default">'+r+'</button><button id="editor-popup-remove" type="button" class="btn btn-default">'+d+"</button></div>",this._editLayer=L.wfst(e.url,o),this._editLayer.options.editing=this._editLayer.options.editing||{},this._editLayer.on("wfst:savesuccess",function(){smap.cmd.loading(!1)}),this._editLayer.on("wfst:saveerror",function(){smap.cmd.loading(!1)}),this._editLayer.on("wfst:ajaxerror",function(){smap.cmd.loading(!1)}),i.addLayer(this._editLayer),this._drawControl=new L.Control.Draw({edit:{featureGroup:this._editLayer}}),i.addControl(this._drawControl),$(".leaflet-draw").remove(),this._editLayer.on("load",n),i.on("draw:created",function(e){$(".smap-editor-btnadd").removeClass("btn-danger"),a._editLayer.addLayer(e.layer),a._marker=e.layer,a._showSaveToolbar("insert")}),this.__onPopupOpen=this.__onPopupOpen||$.proxy(this._onPopupOpen,this),this.map.on("popupopen",this.__onPopupOpen)},_getLayerById:function(e,t){function n(o){var s=o._layers||{};if(!s)return null;if(s.hasOwnProperty(t))return{marker:s[t],markerGeometry:s[t]};var l,r;for(r in s)if(0===i&&(a=r),i+=1,l=n(s[r]),i-=1,l)return{marker:e._layers[a],markerGeometry:l.marker};return null}var a,i=0;return n(e)},_onPopupOpen:function(e){var t=this;if(this._marker&&this._marker.dragging&&this._marker.dragging._draggable&&this._marker.dragging._draggable._enabled){if(this.map.closePopup(),confirm("Do you to stop editing this feature? Any changes made to the feature will be removed.")!==!0)return;this.cancelEdit()}var n=$(e.popup._container);if(e.popup._source.feature&&"polyline"!=this._geomType)this._marker=e.popup._source,this._markerGeometry=null;else{var a=this._getLayerById(this._editLayer,e.popup._source._leaflet_id);this._marker=a.marker,this._markerGeometry=e.popup._source}n.find("#editor-popup-remove").on("click",function(){return confirm(t.lang.ruSureRemove)===!0&&t._editLayer.wfstRemove(t._marker).done(function(){t._editLayer.clearLayers(),t._editLayer._refresh({force:!0})}),!1}),n.find("#editor-popup-move").on("click",function(){t.map.closePopup();var e=t._getEditToolbar();return e.handler._enableLayerEdit(t._markerGeometry||t._marker),t._showSaveToolbar("update"),t._editLayer.options.editable=!0,!1}),n.find("#editor-popup-edit").on("click",function(){return t._modalEdit.modal("show"),!1})},_getEditToolbar:function(){var e;for(var t in this._drawControl._toolbars)if(e=this._drawControl._toolbars[t],e&&e._modes&&e._modes.edit)return e._modes.edit;return null},_getDrawToolbar:function(){var e;for(var t in this._drawControl._toolbars)if(e=this._drawControl._toolbars[t],e&&e._modes&&e._modes[this._geomType])return e._modes[this._geomType];return null},wfstSave:function(e){e=e?L.Util.isArray(e)?e:[e]:[];var t,n,a=[],i=this._editLayer;for(n=0,len=e.length;n<len;n++)if("object"==typeof e[n]._layers)for(t in e[n]._layers)smap.cmd.loading(!0),a.push(i._wfstSave(e[n]._layers[t]));else a.push(i._wfstSave(e[n]));return $.when.apply($,a)},save:function(e){e=e||null;var t,n,a=this._inserts,i=this._updates,o=this._editLayer,s=a.length;for(t=0;s>t;t++)n=a[t],o._wfstAdd(n).done(function(){a.splice(n,1),e&&e()});for(s=i.length,t=0;s>t;t++)n=i[t],this.wfstSave(n).done(function(){i.splice(n,1)})},cancelEdit:function(){var e=this._getEditToolbar();e.handler._disableLayerEdit(this._markerGeometry||this._marker),this._editLayer.clearLayers(),this._editLayer._refresh({force:!0}),this._hideSaveToolbar()},_showSaveToolbar:function(e){if(this._editType=e,!this._saveToolbar){var t=this;this._saveToolbar=$('<div class="smap-editor-savetoolbar btn-group btn-group-lg" />');var n=$('<button class="btn btn-success">Save</button>'),a=$('<button class="btn btn-default">Cancel</button>');this._saveToolbar.append(a).append(n),$(".leaflet-top.leaflet-left").append(this._saveToolbar),n.on("click",function(){if(t._marker.options.geomType=t._editLayer.options.geomType.toUpperCase(),"update"===t._editType){var e=t._marker.options.geomType;"POINT"===e||"POLYGON"===e?t.wfstSave(t._marker):(t._markerGeometry.feature=$.extend({},t._marker.feature),t.wfstSave(t._markerGeometry))}var n=t._getEditToolbar();return n.handler._disableLayerEdit(t._markerGeometry||t._marker),"insert"===t._editType?(t._inserts.push(t._marker),t.save(function(){t._editLayer.clearLayers(),t._editLayer._refresh({force:!0}),t._hideSaveToolbar()})):"update"===t._editType&&(t.save(),t._hideSaveToolbar()),!1}),a.on("click",function(){return t.cancelEdit(),!1})}var i="insert"==this._editType?this.lang.saveNewMarker:this.lang.saveMove,o=this.lang.cancel;this._saveToolbar.find("button:eq(0)").text(o),this._saveToolbar.find("button:eq(1)").text(i),this._saveToolbar.show()},_hideSaveToolbar:function(){this._saveToolbar.hide()},_fillModal:function(e){if(e=e||null,null===e)return!1;var t,n,a,i,o=this._modalEdit.find("#smap-editor-content"),s=$('<form role="form" />'),l=this.options.encodeKeys||[];for(t in e)"fid"!==t&&"id"!==t&&"gid"!==t&&(n=e[t],n=n||"",("*"===l||$.inArray(t,l)>-1)&&(n=decodeURIComponent(n)),i="smap-editor-propentry-"+t,a='<div class="form-group">					<label for="'+i+'">'+t+'</label>					<textarea rows="1" resizable name="'+t+'" class="form-control" id="'+i+'">'+n+"</textarea>				</div>",s.append(a));s.find("textarea").on("change",function(){$(this).addClass("changed")}).on("focus",function(){$(this).prop("rows",5)}).on("blur",function(){$(this).prop("rows",1)}),o.append(s)},_onSaveAttributesSuccess:function(){this._marker.fire("click")},_saveAttributes:function(){var e=this._marker.feature.properties,t={},n=this._modalEdit.find("form").find("textarea.changed");if(!n.length)return this._modalEdit.modal("hide"),!1;var a,i,o=this.options.encodeKeys||[];n.each(function(){a=$(this).attr("name"),i=$(this).val(),("*"===o||$.inArray(a,o)>-1)&&(i=encodeURIComponent(i)),t[a]=i});var s=$.extend({},e,t);this._marker.feature.properties=s,this._marker.toGML||(this._markerGeometry.feature=$.extend({},this._marker.feature)),this.__onSaveAttributesSuccess=this.__onSaveAttributesSuccess||$.proxy(this._onSaveAttributesSuccess,this),this._editLayer.off("wfst:savesuccess",this.__onSaveAttributesSuccess).on("wfst:savesuccess",this.__onSaveAttributesSuccess),this._editLayer._wfstSave(this._markerGeometry||this._marker,{newProps:t}),this._modalEdit.modal("hide"),this.map.closePopup()},_drawModal:function(){var e=this,t=$('<div id="smap-editor-content" />'),n='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+'</button><button id="smap-editor-editmodal-btnsave" type="button" class="btn btn-primary">'+this.lang.save+"</button>";this._modalEdit=utils.drawDialog(this.lang.dTitle,t,n,{}),this._modalEdit.find("#smap-editor-editmodal-btnsave").on("click",function(){return e._saveAttributes(),!1}),this._modalEdit.on("shown.bs.modal",function(){var t=e._marker.feature.properties;e._fillModal(t),e.options.saveOnPressEnter&&e._modalEdit.on("keypress",function(t){13===t.which&&($("#smap-editor-editmodal-btnsave").focus(),e._saveAttributes(),e._modalEdit.modal("hide"),t.preventDefault())})}),e._modalEdit.on("hidden.bs.modal",function(){t.empty(),e._modalEdit.off("keypress")})}}),L.Control.FullScreen=L.Control.extend({options:{position:"topright",url_root:location.origin+location.pathname+"?",mode:"full"},_properties:function(){var e=this,t=this.lang;switch(this.options.mode){case"replace":return{expand:"fa fa-expand",compress:"fa fa-compress",expTitle:t.viewLarge,compTitle:t.back,action:function(){window.parent.location.href=smap.cmd.createParams(e.options.url_root)}};case"newTab":return{expand:"fa fa-external-link",compress:"fa fa-compress",expTitle:t.newTab,compTitle:t.back,action:function(){window.open(smap.cmd.createParams(e.options.url_root))}};case"full":return{expand:"fa fa-expand",compress:"fa fa-compress",expTitle:t.fullExp,compTitle:t.reset,action:function(){var e=document.getElementById("body");screenfull.enabled&&screenfull.toggle(e)}}}},_lang:{sv:{viewLarge:"Visa större karta",newTab:"Öppna kartan i ny flik",fullExp:"Visa kartan i fullskärm",reset:"Återställ",back:"Tillbaka",notAllowed:"Helskärmsläge stöds eller tillåts inte av din webläsare. Funktionen kommer inte vara tillgänglig"},en:{viewLarge:"Show larger map",newTab:"Open map in new tab",fullExp:"Show in fullscreen",reset:"Reset",back:"Go back",notAllowed:"Fullscreen mode not supported/allowed by your browser. Feature will not be available."}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e;var t=this;return this._container=L.DomUtil.create("div","leaflet-control-fullScreen"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),"full"===this.options.mode?this._enableIframeFullscreen()&&screenfull.enabled&&(this._createBtn(),document.addEventListener(screenfull.raw.fullscreenchange,function(){t._updateButton()})):this._createBtn(),this._container},activate:function(){this._properties().action()},_enableIframeFullscreen:function(){if(self===top)return!0;try{var e=window.parent.document.getElementsByTagName("iframe")[0];return e.setAttribute("allowfullscreen",""),!0}catch(t){return!1}},_updateButton:function(){var e=$("#smap-fullscreen-btn"),t=this._properties();screenfull.isFullscreen?(e.find("span").removeClass(t.expand).addClass(t.compress),e.attr("data-original-title",t.compTitle)):(e.find("span").removeClass(t.compress).addClass(t.expand),e.attr("data-original-title",t.expTitle)),e.blur()},onRemove:function(){},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-fullscreen-btn" title="'+e._properties().expTitle+'" class="btn btn-default"><span class="'+e._properties().expand+'"></span></button>'),this.$btn.on("click",function(){return e.activate(),!1}),this.$container.append(this.$btn)}}),L.control.fullScreen=function(e){return new L.Control.FullScreen(e)},L.Control.GuideIntroScreen=L.Control.extend({options:{autoActivate:!0,position:"bottomright",prefix:"",bgSrc:null,langs:{sv:"Svenska",en:"English"},words:{sv:{btnStartTour:"Starta turen"},en:{btnStartTour:"Start the tour"}},header:{sv:{title:"Promenadstaden",subHeaders:["Malmö museer, Science Center"]},en:{title:"The walking city",subHeaders:["Malmö museums, Science Center"]}},configs:[{configName:"guide-industri.js",disabledText:!1,sv:{title:"Industristaden",description:"Industrispåret guidar dig genom de gamla industrierna i Malmös innerstad."},en:{title:"The industrial city",description:"This tour guides you to some old industrial buildings of Malmö"}},{configName:"guide-vh.js",disabledText:!1,sv:{title:"Västra hamnen",description:"Västra hamnen guidar dig genom Malmös modernaste och fräsigaste stadsdel."},en:{title:"Western harbor",description:"This tour guides you through the most modern part of Malmö."}}]},initialize:function(e){L.setOptions(this,e)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-guideintroscreen"),L.DomEvent.disableClickPropagation(this._container);var t=this._makeContent("sv"),n=$('<div class="guide-introscreen" />');return n.append(t),this.options.euLogoSrc&&n.append('<img class="gintro-eulogo" src="'+this.options.euLogoSrc+'"></img>'),this.options.bgSrc&&n.prepend('<img class="gintro-bg gintro-bg-left" src="'+this.options.bgSrc+'"></img><img class="gintro-bg gintro-bg-right" src="'+this.options.bgSrc+'"></img>'),this.$container=n,this._container},onRemove:function(){this.deactivate(),this.$container.remove()},activate:function(){$("#maindiv").append(this.$container),$("#mapdiv").hide()},deactivate:function(){this.$container.detach(),$("#mapdiv").show()},_makeContent:function(e){for(var t=$('<div class="guide-content container" />'),n=this.options.words[e],a=this,i=function(){smap.cmd.loading(!0);var e=$(this).data("configName");return smap.map.removeControl(a),smap.cmd.reloadCore({params:{CONFIG:e}}),!1},o=this.options.header[e],s="",l=0,r=o.subHeaders.length;r>l;l++)s+='<p class="lead">'+o.subHeaders[l]+"</p>";var p=$('<div class="container" id="gintro-logo-container"></div>');this.options.munLogoSrc&&p.append('<img class="gintro-munlogo" src="'+this.options.munLogoSrc+'"></img>');var d,c='<div class="container"><h1 style="margin-bottom:20px;">'+o.title+"</h1>"+s+"</div>",m="btn-danger",u=this.options.langs,h="",_=$('<div style="margin-top:30px;" class="btn-group" />');for(var v in u)h=u[v],d=$('<button type="button" class="guideintro-btn-option btn btn-default">'+h+"</button>"),v===e&&d.addClass(m),d.data("langCode",v),_.append(d);t.append(c),p.children().length&&t.append(p),t.append(_);var g,f,b,y,k=this.options.configs,w=$('<div class="row" />');t.append(w);for(var l=0,r=k.length;r>l;l++){if(g=k[l],y=g.configName,f=g[e],b=$('<div class="gintro-box col-xs-6 col-md-4 col-lg-3 text-left"><h3>'+f.title+'</h3><div style="margin-bottom:20px;"><p class="lead text-muted">'+f.description+'</p><button class="btn btn-default btn-sm gintro-btn-configoption">'+n.btnStartTour+"</button></div></div>"),g.disabledText){var C=$('<div class="gintro-disbox"><label>'+g.disabledText+"</label></div>");b.find("div").append(C),b.find("button").addClass("disabled"),b.addClass("disabled")}b.addClass("col-xs-offset-3 col-md-offset-1 col-lg-offset-1");var A=b.find("button");A.data("configName",y),w.append(b)}return t.find(".guideintro-btn-option").on("click",function(){var t=$(this).data("langCode");if(e!==t){$(this).addClass(m).siblings().removeClass(m).addClass("btn-default");var n=a._makeContent(t).children();$(".guide-content").empty().append(n)}return!1}),t.find(".gintro-btn-configoption").on("click",i),t}}),L.control.guideIntroScreen=function(e){return new L.Control.GuideIntroScreen(e)},L.Control.Geolocate=L.Control.extend({options:{position:"bottomright",locateOptions:{maxZoom:17,enableHighAccuracy:!0}},_lang:{sv:{errorGeolocate:"Kunde inte hitta din position. Position / gps är inte aktiverad",notSupported:"Din webbläsare stödjer inte geolokalisering"},en:{errorGeolocate:"The browser could not detect your position",notSupported:"Your browser does not support geolocation"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Geolocate"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawButton(),this._container},onRemove:function(){},_drawButton:function(){var e=$('<button id="smap-glocate-btn" class="btn btn-default"><span class="fa fa-location-arrow"></span></button>');this.$container.append(e),this.btn=e,e.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this))},activate:function(){return this.active?!1:navigator.geolocation?(this.active=!0,this.btn.addClass("btn-primary"),smap.cmd.loading(!0),this.__onLocationFound=this.__onLocationFound||$.proxy(this._onLocationFound,this),this.__onLocationError=this.__onLocationError||$.proxy(this._onLocationError,this),this.__onDragStart=this.__onDragStart||$.proxy(this._onDragStart,this),this.map.on("locationfound",this.__onLocationFound),this.map.on("locationerror",this.__onLocationError),this.map.on("dragstart",this.__onDragStart),this.map.on("zoomstart",this.__onDragStart),void this._startLocate(this.options.locateOptions)):(smap.cmd.notify(this.lang.notSupported,"error"),!1)},deactivate:function(){return this.active?(this.active=!1,smap.cmd.loading(!1),this.btn.removeClass("btn-primary"),this.map.off("locationfound",this.__onLocationFound),this.map.off("locationerror",this.__onLocationError),this.map.off("dragstart",this.__onDragStart),this.map.off("zoomstart",this.__onDragStart),this._stopLocate(),void(this.marker&&(this.map.removeLayer(this.marker),this.marker=null))):!1},_startLocate:function(e){e=e||{};var t={watch:!0,setView:!0,enableHighAccuracy:!1};e=$.extend(t,e),this.map.locate(e)},_stopLocate:function(){this.map.stopLocate()},_onLocationFound:function(e){smap.cmd.loading(!1),this.marker=this.marker||L.userMarker(e.latlng,{pulsing:!0}).addTo(this.map),this.marker.setLatLng(e.latlng),this.marker.setAccuracy(e.accuracy)},_onLocationError:function(e){smap.cmd.loading(!1);var t=smap.cmd.notify(this.lang.errorGeolocate+": "+e.message,"error",{parent:$("body")});t.on("touchstart",function(){$("body").find(".alert").remove()}),this.deactivate()},_onDragStart:function(){this._stopLocate(),this._startLocate({setView:!1})}}),L.control.geolocate=function(e){return new L.Control.Geolocate(e)},L.Control.GuidePopup=L.Control.extend({options:{},initialize:function(e){L.setOptions(this,e),this._setLang()},_lang:{sv:{introHeader:"Info",mediaHeader:"Media",accessHeader:"Tillgänglighet",close:"Stäng",showMore:"Visa mer",clickToSee:"Klicka för mer info",loadingPic:"Hämtar bild",tipClickForFullScreen:"Klicka för fullskärmsbild"},en:{introHeader:"About",mediaHeader:"Media",accessHeader:"Accessibility",close:"Close",showMore:"Read more",loadingPic:"Loading photo",clickToSee:"Click for more info",picFullScreenTitle:"Slideshow",tipClickForFullScreen:"Click for full-screen photo"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-guidepopup"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.__onPopupClick=this.__onPopupClick||$.proxy(this._onPopupClick,this);var t=this;return t._activate(),this._container},onRemove:function(){this._deactivate(),windowWidth<950?this.hideTheTag():this.showTheTag()},_onPopupClick:function(e){var t=$("#gp-btn-show").data("props"),n=this._getFeatureData(t[this.options.attrId]),a=n.tabMedia,i=n.tabIntro;if(i)this.createPopup(t);else if(a&&a instanceof Object){var o,s=this._makeMediaContent(a.mediaType,utils.extractToHtml(a.sources,t).split(","));"image"!==n.mediaType&&(o=utils.extractToHtml(n.fullScreenIntroPic,t)),this.showFullScreen(s,utils.extractToHtml(a.label,t),o)}return($(e.target).hasClass("gp-mediaicons")||$(e.target).parent().hasClass("gp-mediaicons"))&&$('[href="#gp-moreinfo"]').click(),!1},_onPopupOpen:function(e){
if(e.popup._source&&e.popup._source.feature){var t=(e.popup._source.feature.layerId,e.popup._source.feature.properties);e.popup.options.autoPanPaddingTopLeft=[0,60],$(".leaflet-popup-content").find(".gp-mediaicons").on("touchstart click",this.__onPopupClick);var n=this._getFeatureData(t[this.options.attrId]);if(n&&n instanceof Object){var a=$('<button style="margin-top:10px;" id="gp-btn-show" class="btn btn-default">'+this.lang.showMore+"</button>");$(".leaflet-popup-content").append(a),a.data("props",t),a.on("touchstart click",this.__onPopupClick),$(".leaflet-popup-content img").on("touchstart click",this.__onPopupClick).css("cursor","pointer").tooltip({title:this.lang.clickToSee})}}},_onPopupClose:function(e){$(e.popup._wrapper).off("touchstart",this.onPopupClick)},_activate:function(){for(var e,t=this,n={audio:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/120-headphones.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})},video:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/46-movie-2.png",iconSize:[20,25],iconAnchor:[10,12],popupAnchor:[0,-9]})},image:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/121-landscape.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})}},n={audio:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/120-headphones.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})},video:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/46-movie-2.png",iconSize:[20,25],iconAnchor:[10,12],popupAnchor:[0,-9]})},image:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/121-landscape.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})}},a=smap.config.ol||[],i=0,o=a.length;o>i;i++)e=a[i].options,e.params&&e.params.q&&(e.pointToLayer=function(e,a){var i=e.properties||{},o=t.options.modalContentOverrides[i[t.options.attrId]]||{};return o.tabMedia,o.iconType&&n[o.iconType]?L.marker(a,n[o.iconType]):L.marker(a)});this.map.on("popupopen",this._onPopupOpen,this),this.map.on("popupclose",this._onPopupClose,this)},_deactivate:function(){this.map.off("popupopen",this.__onPopupOpen),this.map.off("popupclose",this.__onPopupClose)},_makeCarousel:function(e){e=e||[];for(var t,n=$('<div id="guide-carousel" class="carousel slide">'),a=$('<ol class="carousel-indicators" />'),i=$('<div class="carousel-inner" />'),o=$('<a class="left carousel-control" href="#guide-carousel" data-slide="prev"><span class="icon-prev"></span></a><a class="right carousel-control" href="#guide-carousel" data-slide="next"><span class="icon-next"></span></a>'),s=0,l=e.length;l>s;s++)t=e[s],a.append('<li data-target="#guide-carousel" data-slide-to="'+s+'"></li>'),i.append('<div class="item"><img src="'+t+'"></img></div>');return i.find(".item:first").add(a.find("li:first")).addClass("active"),n.append(i),e.length>1&&(n.prepend(a),n.append(o),n.swiperight(function(){$(this).carousel("prev")}).swipeleft(function(){$(this).carousel("next")})),$(document).on("orientationchange",function(){var e=window.innerHeight;$(".gp-fullscreen").height(e)}),n},_makeAudioTag:function(e){e=e||[];for(var t,n,a,i,o=$('<audio controls="controls" />'),s=0,l=e.length;l>s;s++){switch(t=e[s],n=t.substring(t.length-3).toUpperCase()){case"OGG":a="audio/ogg";break;case"MP3":a="audio/mpeg"}i='<source src="'+t+'" type="'+a+'" />',o.append(i)}return o},_makeVideoTag:function(e){e=e||[];var t=$(window).width()-2,n=$(window).height()-65;if(n>t){var a=t;t=n,n=a}n/=2,t/=2;var i,o=e[0];return o.search(/youtu.be|youtube/i)>-1?i=$('<iframe src="'+o+'?rel=0" width="100%" height="80%" frameborder="0" allowfullscreen></iframe>'):o.search(/vimeo.com/i)&&(i=$('<iframe src="'+o+'" width="100%" height="80%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')),i},_makeAccessContent:function(e){var t=this._getFeatureData(e[this.options.attrId]);return utils.extractToHtml(t.tabAccess,e)},_makeMediaList:function(e,t){if(e=e||[],!e.length)return null;var n,a,i,o={image:"fa fa-picture-o fa-lg",audio:"fa fa-volume-up fa-lg",video:"fa fa-film fa-lg"},s=$('<div id="gp-listmoreinfo" class="list-group" />');for(a=0,len=e.length;a<len;a++)n=e[a],(!n.condition||n.condition&&n.condition(t)===!0)&&(i=$('<a href="#" class="list-group-item"><span class="'+o[n.mediaType]+'"></span>&nbsp;&nbsp;&nbsp;'+utils.extractToHtml(n.label,t)+"</a>"),i.data("mediaType",a),s.append(i));return s.children().length?s:null},showFullScreen:function(e,t,n){function a(e){27===e.which&&i()}function i(){return $("body").off("keydown",a),$(".gp-fullscreen").removeClass("gp-fs-visible"),$(".gp-fullscreen").find("audio").each(function(){this.pause&&this.pause()}),setTimeout(function(){$(".gp-fullscreen").empty().remove()},500),!1}var o=$('<div class="gp-fullscreen"></div>');$("body").on("keydown",a);var s=$('<button type="button" class="btn btn-default">Stäng</button>');s.on("click",function(){return i(),!1});var l="<h1>"+t+"</h1>";if(o.append(l),n){var r=$('<img class="gp-mediapic" src="'+n+'" />');o.append(r)}o.append(e),o.append(s),s.css("z-index",3e3),$("body").append(o),setTimeout(function(){o.addClass("gp-fs-visible")},50)},_makeMediaContent:function(e,t){switch(e.toLowerCase()){case"image":content=this._makeCarousel(t);break;case"audio":content=this._makeAudioTag(t);break;case"video":content=this._makeVideoTag(t)}return content},_getFeatureData:function(e){var t=this.options.modalContentOverrides[e]||{};return $.extend(!0,{},this.options.modalContent||{},t)},createPopup:function(e){function t(){var t,a=$(this).data("mediaType"),o=i.tabMedia[a],s=utils.extractToHtml(o.sources,e),l=n._makeMediaContent(o.mediaType,s.split(","));return"audio"===o.mediaType&&(t=utils.extractToHtml(i.fullScreenIntroPic,e)),n.showFullScreen(l,$(this).text(),t),!1}e=e||{};var n=this,a='<ul class="nav nav-tabs"><li class="active"><a href="#gp-intro" data-toggle="tab">'+this.lang.introHeader+'</a></li><li><a href="#gp-moreinfo" data-toggle="tab">'+this.lang.mediaHeader+'</a></li><li><a href="#gp-access" data-toggle="tab">'+this.lang.accessHeader+'</a></li></ul><div class="tab-content gp-popup"><div class="tab-pane active" id="gp-intro"></div><div class="tab-pane" id="gp-moreinfo"></div><div class="tab-pane" id="gp-access"></div></div>';a=$(a);var i=this._getFeatureData(e[this.options.attrId]),o=this._makeMediaList(i.tabMedia,e);o?a.find("#gp-moreinfo").append(o):a.find('[href="#gp-moreinfo"], #gp-moreinfo').remove();var s=this._makeAccessContent(e);s?a.find("#gp-access").append(s):a.find('[href="#gp-access"], #gp-access').remove();var l=utils.extractToHtml(i.dialogTitle||e[this.options.dialogTitle],e),r='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";if(this.dialog=utils.drawDialog(l,a,r),this.dialog.on("hidden.bs.modal",function(){$(this).empty().remove(),n.dialog=null,delete n.dialog}),this.dialog.attr("id","gp-popup"),this.dialog.find("#gp-listmoreinfo").find(".list-group-item").on("tap click",t),$("body").append(this.dialog),this.dialog.modal(),i.tabIntro){var p=utils.extractToHtml(i.tabIntro,e);if("HTTP"===p.substring(0,4).toUpperCase())this._getData(p,function(){$("#gp-intro").append(utils.extractToHtml($(this).html(),e)),smap.cmd.loading(!1)});else{var d=$("<div />").append(p);d.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"150px"})}),d.find("img").on("click tap",function(){var e=n._makeCarousel([$(this).prop("src")]);n.showFullScreen(e,l)}).prop("title",this.lang.tipClickForFullScreen).tooltip(),$("#gp-intro").append(d)}}},_getData:function(e,t){var n=$("<div />");smap.cmd.loading(!0),e=this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(e):e,n.load(e,t)}}),L.control.guidePopup=function(e){return new L.Control.GuidePopup(e)},L.Control.Helper=L.Control.extend({options:{autoActivate:!1,position:"topright",steps:[{title:"Welcome to Malmö Stadsatlas!",description:'<p>Would you like to take a little tour?</p><div class="smap-helper-button-group smap-helper-tour-or-not" style="text-align: left; font-size:1.5em;"><div class="smap-helper-button"><i class="fa fa-close"></i><span> No</span></div><div class="smap-helper-button" style="margin-left: 10px;"><span>Yes </span><i class="fa fa-check"></i></div></div>',noNav:!0,func:function(){var e=this._$stepContainer.find(".smap-helper-tour-or-not"),t=e.find(".smap-helper-button:eq(0)"),n=e.find(".smap-helper-button:eq(1)"),a=this;t.on("click",function(){return a.deactivate(),!1}),n.on("click",function(){return a.goToNextStep(),!1}),e.addClass("smap-helper-fadein")}},{title:"Toggle button",description:"To hide the switcher you can press this button.",breakPoint:991,bbox:{selector:".lswitch-btnhide",mobileSelector:!1},css:{side:"right"}},{title:"Layer switcher",description:"The layer switcher is not visible from start on mobile devices. Try making the window smaller and notice that the switcher hides. You can then show it by clicking the expand button in the lower left section of the map.",breakPoint:991,bbox:{selector:".lswitch-panel .panel",mobileSelector:"#lswitch-btn"},css:{side:"right",mobileSide:"bottom"},func:function(){}},{title:"Search functionality",description:"The search functionality is vast. You can search for Malmö addresses or a place like Turning Torso, or Zlatans home.",bbox:{selector:"#smap-search-div"},css:{side:"bottom"}},{title:"Tools",description:"These are the basic tools for map navigation",bbox:{selector:".leaflet-bottom.leaflet-right"},css:{side:"top"}},{title:"Masthead",description:"Left",bbox:{selector:"#malmo-masthead"},css:{side:"bottom"}},{title:"Search again",description:"The search functionality is vast. You can search for Malmö addresses or a place like Turning Torso, or Zlatans home.",bbox:{selector:"#smap-search-div"},css:{side:"bottom"}},{title:"That's it",description:'<p>If you have questions, please contact stadsatlas@malmo.se</p><div id="smap-helper-done" class="smap-helper-button" style="font-size:1.5em;"><span>Done </span><i class="fa fa-check"></i></div>',noNav:!0,func:function(){var e=this;$("#smap-helper-done").on("click",function(){return e.deactivate(),!1})}}]},_lang:{sv:{btnLabel:"Hjälp"},en:{btnLabel:"Help"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-helper"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn();var t=this;return this._refresh=function(){setTimeout(function(){t.refresh()},500)},this._container},onRemove:function(){},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-helper-btn" title="'+e.lang.btnLabel+'" class="btn btn-default"><span class="fa fa-question"></span></button>'),this.$btn.on("touchend click",function(){return e.activate(),!1}),this.$container.append(this.$btn)},activate:function(){return this._active&&this._active===!0?this.deactivate():(this._active=!0,this._nbr=0,this._prevNbr=0,this._drawBasic(),this._bindEvents(),this.goToStep(1),$(this._bgCanvas).addClass("smap-helper-fadein"),void $(window).on("resize",this._refresh))},deactivate:function(){if(this._active===!1)return!1;this._active=!1;var e=this;this._$btnClose.remove(),this._$btnClose=null,this._$clickTip.popover("destroy"),this._$clickTip.empty().remove(),this._$clickTip=null,e._$stepContainer.empty().remove(),e._$stepContainer=null,$(this._bgCanvas).removeClass("smap-helper-fadein"),setTimeout(function(){$(e._bgCanvas).remove(),e._bgCanvas=null},300),$(window).off("resize",this._refresh),this._unbindEvents()},_unbindEvents:function(){$("body").off("keydown",this.onKeyDown)},_bindEvents:function(){var e=this;this._$clickTip.find(".smap-helper-button").on("tap click",function(){var t=$(this).index();switch(t){case 0:e.goToPrevStep();break;case 1:e.goToNextStep()}return!1}),this.onKeyDown=function(t){switch(t.which){case 27:e.deactivate();break;case 37:e.goToPrevStep();break;case 38:e.goToPrevStep();break;case 39:e.goToNextStep();break;case 40:e.goToNextStep()}return!1},$("body").on("keydown",this.onKeyDown)},_drawBasic:function(){if(this._$stepContainer)return!1;var e=this;this._$btnClose=$('<div class="smap-helper-btnclose"><i class="fa fa-close"></i></div>'),$("#maindiv").append(this._$btnClose),this._$btnClose.on("tap click",function(){return e.deactivate(),!1}),this._$stepContainer=$('<div class="smap-helper-stepcont"><div class="smap-helper-steptitle"><span>The title</span></div><div class="smap-helper-stepdescription">The description</div></div>'),this._$clickTip=$('<div class="smap-helper-button-group smap-helper-clicktip"><div class="smap-helper-button smap-helper-button-icon-effect"><i class="fa fa-chevron-left"></i><span> Back</span></div><div class="smap-helper-button smap-helper-button-icon-effect"><span>Next </span><i class="fa fa-chevron-right"></i></div></div>'),$("#mapdiv").append(this._$clickTip);var t='<canvas class="smap-helper-bgcanvas" />';$("#mapdiv").append(this._$stepContainer),$("body").append(t),this._bgCanvas=$(".smap-helper-bgcanvas")[0]},_drawCanvasHole:function(e){var t=this._bgCanvas,n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);var a=$(window).width(),i=$(window).height();if(e){var o=[];if(e instanceof Array)o=e;else if(e.selector){var s=15,l=e.selector,r=$(l),p=r.offset(),d=0,c=0,m=0,u=0;o.push(p.left+d-s-m),o.push(p.top+c-s-u),o.push(p.left+r.width()+d+s-m),o.push(p.top+r.height()+c+s-m)}var h=o[0],_=o[1],v=o[2],g=o[3]}t.width=a,t.height=i,n.moveTo(0,0),n.lineTo(a,0),n.lineTo(a,i),n.lineTo(0,i),n.lineTo(0,0),n.closePath(),e&&(n.moveTo(h,_),n.lineTo(h,g),n.lineTo(v,g),n.lineTo(v,_),n.lineTo(h,_),n.closePath()),n.fillStyle="rgba(0,0,0,0.5)",n.shadowColor="rgba(0,0,0,1)",n.shadowBlur=20,n.fill()},refresh:function(){this.goToStep(this._nbr)},goToStep:function(e){var t=this;if(0>=e)return!1;if(this._prevNbr=this._nbr,this._nbr=e,this._$clickTip.removeClass("smap-helper-fadein"),e>this.options.steps.length)return this.deactivate();var n=this.options.steps[e-1],a=this._$stepContainer.find(".smap-helper-steptitle"),i=this._$stepContainer.find(".smap-helper-stepdescription");a.find("span").empty().html(n.title),i.empty().html(n.description);var o;if(n.bbox&&n.bbox.selector){if(o=n.bbox.selector,n.breakPoint&&$(window).width()<=n.breakPoint&&(o=n.bbox.mobileSelector),o===!1)return this._prevNbr<this._nbr?this.goToNextStep():this.goToPrevStep();this._$stepContainer.css(n.css.standard?n.css.standard:n.css),n.css.side&&$(document).ready(function(){var e,t,a=n.css.side;n.bbox.breakPoint&&n.css.mobileSide&&$(window).width()<=n.bbox.breakPoint&&(a=n.css.mobileSide),"top"===a?(e="bottom",t=a+"-20px"):"bottom"===a?(e="top",t=a+"+20px"):"left"===a?(e="right",t=a+"-20px"):"right"===a&&(e="left",t=a+"+20px"),$(".smap-helper-stepcont").position({my:e,at:t,of:o,collision:"fit flip"})})}else $(".smap-helper-stepcont").position({my:"center",at:"center",of:"#mapdiv",collision:"fit flip"});n.css&&n.css.standard&&this._$stepContainer.css(n.css.standard),this._drawCanvasHole({selector:o}),this._showHelperTimeout&&clearTimeout(this._showHelperTimeout),n.noNav||($(".smap-helper-clicktip").popover("destroy"),this._$clickTip.show(),this._nbr>=this.options.steps.length?this._$clickTip.find(".smap-helper-button:eq(1)").hide():this._$clickTip.find(".smap-helper-button").show(),this._showHelperTimeout=setTimeout(function(){t._$clickTip.addClass("smap-helper-fadein"),L.Browser.touch||t._helperPopoverShownOnce||(t._helperPopoverShownOnce=!0,$(".smap-helper-clicktip").popover({content:'Tip! Use your keyboards\' arrow keys to navigate through the help section <i class="fa fa-caret-square-o-left"><i class="fa fa-caret-square-o-up"></i><i class="fa fa-caret-square-o-right"><i class="fa fa-caret-square-o-down"></i>',html:!0,placement:"top",trigger:"manual",container:".maindiv"}).popover("show"),$(".smap-helper-clicktip").data("bs.popover").$tip.addClass("smap-helper-popover"))},950)),n.func&&n.func.call(this)},goToPrevStep:function(){this.goToStep(this._nbr-1)},goToNextStep:function(){this.goToStep(this._nbr+1)}}),L.Control.Info=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",logo:"",_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Om kartan",close:"Stäng"},en:{btntitle:"About Map",close:"Close"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-info"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._container},onRemove:function(){},activate:function(){var e=this,t='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>",n='<div><div class="row"><div class="col-xs-12"><div style="clear:both"><a id="omkartalogo" href="http://www.kristianstad.se/"target="_blank" style="position:relative;display:block;height:62px"></a></div></div></div>'+this.lang.bodyContent+'</div><script>document.getElementById("omkartalogo").innerHTML = \''+this.options.logo+"'</script>";e._$dialog||(e._$dialog=utils.drawDialog(e.lang.titleInfo,n,t)),e._$dialog.modal("show")},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-info",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-info-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="fa fa-info"></span></button>');t.on("click",function(){return e.activate(),!1}),this.$container.append(t)}}}),L.control.info=function(e){return new L.Control.Info(e)},L.Control.LayerSwitcher=L.Control.extend({options:{pxDesktop:992,toggleSubLayersOnClick:!1,unfoldOnClick:!0,olFirst:!1,unfoldAll:!1,btnHide:!0,zoomToExtent:!1,catIconClass:"fa fa-chevron-right",showBgLabel:!0,showBgLayer:!0,showOvLabel:!0,showOvLayer:!0,getFitBoundsOptions:function(){var e={paddingTopLeft:[0,0]};return $(".lswitch-panel:visible").length&&(e.paddingTopLeft[0]=330),e}},_lang:{sv:{baselayers:"Bakgrundslager",overlays:"Kartlager",close:"Stäng",hide:"Göm",btnHideTooltip:"Göm lagerväljaren",btnShowTooltip:"Visa lagerväljaren",layerSwitcher:"",btnRemoveLgTooltip:"Släck alla kartlager"},en:{baselayers:"Baselayers",overlays:"Overlays",close:"Close",hide:"Hide",btnHideTooltip:"Hide layer switcher",btnShowTooltip:"Show layer switcher",layerSwitcher:"Layer switcher",btnRemoveLgTooltip:"Remove all overlays"}},showLayer:function(e){return smap.core.layerInst.showLayer(e)},hideLayer:function(e){smap.core.layerInst.hideLayer(e)},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"sv",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.lang)},onAdd:function(e){function t(e){var t=0;$(e).on("touchstart",function(e){t=this.scrollTop+e.originalEvent.touches[0].pageY}),$(e).on("touchmove",function(e){this.scrollTop=t-e.originalEvent.touches[0].pageY})}this.map=e,this._container=L.DomUtil.create("div","leaflet-control-LayerSwitcher"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.__onRowTap=this.__onRowTap||$.proxy(this._onRowTap,this),this.__onHeaderClick=this.__onHeaderClick||$.proxy(this._onHeaderClick,this),this.__onHeaderIconClick=this.__onHeaderIconClick||$.proxy(this._onHeaderIconClick,this),this.__onBtnDialogClick=this.__onBtnDialogClick||$.proxy(this._onBtnDialogClick,this),this.__onLegendEnter=this.__onLegendEnter||$.proxy(this._onLegendEnter,this),this.__onLegendLeave=this.__onLegendLeave||$.proxy(this._onLegendLeave,this);var n=this;if(this._moveWithCursor=function(e){$("body").find(".lswitch-legend-big").length||$("body").append(n._hoverImg),$(".lswitch-legend-big").css({left:e.pageX+10+"px",top:e.pageY-30+"px"})},this._addPanel(),this._addLayers(smap.config.bl,smap.config.ol),this.options.startOpened=!1,this.options.startOpened){var a=$("#lswitch-olcont, #lswitch-blcont");1===this.options.startOpened?a.children(".lswitch-cat").click():2===this.options.startOpened?a.children(".lswitch-cat").next().find(".lswitch-cat").click():this.options.startOpened===!0&&a.find(".lswitch-cat").click()}return this._addBtn(),this._bindEvents(),$("#mapdiv").addClass("lswitch-panelslide"),L.Browser.android&&t($(".lswitch-panel")),this._container},onRemove:function(){},_addLayers:function(e,t){e=e||[],t=t||[];var n;if(e.length>1)for(var a=0,i=e.length;i>a;a++)n=e[a],n.options.isBaseLayer=!0,this._addRow(n);else $(".lswitch-panel-bl").hide();if(t.length>0)for(var a=0,i=t.length;i>a;a++)n=t[a],n.options.isBaseLayer=!1,n.options.showInLayerSwitcher!==!1&&this._addRow(n);else $(".lswitch-panel-ol").hide();e.length<=1&&0===t.length&&$(".lswitch-panel span").css("color","#fff"),this._setSwitcherPosition(),this.__setSwitcherPosition=this.__setSwitcherPosition||$.proxy(this._setSwitcherPosition,this),$(window).on("resize",this.__setSwitcherPosition)},_setSwitcherPosition:function(){var e=0,t=$(".lswitch-panel");t.children().each(function(){e+=$(this).outerHeight()}),e>$("#mapdiv").innerHeight()-utils.rmPx(t.css("padding-top")+20)?t.css("position","absolute"):t.css("position","relative");var n=utils.getBrowser();n.ie&&t.css("position","absolute"),L.Browser.touch||n.ie&&n.ieVersion<=8||this.hidePanel()},_bindEvents:function(){var e=this;$("#mapdiv").on("touchstart click",$.proxy(function(){return $(window).width()<this.options.pxDesktop?(this.hidePanel(),!1):void 0},this));var t=($.proxy(this.showPanel,this),$.proxy(this.hidePanel,this));L.Browser.touch&&$(window).on("orientationchange",function(){e.$panel.is(":visible")&&t()}),this.map.on("layeradd layerremove",function(t){var n=t.layer||{};if(n.options&&!n.options._silent&&n.options.layerId&&!n.feature){var a=n.options.layerId,i=e._makeId(a),o=$("#"+i),s=o.hasClass("active");o.length&&("layeradd"===t.type&&s===!1?e.onRowTap(o):"layerremove"===t.type&&s===!0&&e.onRowTap(o))}}),smap.event.on("smap.core.createparams",function(e,t){var n=smap.core.paramInst.getParams();n.LSW&&(t.lsw=n.LSW)});var n=function(){if($(window).width()>e.options.pxDesktop)return!1;var t=smap.core.paramInst.getParams();t.LSW&&1===parseInt(t.LSW)&&setTimeout(function(){$("#lswitch-btn").trigger("mousedown")},310)};smap.event.on("smap.core.pluginsadded",n)},_addBtn:function(){var e=$('<div id="lswitch-btn"><span class="fa fa-bars fa-2x"></span></div>');$("#mapdiv").prepend(e),e.on("mousedown "+L.DomEvent._touchstart,$.proxy(function(){if(!this._panelIsSliding){var e=$(".lswitch-panel").hasClass("panel-visible");e?this.hidePanel():this.showPanel()}return!1},this)),e.on("dblclick",function(){return!1})},_addPanel:function(){function e(e,t){e.tooltip("destroy"),$(".tooltip").remove(),e.prop("title",t),e.tooltip({placement:"right",text:t,container:"#maindiv"})}var t=this;if(this.$panel=$('<div id="lswitch-panel_unselectable" class="lswitch-panel unselectable" />'),this.$panel.on("swipeleft",$.proxy(function(){this.hidePanel()},this)),this.$panel.on("touchstart",function(){$(this).css("overflow-y","auto")}),this.$list=$('<div class="panel panel-default lswitch-panel-bl"><div id="background_label_id"  class="panel-heading"><span>'+this.lang.baselayers+'</span></div><div id="lswitch-blcont" class="list-group"></div></div><div class="panel panel-default lswitch-panel-ol"><div id="overlays_label_id" class="panel-heading"><span>'+this.lang.overlays+'</span></div><div id="lswitch-olcont" class="list-group"></div></div>'),this.$panel.append(this.$list),this.options.olFirst&&this.options.olFirst===!0&&this.$panel.prepend(this.$panel.find(".lswitch-panel-ol")),this.options.btnHide){var n=$('<button title="'+this.lang.btnHideTooltip+'" type="button" class="lswitch-btnhide btn btn-default"><i class="fa fa-chevron-up"></i></button>'),a=$('<button title="'+this.lang.btnRemoveLgTooltip+'" type="button" class="slack-alla-kartskikt btn btn-default"><i class="fa fa-times"></i></button>');this.$panel.find(".panel-heading:first").append(n),this.$panel.find(".panel-heading:first").append(a),e(n,this.lang.btnHideTooltip),e(a,this.lang.btnRemoveLgTooltip);var i=n.parent().text(),o=!1;n.on("tap click",function(){var n=$(this);if(o)return!1;var a="fa-bars",s=n.find("i");return s.hasClass(a)?(setTimeout(function(){$(".lswitch-panel").removeClass("lswitch-displaynone"),"undefined"!==$(".slack-alla-kartskikt")&&null!==$(".slack-alla-kartskikt")&&$(".slack-alla-kartskikt").length>0?$(".slack-alla-kartskikt")[0].style.display="table-cell":"",n.prev().text(i),$("#overlays_label_id>button").removeClass("lswitch-btnshow"),$("#overlays_label_id>button").addClass("lswitch-btnhide"),s.removeClass(a),s.addClass("fa-chevron-up"),$(".lswitch-panel").removeClass("lswitch-hidden")},1),e(n,t.lang.btnHideTooltip)):(o=!0,s.removeClass("fa-chevron-up"),s.addClass(a),"undefined"!==$(".slack-alla-kartskikt")&&null!==$(".slack-alla-kartskikt")&&$(".slack-alla-kartskikt").length>0?$(".slack-alla-kartskikt")[0].style.display="none":"",$(".lswitch-panel").addClass("lswitch-hidden"),$("#overlays_label_id>button").removeClass("lswitch-btnhide"),$("#overlays_label_id>button").addClass("lswitch-btnshow"),e(n,t.lang.btnShowTooltip),n.prev().text(t.lang.layerSwitcher),setTimeout(function(){$(".lswitch-panel").addClass("lswitch-displaynone"),o=!1},200)),!1}),a.on("tap click",function(){smap.cmd.removeAllMapLayer()})}$("#maindiv").append(this.$panel),"undefined"!=typeof this.options.showOvLabel&&null!==this.options.showOvLabel&&(this.options.showOvLabel||(this.$list.find("#overlays_label_id")[0].style.display="none")),"undefined"!=typeof this.options.showOvLayer&&null!==this.options.showOvLayer&&(this.options.showOvLayer||(this.$list.find("#lswitch-olcont")[0].style.display="none")),"undefined"!=typeof this.options.showBgLabel&&null!==this.options.showBgLabel&&(this.options.showBgLabel||(this.$list.find("#background_label_id")[0].style.display="none")),"undefined"!=typeof this.options.showBgLayer&&null!==this.options.showBgLayer&&(this.options.showBgLayer||(this.$list.find("#lswitch-blcont")[0].style.display="none")),$("#mapdiv").on("touchstart click",$.proxy(function(){if(L.Browser.touch&&$(".lswitch-btnhide.btn.btn-default")&&1===$(".fa.fa-chevron-up").length){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;767>=e&&n.tap()}},n))},showPanel:function(){var e=this;if(this.$panel.show(),this._panelIsSliding)return!1;this._panelIsSliding=!0,$("#lswitch-btn span").removeClass("fa-bars").addClass("fa-chevron-left"),setTimeout(function(){$(".lswitch-panel").addClass("panel-visible")},1),setTimeout(function(){e._panelIsSliding=!1},300),$("#mapdiv").addClass("mapdiv-slidetransition"),$("#maindiv").addClass("lswitcher-slidetransition");this.$panel.outerWidth();$("#lswitch-btn").css({left:$(".lswitch-panel").outerWidth()-3+"px"})},hidePanel:function(){return this._panelIsSliding?!1:(this._panelIsSliding=!0,$("#lswitch-btn span").removeClass("fa-chevron-left").addClass("fa-bars"),$("#lswitch-btn").css({left:"0"}),$(".lswitch-panel").removeClass("panel-visible"),$("#maindiv").addClass("lswitch-overflow-hidden"),$("#maindiv").removeClass("lswitcher-slidetransition"),void setTimeout($.proxy(function(){$("#mapdiv").removeClass("mapdiv-slidetransition"),this._panelIsSliding=!1,this.$panel.hide(),$("#maindiv").removeClass("lswitch-overflow-hidden")},this),300))},_setBaseLayer:function(e){var t,n=this.map._layers;for(var a in n)t=n[a],t&&t.options&&t.options.isBaseLayer&&("undefined"==typeof t.options.isMultipleBaseLayer||null===t.options.isMultipleBaseLayer&&t.options.isMultipleBaseLayer!==!0)&&t.options.layerId!==e&&this.hideLayer(t.options.layerId);this.showLayer(e)},_onLegendClick:function(){return $(this).parent().trigger("tap"),!1},_onRowTap:function(e){var t=$(e.target);return t.hasClass("list-group-item")?(this.onRowTap(t),!1):void 0},onRowTap:function(e){var t=e.attr("id"),n=this._unMakeId(t),a=$("#"+t).parents("#lswitch-blcont").length>0;if(a)return $("#lswitch-blcont").find("a.active").removeClass("active"),e.addClass("active"),this._setBaseLayer(n),!1;e.toggleClass("active");var i=e.hasClass("active"),o=e.parents(".lswitch-catcont");o.each(function(){if(i)$(this).prev().addClass("active");else{if($(this).find("a.list-group-item.active").length>0)return!1;$(this).prev().removeClass("active")}});var s,i=e.hasClass("active");if(i){var l=e.data("t")||null;s=this.showLayer(l||n);var r=this.options.getFitBoundsOptions?this.options.getFitBoundsOptions():null;(this.options.zoomToExtent||l&&l.options&&l.options.zoomToExtent)&&!this._sumBounds&&s.getBounds&&($.isEmptyObject(s._layers)?s.once("load",function(e){e.layer._map.fitBounds(s.getBounds(),r)}):this.map.fitBounds(s.getBounds(),r))}else this.map.closePopup(),s=this.hideLayer(n);return s},_makeId:function(e){return"lswitchrow-"+encodeURIComponent(e).replace(/%/g,"--pr--")},_unMakeId:function(e){return decodeURIComponent(e.replace("lswitchrow-","").replace(/--pr--/g,"%"))},_toggleHeader:function(e){e.next().toggleClass("lswitch-catcont-visible"),e.toggleClass("open")},_onHeaderClick:function(e,t){t=t||{};var n=this,a=e.target;a="A"===a.tagName||"SPAN"===a.tagName?$(a).parent():$(a);var i=a.next();if(!this.options.unfoldOnClick||!this.options.unfoldAll&&t.isSubHeader||this._toggleHeader(a),!this.options.toggleSubLayersOnClick&&this.options.unfoldOnClick&&this.options.unfoldAll&&i.find("div.list-group-item").each(function(){h=$(this);var e=a.hasClass("open"),t=h.hasClass("open");e!==t&&n._toggleHeader(h)}),this.options.toggleSubLayersOnClick&&0===a.parents("#lswitch-blcont").length){var o,s,l=a.hasClass("active"),r=a.hasClass("open");this.options.unfoldOnClick&&r===l&&!t.isSubHeader?l=!l:a.toggleClass("active");var p,d;this._sumBounds=null,!this.options.zoomToExtent||l||this._sumBounds||(p=$.Deferred(),p.done(function(){n._sumBounds.isValid()&&n.map.fitBounds(n._sumBounds,n.options.getFitBoundsOptions?n.options.getFitBoundsOptions():null),n._rowCount=null,n._sumBounds=null}),this._rowCount=this._rowCount||i.find("a.list-group-item").length,this._sumBounds=L.latLngBounds([]),d=function(e,t){this._rowCount-=1,this._sumBounds.extend(e.getBounds()),0===this._rowCount&&t.resolve()}),i.children(".list-group-item").each(function(){if(s=$(this),o=s.hasClass("active"),"A"===s[0].tagName&&l===o){var e=n.onRowTap(s);n._sumBounds&&e.getBounds&&($.isEmptyObject(e._layers)===!0?e.once("load",function(){d.call(n,e,p)}):d.call(n,e,p))}else"DIV"===s[0].tagName&&l===o&&n._onHeaderClick({target:s},{isSubHeader:!0})})}return $(window).width()>this.options.pxDesktop?this._setSwitcherPosition():$(".lswitch-panel").css("position","absolute"),!1},_onHeaderIconClick:function(e){var t=$(e.target);return this._toggleHeader(t.parent()),!1},_onBtnDialogClick:function(e){var t=$(e.target).parents(".list-group-item:first").data("t").options,n="",a=t.dialog;("http"===a.substring(0,4)||"//"===a.substring(0,2))&&(n='<div class="modal-body-container"><iframe frameborder="0" scrolling="auto" src="'+a+'" width="100%" height="100%" style="position:absolute;left:0;top:0;margin:0;padding:0;" frameborder="0"></iframe></div>');var i='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>",o=utils.drawDialog(t.displayName,n,i,{});o.addClass("lswitch-dialog"),o.modal("show");var s=$("#mapdiv").height();return s=s>500?500:s,o.find(".modal-body").css({"min-height":s+"px"}),o.on("hidden.bs.modal",function(){$(this).empty().remove()}),!1},_addBtnDialog:function(e){var t=$('<span class="fa fa-info-circle lswitch-btndialog" aria-hidden="true"></span>');t.on("click touchstart",this.__onBtnDialogClick),e.prepend(t)},_addLegend:function(e,t,n){var a=$('<img class="lswitch-legend" src="'+t+'" />');if(this.options.layerInfoConfig){if(L.Browser.touch)var i=$('<div class="layer-info-btn"><span class="glyphicon glyphicon-info-sign"  /></div>');
else var i=$('<div class="layer-info-btn"><span class="glyphicon glyphicon-info-sign"  /></div>');n.options.layerInfoConfig=this.options.layerInfoConfig,i.on("tap",$.proxy(function(e){if(e.preventDefault(),n.options){var t="";for(col in n.options.layerInfoConfig){var a=this.options.layerInfoConfig[col],i=function(){return n.options[col]?n.options[col]:""}();if("legend"===col){t+='<div id="postProcessLegendContent" class="row">  </div>';var o=new Image;o.columnNmae=a,o.columnValue=i,o.src=i,window.image_content="",o.onload=function(){window.image_content=$(this.width<300?' <div class="col-xs-12 col-sm-6"><b>'+this.columnNmae+':</b></div> <div  class="col-xs-12 col-sm-6"><img style="max-width:85%;" class="" src="'+this.columnValue+'" /> </div> ':' <div class="col-xs-12"><b>'+this.columnNmae+':</b></div> <div  class="col-xs-12"><img class="layerInfoLegend" src="'+this.columnValue+'" /> </div>')}}else t="link"===col?i.length>0?t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a+':</b></div> <div  class="col-xs-12 col-sm-6"><a href='+i+' target="_blank">Mer information</a></div> </div>':t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a+':</b></div> <div  class="col-xs-12 col-sm-6"></div> </div>':"attribution"===col?t+'<div class="row"> <div class="col-xs-12 col-sm-12">'+i+"</div></div>":t+'<div class="row"> <div class="col-xs-12 col-sm-6"><b>'+a+':</b></div> <div  class="col-xs-12 col-sm-6">'+i+"</div> </div>"}var e='<button type="button" class="btn btn-default" data-dismiss="modal">Stäng</button>',s=utils.drawDialog("Information för "+n.options.displayName,t,e,null);s.modal("show"),s.on("hidden.bs.modal",function(){document.body.removeChild(this)}),s.on("shown.bs.modal",function(){window.image_content&&$("#postProcessLegendContent")&&$("#postProcessLegendContent").append(window.image_content)})}},n))}a.on("tap",this._onLegendClick),L.Browser.touch?"":a.on("mouseenter",this.__onLegendEnter),L.Browser.touch?"":a.on("mouseleave",this.__onLegendLeave),e.prepend(a),this.options.layerInfoConfig&&e.prepend(i)},_onLegendLeave:function(){$(".lswitch-legend-big").remove(),$(document).off("mousemove",this._moveWithCursor)},_onLegendEnter:function(e){var t=$(e.target),n=t.parent().data("t"),a=n.options.legendBig||n.options.legend;$(".lswitch-legend-big").remove(),delete this._hoverImg;var i=$('<img class="lswitch-legend-big" src="'+a+'" />');this._hoverImg=i,$(document).on("mousemove",this._moveWithCursor)},_addRow:function(e){function t(e,i,s){return c=e[i],p=s.find('.lswitch-cat:has(span:contains("'+c+'"))'),p.length?d=p.next():(p=$('<div class="list-group-item lswitch-cat"><i class="'+n+'"></i><span>'+c+"</span></div>").appendTo(s),d=$('<div class="lswitch-catcont"></div>'),p.after(d),p.on("tap",a.__onHeaderClick),p.find("i").on("tap",a.__onHeaderIconClick)),e.length>i+1?t(e,i+1,d):(d.append(o),!0)}var n=this.options.catIconClass,a=this,i=e.options,o=$('<a class="list-group-item"></a>'),s=$('<div class="displayname-div-lvl1"></div>'),l=$('<div class="displayname-div-lvl2">'+i.displayName+"</div>");s.append(l),o.append(s),o.attr("id",this._makeId(i.layerId)),o.on("tap",this.__onRowTap),l.on("tap",$.proxy(function(e){o.tap(),e.preventDefault()},o)),o.data("t",e),!i.legend&&$(window).width()<this.options.pxDesktop||this._addLegend(o,i.legend,e),i.dialog&&this._addBtnDialog(o,e);var r;if(i.isBaseLayer?(r=$("#lswitch-blcont"),r.is(":visible")||$(".lswitch-panel-bl").show()):(r=$("#lswitch-olcont"),r.is(":visible")||$(".lswitch-panel-ol").show()),i.category){var p,d,c,m=i.category;t(m,0,r)}else r.append(o);return o}}),L.control.layerSwitcher=function(e){return new L.Control.LayerSwitcher(e)},L.Control.MMP=L.Control.extend({options:{position:"bottomright",wsSave:location.protocol+"//gkkundservice.test.malmo.se/KartService.svc/saveGeometry"},_lang:{sv:{btnLabel:"Spara",clickHereToSave:"Klicka här för att spara positionen",dragInfo:'<div style="font-size:1.2em;"><strong style="font-size:1.3em;">Instruktioner</strong><ol style="margin:0;padding-left:1.65em;margin-top:0.5em;"><li>Zooma in i kartan så mycket som möjligt</li><li>Klicka i kartan för att markera platsen för ärendet<br />(pekskärm: peka och håll kvar fingret på en plats)</li></ol></div>',youCanDragMeOrClick:"<strong>Klicka i kartan</strong> igen eller <strong>dra i markören</strong> för att ändra positionen",btnSave:"Bekräfta position",zoomInMore:"Du måste zooma in mer i kartan för att kunna lägga till markör"},en:{btnLabel:"Save",clickHereToSave:"Click here to save new position",dragInfo:"<h1>Instructions</h1><ol><li>Zoom the map as much as possible</li><li>Then click once in the map to set the location of the incident</li></ol>",youCanDragMeOrClick:"Click on the map again or drag the marker to adjust the location",btnSave:"Confirm position",zoomInMore:"You must zoom the map more before you can add a marker"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-mmp"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._bindEvents(),this._mmpExternalLayers=[],this._container},onRemove:function(){this._unbindEvents(),this.$btn.empty().remove(),this._mmpExternalLayers=null},activateAddMarker:function(){this._editingIsActive=!0,this._createBtn();var e;e=L.Browser.touch?"contextmenu":"click",this.map.on(e,this.onMapClick,this)},deactivateAddMarker:function(){this._editingIsActive=!1;var e;e=L.Browser.touch?"contextmenu":"click",this.map.off(e,this.onMapClick),$("#smap-mmp-btn").empty().remove(),this.$btn=null},onMapClick:function(e){return this.map.getZoom()<this.options.minZoom?void smap.cmd.notify(this.lang.zoomInMore,"error",{fadeOut:5e3}):(this._marker&&(this.map.removeLayer(this._marker),this._marker=null),void this._addMarker(e.latlng))},onHashChange:function(){var e=location.hash.substring(1),t=utils.paramsStringToObject(e,!0);if(t&&t.MMP_DATA){var n=t.MMP_DATA;n=decodeURIComponent(n),this._counterLayerId=this._counterLayerId||0,this._clearExternalData(),this._counterLayerId+=1,this._addExternalData(n,{layerId:"mmp-extlayer-"+this._counterLayerId})}},_bindEvents:function(){var e=this;smap.event.on("smap.core.beforeapplyparams",function(e,t){var n=t.OL||"";n=n.split(","),n.push(t.CATEGORY),n=n.join(","),t.OL=n}),smap.event.on("smap.core.applyparams",function(t,n){n.MMP_EDIT&&"TRUE"===n.MMP_EDIT.toUpperCase()&&e.activateAddMarker();var a=null,i=null;if(n.MMP_XY){var a=n.MMP_XY instanceof Array?n.MMP_XY:n.MMP_XY.split(",");a=$.map(a,function(e){return parseFloat(e)}),i=utils.projectLatLng(L.latLng(a),"EPSG:3008","EPSG:4326",!0,!1)}else this._editingIsActive&&smap.cmd.notify(e.lang.dragInfo,"info");n.MMP_ID&&(e._tempId=n.MMP_ID),i&&e._addMarker(i),e.onHashChange()}),this._onHashChange=$.proxy(this.onHashChange,this),$(window).on("hashchange",this._onHashChange)},_clearExternalData:function(){for(var e=this._mmpExternalLayers,t=0;t<e.length;t++)smap.cmd.hideLayer(e[t]);this._mmpExternalLayers=[]},_addExternalData:function(e,t){t=t||{};var n,a=L.AwesomeMarkers.icon({icon:"warning",markerColor:"black",prefix:"fa"}),i={url:e,init:"L.GeoJSON.WFS",options:$.extend(!0,{layerId:L.stamp(this),displayName:"Incidenter",xhrType:"GET",attribution:"Malmö stad",inputCrs:"EPSG:3008",uniqueKey:"arendeId",selectable:!0,reverseAxis:!1,showInLayerSwitcher:!0,reverseAxisBbox:!0,geomType:"POINT",includeParams:["bbox"],separator:"&",popup:"*",style:{icon:a}},t)},o=smap.cmd.getControl("LayerSwitcher");if(o){var s=o._addRow(i);s.trigger("tap"),n=smap.cmd.getLayer(i.layerId)}else n=smap.cmd.addLayerWithConfig(i);this._mmpExternalLayers.push(n)},_unbindEvents:function(){this.map.off("click",this.onMapClick)},_adaptUrl:function(e){return"localhost"===document.domain?e=e.replace("gkkundservice.test.malmo.se","localhost").replace("kartor.malmo.se","localhost"):"kartor.malmo.se"===document.domain&&(e=e.replace("gkkundservice.test.malmo.se/","kartor.malmo.se/gkkundservicedev/").replace("gkkundservice.malmo.se/","kartor.malmo.se/gkkundservicedev/")),e},_save:function(e){var t=this.options.wsSave;t=this._adaptUrl(t),smap.cmd.loading(!0),$.ajax({url:t,type:"GET",data:e,context:this,dataType:"json",success:function(e){e.success&&JSON.parse(e.success)},error:function(){},complete:function(){smap.cmd.loading(!1)}})},save:function(){var e=utils.projectPoint(this._latLng.lng,this._latLng.lat,"EPSG:4326","EPSG:3008"),t=e[0],n=e[1];this._save({easting:parseInt(t),northing:parseInt(n),tempId:this._tempId||null})},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-mmp-btn" class="btn btn-primary btn-lg hidden"><span class="fa fa-check"></span> '+this.lang.btnSave+"</button>"),this.$btn.on("click",function(t){return t.stopPropagation(),e.save(),!1}),$("#mapdiv").append(this.$btn)},_addMarker:function(e){var t=this;e&&(this._latLng=e);var n=L.AwesomeMarkers.icon({icon:this._editingIsActive?"arrows":"lock",markerColor:"darkred",prefix:"fa",extraClasses:"mmpmarker"}),a=L.marker(e,{draggable:this._editingIsActive||!1,icon:n,zIndexOffset:999});a.on("dragstart",function(e){e.target.closePopup()}),a.on("dragend",function(e){t._latLng=e.target.getLatLng()}),this.map.addLayer(a),a.openPopup(),this._marker=a,this.$btn&&(this.$btn.removeClass("hidden"),$(".alert").remove())}}),L.Control.Add2HomeScreen=L.Control.extend({options:{},initialize:function(e){L.setOptions(this,e),$("body").append('<script src="lib/add-to-homescreen/src/addtohomescreen.js"></script>')},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-add2HomeScreen"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._container},onRemove:function(){}}),L.control.add2HomeScreen=function(e){return new L.Control.Add2HomeScreen(e)},L.Control.Mapillary=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-mapillary"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._container},onRemove:function(){},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-mapillary-btn" title="'+e.lang.exampleLabel+'" class="btn btn-default"><span class="fa fa-expand"></span></button>'),this.$btn.on("click",function(){return e.activate(),!1}),this.$container.append(this.$btn)}}),L.Control.MeasureDraw=L.Control.extend({options:{position:"topright",saveMode:"url",saveWfsUrl:"",saveWfsTypeName:"",layerName:"measurelayer",moreCoordsAsModal:!0,touchShowButtonAsDisabled:!0,stylePolygon:{color:"#0077e2",weight:3},stylePolyline:{color:"#0077e2",weight:9}},_lang:{sv:{btnDisabledBecauseTouch:"Rita & Mät stödjer inte din nuvarande enhet",close:"Stäng",drawTools:"Ritverktyg",draggableMarker:"Markören är dragbar",btnTitle:"Rita & Mät",drawPoint:"Punkt/Koordinater",drawLine:"Linje",drawPolygon:"Yta",drawCircle:"Cirkel",drawRectangle:"Rektangel",circumference:"Omkrets",radius:"Radie",area:"Area",len:"Längd",lenPart:"Sidlängd",easting:"Easting (x/longitud)",northing:"Northing (y/latitud)",clickToAddText:"Klicka för att lägga till text (stäng pratbubblan för att spara)",showMeasures:"Visa mätresultat",remove:"Ta bort",moreCoords:"Fler koordinatsystem",helpTextSavePopup:"Stäng pratbubblan för att spara",handlers:{circle:{tooltip:{start:"Klicka och dra för att rita cirkel."}},marker:{tooltip:{start:"Klicka i kartan för att placera markör."}},polygon:{tooltip:{start:"Klicka för att påbörja yta",cont:"Klicka igen för att fortsätta rita ytan.",end:"Dubbelklicka eller klicka första punkten för att avsluta ytan."}},polyline:{error:"<strong>Error:</strong> linjers kanter kan inte korsa varandra!",tooltip:{start:"Klicka för att påbörja linje.",cont:"Klicka för att fortsätta linje.",end:"Dubbelklicka för att avsluta linje."}},rectangle:{tooltip:{start:"Klicka och dra för att rita rektangel."}},simpleshape:{tooltip:{end:"Släpp musknappen för att avsluta."}}}},en:{btnDisabledBecauseTouch:"Draw & Measure is not supported on your device",close:"Close",drawTools:"Draw tools",draggableMarker:"The marker is draggable",btnTitle:"Draw & Measure",drawPoint:"Point/Coordinates",drawLine:"Line",drawPolygon:"Area",drawCircle:"Circle",drawRectangle:"Rectangle",circumference:"Circumference",radius:"Radius",area:"Area",len:"Length",easting:"Easting (x/longitude)",northing:"Northing (y/latitude)",clickToAddText:"Click to add text",showMeasures:"Show measure results",remove:"Remove",moreCoords:"More projections",helpTextSavePopup:"Close the popup to save"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode),this._tools={},this._setLabels()},_jsonCompressDict:{'"FeatureCollection":':":fc:",'"Feature"':":F:",'"Point"':":P:",'"features":':":fs:",'"type":':":t:",'"geometry":':":g:",'"coordinates":':":c:",'"properties":':":p",'"measure_form"':":m:",'"measure_text"':":mt:"},_compressJson:function(e){var t,n=this._jsonCompressDict;for(var a in n)t=new RegExp(a,"g"),e=e.replace(t,n[a]);return e},_uncompressJson:function(e){var t,n=this._jsonCompressDict;for(var a in n)t=new RegExp(n[a],"g"),e=e.replace(t,a);return e},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-measuredraw"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._proxyListeners(),this._initDraw();var t=L.Browser.touch&&this.options.touchShowButtonAsDisabled;if(!L.Browser.touch||t){var n=this._createBtn();t?(n.prop("disabled",!0),n.prop("title",this.lang.btnDisabledBecauseTouch),n.tooltip({placement:"bottom"})):smap.event.on("smap.core.pluginsadded",function(){$(".leaflet-control-measuredraw .dropdown-toggle").dropdown()})}var a=this;return this.map.on("layeradd",function(){a._layer.bringToFront(),a._layer.setZIndex(1e4),a._layer.eachLayer(function(e){e.options.selectable=!0,e.options.clickable=!1,e.bringToFront&&e.bringToFront(),e.setZIndex&&e.setZIndex(1e4)})}),smap.event.on("smap.core.createparams",$.proxy(this._onCreateParams,this)),smap.event.on("smap.core.applyparams",$.proxy(this._onApplyParams,this)),this._container},_onCreateParams:function(e,t){function n(e){for(var t,a=0,i=e.length;i>a;a++)t=e[a],t instanceof Array?n(t):e[a]=L.Util.formatNum(t,5)}for(var a=t.ol,i=0,o=a.length,s=this.options.layerName;o>i;i++)if(a[i]===s){a.splice(i,1);break}if("url"===this.options.saveMode){var l=[],r=0;if(this._layer.eachLayer(function(e){e._radius&&(e.properties.radius=e.getRadius()),e._popup&&e._popup._isOpen&&(delete t.sel,e.properties.popupIsOpen=!0),e._popup&&e._popup._isOpen?"undefined"!=typeof e.properties&&null!==e.properties&&"undefined"!=typeof e.properties.popupIsOpen&&null!==e.properties.popupIsOpen&&(e.properties.popupIsOpen=!0):"undefined"!=typeof e.properties&&null!==e.properties&&"undefined"!=typeof e.properties.popupIsOpen&&null!==e.properties.popupIsOpen&&(e.properties.popupIsOpen=!1),l.push(e.properties),e.properties&&(r+=1)}),0===r)return!1;for(var p,d,c=this._layer.toGeoJSON(),m=c.features,u=[],i=0,o=m.length;o>i;i++)d=m[i],p=$.extend(!0,{},d),n(p.geometry.coordinates),l[i]&&(p.properties=$.extend({},l[i]),delete p.properties.measure_form,u.push(p));c.features=u;var h=JSON.stringify(c);h=this._compressJson(h);var _=encodeURIComponent(this.options.saveMode+","+h);_=_.replace(/%3A/g,":"),_=_.replace(/%3A/g,":"),t.md=_}},_onApplyParams:function(e,t){if(t.MD){var n=decodeURIComponent(t.MD),a=n.search(","),i=n.substring(0,a),o=n.substring(a+1);if("url"===i){o=this._uncompressJson(o);var s,l=JSON.parse(o),r=L.geoJson(l),d=window.getQueryParameters("hidedrawinfo");if(d.length>0)if("true"===d){if(r&&r._layers)for(key in r._layers)r._layers[key].feature&&r._layers[key].feature.properties&&"undefined"!=typeof r._layers[key].feature.properties.popupIsOpen&&null!==r._layers[key].feature.properties.popupIsOpen&&r._layers[key].feature.properties.popupIsOpen&&(r._layers[key].feature.properties.popupIsOpen=!1)}else if("false"===d&&r&&r._layers){var c=0;for(key in r._layers)r._layers[key].feature&&r._layers[key].feature.properties&&"undefined"!=typeof r._layers[key].feature.properties.popupIsOpen&&null!==r._layers[key].feature.properties.popupIsOpen&&r._layers[key].feature.properties.popupIsOpen&&c++;if(0===c)for(key in r._layers)r._layers[key].feature&&r._layers[key].feature.properties&&("undefined"!=typeof r._layers[key].feature.properties.popupIsOpen&&null!==r._layers[key].feature.properties.popupIsOpen?r._layers[key].feature.properties.popupIsOpen||(r._layers[key].feature.properties.popupIsOpen=!0):r._layers[key].feature.properties.measure_text.length>0&&(r._layers[key].feature.properties.popupIsOpen=!0))}p=this,r.eachLayer(function(e){var t={Point:"marker",LineString:"polyline",Polygon:"polygon"};if("Point"===e.feature.geometry.type){var n=e.feature.geometry.coordinates;s=L.marker([n[1],n[0]]),s.properties=$.extend(!0,{},e.feature.properties)}else s=e;p.onCreated({_silent:!0,layerType:t[e.feature.geometry.type],layer:s})})}}},_proxyListeners:function(){this.__onRowClick=$.proxy(this._onRowClick,this)},onRemove:function(){},readableDistance:function(e,t){t=t||1;var n="m",a=0;if(1===t&&e>=1e3||2===t&&e>=1e5){var i=Math.pow(1e3,t-1);e/=i,e/=1e3,a=3,n="km"}return n=1===t?n:n+t,utils.round(e,a)+" "+n},_renderLabel:function(e,t){this._labels=this._labels||[];var n=utils.createLabel(e,this.readableDistance(t,1),"leaflet-maplabel leaflet-maplabel-small");this._layer.addLayer(n),this._labels.push(n);var a=$(".leaflet-maplabel.leaflet-maplabel-small:last");a.css({"margin-left":-a.width()/2+"px"})},onNodeClick:function(e){this._nodes=this._nodes||[];var t=e.latlng||null,n=this._nodes;if(t&&n.push(t),n.length>1){var a=n.slice(n.length-2),i=utils.getLength(a);if(0>=i)return!1;var o=L.latLng((a[0].lat+a[1].lat)/2,(a[0].lng+a[1].lng)/2);this._renderLabel(o,i)}console.log("node click")},_createCoordsHtml:function(e,t){t=t||!1;var n=utils.projectLatLng(e,"EPSG:4326","EPSG:3006"),a=utils.projectLatLng(e,"EPSG:4326","EPSG:3008"),i=utils.projectLatLng(e,"EPSG:4326","EPSG:3021"),o="",s="",l="";return t||(o=" hidden",s='<div style="margin-bottom:1em;">['+this.lang.draggableMarker+"]</div>",l='<br><button ondrag="return false;" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i>&nbsp;&nbsp;'+this.lang.moreCoords+"</button></div></div>"),html=s+"<div><strong>WGS 84 (EPSG:4326)</strong><br>Lat: &nbsp;"+utils.round(e.lng,5)+"<br>Lon: &nbsp;"+utils.round(e.lat,5)+"<div>"+l,html+="<br><div class='measuredraw-morecoords"+o+"'><strong>Sweref99 TM (EPSG:3006)</strong><br>East: &nbsp;"+utils.round(n.lng)+"<br>North: &nbsp;"+utils.round(n.lat)+"<br><br><strong>Sweref99 13 30 (EPSG:3008)</strong><br>East: &nbsp;"+utils.round(a.lng)+"<br>North: &nbsp;"+utils.round(a.lat)+"<br><br><strong>RT90 2.5 gon V (EPSG:3021)</strong><br>East: &nbsp;"+utils.round(i.lng)+"<br>North: &nbsp;"+utils.round(i.lat)+"</div>",html},_getLabel:function(e){var t;return this._layer.eachLayer(function(n){n._parentFeature&&n._parentFeature===e&&(t=n)}),t},onCreated:function(e){var t=this;this._deactivateAll();var n=e.layerType,a=e.layer;if(a.properties&&a.properties.radius){var i=a.properties;n="circle",a=L.circle(a._latlng,a.properties.radius),a.properties=i}if(a.setStyle)switch(n){case"polyline":a.setStyle(this.options.stylePolyline);break;default:a.setStyle(this.options.stylePolygon)}"marker"===n&&(a.options.draggable=!0,a.on("dragstart",function(e){var t=e.target;t.closePopup()}),a.on("drag",function(e){var n=e.target,a=t._getLabel(n);a.setLatLng(n.getLatLng());var i=t._createCoordsHtml(n.getLatLng());$(a._icon).html(i);var o=$(".alert");if(o.length){var s=smap.cmd.notify(t._createCoordsHtml(n.getLatLng(),!0),"blank");s.addClass("notify-transition notify-visible")}})),this._layer.addLayer(a),a.options.layerId=a._leaflet_id,a.feature&&(a.properties=a.feature.properties||a.properties,delete a.feature),a.properties&&(a.properties.measure_form||a.properties.measure_text)||(a.properties={id:a._leaflet_id,measure_form:'<div class="measuredraw-popup-div-save"><textarea class="form-control" placeholder="'+this.lang.clickToAddText+'" rows="3"></textarea></div>',measure_text:""}),a.properties.id=a._leaflet_id,a._measureDrawFeature=!0,this._layer.fire("load"),a.unbindPopup();var o,s,l,r="";switch(n){case"marker":var p=o=a.getLatLng();r=this._createCoordsHtml(p);break;case"polyline":var d=a.getLatLngs();o=d[parseInt(d.length/2)],s=utils.getLength(d),r=this.lang.len+": &nbsp;"+this.readableDistance(s,1)+"<br>";break;case"polygon":o=a.getBounds().getCenter();var d=a.getLatLngs();d.push(d[0]);var l=L.GeometryUtil.geodesicArea(d);s=utils.getLength(d),r=this.lang.circumference+": &nbsp;"+this.readableDistance(s,1)+"<br>"+this.lang.area+": &nbsp;"+this.readableDistance(l,2);break;case"circle":o=a.getBounds().getCenter();var c=a.getRadius();l=c*c*Math.PI,s=2*c*Math.PI,r=this.lang.circumference+": &nbsp;"+this.readableDistance(s,1)+"<br>"+this.lang.radius+": &nbsp;"+this.readableDistance(c,1)+"<br>"+this.lang.area+": &nbsp;"+this.readableDistance(l,2);break;case"rectangle":o=a.getBounds().getCenter();var d=a.getLatLngs();d.push(d[0]);var l=L.GeometryUtil.geodesicArea(d);s=utils.getLength(d),r=this.lang.circumference+": &nbsp;"+this.readableDistance(s,1)+"<br>"+this.lang.area+": &nbsp;"+this.readableDistance(l,2)}var m=a._leaflet_id,u="measuredrawlabel_"+m+"_",h="leaflet-maplabel "+u;if(L.Browser.touch);else{(e._silent||"rectangle"===n)&&a.getLatLngs&&(this._nodes=[],$.each(a.getLatLngs(),function(e,n){t.onNodeClick({latlng:n})}));var _=utils.createLabel(o,r,h);if(this._layer.addLayer(_),a.on("mouseover",this.onMouseOver),a.on("mouseout",this.onMouseOut),_.options.clickable=!0,"marker"===n){var v=function(){if(t.options.moreCoordsAsModal){var e=t._createCoordsHtml(a.getLatLng(),!0);smap.cmd.notify(e,"blank",{fade:!0})}else{var n=$(this),i=n.parent().parent().parent();i.find(".measuredraw-morecoords").toggleClass("hidden"),n.parent().remove()}return!1},g=function(){var e=$(this);e.find("button").off("click",v).on("click",v)};$(_._icon).on("mouseenter",g),$(_._icon).on("click",function(){return!1})}this._labels=this._labels||[],this._labels.push(_);for(var f=this._labels||[],b=0,y=f.length;y>b;b++)f[b]._parentFeature=a;this._labels=[];var k=$(".leaflet-maplabel:last");"marker"===n&&k.css("transition","none"),k.css({"margin-left":-k.width()/2-15+"px"})}e._silent?a.properties&&a.properties.popupIsOpen&&(delete a.properties.popupIsOpen,this.map.fire("selected",{feature:a,selectedFeatures:[],layer:this._layer})):k&&(k.addClass("leaflet-maplabel-hover"),setTimeout(function(){k.removeClass("leaflet-maplabel-hover")},2e3))},onMouseOver:function(e){var t=$(".measuredrawlabel_"+e.target._leaflet_id+"_");t.addClass("leaflet-maplabel-hover")},onMouseOut:function(e){$(".measuredrawlabel_"+e.target._leaflet_id+"_").removeClass("leaflet-maplabel-hover")},_setLabels:function(){var e=L.drawLocal.draw;$.extend(!0,e.handlers,this.lang.handlers||{})},_selection:function(e){var t,n,a=[smap.cmd.getControl("L.Control.SelectWMS"),smap.cmd.getControl("L.Control.SelectVector")];for(n=0;n<a.length;n++)t=a[n],t&&(e===!0?t.activate():t.deactivate())},_initDraw:function(){this._layer=L.featureGroup(),this._layer.options={layerId:this.options.layerName,popup:"${measure_text}${measure_form}",uniqueKey:"id"},this.map.addLayer(this._layer),this._drawControl=new L.Control.Draw({draw:{marker:!1,polyline:!1,polygon:!1,rectangle:!1,circle:!1},edit:null}),this._onCreated=this._onCreated||$.proxy(this.onCreated,this),this._onNodeClick=this._onNodeClick||$.proxy(this.onNodeClick,this),this._onPopupOpen=this._onPopupOpen||$.proxy(this.onPopupOpen,this),this.map.on("draw:created",this._onCreated);var e=this;e.map.on("click",function(){this._removeAlerts()},this);var t=function(e){this.onNodeClick(e)}.bind(this);this.map.on("draw:drawstart",function(){e._nodes=[],e._selection(!1),e._map.on("draw:vertexchanged",t)}),this.map.on("draw:drawstop",function(n){e._map.off("draw:vertexchanged",t),e._nodes&&_.indexOf(["polygon","rectangle"],n.layerType)>-1&&e._onNodeClick({latlng:e._nodes[0]}),setTimeout(function(){e._selection(!0)},50)}),this.map.on("popupopen",this._onPopupOpen)},_removeFeature:function(e){var t=this;this.map.fire("unselected",{}),this.map._popup&&this.map.closePopup(),this._labels,e.off(),this._layer.eachLayer(function(n){n._parentFeature&&n._parentFeature===e&&(n.off(),t.map.removeLayer(n))}),this._layer.removeLayer(e)},onPopupOpen:function(e){var t=this;this._removeAlerts();var a=e.popup&&e.popup._source?e.popup._source:null;if(a&&a._measureDrawFeature){var o=smap.cmd.getControl("L.Control.SelectWMS");o._dblclickWasRegistered=!0,o&&setTimeout(function(){o._dblclickWasRegistered=!1},400);var l=$(".measuredraw-popup-div-save textarea"),r=window.getQueryParameters("hidedrawdeletebutton");if(n=r.length>0&&"true"===r?'<br><br><button style="display:none!important;" class="btn btn-default btn-sm measuredraw-btn-popupremove">'+this.lang.remove+"</button>":'<br><br><button class="btn btn-default btn-sm measuredraw-btn-popupremove">'+this.lang.remove+"</button>",s=e.popup,i=s.getContent(),-1===i.search("measuredraw-btn-popupremove")&&(i+=n,s.setContent(i),s.update(),l=$(".measuredraw-popup-div-save textarea")),$(".leaflet-popup-content").find(".measuredraw-btn-popupremove").on("click",function(){return t._removeFeature(a),!1}),l.length){l.placeholder(),l.tooltip({placement:"top",title:this.lang.helpTextSavePopup,container:".leaflet-popup",trigger:"manual"}),l.on("keypress",function(){$(".tooltip:visible").length||$(this).tooltip("show")});var p=utils.getBrowser();l.on("focus",function(){$(".measuredraw-btn-popupremove").prop("disabled",!0),(p.ie10||p.ie11)&&$(this).val("")}),this.lang.clickToAddText,l.on("blur",function(){$(".measuredraw-btn-popupremove").prop("disabled",!1),$(this).tooltip("hide");var t=e.popup._source,n=$(this).val();""===n||(t.properties.measure_text=n,t.properties.measure_form="",t.closePopup())})}}},_getDrawToolbar:function(e){var t;for(var n in this._drawControl._toolbars)if(t=this._drawControl._toolbars[n],t&&t._modes&&t._modes[e])return t._modes[e];return null},_deactivateAll:function(){var e=this._tools;for(var t in e)e[t].disable(),this.$container.find(".dropdown-menu li.active").removeClass("active");this._removeAlerts()},_removeAlerts:function(){var e=$(".alert");e.length&&(e.removeClass("notify-visible"),setTimeout(function(){e.remove()},500))},_onRowClick:function(e){var t="li"===e.target.tagName?$(e.target):$(e.target).parents("li"),n=t.data("geomType");return t.hasClass("active")?(t.removeClass("active"),this._tools[n].disable()):(this._deactivateAll(),t.toggleClass("active"),this._tools[n].enable(),setTimeout(function(){$(".leaflet-control-measuredraw .dropdown-menu").dropdown("toggle")},200)),!1},_createRow:function(e){var t="";"marker"==e.geomType&&(t='id="drawMarker"');var n=$("<li><a "+t+'><div><span class="drawicons '+e.cl+'"></span><span>'+e.label+"</span></div></a></li>");n.data("geomType",e.geomType),n.on("click",this.__onRowClick);var a=L.Draw[utils.capitalize(e.geomType)],i=new a(this.map,this._drawControl.options.draw[e.geomType]);i.options.shapeOptions=i.options.shapeOptions||{};var o={};switch(e.geomType){case"polyline":o=this.options.stylePolyline;break;default:o=this.options.stylePolygon}return $.extend(i.options.shapeOptions,o),this._tools[e.geomType]=i,n},_createBtn:function(){var e=[{label:this.lang.drawPoint,cl:"leaflet-draw-draw-marker",geomType:"marker"},{label:this.lang.drawLine,cl:"leaflet-draw-draw-polyline",geomType:"polyline"},{label:this.lang.drawPolygon,cl:"leaflet-draw-draw-polygon",geomType:"polygon"},{label:this.lang.drawCircle,cl:"leaflet-draw-draw-circle",geomType:"circle"},{label:this.lang.drawRectangle,cl:"leaflet-draw-draw-rectangle",geomType:"rectangle"}],t=$('<div class="btn-group"><button type="button" title="'+this.lang.btnTitle+'" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><svg class="fa leaflet-draw-draw-marker measuredraw-btntoggle-image" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" version="1.1" y="0" x="0" enable-background="new 0 0 100 100" viewBox="0 0 100 100"><style>.s0{fill:#4d4d4d;}.s1{fill:#666;stroke-width:2;stroke:#fff;}</style><path d="m51.1 28.2-2.8-2.9-18.9-18.8c-1.9-2-5.2-2-7.2 0l-15.7 15.7c-2 2-2 5.2 0 7.2l2.5 2.5 11.5-11.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-11.5 11.5 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8" fill="#4d4d4d"/><path d="m7.5 74.9c-1.4 1.4-2.5 4.1-2.5 6.1v10.5 3.5h14.1c1.9 0 4.7-1.1 6-2.5l68.9-68.9c1.4-1.4 1.4-3.6 0-5l-12.6-12.6c-1.4-1.3-3.7-1.3-5 0.1l-68.9 68.8z" fill="#b3b3b3"/><path d="m71.8 48.9-0.9 0.9-22 22 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8 7.5-7.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-7.5 7.5 4.8 4.8 11.5-11.5c0.4-0.4 1.2-0.4 1.6 0s0.4 1.2 0 1.6l-11.5 11.5 2.5 2.5c2 2 5.2 2 7.2 0l15.7-15.7c2-2 2-5.2 0-7.2l-21.7-21.7z" fill="#4d4d4d"/><path d="m79.7 11.4-69.5 68.3" class="s1"/><path d="m84.3 15.9-69.5 68.2" class="s1"/><path d="m88.6 20.6-69.5 68.2" class="s1"/><style xmlns="http://www.w3.org/1999/xhtml" type="text/css" charset="utf-8" class="firebugResetStyles">.firebugResetStyles {z-index: 2147483646 !important;top: 0 !important;left: 0 !important;display: block !important;border: 0 none !important;margin: 0 !important;padding: 0 !important;outline: 0 !important;min-width: 0 !important;max-width: none !important;min-height: 0 !important;max-height: none !important;position: fixed !important;transform: rotate(0deg) !important;transform-origin: 50% 50% !important;border-radius: 0 !important;box-shadow: none !important;background: transparent none !important;pointer-events: none !important;white-space: normal !important;}style.firebugResetStyles {display: none !important;}.firebugBlockBackgroundColor {background-color: transparent !important;}.firebugResetStyles:before, .firebugResetStyles:after {content: &quot;&quot;!important;}.firebugCanvas {display: none !important;}.firebugLayoutBox {width: auto !important;position: static !important;}.firebugLayoutBoxOffset {opacity: 0.8 !important;position: fixed !important;}.firebugLayoutLine {opacity: 0.4 !important;background-color: #000000 !important;}.firebugLayoutLineLeft, .firebugLayoutLineRight {width: 1px !important;height: 100% !important;}.firebugLayoutLineTop, .firebugLayoutLineBottom {width: 100% !important;height: 1px !important;}.firebugLayoutLineTop {margin-top: -1px !important;border-top: 1px solid #999999 !important;}.firebugLayoutLineRight {border-right: 1px solid #999999 !important;}.firebugLayoutLineBottom {border-bottom: 1px solid #999999 !important;}.firebugLayoutLineLeft {margin-left: -1px !important;border-left: 1px solid #999999 !important;}.firebugLayoutBoxParent {border-top: 0 none !important;border-right: 1px dashed #E00 !important;border-bottom: 1px dashed #E00 !important;border-left: 0 none !important;position: fixed !important;width: auto !important;}.firebugRuler{position: absolute !important;}.firebugRulerH {top: -15px !important;left: 0 !important;width: 100% !important;height: 14px !important;background: url(&quot;data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%13%88%00%00%00%0E%08%02%00%00%00L%25a%0A%00%00%00%04gAMA%00%00%D6%D8%D4OX2%00%00%00%19tEXtSoftware%00Adobe%20ImageReadyq%C9e%3C%00%00%04%F8IDATx%DA%EC%DD%D1n%E2%3A%00E%D1%80%F8%FF%EF%E2%AF2%95%D0D4%0E%C1%14%B0%8Fa-%E9%3E%CC%9C%87n%B9%81%A6W0%1C%A6i%9A%E7y%0As8%1CT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AATE9%FE%FCw%3E%9F%AF%2B%2F%BA%97%FDT%1D~K(%5C%9D%D5%EA%1B%5C%86%B5%A9%BDU%B5y%80%ED%AB*%03%FAV9%AB%E1%CEj%E7%82%EF%FB%18%BC%AEJ8%AB%FA&apos;%D2%BEU9%D7U%ECc0%E1%A2r%5DynwVi%CFW%7F%BB%17%7Dy%EACU%CD%0E%F0%FA%3BX%FEbV%FEM%9B%2B%AD%BE%AA%E5%95v%AB%AA%E3E5%DCu%15rV9%07%B5%7F%B5w%FCm%BA%BE%AA%FBY%3D%14%F0%EE%C7%60%0EU%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5JU%88%D3%F5%1F%AE%DF%3B%1B%F2%3E%DAUCNa%F92%D02%AC%7Dm%F9%3A%D4%F2%8B6%AE*%BF%5C%C2Ym~9g5%D0Y%95%17%7C%C8c%B0%7C%18%26%9CU%CD%13i%F7%AA%90%B3Z%7D%95%B4%C7%60%E6E%B5%BC%05%B4%FBY%95U%9E%DB%FD%1C%FC%E0%9F%83%7F%BE%17%7DkjMU%E3%03%AC%7CWj%DF%83%9An%BCG%AE%F1%95%96yQ%0Dq%5Dy%00%3Et%B5&apos;%FC6%5DS%95pV%95%01%81%FF&apos;%07%00%00%00%00%00%00%00%00%00%F8x%C7%F0%BE%9COp%5D%C9%7C%AD%E7%E6%EBV%FB%1E%E0(%07%E5%AC%C6%3A%ABi%9C%8F%C6%0E9%AB%C0&apos;%D2%8E%9F%F99%D0E%B5%99%14%F5%0D%CD%7F%24%C6%DEH%B8%E9rV%DFs%DB%D0%F7%00k%FE%1D%84%84%83J%B8%E3%BA%FB%EF%20%84%1C%D7%AD%B0%8E%D7U%C8Y%05%1E%D4t%EF%AD%95Q%BF8w%BF%E9%0A%BF%EB%03%00%00%00%00%00%00%00%00%00%B8vJ%8E%BB%F5%B1u%8Cx%80%E1o%5E%CA9%AB%CB%CB%8E%03%DF%1D%B7T%25%9C%D5(%EFJM8%AB%CC&apos;%D2%B2*%A4s%E7c6%FB%3E%FA%A2%1E%80~%0E%3E%DA%10x%5D%95Uig%15u%15%ED%7C%14%B6%87%A1%3B%FCo8%A8%D8o%D3%ADO%01%EDx%83%1A~%1B%9FpP%A3%DC%C6&apos;%9C%95gK%00%00%00%00%00%00%00%00%00%20%D9%C9%11%D0%C0%40%AF%3F%EE%EE%92%94%D6%16X%B5%BCMH%15%2F%BF%D4%A7%C87%F1%8E%F2%81%AE%AAvzr%DA2%ABV%17%7C%E63%83%E7I%DC%C6%0Bs%1B%EF6%1E%00%00%00%00%00%00%00%00%00%80cr%9CW%FF%7F%C6%01%0E%F1%CE%A5%84%B3%CA%BC%E0%CB%AA%84%CE%F9%BF)%EC%13%08WU%AE%AB%B1%AE%2BO%EC%8E%CBYe%FE%8CN%ABr%5Dy%60~%CFA%0D%F4%AE%D4%BE%C75%CA%EDVB%EA(%B7%F1%09g%E5%D9%12%00%00%00%00%00%00%00%00%00H%F6%EB%13S%E7y%5E%5E%FB%98%F0%22%D1%B2&apos;%A7%F0%92%B1%BC%24z3%AC%7Dm%60%D5%92%B4%7CEUO%5E%F0%AA*%3BU%B9%AE%3E%A0j%94%07%A0%C7%A0%AB%FD%B5%3F%A0%F7%03T%3Dy%D7%F7%D6%D4%C0%AAU%D2%E6%DFt%3F%A8%CC%AA%F2%86%B9%D7%F5%1F%18%E6%01%F8%CC%D5%9E%F0%F3z%88%AA%90%EF%20%00%00%00%00%00%00%00%00%00%C0%A6%D3%EA%CFi%AFb%2C%7BB%0A%2B%C3%1A%D7%06V%D5%07%A8r%5D%3D%D9%A6%CAu%F5%25%CF%A2%99%97zNX%60%95%AB%5DUZ%D5%FBR%03%AB%1C%D4k%9F%3F%BB%5C%FF%81a%AE%AB&apos;%7F%F3%EA%FE%F3z%94%AA%D8%DF%5B%01%00%00%00%00%00%00%00%00%00%8E%FB%F3%F2%B1%1B%8DWU%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*UiU%C7%BBe%E7%F3%B9%CB%AAJ%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5J%95*U%AAT%A9R%A5*%AAj%FD%C6%D4%5Eo%90%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5%86%AF%1B%9F%98%DA%EBm%BBV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%ADV%AB%D5j%B5Z%AD%D6%E4%F58%01%00%00%00%00%00%00%00%00%00%00%00%00%00%40%85%7F%02%0C%008%C2%D0H%16j%8FX%00%00%00%00IEND%AEB%60%82&quot;) repeat-x !important;border-top: 1px solid #BBBBBB !important;border-right: 1px dashed #BBBBBB !important;border-bottom: 1px solid #000000 !important;}.firebugRulerV {top: 0 !important;left: -15px !important;width: 14px !important;height: 100% !important;background: url(&quot;data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0E%00%00%13%88%08%02%00%00%00%0E%F5%CB%10%00%00%00%04gAMA%00%00%D6%D8%D4OX2%00%00%00%19tEXtSoftware%00Adobe%20ImageReadyq%C9e%3C%00%00%06~IDATx%DA%EC%DD%D1v%A20%14%40Qt%F1%FF%FF%E4%97%D9%07%3BT%19%92%DC%40(%90%EEy%9A5%CB%B6%E8%F6%9Ac%A4%CC0%84%FF%DC%9E%CF%E7%E3%F1%88%DE4%F8%5D%C7%9F%2F%BA%DD%5E%7FI%7D%F18%DDn%BA%C5%FB%DF%97%BFk%F2%10%FF%FD%B4%F2M%A7%FB%FD%FD%B3%22%07p%8F%3F%AE%E3%F4S%8A%8F%40%EEq%9D%BE8D%F0%0EY%A1Uq%B7%EA%1F%81%88V%E8X%3F%B4%CEy%B7h%D1%A2E%EBohU%FC%D9%AF2fO%8BBeD%BE%F7X%0C%97%A4%D6b7%2Ck%A5%12%E3%9B%60v%B7r%C7%1AI%8C%BD%2B%23r%00c0%B2v%9B%AD%CA%26%0C%1Ek%05A%FD%93%D0%2B%A1u%8B%16-%95q%5Ce%DCSO%8E%E4M%23%8B%F7%C2%FE%40%BB%BD%8C%FC%8A%B5V%EBu%40%F9%3B%A72%FA%AE%8C%D4%01%CC%B5%DA%13%9CB%AB%E2I%18%24%B0n%A9%0CZ*Ce%9C%A22%8E%D8NJ%1E%EB%FF%8F%AE%CAP%19*%C3%BAEKe%AC%D1%AAX%8C*%DEH%8F%C5W%A1e%AD%D4%B7%5C%5B%19%C5%DB%0D%EF%9F%19%1D%7B%5E%86%BD%0C%95%A12%AC%5B*%83%96%CAP%19%F62T%86%CAP%19*%83%96%CA%B8Xe%BC%FE)T%19%A1%17xg%7F%DA%CBP%19*%C3%BA%A52T%86%CAP%19%F62T%86%CA%B0n%A9%0CZ%1DV%C6%3D%F3%FCH%DE%B4%B8~%7F%5CZc%F1%D6%1F%AF%84%F9%0F6%E6%EBVt9%0E~%BEr%AF%23%B0%97%A12T%86%CAP%19%B4T%86%CA%B8Re%D8%CBP%19*%C3%BA%A52huX%19%AE%CA%E5%BC%0C%7B%19*CeX%B7h%A9%0C%95%E1%BC%0C%7B%19*CeX%B7T%06%AD%CB%5E%95%2B%BF.%8F%C5%97%D5%E4%7B%EE%82%D6%FB%CF-%9C%FD%B9%CF%3By%7B%19%F62T%86%CA%B0n%D1R%19*%A3%D3%CA%B0%97%A12T%86uKe%D0%EA%B02*%3F1%99%5DB%2B%A4%B5%F8%3A%7C%BA%2B%8Co%7D%5C%EDe%A8%0C%95a%DDR%19%B4T%C66%82fA%B2%ED%DA%9FC%FC%17GZ%06%C9%E1%B3%E5%2C%1A%9FoiB%EB%96%CA%A0%D5qe4%7B%7D%FD%85%F7%5B%ED_%E0s%07%F0k%951%ECr%0D%B5C%D7-g%D1%A8%0C%EB%96%CA%A0%A52T%C6)*%C3%5E%86%CAP%19%D6-%95A%EB*%95q%F8%BB%E3%F9%AB%F6%E21%ACZ%B7%22%B7%9B%3F%02%85%CB%A2%5B%B7%BA%5E%B7%9C%97%E1%BC%0C%EB%16-%95%A12z%AC%0C%BFc%A22T%86uKe%D0%EA%B02V%DD%AD%8A%2B%8CWhe%5E%AF%CF%F5%3B%26%CE%CBh%5C%19%CE%CB%B0%F3%A4%095%A1%CAP%19*Ce%A8%0C%3BO*Ce%A8%0C%95%A12%3A%AD%8C%0A%82%7B%F0v%1F%2FD%A9%5B%9F%EE%EA%26%AF%03%CA%DF9%7B%19*Ce%A8%0C%95%A12T%86%CA%B8Ze%D8%CBP%19*Ce%A8%0C%95%D1ae%EC%F7%89I%E1%B4%D7M%D7P%8BjU%5C%BB%3E%F2%20%D8%CBP%19*Ce%A8%0C%95%A12T%C6%D5*%C3%5E%86%CAP%19*Ce%B4O%07%7B%F0W%7Bw%1C%7C%1A%8C%B3%3B%D1%EE%AA%5C%D6-%EBV%83%80%5E%D0%CA%10%5CU%2BD%E07YU%86%CAP%19*%E3%9A%95%91%D9%A0%C8%AD%5B%EDv%9E%82%FFKOee%E4%8FUe%A8%0C%95%A12T%C6%1F%A9%8C%C8%3D%5B%A5%15%FD%14%22r%E7B%9F%17l%F8%BF%ED%EAf%2B%7F%CF%ECe%D8%CBP%19*Ce%A8%0C%95%E1%93~%7B%19%F62T%86%CAP%19*Ce%A8%0C%E7%13%DA%CBP%19*Ce%A8%0CZf%8B%16-Z%B4h%D1R%19f%8B%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1%A2%A52%CC%16-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2EKe%98-Z%B4h%D1%A2EKe%D02%5B%B4h%D1%A2EKe%D02%5B%B4h%D1%A2E%8B%96%CA0%5B%B4h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%16-%95a%B6h%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-Z*%C3l%D1%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z%B4T%86%D9%A2E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4h%A9%0C%B3E%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%D1R%19f%8B%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1%A2%A52%CC%16-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2EKe%98-Z%B4h%D1%A2EKe%D02%5B%B4h%D1%A2EKe%D02%5B%B4h%D1%A2E%8B%96%CA0%5B%B4h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%16-%95a%B6h%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-Z*%C3l%D1%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z%B4T%86%D9%A2E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4h%A9%0C%B3E%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%A9%0CZf%8B%16-Z%B4h%D1R%19f%8B%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1R%19%B4%CC%16-Z%B4h%D1%A2%A52%CC%16-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2%A52h%99-Z%B4h%D1%A2EKe%98-Z%B4h%D1%A2EKe%D02%5B%B4h%D1%A2EKe%D02%5B%B4h%D1%A2E%8B%96%CA0%5B%B4h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%96%CA%A0e%B6h%D1%A2E%8B%16-%95a%B6h%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-%95A%CBl%D1%A2E%8B%16-Z*%C3l%D1%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z*%83%96%D9%A2E%8B%16-Z%B4T%86%D9%A2E%8B%16-Z%B4T%06-%B3E%8B%16-Z%B4%AE%A4%F5%25%C0%00%DE%BF%5C&apos;%0F%DA%B8q%00%00%00%00IEND%AEB%60%82&quot;) repeat-y !important;border-left: 1px solid #BBBBBB !important;border-right: 1px solid #000000 !important;border-bottom: 1px dashed #BBBBBB !important;}.overflowRulerX &gt;.firebugRulerV {left: 0 !important;}.overflowRulerY &gt;.firebugRulerH {top: 0 !important;}.fbProxyElement {position: fixed !important;pointer-events: auto !important;}</style></svg></button><ul class="dropdown-menu" role="menu"></ul></div>');

utils.getBrowser().ie&&t.find(".measuredraw-btntoggle-image").css({"background-position":"-120px 0"});for(var n,a,i=t.find(".dropdown-menu"),o=0,s=e.length;s>o;o++)a=e[o],n=this._createRow(a),i.append(n);return this.$container.append(t),t}}),L.control.measureDraw=function(e){return new L.Control.MeasureDraw(e)},L.Draw.Polyline.addInitHook(function(){this._vertexChanged=function(e,t){this._updateFinishHandler(),this._updateRunningMeasure(e,t),this._clearGuides(),this._updateTooltip(),this._map.fire("draw:vertexchanged",{latlng:e})}}),L.Control.MalmoHeader=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-MalmoHeader"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container);var t='<!--[if IE]><meta content="IE=edge" http-equiv="X-UA-Compatible" /><![endif]-->    <!--[if lte IE 8]><script src="//assets.malmo.se/external/v4/html5shiv-printshiv.js" type="text/javascript"></script><![endif]-->    <link href="//assets.malmo.se/external/v4/masthead_standalone.css" media="all" rel="stylesheet" type="text/css"/>    <!--[if lte IE 8]><link href="//assets.malmo.se/external/v4/legacy/ie8.css" media="all" rel="stylesheet" type="text/css"/><![endif]-->    <noscript><link href="//assets.malmo.se/external/v4/icons.fallback.css" rel="stylesheet"></noscript>    <link rel="icon" type="image/x-icon" href="//assets.malmo.se/external/v4/favicon.ico" />';return $("head").prepend(t),$("body").addClass("mf-v4 no-footer"),$("body").append('<script src="//assets.malmo.se/external/v4/masthead_standalone_without_jquery.js"></script>'),this._container},onRemove:function(){$("#malmo-masthead").remove()}}),L.control.malmoHeader=function(e){return new L.Control.MalmoHeader(e)},L.Control.KristianstadHeader=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-KristianstadHeader"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container);var t='<!--[if IE]><meta content="IE=edge" http-equiv="X-UA-Compatible" /><![endif]-->    <!--[if lte IE 8]><script src="v4/html5shiv-printshiv.js" type="text/javascript"></script><![endif]-->    <link href="v4/masthead_standalone.css" media="all" rel="stylesheet" type="text/css"/>    <!--[if lte IE 8]><link href="v4/ie8.css" media="all" rel="stylesheet" type="text/css"/><![endif]-->    <noscript><link href="v4/icons.fallback.css" rel="stylesheet"></noscript>    <link rel="icon" type="image/x-icon" href="http://kartor.kristianstad.se/kkarta4/img/favicon.png" />';return $("head").prepend(t),$("body").addClass("mf-v4 no-footer"),$("body").append('<script src="v4/masthead_standalone_without_jquery.js"></script>'),this._container},onRemove:function(){$("#malmo-masthead").remove()}}),L.control.kristianstadHeader=function(e){return new L.Control.KristianstadHeader(e)},L.Control.Menu=L.Control.extend({options:{position:"topright",btnID:"my-btn"},_lang:{sv:{caption:"Exempeltext som jag ändrar"},en:{caption:"Share position link"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Menu"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createMenu();var t="";return this.options.btnID&&(t=this.options.btnID),this.addButton(t,"My button","fa fa-link",function(){return!1}),this._container},addButton:function(e,t,n,a,i){i=i||{};var o=e||"",s=$('<li><a id="'+o+'" href="btn btn-default"><span class="'+n+'"></span> '+t+"</a></li>");i.proxy&&(a=$.proxy(a,i.proxy)),s.on("click",a),$("#btns").append(s),i.callback&&i.callback(s)},_createMenu:function(){var e=$('<header id="smap-menu-div" class="navbar navbar-static-top bs-docs-nav" role="banner"><div class="container"><div class="navbar-header">    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">      <span class="sr-only">Toggle navigation</span>      <span class="fa fa-bars"></span>    </button><a class="navbar-brand" href="#">Stadsatlas</a>  </div>  <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">    <ul id="btns" class="nav navbar-nav navbar-right">    </ul>  </nav></div></header>');$("#maindiv").prepend(e)},onRemove:function(){}}),L.control.menu=function(e){return new L.Control.Menu(e)},L.Control.Opacity=L.Control.extend({options:{position:"bottomright",addToMenu:!1},_lang:{sv:{caption:"Ändra genomskinlighet på lager",close:"Stäng",collapsebtn:"visa/dölj lagerlista",btntitle:"Justera transparens",prefTxt:"Spara inställningar"},en:{caption:"Transparency tool",close:"Close",collapsebtn:"show/hide layers",btntitle:"Adjust transparency",prefTxt:"Save settings"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){var t=this;return t.allNamesInGui=[],e.on("layeradd layerremove",function(e){if(e.layer.options&&e.layer.options.layerId&&!e.layer.feature){var n=e.layer.options.layerId;if(-1==$.inArray(n,t.allNamesInGui))t.allNamesInGui.push(n);else if("layerremove"===e.type){var a=$.inArray(n,t.allNamesInGui);t.allNamesInGui.splice(a,1),$("#op-rowsdiv").find("#"+n).remove()}}}),t._container=L.DomUtil.create("div","leaflet-control-Opacity"),L.DomEvent.disableClickPropagation(t._container),t.$container=$(t._container),t._createBtn(),t._container},_setOp100:function(){if(L.Control.Opacity.prototype.SliderList&&L.Control.Opacity.prototype.SliderList.length>0)for(var e=0;e<L.Control.Opacity.prototype.SliderList.length;e++)L.Control.Opacity.prototype.SliderList[e].slider("setValue",100,!1,!0)},_addLayers:function(e){L.Control.Opacity.prototype.SliderList=[];var t=$("<div class='op-opdiv'><button style='display:none;' id='op-collapsebtn' type='button' class='btn' data-toggle='collapse' data-target='#op-rowsdiv'>"+this.lang.collapsebtn+"</button><div id='op-rowsdiv' class='collapse in'></div></div>"),n=t.children("#op-rowsdiv");return a=0,$.each(e,function(){var e=smap.core.layerInst._getLayer(this);if(null!=e&&"measurelayer"!=e.options.layerId&&("undefined"==typeof e.options.isMultipleBaseLayer||null===e.options.isMultipleBaseLayer&&e.options.isMultipleBaseLayer!==!0)){var t=null!=e.options.opacity?e.options.opacity:1,i=Math.round(100*t),o=$("<div class='op-rows' id='"+e.options.layerId+"' ><span class='op-mapname'>"+e.options.displayName+"</span><input class='op-sliderdiv' data-slider-tooltip='hide'data-slider-id='slider"+a+"' type='text' data-slider-min='0' data-slider-max='100' data-slider-value='"+i+"' data-slider-step='1'/><span class='op-values'>"+i+"</span>"),s=o.children("input").slider();L.Control.Opacity.prototype.SliderList.push(s),s.on("change",function(e){var t=$(this).closest("div.op-rows"),n=t.get(0).id,a=smap.core.layerInst._getLayer(n);if(a&&a.options&&a.options.mergeLayers&&a.options.mergeLayers.length>0&&smap.cmd.mergeLayers&&smap.cmd.mergeLayers.mergeLayers)for(mglg in smap.cmd.mergeLayers.mergeLayers)if(mglg.split("_mergedLayer_")[1]===n){var i=smap.core.layerInst._getLayer(mglg);i.setOpacity?i.setOpacity(e.value.newValue/100):i.options.style&&i.setStyle({opacity:e.value.newValue/100,fillOpacity:e.value.newValue/100}),t.children("span.op-values").text(e.value.newValue)}var i=smap.core.layerInst._getLayer(n);i.setOpacity?i.setOpacity(e.value.newValue/100):i.options.style&&i.setStyle({opacity:e.value.newValue/100,fillOpacity:e.value.newValue/100}),t.children("span.op-values").text(e.value.newValue)}).on("slideStart",function(){$("#op-modal").addClass("op-modal-slideeffect")}).on("slideStop",function(){$("#op-modal").removeClass("op-modal-slideeffect")}),a+=1,n.append(o)}}),t},_onClose:function(){this.options.savePrefBox&&0==$("#op-prefs").is(":checked")&&$.each($("div.op-rows"),function(){smap.core.layerInst._getLayer(this.id).setOpacity?smap.core.layerInst._getLayer(this.id).setOpacity(1):theLyr.options.style&&theLyr.setStyle({opacity:1,fillOpacity:1}),$(this).children("span.op-values").text(100)})},activate:function(){var e=this,t=e._addLayers(e.allNamesInGui);if(!e._$dialog){if(e.options.savePrefBox&&1==e.options.savePrefBox)var n="<div id='op-prefdiv'><label for='op-prefs'>"+e.lang.prefTxt+"</label><input id='op-prefs' type='checkbox'  name='saveprefs' checked /></div><button type='button' class='btn btn-default' data-dismiss='modal'>"+this.lang.close+"</button>";else var n='<button id="_setOP100" class="btn btn-default" onclick="L.Control.Opacity.prototype._setOp100();">Sätt alla på 100</button><button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";e._$dialog=utils.drawDialog(e.lang.caption,t,n),e._$dialog.attr("id","op-modal"),$("#_setOP100").on("click",function(){e._setOp100()}),e._$dialog.on("hidden.bs.modal",function(){e._onClose(),e._$dialog.empty().remove(),e._$dialog=null})}e._$dialog.modal("show"),$(".modal-backdrop.fade.in")&&$(".modal-backdrop.fade.in").length>0&&($(".modal-backdrop.fade.in")[0].style.opacity=0)},_createBtn:function(){var e=this;if(e.options.addToMenu)smap.cmd.addToolButton("","fa fa-adjust",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-opacity-btn" title="'+e.lang.btntitle+'" class="btn btn-default"><span class="fa fa-opacity"><img class="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAAXNSR0IArs4c6QAAAHBJREFUKM+VkkEOgCAMBKfEh+nLqi+Tn+EBSCxYgT0BmexuaCWRddUDACoYSeqQLzR4kH0PTEnOxiua212CNx+pwSomNOJ3nOwWRl7Zb9VtgLVjeWtfduvH3HuV0QMcyUMM5q8AqKx/iNdRxYT+bfEDEF4eXRN1RNoAAAAASUVORK5CYII="></span></button>');t.on("click",function(){return e.activate(),!1}),e.$container.append(t)}},onRemove:function(){}}),L.control.opacity=function(e){return new L.Control.Opacity(e)},L.Control.Print=L.Control.extend({options:{position:"topleft",printUrl:"//localhost/print-servlet/print",compactConditions:!1},_lang:{sv:{caption:"Skriv ut",mTitle:"Skriv ut/Exportera",header:"Rubrik",tip_header:"Rubrik (valfritt)",descript:"Beskrivning",tip_descript:"Beskrivning (valfritt)",layout:"Pappersformat",resolution:"Upplösning",orientation:"Orientering",portrait:"Stående",landscape:"Liggande",create:"Skapa bild",close:"Stäng",loading:"Laddar…",processingPrint:"Skapar bild…",northarrow:"Nordpil",scale:"Skala",misc:"Övrigt",legend:"Teckenförklaring",couldNotLoadCapabilities:"Kan inte skriva ut/exportera. Fick inget/felaktigt svar från servern.",conditionsHeader:"Jag godkänner <span>användarvillkoren</span>",conditions:'För utdrag från kartan/flygfotot till tryck eller annan publicering, krävs tillstånd från Kristianstads kommun miljö- och samhällsbyggnadsförvaltningen. Vid frågor om tillstånd, användningsområden eller kartprodukter kontakta miljö- och samhällsbyggnadsförvaltningen kartförsäljning:<br>044-13 50 00 eller <a href="mailto:msf@kristianstad.se?subject=Best%E4lla karta">msf@kristianstad.se</a>.',conditionsTip:"För att kunna skriva ut måste du godkänna användarvillkoren.",confirm:"Kom ihåg mitt val"},en:{caption:"Print",mTitle:"Print/Export",header:"Rubrik",tip_header:"Header (optional)",descript:"Description",tip_descript:"Description (optional)",layout:"Layout",resolution:"Resolution",orientation:"Orientation",portrait:"Portrait",landscape:"landscape",create:"Create image",close:"Close",loading:"Loading…",processingPrint:"Creating image…",northarrow:"North arrow",scale:"Scale",misc:"Miscellaneous",legend:"Legend",couldNotLoadCapabilities:"Cannot print/export. Bad response from the server.",conditionsHeader:"I agree to these <span>terms</span>",conditions:'For excerpts from the map or aerial photo for commercial printing or other types of publication, permission is required from the City Planning Office. For questions about these terms or map products, please contact our sales office: <br> +46 40 34 24 35 or <a href="mailto:sbk.sma@malmo.se?subject=Best%E4lla karta">sbk.sma@malmo.se</a>.',conditionsTip:"To print you must agree to the user terms.",confirm:"Remember my choice"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Print"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._initPrint(),this._drawModal(),this._container},onRemove:function(){this._removeBtn(),this._destroyPrint()},_createBtn:function(){var e=this;this.$btn=$('<button id="smap-print-btn" title="'+e.lang.caption+'" class="btn btn-default"><span class="fa fa-print"></span></button>'),this.$btn.on("click touchstart",function(){return window.printRelatedPopup_closed_once=!1,e.show(),!1}),this.$container.append(this.$btn)},_removeBtn:function(){this.$btn.remove()},_initPrint:function(){function e(){smap.cmd.notify(t.lang.couldNotLoadCapabilities,"error",{parent:$(".modal-body")}),t._modal.off("shown.bs.modal",e)}var t=this;L.mapbox=L.mapbox||{TileLayer:L.Class.extend({})},this.printProvider=L.print.provider({method:"POST",url:this.options.printUrl,autoLoad:!0,copy:"© Geodatasamverkan, © Kristianstads kommun",layout:"A4_Portrait_NoArrow_NoBar",outputFormat:"pdf",map:this.map}),this.printProvider.on("printexception printsuccess",function(){var e=t._modal.find("button[type='submit']");e.button("reset"),smap.cmd.loading(!1)}),this.printProvider.on("oncapabilitiesloaderror",function(){t._modal&&($(".modal-body").length?e():t._modal.on("shown.bs.modal",e))}),this.printOptions={paperFormat:"A4",orientation:"Portrait",arrow:!1,scalebar:!1,dpi:96,legends:[]},this.printProvider.on("capabilitiesload",function(e){e.capabilities.printURL=e.capabilities.printURL.replace(/localhost:8080/g,"localhost").replace(document.domain,"localhost"),e.capabilities.createURL=e.capabilities.createURL.replace(/localhost:8080/g,"localhost").replace(document.domain,"localhost"),L.Control.Print.prototype._savedPrintCapabilities=e.capabilities})},_destroyPrint:function(){this.printProvider.destroy(),this.printProvider=null,this._modal.remove()},_getMercatorScaleForLat:function(){var e=this.map.getCenter().lat,t=this.printProvider._getScale(),n=1/Math.cos(e*Math.PI/180);return t=parseInt(Math.round(t/n))},_makeLegends:function(){var e,t,n,a,i=[],o=this.map._layers;for(lid in o)e=o[lid],a=e.options,!a||void 0!==a.printLegend&&a.printLegend===!1||(a.isBaseLayer?delete a.printLegend:a&&(a.printLegend||e instanceof L.TileLayer.WMS||e instanceof L.GeoJSON.WFS)&&(t=a.printLegend,t&&t.length||(t=-1===e._url.search(/\?/)?e._url+"?":e._url,t=t+"request=GetLegendGraphic&format=image/png&width=20&height=20&layer="+a.layers),t&&(n=a.displayName||"Unnamed layer"),i.push({name:n,icon:t})));var s=[{name:"Teckenförklaring",classes:i}];return s},_preprocessPrintOptions:function(e){var t={mapTitle:e.mapTitle,comment:e.comment,dpi:e.dpi,legends:this._makeLegends(),displayscale:this.lang.scale+" 1:",layout:[e.paperFormat,e.orientation,e.legend?"Legend":"NoLegend"].join("_")};return t},_preprocessLayers:function(){var e,t,n=this.map;for(e in n._layers){var a=n._layers[e];if(a.options&&a.options.layerId){if(t=smap.cmd.getLayerConfig(a.options.layerId),!t)continue;if(a instanceof L.NonTiledLayer.WMS&&!t.options.printLayer){var i=$.extend(!0,{},t.options);i.layerId+="1",t.options.printLayer={url:t.url,init:"L.TileLayer.WMS",options:i},a.options.printLayer=$.extend(!0,{},t.options.printLayer)}}}},print:function(e){if(!this.printProvider._capabilities)return!1;var t=this._modal.find("button[type='submit']");if(t.attr("data-loading-text",this.lang.processingPrint),t.button("loading"),smap.cmd.loading(!0),this._preprocessLayers(),document.getElementById("select_scale")){var n=document.getElementById("select_scale").value;this.options.currentScale=n}this.printProvider.print(e,this.options)},_drawModal:function(){var e=this,t="resources/PrintModal.html";document.URL.search(/\/dev.html/)>-1&&(t="plugins/Print/"+t);var n=L.Browser.touch?"tap":"click";$.get(t,function(t){t=utils.extractToHtml(t,e.lang),e._modal=utils.drawDialog(e.lang.mTitle,t,null,null,"LControlPrint");var a=e._modal.find(".print-conditions");e.conditionsCheckbox=e._modal.find('[name="conditions"]'),e.submitDiv=e._modal.find("#submitDiv");var i=e._modal.find("button[type=submit]"),o=e._modal.find("#conditionsLink span"),s=e._modal.find('[name="storeAnswer"]');if(e.options.compactConditions?("yes"===localStorage.getItem("smapConditionsAgreed")?(e.conditionsCheckbox.prop("checked",!0),s.prop({checked:!0,disabled:!1}),i.prop("disabled",!1)):e.conditionsCheckbox.prop("checked",!1),o.addClass("link"),s.change(function(){e._storeConditions(s.prop("checked"))}),s.next().on(n,function(){var e=$(this).prev();return e.prop("checked",!e.prop("checked")),!1}),a.hide(),o.on(n,function(){a.slideToggle(250)})):(o.append(":"),e._modal.find("#store").hide()),e.conditionsCheckbox.change(function(){e._setButtonState(e.conditionsCheckbox.prop("checked"))}),e.submitDiv.on(n,function(t){e.conditionsCheckbox.prop("checked")||(e.conditionsCheckbox=$("#printmodal").find('[name="conditions"]'),e.conditionsCheckbox.popover({content:e.lang.conditionsTip,trigger:"manual",placement:"right",animation:"false"}),e.conditionsCheckbox.popover("show"),t.stopPropagation(),e._modal.one(n,function(){e.conditionsCheckbox.popover("destroy")}))}),e._modal.attr("id","printmodal"),e._modal.addClass("printmodal"),e._modal.find("form").submit(function(){var t=utils.paramsStringToObject($(this).serialize(),!1);return t=e._preprocessPrintOptions(t),e.printProvider.setDpi(t.dpi),e.print(t),!1}),smap.event.trigger("smap:print:modaldrawn"),e._modal.find("[placeholder]").placeholder(),e.sprint_a3_responsive=e._modal.find("#sprint_a3"),e.sprint_a4_responsive=e._modal.find("#sprint_a4"),e.sprint_a5_responsive=e._modal.find("#sprint_a5"),e.sprint_portrait_responsive=e._modal.find("#sprint_portrait"),e.sprint_landscape_responsive=e._modal.find("#sprint_landscape"),e._print_adjust_selectScale=e._modal.find("#select_scale"),e.sprint_a3_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_a4_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_a5_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_portrait_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e.sprint_landscape_responsive.on("change",function(t){this.checked=!0,e._drawCaptureBox()}),e._print_adjust_selectScale.on("change",function(t){if(e._drawCaptureBox(),e._print_scale_header&&e._print_scale_header.options.length>0)for(var t=0;t<e._print_scale_header.options.length;t++)if(e._print_scale_header.options[t].value===e._print_adjust_selectScale[0].value){e._print_scale_header.options[t].selected=!0;break}}),e._modal.on("shown.bs.modal",function(){$("#select_scale_header")?$("#select_scale_header").hide():"",e._drawCaptureBox(),$("#printmodal")[0].style.opacity=1,window._print_scale_header_eventRegistered||$("#select_scale_header").on("change",$.proxy(function(){if(e._print_adjust_selectScale&&e._print_adjust_selectScale[0].options.length>0)for(var t=0;t<e._print_adjust_selectScale[0].options.length;t++)if(e._print_adjust_selectScale[0].options[t].value===e._print_scale_header.value){e._print_adjust_selectScale[0].options[t].selected=!0,e._drawCaptureBox();break}},e._print_scale_header)),window._print_scale_header_eventRegistered=!0,$("#modalDialogMinimizeID_LControlPrint").on("click touchstart",function(){"none"===$(".modal-body")[0].style.display?$("#select_scale_header")[0].style.display="table-row":$("#select_scale_header").hide()})}),e._modal.on("hidden.bs.modal",function(){e._removeCaptureBox(),"undefined"!=typeof window.popup_print&&null!==window.popup_print&&smap.map.removeLayer(window.popup_print),document.getElementById("anvandarvillkoren")&&(document.getElementById("anvandarvillkoren").style.display="table"),document.getElementById("conditions")&&(document.getElementById("conditions").style.display="none")}),e._print_adjust_left=e._modal.find("#print_adjust_left"),e._print_adjust_right=e._modal.find("#print_adjust_right"),e._print_adjust_plus=e._modal.find("#print_adjust_plus"),e._print_adjust_up=e._modal.find("#print_adjust_up"),e._print_adjust_down=e._modal.find("#print_adjust_down"),e._print_adjust_minus=e._modal.find("#print_adjust_minus"),e._print_adjust_left.on(n,function(e){smap.map.panBy([-100,0])}),e._print_adjust_right.on(n,function(e){smap.map.panBy([100,0])}),e._print_adjust_plus.on(n,function(e){$("#zoombar-plus").click()}),e._print_adjust_up.on(n,function(e){smap.map.panBy([0,-100])}),e._print_adjust_down.on(n,function(e){smap.map.panBy([0,100])}),e._print_adjust_minus.on(n,function(e){$("#zoombar-minus").click()}),e._print_minimize_alternative=e._modal.find("#minimize_alternative"),e._print_anvandarvillkoren=e._modal.find("#anvandarvillkoren"),e._print_conditions=e._modal.find("#conditions"),e._print_minimize_alternative.on(n,function(e){var t=L.Browser.touch?"tap":"click";"click"===t?window.setTimeout(function(){$("#modalDialogMinimizeID_LControlPrint").click(),$("#select_scale_header")[0].style.display="table-row"},200):"tap"===t&&window.setTimeout(function(){$("#modalDialogMinimizeID_LControlPrint").tap(),$("#select_scale_header")[0].style.display="table-row"},200)}),e._print_anvandarvillkoren.on(n,function(t){this.style.display="none",e._print_conditions[0].style.display="block"}),smap.map.on("zoomend",function(){if($("#printmodal").hasClass("in")&&document.getElementById("select_scale")){var e=document.getElementById("select_scale").value;0===e.length&&L.Control.Print.prototype._drawCaptureBox()}}),smap.map.on("dragend",function(){$("#printmodal").hasClass("in")&&L.Control.Print.prototype._drawCaptureBox()}),e._print_scale_header=document.createElement("select"),e._print_scale_header.id="select_scale_header",e._print_scale_header.style.width="35px",e._print_scale_header.style.height="32px",e._print_scale_header.style["float"]="right",e._print_scale_header.style.marginTop="-3px",e._print_scale_header.style.marginRight="3px",e._print_scale_header.style.display="table-row",e._print_scale_header.className="form-control",e._print_scale_header.style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAgCAYAAACYTcH3AAADKUlEQVR42s3YXWyLURgH8Ee2LD4yxkRGh4hvG8MYso52QzAShPiKuCCYjwvqgo0gvjLfJhPZDVN2oTapjrDYdJZITElEiMXH3LhAJIi13Szmf97+t7xpYlNtk/ckv3R71/f06TnPOc/ZKyLihlOwC+7AVlgBVbAe1kEN7IWdcJbyYRtUgA2y4Qb7Wc2+DrO/I1DE3zdAGeyHqXAJimEjyCFYDCmQA2NgKMyBETAc5sIEGMcOlPF8r5X3JoGFPw9jX5NgNF8z+Kr6zII0SIRMfqkLwm+rOo9G68EPXw4rYZXOUgbchwEdEA55TpSCGcAp98ALaID38BkaOZVqtE1gjnYwsTCIUz4f1nAEXsM3qIeJkAtX1A07ojhNqsVBX+aWWgTVTPpaeMY8ms4FoWV4VhSDiYdUBnITHsAerqD2YNTo5Kk3l8OSMD8wBrozYWN119W1yXAUnnIbyeMoFfCaCmQm36P9YUiYwZg41LMgWXddJeVJJuxt2MzVM4rT4gkO5jj3h3BaOmyB3dxP+jFpL8JDcMJa7j/tU2fmKCXpp6kwAsFYmHvF3FOs3FlVkjpgGUdP33rDYCZ4RwJnR2CaLNzyS7h0j8EHLle1uXXr4v6OpV0RgQS2MDfUsn0Odaw96hv3+secM7fXpqwIBHMe3nFE1PQcZKGdx3oV38n9HeUgM2gF/E+bwn3kMTziaJ+D08yFhUzUvzWzNiilTWK66pVkF15DdR3sTTIwNVfGsrIXMHf0bMyJzoJRp4TZgs7uO/xS4/KLO1S3/FJ9zSvOki9azenJbT8xSAL/FtNFAtul3C+NVS3yqa5VvofK/Uu+On3y0uGTTWFOc2BpVzbLx9pW+eFpk7ZQ1f+W5rst8qayJbBhhdHStJOeQYLJ1LYCgwRj1fYpgwSjKvt2owRjqAReAKVGCSZJO/oaJJgZsM8owQRqk0GCCdQmgwQTqE2GWtqqUN6LTKGM47konYfyBD4sUGed/rw+jYfyFP6/pK6N5NLOF7tPXjm80uDyydtQIZCGMq88ufxTe8yhPnwRnIAzfEpRwMctGTz4F/FxiY0H+EI+IlGnTdcfGqCd0GGmQbMAAAAASUVORK5CYII=)",e._print_scale_header.style.backgroundRepeat="no-repeat",e._print_modal_header=e._modal.find(".modal-header"),e._print_adjust_selectScale&&e._print_adjust_selectScale[0].options.length>0){for(b=0;b<e._print_adjust_selectScale[0].options.length;b+=1)option=document.createElement("option"),option.value=e._print_adjust_selectScale[0].options[b].value,option.text=e._print_adjust_selectScale[0].options[b].text,e._print_scale_header.appendChild(option);e._print_modal_header[0].appendChild(e._print_scale_header)}})},_setButtonState:function(e){var t=$("#printmodal").find("button[type=submit]"),n=$("#printmodal").find('[name="storeAnswer"]');t.prop("disabled",e?!1:!0),n.prop({disabled:e?!1:!0})},_storeConditions:function(e){if("undefined"!=typeof Storage){var t=localStorage.getItem("smapConditionsAgreed");if("yes"===t&&e)return!1;t&&!e?localStorage.removeItem("smapConditionsAgreed"):e&&localStorage.setItem("smapConditionsAgreed","yes")}},_loadCapabilities:function(){},show:function(){var e=this;this.printProvider._capabilities||this._loadCapabilities(),this._modal?this._modal.modal("show"):smap.event.off("smap:print:modaldrawn").on("smap:print:modaldrawn",function(){e._modal.modal("show")})},_drawCaptureBox:function(){this._removeCaptureBox();var e=function(){for(var e,t,n=smap.map,a=n.getBounds(),i=1e3*L.print.Provider.INCHES_PER_METER,o=L.Control.Print.prototype._savedPrintCapabilities.scales,s=a.getSouthWest(),l=a.getNorthEast(),r=(s.lat+l.lat)/2,p=L.latLng(r,s.lng),d=L.latLng(r,l.lng),c=p.distanceTo(d),m=n.getSize().x,u=c/m/1e3,h=(u||1e-6)*i*L.print.Provider.DPI,_=Number.POSITIVE_INFINITY,v=o.length;v--;)e=Math.abs(h-o[v].value),_>e&&(_=e,t=parseInt(o[v].value,10));return t},t=e();if(document.getElementById("select_scale")){var n=document.getElementById("select_scale").value;n.length>0&&(t=n)}var a=utils.projectLatLng(smap.map.getCenter(),"EPSG:3857"),i=0,o=0,s="noPrintID";document.getElementById("sprint_a3").checked===!0?document.getElementById("sprint_portrait").checked===!0?(i=297,o=420,s="A3_Portrait"):document.getElementById("sprint_landscape").checked===!0&&(i=420,o=297,s="A3_Landscale"):document.getElementById("sprint_a4").checked===!0?document.getElementById("sprint_portrait").checked===!0?(i=210,o=297,s="A4_Portrait"):document.getElementById("sprint_landscape").checked===!0&&(i=297,o=210,s="A4_Landscale"):document.getElementById("sprint_a5").checked===!0&&(document.getElementById("sprint_portrait").checked===!0?(i=148,o=210,s="A5_Portrait"):document.getElementById("sprint_landscape").checked===!0&&(i=210,o=148,s="A5_Landscale"));var l=i/1e3/2,r=o/1e3/2,p=21,d=13.5,c=20.5,m=utils.projectPoint(a.lng-(l-d/1e3)*t,a.lat-(r-c/1e3)*t,"EPSG:3857","EPSG:4326"),u=L.latLng(m[1],m[0]),h=utils.projectPoint(a.lng+(l-d/1e3)*t,a.lat+(r-p/1e3)*t,"EPSG:3857","EPSG:4326"),_=L.latLng(h[1],h[0]),v=L.latLngBounds(u,_);L.rectangle(v,{color:"#228B22",fillColor:"#90EE90",fillOpacity:.3,weight:7,layerId:s,_noprint:!0}).addTo(smap.map),"undefined"!=typeof window.popup_print&&null!==window.popup_print&&smap.map.removeLayer(window.popup_print),window.popup_print=L.popup({keepInView:!1}).setLatLng(smap.map.getCenter()).setContent("<p>Panorera eller zooma in/ut för att ändra utskriftsområde.</p>"),"undefined"!=typeof window.printRelatedPopup_closed_once&&null!==window.printRelatedPopup_closed_once?window.printRelatedPopup_closed_once||(window.popup_print.openOn(smap.map),window.popup_print._wrapper.style.background="rgba(255,255,255,0.2)",window.popup_print._closeButton.onclick=function(){"undefined"!=typeof window.printRelatedPopup_closed_once&&null!==window.printRelatedPopup_closed_once&&(window.printRelatedPopup_closed_once=!0)}):(window.popup_print.openOn(smap.map),window.popup_print._wrapper.style.background="rgba(255,255,255,0.2)",window.popup_print._closeButton.onclick=function(){"undefined"!=typeof window.printRelatedPopup_closed_once&&null!==window.printRelatedPopup_closed_once&&(window.printRelatedPopup_closed_once=!0)})},_removeCaptureBox:function(){for(v in smap.map._layers)smap.map._layers[v].options&&("A3_Portrait"===smap.map._layers[v].options.layerId||"A3_Landscale"===smap.map._layers[v].options.layerId||"A4_Portrait"===smap.map._layers[v].options.layerId||"A4_Landscale"===smap.map._layers[v].options.layerId||"A5_Portrait"===smap.map._layers[v].options.layerId||"A5_Landscale"===smap.map._layers[v].options.layerId)?smap.map.removeLayer(smap.map._layers[v]):""},hide:function(){this._modal.modal("hide")}}),L.control.Print=function(e){return new L.Control.Print(e)},L.Control.Printer=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-printer"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._container},onRemove:function(){}}),L.Control.RedirectClick=L.Control.extend({options:{position:"topright"},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this._lang=$.extend(!0,this._lang,this.options._lang),this.lang=this._lang?this._lang[e]:null)},initialize:function(e){this._lang={sv:{},en:{}},L.setOptions(this,e),this._setLang(e.langCode)},_setURL:function(e){var t=this;t.options.url=e?e||t.options.url:null},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-RedirectClick"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createButton(),this._container},addHooks:function(){this.map.on("click",this.onMapClick,this),L.Browser.touch?(this.staticTooltip=$('<div class="rclick-static-tooltip">'+this.lang.hoverText+"</div>"),$("#mapdiv").append(this.staticTooltip)):L.Browser.touch||(this._tooltip={},this._tooltip.text=this.lang.hoverText,this.tooltip=new L.Tooltip(this.map).updateContent(this._tooltip),this.map.on("mousemove mouseup",this._onMouseMove,this))},removeHooks:function(){this.map.off("click",this.onMapClick,this),this.tooltip&&(this.map.off("mousemove mouseup",this._onMouseMove,this),this.tooltip.dispose())},_projectEPSG:function(e){var t=new Proj4js.Proj("EPSG:4326"),n=new Proj4js.Proj("EPSG:3008"),a=(L.Proj,new Proj4js.Point(e.latlng.lng,e.latlng.lat));return Proj4js.transform(t,n,a),e.latlng.lat=a.x,e.latlng.lng=a.y,e},_onMouseMove:function(e){this.tooltip.updatePosition(e.latlng)},onMapClick:function(e){this.onDone(e),this._deactivate()},_createButton:function(){var e=this,t=$('<button title="'+this.lang.name+'" class="btn btn-default"><span class="'+this.options.btnClass+'"></span></button>');t.on("click touchstart",function(){return e.active&&e.active!==!1?(e._deactivate(),$("#mapdiv").focus(),e.active=!1):(e._deactivate(),e._activate(),e.active=!0),!1}),this.$btn=t,e.$container.append(t)},_activate:function(){return this.active?!1:(this._deactivateAll(),this.$btn.addClass("active"),this.$btn.blur(),void(this.options.url?(this.removeHooks(),this.addHooks(),$("#mapdiv").css({cursor:this.options.cursor})):(this._deactivate(),$("#mapdiv").focus(),utils.log("RedirectClick error: Redirect URL missing. Check config-file."))))},_deactivate:function(){this.active=!1,this.$btn.removeClass("active"),this.removeHooks(),this.staticTooltip&&this.staticTooltip.remove(),$("#mapdiv").css({cursor:""})},_deactivateAll:function(){for(var e=smap.cmd.getControls("RedirectClick"),t=0;t<e.length;t++)e[t]._deactivate()},onRemove:function(){this.$container.empty(),this.staticTooltip&&this.staticTooltip.remove()},onDone:function(e){var t=this,n=t.options.url,a=new proj4.Proj("EPSG:4326"),i=new proj4.Proj("EPSG:3008"),o={
x:e.latlng.lng,y:e.latlng.lat};this.staticTooltip&&this.staticTooltip.remove(),proj4.transform(a,i,o),n=n.replace(/\${x}/g,o.x).replace(/\${y}/g,o.y),window.open(n,this.lang.name)}}),L.control.redirectclick=function(e){return new L.Control.RedirectClick(e)},L.Control.Search=L.Control.extend({options:{whitespace:"%20",wsOrgProj:"EPSG:3006",pxDesktop:992,clearEntryAfterSearch:!1,funcSetPosition:function(){var e=smap.cmd.getControl("L.Control.LayerSwitcher");e||$("#smap-search-div").css("left","10px")},gui:!1,addToMenu:!1,zoom:15,iconOptions:$.extend({},(new L.Icon.Default).options,{iconUrl:L.Icon.Default.imagePath+"/marker-icon.png"}),source:null,acHeight:null,autoScrollAcOnRowNbr:2,acOptions:{items:100}},_lang:{sv:{search:"Sök adress",addressNotFound:"Den sökta adressen hittades inte",remove:"Ta bort"},en:{search:"Search address",addressNotFound:"The searched address was not found",remove:"Remove"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode);var t=this.options.funcSetPosition;t&&smap.event.on("smap.core.pluginsadded",function(){t()})},onAdd:function(e){function t(){this._cacheLayer(r,!1,this.options.wfsSearch),r.off("load",t)}var n=this;if(this.map=e,this._container=L.DomUtil.create("div","leaflet-control-search"),L.DomEvent.disableClickPropagation(this._container),this._searchLayer=L.layerGroup(),L.Control.Search.prototype._searchLayer=this._searchLayer,this.map.addLayer(this._searchLayer),(void 0===this.options.gui||this.options.gui===!0)&&(this.$container=$(this._container),this.$container.css("display","none"),this._makeSearchField(),this.map.on("click",this._blurSearch)),this.options.vectorSearch&&(this._cachedFeatures=this._cachedFeatures||{},this.map.on("layeradd",this._onLayerAdd,this),this.map.on("layerremove",this._onLayerRemove,this)),this.options.wfsSearch){this._cachedFeatures=this._cachedFeatures||{};var a=this.options.wfsSearch;this._setACOptions(a);var i,o;this._wfsLayerGroup=L.layerGroup();for(var s=0,l=a.layerIds.length;l>s;s++)if(i=smap.cmd.getLayerConfig(a.layerIds[s])){o=$.extend(!0,{},i),o.options.layerId+=1;var r=smap.core.layerInst._createLayer(o);this._initVectorSearch(r),this._wfsLayerGroup.addLayer(r),n.map.whenReady(function(){r._map=e,r.on("load",t,n),r._refresh({force:!0,bounds:!1}),r._map=null},1e3)}}return this.__onApplyParams=this.__onApplyParams||$.proxy(this._onApplyParams,this),smap.event.on("smap.core.applyparams",this.__onApplyParams),this.__onCreateParams=this.__onCreateParams||$.proxy(this._onCreateParams,this),smap.event.on("smap.core.createparams",this.__onCreateParams),$(".leaflet-top.leaflet-left").addClass("with-search-bar"),n._container},_blurSearch:function(){$(".smap-search-div input").blur()},onRemove:function(){smap.event.off("smap.core.applyparams",this.__onApplyParams),smap.event.off("smap.core.createparams",this.__onCreateParams),this.map.off("click",this._blurSearch),$(".leaflet-top.leaflet-left").removeClass("with-search-bar")},_onLayerAdd:function(e){var t=e.layer||{};t.options&&!t.options._silent&&t.options.layerId&&!t.feature&&this.options.vectorSearch&&$.inArray(t.options.layerId,this.options.vectorSearch.layerIds)>-1&&(this._setACOptions(this.options.vectorSearch),this._initVectorSearch(t))},_onLayerRemove:function(e){var t=e.layer||{};t.options&&!t.options._silent&&t.options.layerId&&!t.feature&&this.options.vectorSearch&&$.inArray(t.options.layerId,this.options.vectorSearch.layerIds)>-1&&this._cacheLayer(t,!0)},_cacheProperties:function(e,t,n){var a,i,o=[];i=$.extend(!0,{},{name:e[t[0]]}),o=[];for(var s=0,l=t.length;l>s;s++)a=e[t[s]],a&&a.length&&o.push(n[s]+"=="+a);return i.searchWords=o.join("&&"),i},_cacheLayer:function(e,t,n){t=t||!1,n=n||{},this._acVector=this._acVector||[];var a,i,o=[],s=this._cacheProperties,l=n.keyVals,r=this._acVector,p=[],d=[];for(var c in l)p.push(c),d.push(l[c]);e.eachLayer(function(e){a=e.feature.properties,i=s(a,p,d),r.splice(i),t||o.push(i)}),this._acVector=this._acVector.concat(o),$("#smap-search-div input").prop("disabled",!1)},_initVectorSearch:function(e){function t(){this._cacheLayer(e,!1,this.options.vectorSearch),e.off("load",t)}var n=e.options;return n?($("#smap-search-div input").prop("disabled",!0),void($.isEmptyObject(e._layers)?e.on("load",t,this):this._cacheLayer(e,!1,this.options.vectorSearch))):!1},_setACOptions:function(e){var t=this;for(var n in e.keyVals)break;var a=e.keyVals[n],i=e.suffix,o=this.options.suffix;this.options.typeaheadOptions=$.extend(!0,{},this.options.typeaheadOptions,{source:$.proxy(function(e,t){e=encodeURIComponent(e);var n=this.options.wsAcUrl;n?(this.options.whitespace&&(e=e.replace(/%20/g,this.options.whitespace)),this._proxyInst&&this._proxyInst.abort(),smap.cmd.loading(!0),this._proxyInst=$.ajax({type:"GET",url:this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(n+"?q=")+e:n+"?q="+e,dataType:"text",context:this,success:function(e){for(var n,a=e.split("\n"),i=[],o=0,s=a.length;s>o;o++)n=$.trim(a[o]),n.length&&i.push({name:n,searchWords:"Adress=="+n});i=this._acVector.concat(i),t(i)},error:function(){},complete:function(){smap.cmd.loading(!1)}})):t(this._acVector)},this),displayText:function(e){return e.searchWords},highlighter:function(e){for(var t,n={},a=e.split("&&"),i=0,o=a.length;o>i;i++)t=a[i].split("=="),n[t[0]]=t[1];var s="",i=0;for(var l in n)s+=0===i?'<div style="font-size:1.2em;">'+n[l]+"</div>":"<div><span>"+l+"</span>:&nbsp;<span>"+n[l]+"</span></div>",i++;return s},updater:function(e){for(var t,n={},s=e.searchWords.split("&&"),l=0,r=s.length;r>l;l++)t=s[l].split("=="),n[t[0]]=t[1];return n[a]?e.name+" "+i:e.name+" "+o},afterSelect:function(n){if(t._searchLayer.clearLayers(),t.options.clearEntryAfterSearch&&$(".smap-search-div input").val(null),encodeURIComponent(n).search(encodeURIComponent(o))>-1)n=$.trim(n.replace(o,"")),t._geoLocate(n,"");else if(encodeURIComponent(n).search(encodeURIComponent(i))>-1){n=$.trim(n.replace(i,""));for(var a in e.keyVals)break;var s,l,r,p,d=t.map;for(p in d._layers)if(s=d._layers[p],s._layers)for(r in s._layers)if(l=s._layers[r],l.feature&&l.feature.properties[a]===n){var c;return c=l.getLatLng?l.getLatLng():l.getBounds().getCenter(),d.setView(c,17),void d.fire("selected",{feature:l.feature,selectedFeatures:[l],layer:s,latLng:c,shiftKeyWasPressed:!1})}t._wfsLayerGroup.eachLayer(function(e){e.eachLayer(function(i){if(i.feature&&i.feature.properties[a]===n){t._searchLayer.addLayer(i),this.marker=i;var o;return o=i.getLatLng?i.getLatLng():i.getBounds().getCenter(),d.setView(o,17),void d.fire("selected",{feature:i.feature,selectedFeatures:[i],layer:e,latLng:o,shiftKeyWasPressed:!1})}})})}}});var s=$("#smap-search-div input");s.typeahead("destroy"),this._initAutoComplete(s)},_onApplyParams:function(e,t){if("undefined"!=typeof t.QL&&null!==t.QL&&"undefined"!=typeof t.QA&&null!==t.QA);else if(t.POI){var n=t.POI instanceof Array?t.POI[0]:t.POI;n=n.replace(/--c--/g,",");var a=t.POI instanceof Array&&t.POI.length>1?t.POI[1]:!1,i=!1,o=smap.core.paramInst.getWebParamsAsObject(),s=config.params,l=o.ZOOM||this.options.zoom;o.CENTER||(i=!0,!o.POI&&s.CENTER&&(i=!1,l=t.ZOOM)),this._geoLocate(decodeURIComponent(n),{setView:i,zoom:l,showPopup:a})}},_onCreateParams:function(e,t){if(this.marker&&this.marker.options.q){var n=this.marker.getPopup()._isOpen?!0:!1;t.poi=[encodeURIComponent(this.marker.options.q.replace(/,/g,"--c--"))],n&&t.poi.push(1)}},_rmAdressMarker:function(e){null!=e&&(this._searchLayer.removeLayer(e),this.addressMarker=null)},_makeSearchField:function(){function e(){var e=$(window).width();if(!(e>=a.options.pxDesktop)&&L.Browser.touch){var t=$("#smap-search-bg");t.length||(t=$('<div id="smap-search-bg" />'),i.addClass("search-active"),$("#mapdiv").append(t),setTimeout(function(){t.addClass("search-bg-visible")},1))}}function t(){var e=$(window).width();e>=a.options.pxDesktop||!L.Browser.touch||(i.removeClass("search-active"),$("#smap-search-bg").removeClass("search-bg-visible"),setTimeout(function(){$("#smap-search-bg").remove()},300))}function n(e){e.stopPropagation()}var a=this,i=$('<div id="smap-search-div" class="smap-search-div input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span><input id="searchInputDetact" autocorrect="off" autocomplete="off" data-provide="typeahead" type="text" class="form-control" placeholder="'+this.lang.search+'"></input></div>'),o=i.find("input");o.placeholder(),L.Browser.msTouch&&o.attr("pattern","[0-9]"),o.on("dblclick",n).on("mousedown",n).on("focus",function(){$(this).parent().addClass("smap-search-div-focused"),$("#mapdiv").trigger("touchstart"),e()}).on("blur",function(){$(this).parent().removeClass("smap-search-div-focused")}).on("touchstart",function(){$(this).focus()}),i.on("click touchstart",function(e){$(this).find("input").focus(),e.stopImmediatePropagation()}),o.on("blur",t),$("#maindiv").append(i),smap.event.on("smap.core.pluginsadded",function(){var e=$("#smap-menu-div nav");e.length&&i.addClass("smap-search-div-in-toolbar")});var s=this.options.whitespace,l=this.options._geoLocate||this._geoLocate,r={items:5,minLength:2,highlight:!0,hint:!0,afterSelect:function(e){return smap.cmd.loading(!0),l.call(a,e),t(),e}};$.extend(r,this.options.acOptions||{}),this.options.source?r.source=$.proxy(this.options.source,this):this.options.wsAcUrl?r.source=function(e,t){e=e.replace(/^\s+|\s+$/g,""),e=encodeURIComponent(e);var n=a.options.wsAcUrl;s&&(e=e.replace(/%20/g,s)),a._proxyInst&&a._proxyInst.abort(),a._proxyInst=$.ajax({type:"GET",url:a.options.useProxy?smap.config.ws.proxy+encodeURIComponent(n+"?q=")+e:n+"?q="+e,dataType:"text",success:function(e){var n=decodeURIComponent(e).replace(/^\s+|\s+$/g,"").split("\n");t(n)},error:function(){}})}:this.options.wsAcLocal&&this.options.wsAcLocal instanceof Array&&(r.source=this.options.wsAcLocal),this._initAutoComplete(o,r)},_initAutoComplete:function(e,t){t=t||this.options.typeaheadOptions;var n=this.options.autoScrollAcOnRowNbr;if(this._onKeyPress=this._onKeyPress||function(e){var t=38===e.which,a=40===e.which;if(t||a){var i=$(".typeahead.dropdown-menu li.active"),o=i.parent().find("li").length;if(t&&1===i.index()||a&&i.index()===o-1)i.parent().scrollTo($(".typeahead.dropdown-menu li:first"),0);else if(t&&0===i.index())i.parent().scrollTo($(".typeahead.dropdown-menu li:last"),0);else if(i.index()>=n){for(var s=i,l=0;n/2>l;l++)s=s.prev();s&&s.length&&i.parent().scrollTo(s,0)}}if("undefined"!=typeof e.which&&null!==e.which&&13===e.which){var r=document.getElementById("searchInputDetact").value;if(r.length>4&&isFinite(r.replace(/ /gi,"").replace(",","").replace(".",""))){r=r.replace(" ",",");var p=r.split(",")[0],d=r.split(",")[1],c=function(e,t){var n=L.latLng(e,t);"undefined"!=typeof L.Control.Search.prototype.marker&&null!==L.Control.Search.prototype.marker&&L.Control.Search.prototype._searchLayer.removeLayer(L.Control.Search.prototype.marker),L.Control.Search.prototype.marker=L.marker(n,{iconOptions:L.icon(L.Control.Search.prototype.options.iconOptions)}).addTo(L.Control.Search.prototype._searchLayer),L.Control.Search.prototype.marker.on("click touchstart",function(){L.Control.Search.prototype._searchLayer.clearLayers()}),smap.map.setView(n,smap.cmd.getControls("L.Control.Search")[0].options.zoom,{animate:!1})};if(p>180||d>180)if(6906693.7888>p&&p>6120098.8505&&223225.0217>d&&d>60857.4994){var m=utils.projectLatLng(L.latLng(p,d),"EPSG:3008","EPSG:4326",!1,!1);c(m.lat,m.lng)}else alert("Du är utanför kartområdet.\nKoordinat sökningen exempel:\n 1. För WGS 84 decimal (lat, lon) (GPS):\n 56.03079 14.15312\n Eller\n 56.03079,14.15312\n  2. För Sweref99 13 30 (X, Y):\n 6212180.214 190711.885\n Eller\n 6212180.214,190711.885\n");else p>55.11294&&57.38874>p&&d>11.86523&&17.20459>d?c(p,d):alert("Du är utanför kartområdet.\nKoordinat sökningen exempel:\n 1. För WGS 84 decimal (lat, lon) (GPS):\n 56.03079 14.15312\n Eller\n 56.03079,14.15312\n  2. För Sweref99 13 30 (X, Y):\n 6212180.214 190711.885\n Eller\n 6212180.214,190711.885\n")}}},e.off("keydown",this._onKeyPress).on("keydown",this._onKeyPress),e.typeahead(t),this.options.acHeight){var a=e.data("typeahead").$menu;a.css({"max-height":this.options.acHeight})}},_geoLocate:function(e,t){t=t||{};var n={setView:!0,showPopup:!0};t=$.extend({},n,t),this.options.qPattern&&(e=utils.extractToHtml(this.options.qPattern,{q:e}));var e=e.replace(/^\s+|\s+$/g,"");e=encodeURIComponent(e);var a=this.options.wsLocateUrl;if(this.options.useProxy){a=smap.config.ws.proxy+encodeURIComponent(a+"?q=")+e;var i=this.options.whitespace;i&&(a=a.replace(/%20/g,i))}else a=a+"?q="+e;var o={success:function(n){function a(){$("#smap-search-popupbtn").off("click").on("click",function(){return i._searchLayer.removeLayer(i.marker),i.marker=null,!1})}var i=this;if("undefined"!=typeof L.Control.Search.prototype.marker&&null!==L.Control.Search.prototype.marker&&(this.marker=L.Control.Search.prototype.marker),this.marker&&(this._searchLayer.removeLayer(this.marker),this.marker=null),!n.features.length)return void smap.cmd.notify(this.lang.addressNotFound,"error");var o=n.features[0].geometry.coordinates,s=L.latLng(o[1],o[0]),l="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==l){var r=window.proj4(this.options.wsOrgProj,l,[s.lng,s.lat]);s=L.latLng(r[1],r[0])}this.map.off("popupopen",a),this.map.on("popupopen",a),this.marker=L.marker(s,{iconOptions:L.icon(this.options.iconOptions)}).addTo(this._searchLayer),this.marker.options.q=e;var p=window.getQueryParameters("hideSDeleteButton");this.marker.bindPopup(p.length>0&&"true"===p?'<p class="lead">'+decodeURIComponent(e)+'</p><div><button style="display:none;" id="smap-search-popupbtn" class="btn btn-default btn-sm">'+this.lang.remove+"</button></div>":'<p class="lead">'+decodeURIComponent(e)+'</p><div><button id="smap-search-popupbtn" class="btn btn-default btn-sm">'+this.lang.remove+"</button></div>");var d=t.zoom||this.options.zoom;t.setView?this.map.setView(s,d,{animate:!1}):this.marker._popup.options.autoPan=!1,t.showPopup&&this.marker.openPopup(),L.Control.Search.prototype.marker=this.marker,window.searchLayerMarker_catch=this.marker,window.setTimeout(function(){window.searchLayerMarker_catch.closePopup(),window.searchLayerMarker_catch.openPopup();var e=window.getQueryParameters("hideSearchInfo");if(e.length>0)if("true"===e)window.searchLayerMarker_catch.closePopup();else{var t=window.getQueryParameters("hideSDeleteButton");t.length>0&&"true"===t&&($("#smap-search-popupbtn")[0].style.display="none")}else{var t=window.getQueryParameters("hideSDeleteButton");t.length>0&&"true"===t&&($("#smap-search-popupbtn")[0].style.display="none")}},300),this.options.clearEntryAfterSearch&&$(".smap-search-div input").val(null),$(".smap-search-div input").blur(),setTimeout(function(){$(".smap-search-div input").blur()},100)},complete:function(){smap.cmd.loading(!1)}};$.ajax({url:a,type:"GET",dataType:"json",context:this,success:this.options.onLocateSuccess||o.success,complete:o.complete})},CLASS_NAME:"L.Control.Search"}),L.control.search=function(e){return new L.Control.Search(e)},L.Control.SelectVector=L.Control.extend({options:{position:"bottomright",selectStyle:{weight:5,color:"#00FFFF",fillColor:"#00FFFF",opacity:1,fillOpacity:.5}},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_selectedFeatures:[],_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode);var t=this;this._onFeatureClick=function(e){var n=200;t._clickWasRegistered||(t.onFeatureClick(e),t._clickWasRegistered=!0,setTimeout(function(){t._clickWasRegistered=!1},n))}},activate:function(){this._active=!0},deactivate:function(){this._active=!1},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-selectvector"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),this._bindEvents(),this.activate(),this._container},onRemove:function(){this.map.off("layeradd",this._onLayerAdded),this.map.off("click",this._onMapClick),this.deactivate()},_bindEvents:function(){this._onLayerAdded=$.proxy(this.onLayerAdded,this),this._onLayerRemoved=$.proxy(this.onLayerRemoved,this),this._onMapClick=$.proxy(this.onMapClick,this),this.map.on("layeradd",this._onLayerAdded),this.map.on("layerremove",this._onLayerRemoved),this.map.on("click",this._onMapClick)},onMapClick:function(){this._selectedFeatures=[]},_vectorLayers:[],onLayerAdded:function(e){var t=this,n=e.layer,a=n.hasOwnProperty("_layers");a&&n.on&&(n.on("load",function(){var e=function(e){e.options=e.options||{},e.options.layerId=n.options.layerId,e.off("click",t._onFeatureClick),e.on("click",t._onFeatureClick)};this.eachLayer&&this.eachLayer(e),this.off("dblclick",t._onFeatureClick).on("dblclick",t._onFeatureClick)}),this._vectorLayers.push(n))},onLayerRemoved:function(e){if(e.layer.options&&e.layer.options.layerId){var t=e.layer.options.layerId;if(t&&e.layer._layers){var n=$.inArray(e.layer,this._vectorLayers);n>-1&&this._vectorLayers.splice(n,1)}}},_layerFromFeature:function(e,t){var n=t._layers;for(var a in n){var i=n[a];if(i.feature&&i.feature.id===e.id)return i}return null},unselect:function(e){var t=e.layerId,n=smap.cmd.getLayer(t),a=$.inArray(e,this._selectedFeatures);this._selectedFeatures.splice(a,1);var i=utils.getLayerFromFeature(e,n)||n;n.resetStyle.call(n,i),this._map.fire("unselected",{feature:e})},onFeatureClick:function(e){if(!this._active)return!1;var t=e.layer&&e.layer.feature?e.layer.feature:e.target.feature||e.target,n=e.originalEvent?e.originalEvent.shiftKey||!1:!1,a=e.target,i=a.options.layerId||e.layer.options.layerId,o=smap.core.layerInst._getLayer(i);if(n===!1&&(this._selectedFeatures=[],o&&o.resetStyle)){var s=o.resetStyle;o.eachLayer(function(e){s.call(o,e)});for(var l=this._vectorLayers,r=0,p=l.length;p>r;r++)c=l[r],c.resetStyle&&c!==o&&c.resetStyle(c)}var d=$.inArray(t,this._selectedFeatures);if(n===!0&&d>-1){this._selectedFeatures.splice(d,1),this._map.fire("unselected",{feature:t});var c=this._layerFromFeature(t,o);o.resetStyle.call(o,c)}else{if(t.layerId=i,t.uniqueKey=o&&o.options?o.options.uniqueKey:t.layerId,this._selectedFeatures.push(t),o){var m=this._layerFromFeature(t,o);m&&m.setStyle&&m.setStyle(o.options.selectStyle||this.options.selectStyle)}this._map.fire("selected",{feature:t,selectedFeatures:this._selectedFeatures,layer:o||t,latLng:e.latlng,shiftKeyWasPressed:e.originalEvent?e.originalEvent.shiftKey||!1:!1})}}}),L.control.selectVector=function(e){return new L.Control.SelectVector(e)},L.Control.SelectWMS=L.Control.extend({options:{wmsVersion:"1.3.0",info_format:"text/plain",maxFeatures:20,buffer:12,useProxy:!1},_layers:[],_selectedFeatures:[],initialize:function(e){L.setOptions(this,e)},onAdd:function(e){return this.map=e,this.activate(),this._container=L.DomUtil.create("div","leaflet-control-selectwms"),$(this._container).css("display","none"),L.DomEvent.disableClickPropagation(this._container),this._container},onRemove:function(){this.deactivate()},onSuccess:function(e){e=e||[];for(var t,n,a,i,o,s,l,r,p=0,d=e.length;d>p;p++)if(t=e[p],s=t[0],l=t[1],r=l.params,n=s.features,s)if(s.features){var a,i,o,n=s.features;if(!n.length)continue;for(var c=0,m=n.length;m>c;c++){if(a=n[c],i=smap.cmd.getLayerConfigBy("options.layers",r.layers)||smap.cmd.getLayerConfigBy("options.selectOptions.layers",r.layers),!i&&a.id){var u=a.id.split(".")[0];if(r.layers.search(u)>-1)for(var h=r.layers.split(","),_=0,v=h.length;v>_;_++)if(h[_].search(u)>-1){var g=h[_];i=smap.cmd.getLayerConfigBy("options.layers",g)||smap.cmd.getLayerConfigBy("options.selectOptions.layers",g)}}if(!i)break;o=i.options,o.selectOptions&&o.selectOptions.srs&&"EPSG:4326"!==o.selectOptions.srs&&utils.projectFeature(a,"EPSG:4326",{});var f=a.geometry.type;if("Point"===f||"MultiPoint"===f){var b=[];switch(f){case"Point":b=a.geometry.coordinates;break;case"MultiPoint":b=a.geometry.coordinates[0]}a.latLng=L.latLng([b[1],b[0]])}else a.latLng=l.latLng;a.options=$.extend({},o),n[c]=a}this._selectedFeatures=this._selectedFeatures.concat(n)}else{var y,k,w=l.latLng;for(var C in s){y=s[C];var A=C.split(":"),x=A[A.length-1],i=smap.cmd.getLayerConfigBy("layers",x,{inText:!0});if(i&&i.options&&i.options.layerId)for(var I=i.options.layerId,c=0,m=y.length;m>c;c++){k=y[c];var a={geometry:{coordinates:[w.lng,w.lat]},latLng:L.latLng([w.lat,w.lng]),properties:k,layerId:I,options:i.options};k&&$.isEmptyObject(k)===!1&&this._selectedFeatures.push(a)}}}this._selectedFeatures.length&&this.map.fire("selected",{layer:this,feature:this._selectedFeatures.length?this._selectedFeatures[0]:null,selectedFeatures:this._selectedFeatures})},_applyParam:function(e){var t,n,a,i,o,s=JSON.parse(decodeURIComponent(e)),l=[];for(n in s)a=s[n],a.xy&&(t=smap.core.layerInst.showLayer(n),l.push(t));i=a.xy&&a.xy.length?a.xy[0]:null,i&&(o=L.latLng(i[1],i[0]),this.onMapClick({latlng:o,_layers:l}))},onApplyParams:function(e,t){t.SEL&&this._applyParam(decodeURIComponent(t.SEL))},activate:function(){return this._active?!1:(this._active=!0,void this._bindEvents())},deactivate:function(){this._active=!1,this._unbindEvents()},_bindEvents:function(){this._onApplyParams=this._onApplyParams||$.proxy(this.onApplyParams,this),smap.event.on("smap.core.applyparams",this._onApplyParams),this.map.on("layeradd",this.onLayerAdd,this).on("layerremove",this.onLayerRemove,this).on("click",this.onMapClick,this).on("dblclick",this.onMapDblClick,this)},_unbindEvents:function(){smap.event.off("smap.core.applyparams",this._onApplyParams),this.map.off("layeradd",this.onLayerAdd,this).off("layerremove",this.onLayerRemove,this).off("click",this.onMapClick,this).off("dblclick",this.onMapDblClick,this)},onLayerAdd:function(e){var t=e.layer;this._layerShouldBeAdded(t)===!0&&this._layers.push(t)},onLayerRemove:function(e){var t=e.layer,n=this._hasLayer(t);n!==!1&&this._layers.splice(n,1)},onMapDblClick:function(){this._dblclickWasRegistered=!0,this.xhr&&this.xhr.abort(),setTimeout($.proxy(function(){this._dblclickWasRegistered=!1},this),400)},onMapClick:function(e){this._selectedFeatures=[];var t=e.latlng;this.xhr&&this.xhr.abort();var n=e._layers||this._layers;if(n.length){var a,i,o,s,l,r=this,p={},d=0;$.each(n,function(e,t){if(l=t.options||{},i=t._url||t._wmsUrl,o=i.toUpperCase()+"&randomversion="+Math.random(),p[o]){var n=p[o].selectOptions||{},a=l.selectOptions||{},c=n.info_format||r.options.info_format;s=c&&a.info_format&&c!==a.info_format,s&&(o+="_1")}p[o]={layerNames:[],url:i,wmsVersion:t._wmsVersion,layerId:l.layerId,selectOptions:l.selectOptions||{}},d+=1,p[o].layerNames.push(l.selectOptions&&l.selectOptions.layers?l.selectOptions.layers:l.layers)});var c;setTimeout($.proxy(function(){if(this._dblclickWasRegistered===!0);else{var e=[];for(var n in p){a=p[n],c=this._makeParams({layers:a.layerNames.join(","),version:a._wmsVersion||this.options.wmsVersion,info_format:a.selectOptions.info_format||this.options.info_format,request:a.selectOptions.request||this.options.request,query_layers:a.selectOptions.query_layers||a.layerNames.join(","),service:a.selectOptions.service||this.options.service,buffer:a.selectOptions.buffer||this.options.buffer,outputFormat:a.selectOptions.outputFormat||this.options.outputFormat,latLng:t,srs:a.selectOptions.srs||"EPSG:4326"},a.selectOptions);var i=a.selectOptions.url||a.url;"undefined"!=typeof i.match("park_besiktning")&&null!==i.match("park_besiktning")&&i.match("park_besiktning").indexOf("park_besiktning")>=0&&(c[smap.cmd.randomText()]=Math.floor(Math.random()*Math.pow(10,18)),smap.cmd.loading(!0)),"text/plain"===c.info_format&&(c.version="1.1.1");var o=this.onSuccess;this.request(a.selectOptions.url||a.url,c,{onSuccess:function(t,n){d-=1,e.push([t,n]),0>=d&&o.call(this,e),n&&n.params&&n.params.layers&&("v_lekplatsredskap"===n.params.layers||"v_lekplatsredskap_utforare"===n.params.layers)&&smap.cmd.loading(!1)},onError:function(){d-=1,smap.cmd.loading(!1)},layerId:a.layerId,latLng:t})}}},this),100)}},_layerShouldBeAdded:function(e){var t=e.wmsParams?!0:!1;return e.options&&e.options.selectable&&e.options.selectable===!0&&this._hasLayer(e)===!1&&t===!0?!0:!1},_hasLayer:function(e){for(var t=this._layers,n=0,a=t.length;a>n;n++)if(e===t[n])return n;return!1},_makeParams:function(e,t){t=t||{};var n=this.map.latLngToContainerPoint(e.latLng),a=e.buffer,i=new OpenLayers.Pixel(n.x-a,n.y+a),o=new OpenLayers.Pixel(n.x+a,n.y-a),s=L.point(i.x,i.y),l=L.point(o.x,o.y),r=this.map.containerPointToLatLng(s),p=this.map.containerPointToLatLng(l),d=L.latLngBounds(r,p),c=d.toBBoxString();if(t.srs&&"EPSG:4326"!==e.srs){var m=d.getSouthWest(),u=d.getNorthEast();m=utils.projectLatLng(m,"EPSG:4326",e.srs,!1,!1),u=utils.projectLatLng(u,"EPSG:4326",e.srs,!1,!1),d=L.latLngBounds(m,u),c=d.toBBoxString()}if(t.reverseAxisBbox){var h=c.split(",");c=[h[1],h[0],h[3],h[2]].join(",")}var _=$.extend({},{service:"WMS",request:"GetFeatureInfo",version:this.options.version,bbox:c,layers:null,styles:"",typename:e.layers,query_layers:e.layers,info_format:e.info_format,feature_count:this.options.maxFeatures,x:utils.round(n.x),y:utils.round(n.y),buffer:this.options.buffer,width:utils.round(this.map.getSize().x),height:utils.round(this.map.getSize().y),srs:"EPSG:4326",exceptions:"application%2Fvnd.ogc.se_xml"},e);return delete _.latLng,_},_parseText:function(e){for(var t,n,a,i,o,s,l={},r={},p=e.split("\n"),d=0,c=p.length;c>d;d++)if(t=p[d],0!==$.trim(t).length)if(-1!==t.search("=")){if(n=t.split("="),n.length>2){var m=n.slice(1);i=m.join("=")}else i=n[1];i=$.trim(i),"null"==i.toLowerCase()&&(i="");var u=/^[0-9.]+$/.test(i),h=i.split("."),_=h.length<=2&&h[0].length>0&&(1===h.length||2===h.length&&h[1].length>0);if(u===!0&&_){try{switch(h.length){case 1:o=parseInt(i);break;case 2:o=parseFloat(i)}}catch(v){}o&&isNaN(o)===!1&&(i=o)}a=$.trim(n[0]),r[a]=i}else{var g=t.search(/'/);if(g>-1){t=t.substring(g+1),g=t.search(/'/),s&&l[s]&&$.isEmptyObject(r)===!1&&(l[s].push($.extend({},r)),r={}),s=t.substring(0,g),l[s]||(l[s]=[]);continue}s&&l[s]&&$.isEmptyObject(r)===!1&&t.search(/\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-/gi)>-1?(l[s].push($.extend({},r)),r={}):a&&i&&(r[a]=i+" "+t)}return s&&l[s]&&$.isEmptyObject(r)===!1&&l[s].push($.extend({},r)),l},request:function(e,t,n){t=t||{},n=n||{};var a=null;this.options.useProxy?e=smap.config.ws.proxy+encodeURIComponent(e+"?"+$.param(t)):a=t,this.xhr=$.ajax({url:e,data:a,type:"GET",dataType:"text",context:this,success:function(e){var a,i=t.info_format;if("text/plain"===i)a=this._parseText(e);else{if("application/json"!==i)return!1;a=JSON.parse(e.replace(/(?:\r\n|\r|\n)/g,""))}n.onSuccess.call(this,a,{latLng:n.latLng,map:this.map,context:this,params:t})},error:n.onError})},CLASS_NAME:"L.Control.SelectWMS"}),L.control.selectWMS=function(e){return new L.Control.SelectWMS(e)},L.Control.SearchLund=L.Control.extend({options:{whitespace:"%2B",wsOrgProj:"EPSG:3006",pxDesktop:992,addToMenu:!1},_lang:{sv:{search:"Sök",addressNotFound:"Den sökta adressen hittades inte",remove:"Ta bort"},en:{search:"Search property",addressNotFound:"The searched address was not found",remove:"Remove"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){var t=this;return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-searchlund"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),this._makeSearchField(),this.__onApplyParams=this.__onApplyParams||$.proxy(this._onApplyParams,this),smap.event.on("smap.core.applyparams",this.__onApplyParams),this.__onCreateParams=this.__onCreateParams||$.proxy(this._onCreateParams,this),smap.event.on("smap.core.createparams",this.__onCreateParams),this.map.on("click",this._blurSearch),t._container},_blurSearch:function(){$("#smap-searchlund-div input").blur()},onRemove:function(){smap.event.off("smap.core.applyparams",this.__onApplyParams),smap.event.off("smap.core.createparams",this.__onCreateParams),this.map.off("click",this._blurSearch)},_onApplyParams:function(e,t){if(t.POI){var n=t.POI instanceof Array?t.POI[0]:t.POI;n=n.replace(/--c--/g,",");var a=t.POI instanceof Array&&t.POI.length>1?t.POI[1]:!1;this._geoLocate(decodeURIComponent(n),{setView:!1,showPopup:a})}},_onCreateParams:function(e,t){if(this.marker&&this.marker.options.q){var n=this.marker.getPopup()._isOpen?!0:!1;t.POI=[encodeURIComponent(this.marker.options.q.replace(/,/g,"--c--"))],n&&t.POI.push(1)}},_rmAdressMarker:function(e){null!=e&&(this.map.removeLayer(e),this.addressMarker=null)},_makeSearchField:function(){function e(){var e=$(window).width();if(!(e>=a.options.pxDesktop)&&L.Browser.touch){var t=$("#smap-searchlund-bg");t.length||(t=$('<div id="smap-searchlund-bg" />'),o.addClass("searchlund-active"),$("#mapdiv").append(t),setTimeout(function(){t.addClass("searchlund-bg-visible")},1))}}function t(){var e=$(window).width();e>=a.options.pxDesktop||!L.Browser.touch||(o.removeClass("searchlund-active"),$("#smap-searchlund-bg").removeClass("searchlund-bg-visible"),setTimeout(function(){$("#smap-searchlund-bg").remove()},300))}function n(e){e.stopPropagation()}var a=this,o=$('<div id="smap-searchlund-div" class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span><input autocorrect="off" autocomplete="off" data-provide="typeahead" type="text" class="form-control" placeholder="'+this.lang.search+'"></input></div>'),s=o.find("input");L.Browser.msTouch&&s.attr("pattern","[0-9]"),s.on("keypress",e).on("dblclick",n).on("mousedown",n).on("focus",function(){$(this).parent().addClass("smap-searchlund-div-focused")}).on("blur",function(){$(this).parent().removeClass("smap-searchlund-div-focused")}).on("touchstart",function(){$(this).focus()}),o.on("click touchstart",function(e){$(this).find("input").focus(),e.stopImmediatePropagation()}),s.on("blur",t),$("#mapdiv").append(o),smap.event.on("smap.core.pluginsadded",function(){var e=$("#smap-menu-div nav");e.length&&o.addClass("smap-searchlund-div-in-toolbar")});var l=this.options.whitespace,r=this.options._geoLocate||this._geoLocate,p={items:10,minLength:2,highlight:!0,hint:!0,updater:function(e){return smap.cmd.loading(!0),r.call(a,e),t(),e}};this.options.wsAcUrl?p.source=function(e,t){var n=encodeURIComponent(a.options.wsAcUrl+"?format=json&prefix="+e);l&&(n=n.replace(/%20/g,l)),a.proxyInst&&a.proxyInst.abort(),a.proxyInst=$.ajax({type:"GET",url:smap.config.ws.proxy+n,dataType:"text",success:function(e){var n=$.parseJSON(e),a=[];for(i=0,len=n.items.length;i<len;i++)a[i]=n.items[i].name;t(a)},error:function(){}})}:this.options.wsAcLocal&&this.options.wsAcLocal instanceof Array&&(p.source=this.options.wsAcLocal),s.typeahead(p)},_geoLocate:function(e,t){t=t||{};var n={setView:!0,showPopup:!0};t=$.extend({},n,t),this.options.qPattern&&(e=utils.extractToHtml(this.options.qPattern,{q:e}));var a=encodeURIComponent(this.options.wsLocateUrl+"?format=json&objectname="+e),i=this.options.whitespace;i&&(a=a.replace(/%20/g,i));var o={success:function(n){function a(){$("#smap-searchlund-popupbtn").off("click").on("click",function(){return i.map.removeLayer(i.marker),i.marker=null,i.polyLayerGroup.clearLayers(),i.map.removeLayer(i.polyLayerGroup),!1})}var i=this;if(this.marker&&(this.map.removeLayer(this.marker),this.marker=null,this.polyLayerGroup&&(this.polyLayerGroup.clearLayers(),i.map.removeLayer(this.polyLayerGroup))),!n.items.length)return void smap.cmd.notify(this.lang.addressNotFound,"error");for(var o=[],s=0,l=n.items.length;l>s;s++)o[s]=$.parseJSON(n.items[s].geometry);

if("MultiPoint"==o[0].type){var r=L.latLng(o[0].coordinates[0][1],o[0].coordinates[0][0]),p="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==p){var d=window.proj4(this.options.wsOrgProj,p,[r.lng,r.lat]);r=L.latLng(d[1],d[0])}}if("Polygon"==o[0].type){for(var r,c=[],m=0;m<o.length;m++)c[m]=[];for(var u=0,h=o.length;h>u;u++)for(var m=0,_=o[u].coordinates[0].length;_>m;m++){var r=L.latLng(o[u].coordinates[0][m][1],o[u].coordinates[0][m][0]),p="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==p){var d=window.proj4(this.options.wsOrgProj,p,[r.lng,r.lat]);r=L.latLng(d[1],d[0])}c[u].push(r)}}if(this.map.off("popupopen",a),this.map.on("popupopen",a),"MultiPoint"==o[0].type&&(this.marker=L.marker(r).addTo(this.map),this.marker.options.q=e,this.marker.bindPopup('<p class="lead">'+e+'</p><div><button id="smap-searchlund-popupbtn" class="btn btn-default">'+this.lang.remove+"</button></div>"),t.setView&&this.map.setView(r,17,{animate:!1})),"Polygon"==o[0].type){this.polyLayerGroup=new L.LayerGroup;for(var m=0;m<o.length;m++)this.mapPolygon=L.polygon(c[m]),this.polyLayerGroup.addLayer(this.mapPolygon);this.map.addLayer(this.polyLayerGroup);var v=this.mapPolygon.getBounds().getCenter();this.marker=L.marker(v).addTo(this.map),this.marker.options.q=e,this.marker.bindPopup('<p class="lead">'+e+'</p><div><button id="smap-searchlund-popupbtn" class="btn btn-default">'+this.lang.remove+"</button></div>"),t.setView&&this.map.setView(r,17,{animate:!1})}t.showPopup&&this.marker.openPopup(),$("#smap-searchlund-div input").val(null),$("#smap-searchlund-div input").blur(),setTimeout(function(){$("#smap-searchlund-div input").blur()},100)},complete:function(){smap.cmd.loading(!1)}};$.ajax({url:smap.config.ws.proxy+a,type:"GET",dataType:"json",context:this,success:this.options.onLocateSuccess||o.success,complete:o.complete})},CLASS_NAME:"L.Control.SearchLund"}),L.control.searchLund=function(e){return new L.Control.SearchLund(e)},L.Control.ShareLink=L.Control.extend({options:{position:"bottomright",addToMenu:!1,maxLen:2083,root:null},_lang:{sv:{caption:"Länk till kartan",close:"Stäng",tooLong:"För lång länk",tooLongUrl:"Notera! Länken är för lång för att fungera i en del äldre webbläsare. Ta bort ett eller flera ritade objekt för att göra länken kortare."},en:{caption:"Share link",close:"Close",tooLong:"Too long link",tooLongUrl:"Note! The link may not work in some older browsers. Please remove one or more drawn features to make it shorter."}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-ShareLink"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._container},activate:function(){function e(){l.find("input[type=text]").prop("disabled",!0),l.off("shown.bs.modal",e)}var t=this,n=smap.cmd.createParams(this.options.root||!0),a=$('<div class="form-group"><input type="text" class="form-control" placeholder="'+this.lang.caption+'"></div>'),i=a.find("input");i.val(n);var o=function(e){e.setSelectionRange?e.setSelectionRange(0,9999):$(e).select()};if(!this._$dialog){window.sendMail={},window.sendMail.upd_link=n,window.sendMail.shareLinkByMail=function(){var e=document.createElement("a");e.href="mailto:?body="+encodeURIComponent(window.sendMail.upd_link),e.click()};var s='<button class="btn btn-default" onclick="window.sendMail.shareLinkByMail();">Skicka e-post</button><button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";this._$dialog=utils.drawDialog(this.lang.caption,a,s),this._$dialog.attr("id","slink-modal"),i.on("tap click",function(){o(this)}),this._$dialog.on("shown.bs.modal",function(){o(i[0])}),this._$dialog.on("hide.bs.modal",function(){$(this).find("input[type=text]").blur()}),this._$dialog.on("hidden.bs.modal",function(){t._$dialog.empty().remove(),t._$dialog=null})}if(n.length>this.options.maxLen){var l=this._$dialog,r=smap.cmd.notify(this.lang.tooLongUrl,"warning",{parent:a.parent()});r.removeClass("map-alert"),l.find("input[type=text]").val(this.lang.tooLong),l.on("shown.bs.modal",e)}this._$dialog.modal("show")},_createBtn:function(){var e=this,t=$('<button id="smap-sharelink-btn" title="'+this.lang.caption+'" class="btn btn-default"><span class="fa fa-link"></span></button>');t.on("click touchstart",function(){return e.activate(),!1}),this.$container.append(t)},onRemove:function(){}}),L.control.sharePos=function(e){return new L.Control.SharePos(e)},L.Control.SharePosition=L.Control.extend({options:{position:"bottomright",autoActivate:!1,wfsSource:"//kartor.malmo.se:8081/geoserver/wfs",wfsFeatureType:"sandbox:sharedpositions",wfsUri:"//www.malmo.se/sandbox/",useProxy:!0,maxAge:15,_refreshIntervalMs:1e4,_storeIntervalMs:1e4},_lang:{sv:{dTitle:"Dela position",dShare:"Dela!",yourName:"Ditt namn",stopSharing:"Sluta dela",btnCancel:"Avbryt"},en:{dTitle:"Share position",dShare:"Share!",yourName:"Your name",stopSharing:"Stop sharing",btnCancel:"Cancel"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},deactivate:function(){this._stopRefresh(),$("#smap-share-btn").removeClass("btn-danger"),this.dialog.find("input").val(null),$("#smap-share-btn").hide(),this.map.removeLayer(this.layer)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-shareposition"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawGui(),this._bindEvents(),this._container},onRemove:function(e){e.stopLocate()},_drawGui:function(){var e=$('<button id="smap-share-btn" class="btn btn-default" type="button"><span class="fa fa-user"></span></button>');e.hide(),this.$container.append(e);var t=this;smap.event.on("smap.core.pluginsadded",function(){$(".leaflet-control-Geolocate").before(t.$container)});var n='<div class="form-group"><label>'+this.lang.yourName+'</label><input type="text" class="form-control" placeholder="'+this.lang.yourName+'"></input></div>',a=$('<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.btnCancel+'</button><button type="button" class="btn btn-primary">'+this.lang.dShare+"</button>");this.dialog=utils.drawDialog(this.lang.dTitle,n,a)},_makeFilter:function(){var e=this.options.maxAge,t=new Date,n=t.getTime(),a=n-60*e*1e3,i=new Date(a),o=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN,property:"datetime_changed",value:i}),s=new OpenLayers.Format.Filter({version:"1.1.0"}),l=new OpenLayers.Format.XML,r=l.write(s.write(o));return r},_addLayer:function(){var e=this;this.layer=smap.core.layerInst._createLayer({init:"L.GeoJSON.WFS",url:this.options.wfsSource,options:{noBindZoom:!0,noBindDrag:!0,layerId:"_shareposition",displayName:"Shared locations",featureType:this.options.wfsFeatureType,attribution:"Malmö stads WFS",inputCrs:"EPSG:4326",selectable:!0,popup:'<span><strong>${text_username}</strong>&nbsp;&nbsp;(<span style="white-space:nowrap;">${function(p) {var d = new Date(p.datetime_changed);var dNow = new Date(); var dDiff = new Date( Math.abs(dNow.getTime() - d.getTime()) ); return dDiff.getMinutes(); }}</span> min ago)</span>',hoverColor:"#FF0",zIndex:350,reverseAxis:!1,reverseAxisBbox:!0,uniqueKey:"id",params:{typeName:"sandbox:sharedpositions",version:"1.1.0",maxFeatures:1e4,format:"text/geojson",outputFormat:"json"}}}),this.layer.options.params.filter=this._makeFilter(),this.layer.off("load"),this.layer.on("load",function(){e.layer.eachLayer(function(t){var n=L.userMarker(t.getLatLng(),{pulsing:!0,smallIcon:!0});if(e.layer.removeLayer(t),t.feature){var a=parseInt(t.feature.id.split(".")[1]),i=e.uid||localStorage.share_uid||null;i=parseInt(i),(!i||i&&i!==a)&&e.layer.addLayer(n);var o=utils.extractToHtml(e.layer.options.popup,t.feature.properties);n.bindLabel(o,{noHide:!0,direction:"right"}).showLabel()}}),smap.cmd.loading(!1)}),this.map.addLayer(this.layer);var e=this},_bindEvents:function(){var e=this;smap.event.on("smap.core.pluginsadded",function(){$("#smap-glocate-btn").on("click",function(){return $(this).hasClass("btn-primary")?($("#smap-share-btn").show(),e._addLayer(),e._startRefresh()):(e._stopShare(),e.deactivate()),!1}),$("#smap-share-btn").on("click",function(){var t=$(this).hasClass("btn-danger");t?($(this).removeClass("btn-danger"),e._stopShare()):e.dialog.modal("show")})}),this.dialog.find("input").on("click",function(){$(this).focus()}),this.dialog.find(".modal-footer .btn-primary").on("click",function(){$("#smap-share-btn").addClass("btn-danger"),e.dialog.modal("hide");var t=$.trim(e.dialog.find("input[type='text']").val());e._startShare(t)})},_onLocationFound:function(e){this._location=e},_onLocationError:function(){smap.cmd.loading(!1)},_setLocateSettings:function(){var e={watch:!0,timeout:3e4,enableHighAccuracy:!0,frequency:3e3};$.extend(this.map._locateOptions,e)},_startShare:function(e){return this._storeInterval?!1:(utils.log("START sharing"),this.uName=e,this.__onLocationFound=this.__onLocationFound||$.proxy(this._onLocationFound,this),this.__onLocationError=this.__onLocationError||$.proxy(this._onLocationError,this),this.map.on("locationfound",this.__onLocationFound),this.map.on("locationerror",this.__onLocationFound),this.uid=localStorage.share_uid||null,this.__store=this.__store||$.proxy(this._store,this),this._storeInterval=setInterval(this.__store,this.options._storeIntervalMs),this._setLocateSettings(),void this.map.fire("drag"))},_startRefresh:function(){return this._refreshInterval?!1:(utils.log("start refreshing"),this.__refresh=this.__refresh||$.proxy(this._refresh,this),void(this._refreshInterval=setInterval(this.__refresh,this.options._refreshIntervalMs)))},_stopRefresh:function(){utils.log("stop refreshing"),clearInterval(this._refreshInterval),this._refreshInterval=null},_stopShare:function(){smap.cmd.loading(!1),utils.log("stop sharing"),this._stopRefresh(),clearInterval(this._storeInterval),this._storeInterval=null,this.map.off("locationfound",this.__onLocationFound,this),this.map.off("locationerror",this.__onLocationError,this),this._location=null,this.uid=null,this.uName=null},uid:null,_store:function(){return this._working||!this._location?!1:(this._working=!0,void $.ajax({url:this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(this.options.wfsSource):this.options.wfsSource,type:"POST",context:this,data:this._getXml(this._location.latlng,this._location.accuracy,this.uName,this.uid),contentType:"text/xml",dataType:"text",error:function(e,t){utils.log("SharePosition: Error storing coordinates because of: "+t)},success:function(e){var t=$.xml2json(e),n=t?t.TransactionResponse||t["wfs:TransactionResponse"]:null;if(n){var a=n?n.TransactionSummary||n["wfs:TransactionSummary"]:null;if(a){var i=parseInt(a.totalInserted||a["wfs:totalInserted"]),o=parseInt(a.totalUpdated||a["wfs:totalUpdated"]);if(!this.uid&&i>0){var s=n.InsertResults||n["wfs:InsertResults"],l=s.Feature||s["wfs:Feature"],r=l.FeatureId||l["ogc:FeatureId"],p=r.fid||r.$.fid;this.uid=parseInt(p.split(".")[1]),localStorage.share_uid=this.uid}else 0===i&&0===o&&(this.uid=null,delete localStorage.share_uid)}}},complete:function(){this._working=!1}}))},_refresh:function(){this.layer.options.params.filter=this._makeFilter(),this.layer._refresh({force:!0})},_getXml:function(e,t,n,a){var i="",o=this.options.wfsFeatureType.split(":")[1];return i=a?'<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="'+this.options.wfsUri+'"\n  xmlns:wfs="//www.opengis.net/wfs"\n  xmlns:ogc="//www.opengis.net/ogc"\n  xmlns:gml="//www.opengis.net/gml"\n  xmlns:xsi="//www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="//www.opengis.net/wfs\n                      //schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd">\n  <wfs:Update typeName="grp:'+o+'">\n	 <wfs:Property><wfs:Name>text_username</wfs:Name><wfs:Value>'+n+"</wfs:Value></wfs:Property>	 <wfs:Property><wfs:Name>int_accuracy</wfs:Name><wfs:Value>"+t+'</wfs:Value></wfs:Property>    <wfs:Property>\n      <wfs:Name>the_geom</wfs:Name>\n      <wfs:Value>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+e.lat+","+e.lng+"</gml:coordinates>\n        </gml:Point>\n      </wfs:Value>\n    </wfs:Property>\n    <ogc:Filter>\n      <PropertyIsEqualTo>\n        <PropertyName>id</PropertyName>\n        <Literal>"+a+"</Literal>\n      </PropertyIsEqualTo>\n    </ogc:Filter>\n  </wfs:Update>\n</wfs:Transaction>":'<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="'+this.options.wfsUri+'"\n  xmlns:wfs="//www.opengis.net/wfs"\n  xmlns:gml="//www.opengis.net/gml"\n  xmlns:xsi="//www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="//www.opengis.net/wfs\n                      //schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd\n                      '+this.options.wfsSource+"/DescribeFeatureType?typename="+this.options.wfsFeatureType+'">\n  <wfs:Insert>\n    <grp:'+o+'>\n      <grp:the_geom>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+e.lat+","+e.lng+"</gml:coordinates>\n        </gml:Point>\n      </grp:the_geom>\n      <grp:int_accuracy>"+t+"</grp:int_accuracy>\n      <grp:text_username>"+n+"</grp:text_username>\n    </grp:"+o+">\n  </wfs:Insert>\n  </wfs:Transaction>"}}),L.control.sharePosition=function(e){return new L.Control.SharePosition(e)},L.Control.ShareTweet=L.Control.extend({options:{position:"topright",wfsSource:"//localhost:8080/geoserver/wfs",wfsFeatureType:"local:tweets"},_lang:{sv:{btnAdd:"Lägg till",btnUnshare:"Sluta dela position",titleDialog:"Skriv nånting",btnCancel:"Avbryt",btnSubmit:"Skicka",loading:"Arbetar..."},en:{btnAdd:"Add tweet",btnUnshare:"Stop sharing position",titleDialog:"Write something",btnCancel:"Cancel",btnSubmit:"Submit",loading:"Working..."}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-sharetweet"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._addWfsLayer();var t=this;return this.map.on("zoomend moveend",function(){t.layer._refresh()}),this._container},onRemove:function(){},_notify:function(e,t){switch(t){case"success":t="alert-success";break;case"error":t="alert-danger"}var n=$('<div class="alert '+t+' alert-dismissable"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e+"</div>");n.css({"margin-top":"20px"}),$(".modal-body").find(".alert").remove(),$(".modal-body .sharetweet-footer").before(n)},_addWfsLayer:function(){this.cluster=new L.MarkerClusterGroup,this.layer=smap.core.layerInst._createLayer({init:"L.GeoJSON.WFS",url:this.options.wfsSource,options:{layerId:"sharetweet-wfstlayer",displayName:"Tweets",featureType:this.options.wfsFeatureType,attribution:"Malmö stads WFS",inputCrs:"EPSG:4326",reverseAxis:!0,selectable:!0,popup:'<p class="lead">${text_text}</p><p>Skrivet den: <strong>${function(p) {var d = new Date(p.dtime_created);return d.toLocaleString();}}</strong></p>',uniqueAttr:null,hoverColor:"#FF0",style:{weight:6,color:"#F00",dashArray:"",fillOpacity:.5}}});var e=this;this.layer._map=this.map,this.layer.on("load",function(t){t.layer.eachLayer(function(t){e.cluster.addLayer(t)}),t.layer.clearLayers(),e.map.removeLayer(e.cluster),e.map.addLayer(e.cluster),smap.cmd.loading(!1)}),this.map.addLayer(this.cluster)},_onLocationFound:function(e){smap.cmd.loading(!1);var t=6;this.modal&&(this.modal.find('form td[name="easting"]').empty().text(utils.round(e.latlng.lng,t)),this.modal.find('form td[name="northing"]').empty().text(utils.round(e.latlng.lat,t)),this.modal.find('form td[name="accuracy"]').empty().text(utils.round(e.accuracy,1)+" m"),this.modal.find(".btn-primary").button("reset"))},_onLocationError:function(){var e=this;this._notify("Your position could not be determined","error"),setTimeout(function(){e.deactivate()},3e3)},deactivate:function(){this.modal&&this.modal.modal("hide")},shareTweet:function(){$("#sharetweet-btn").button(this.lang.btnUnshare),smap.cmd.loading(!0),this.modal=this._showDialog(),this.modal.find(".btn-primary").button("loading");var e=smap.cmd.getControl("Geolocate");e&&e.deactivate(),this.map.on("locationfound",$.proxy(this._onLocationFound,this)),this.map.on("locationerror",$.proxy(this._onLocationError,this)),this.map.locate({watch:!0,setView:!0,enableHighAccuracy:!0}),smap.cmd.loading(!1)},unShareTweet:function(){$("#sharetweet-btn").button(this.lang.btnAdd),this.map.off("locationfound",$.proxy(this._onLocationFound,this)),this.map.off("locationerror",$.proxy(this._onLocationError,this))},_showDialog:function(){var e=$('<form id="sharetweet-form" role="form"><textarea class="form-control" rows="4" name="text" minlength="5" maxlength="140" required></textarea><table><tr><td>Easting:</td><td name="easting"></td></tr><tr><td>Northing:</td><td name="northing"></td></tr><tr style="font-weight:bold;"><td>Felmarginal:</td><td name="accuracy"></td></tr></table><div class="row sharetweet-footer"><button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.btnCancel+'</button><button type="submit" class="btn btn-primary" data-loading-text="'+this.lang.loading+'">'+this.lang.btnSubmit+"</button></div></form>"),t=this;e.on("submit",function(){var e=$(this).serializeArray(),n={};return $.each(e,function(e,t){n[t.name]=t.value}),n.easting=parseFloat($(this).find('[name="easting"]').text()),n.northing=parseFloat($(this).find('[name="northing"]').text()),t._save(L.latLng(n.northing,n.easting),n.text),!1}),e.find("tr").each(function(){var e=$(this).find("td:eq(1)");e.text(""),t._addSpin(e)});var n=utils.drawDialog(this.lang.titleDialog,e,null,{size:"sm"});return e.find(".btn-default").on("click",function(){return n.modal("hide"),!1}).find(".btn-primary").on("click",function(){return!1}),n.modal("show"),n.on("hidden.bs.modal",function(){t.map.stopLocate(),t.modal.empty().remove(),t.modal=null,$("#sharetweet-btn").button(this.lang.btnAdd),$("#sharetweet-btn").removeClass("btn-primary"),delete t.modal}),n},_addSpin:function(e){var t={length:5,width:1,radius:3},n=new Spinner(t).spin();$(e).append(n.el)},_drawBtn:function(){var e=this,t=$('<button id="sharetweet-btn" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;<span>'+this.lang.btnAdd+"</span></button>");t.on("click",function(){$(this).hasClass("btn-primary")?($(this).removeClass("btn-primary"),e.unShareTweet()):($(this).addClass("btn-primary"),e.shareTweet())}),this.$container.append(t)},_createRequest:function(e,t){var n='<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="//localhost/"\n  xmlns:wfs="//www.opengis.net/wfs"\n  xmlns:gml="//www.opengis.net/gml"\n  xmlns:xsi="//www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="//www.opengis.net/wfs\n                      //schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd\n                      '+this.options.wfsSource+"/DescribeFeatureType?typename="+this.options.wfsFeatureType+'">\n  <wfs:Insert>\n    <grp:tweets>\n      <grp:text_text>'+t.text+'</grp:text_text>\n      <grp:the_geom>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+e.lat+","+e.lng+"</gml:coordinates>\n        </gml:Point>\n      </grp:the_geom>\n    </grp:tweets>\n  </wfs:Insert>\n</wfs:Transaction>";return n},_save:function(e,t){if(this.submitting)return!1;this.map.stopLocate(),this.submitting=!0,smap.cmd.loading(!0),this.modal.find(".btn-primary").button("loading");var n=this._createRequest(e,{text:t});$.ajax({url:smap.config.ws.proxy+encodeURIComponent(this.options.wfsSource),type:"POST",context:this,data:n,contentType:"text/xml",dataType:"text",success:function(e){smap.cmd.loading(!1);var t=$.xml2json(e);parseInt(t.TransactionSummary.totalInserted)>0&&(this.deactivate(),this._reload())},error:function(e,t){this._notify("Kunde inte spara. Fel: <strong>"+t+"</strong>","error"),smap.cmd.loading(!1)},complete:function(){this.modal.find(".btn-primary").button("reset"),this.submitting=!1}})},_reload:function(e){e=e||{},smap.cmd.loading(!0),this.layer._refresh()}}),L.control.shareTweet=function(e){return new L.Control.ShareTweet(e)},L.Control.ToolHandler=L.Control.extend({options:{position:"bottomright",showPopoverTitle:!1,breakpoint:991},_lang:{sv:{popoverTitle:"Verktyg"},en:{popoverTitle:"Tools"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(){return this._container=L.DomUtil.create("div","leaflet-control-toolhandler"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),utils.getBrowser().ie8||(this._makeToolHandler(),smap.event.on("smap.core.pluginsadded",function(){$(".thandler-container .leaflet-control button").each(function(){$(this).tooltip({placement:"bottom",container:"#maindiv"})})})),this._onWinResize=$.proxy(this.onWinResize,this),$(window).on("resize",this._onWinResize),this.checkCollapsePoint(),this._container},onWinResize:function(){this.checkCollapsePoint()},checkCollapsePoint:function(){var e=$(window).width();e<=this.options.breakpoint?$("#mapdiv").addClass("thandler-collapsed"):$("#mapdiv").removeClass("thandler-collapsed")},activate:function(){},_makeToolHandler:function(){function e(e){var t=$(".thandler-popover").length&&parseInt($(".thandler-popover").css("opacity")||0)>0,n=$(".popover-content");i.data("bs.popover")&&t&&n.children().length&&(utils.getBrowser().ie9&&o(),i.popover("hide")),smap.event.trigger("smap.toolhandler.hide",e),$(".thandler-container .leaflet-control button").each(function(){$(this).trigger("blur")}),$(".tooltip:visible").hide()}function t(){var e=$(".thandler-container").children(":has('button')");e.length&&i.popover("show")}var n=this,a=$(".leaflet-top.leaflet-right");this.$thCont=a,a.addClass("thandler-container");var i=$('<div class="thandler-btn popover-dismiss"><button type="button" class="btn btn-default thbtn"><span class="fa fa-th"></span></button></div>');$("#mapdiv").append(i),this._map.on("click dragstart",e),$(window).on("orientationchange",e);var o=function(){$(window).off("resize",e);var t=$(".popover-content");setTimeout(function(){t.children().each(function(){$(".thandler-container").prepend(this)})},150)};i.on("click",function(){var a=$(this);if(a.data("bs.popover")){var i=$(".thandler-popover").length&&parseInt($(".thandler-popover").css("opacity")||0)>0;if(i)return utils.getBrowser().ie9&&o(),a.popover("hide"),!1}else a.popover({content:null,placement:"bottom",title:n.lang.popoverTitle,trigger:"manual"}),a.on("shown.bs.popover",function(){var t=$(".popover"),a=$(".popover-content");n.options.showPopoverTitle||t.find("h3").remove(),t.addClass("thandler-popover");var i=$(".thandler-container").children(".leaflet-control:has('button')").detach();a.empty(),i.each(function(){a.prepend(this)}),$(window).on("resize",e)}),a.on("hidden.bs.popover",o);return t(),!1}),i.on("tap",function(){return!1}),i.on("dblclick",function(){return!1})},onRemove:function(){$(window).off("resize",this._onWinResize)}}),L.control.toolhandler=function(e){return new L.Control.ToolHandler(e)},L.Control.VspuHeaderLund=L.Control.extend({options:{position:"topright",btnID:"vspu-btn"},_lang:{sv:{caption:"Genvägar"},en:{caption:"Themes"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){this.map=e,this._container=L.DomUtil.create("div","leaflet-control-VspuHeaderLund"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createMenu();var t="";return this.options.btnID&&(t=this.options.btnID),this.addButton(t,"Genvägar","fa fa-plus-circle",function(){return!1}),this._container},addButton:function(e,t,n,a,i){i=i||{};var o=$('<div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Genvägar <span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button><ul class="dropdown-menu" role="menu"><li><a href="http://kartor.lund.se/vspu/?zoom=14&center=13.6306,55.65929&ol=Avrinningsområde,Kommungränser,VA_vattenskyddsområde,Dammdatabas&bl=binglayer">Björkaprojektet</a></li><li><a href="http://kartor.lund.se/vspu/?zoom=12&center=13.64777,55.71735&ol=Avrinningsområde,Vattendrag-huvud,Vattendrag-mellan,Vattendrag-sma,Kommungränser,Dammdatabas&bl=mapboxlund">Torpsbäcken</a></li><li><a href="http://kartor.lund.se/vspu/?zoom=10&center=13.3717,55.66209&ol=Avrinningsområde,VATTENFOREKOMSTER,Kommungränser,Plan-pågående,OP_nybyggnad,OP_omvandling,OP_linje,Simrishamnsbanan&bl=mapboxlund">Pågående planering</a></li><li><a href="http://kartor.lund.se/vspu/?zoom=12&center=13.03768,55.73929&ol=Avrinningsområde,Kommungränser,OP_nybyggnad,OP_omvandling,Havsnivåökning3m,Havsnivåökning1m,OP_linje&bl=mapboxlund">Översvämningsrisker</a></li></ul></div>');i.proxy,$("#btns").append(o),i.callback&&i.callback(o)},_createMenu:function(){var e=$('<header id="smap-vspuHeaderLund-div" class="navbar navbar-static-top bs-docs-nav" role="banner"><div class="container"><div class="navbar-header">    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">      <span class="sr-only">Toggle navigation</span>      <span class="fa fa-bars"></span>    </button><a class="navbar-brand" href="localhost:8080/karta/dev.html?config=configVspu.js">Kävlingeåns vattenstrategiska planeringsunderlag</a>  </div>  <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">    <ul id="btns" class="nav navbar-nav navbar-right">    </ul>  </nav></div></header>');$("#maindiv").prepend(e),$("body").addClass("mf-v4 no-footer")},onRemove:function(){}}),L.control.vspuHeaderLund=function(e){return new L.Control.VspuHeaderLund(e)},L.Control.Zoombar=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(e){e=e||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-zoombar"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.addClass("btn-group-vertical"),this.$container.on("mousedown",function(){return!1}),this._createButtonZoomIn(),this._createButtonZoomUt(),this.__onZoomEnd=this.__onZoomEnd||$.proxy(this._onZoomEnd,this),this.map.on("zoomend",this.__onZoomEnd),this._container},_onZoomEnd:function(){this.map.getZoom()>=this.map.getMaxZoom()?this.$container.find("#zoombar-plus").addClass("disabled"):this.map.getZoom()<=this.map.getMinZoom()?this.$container.find("#zoombar-minus").addClass("disabled"):this.$container.find("button").removeClass("disabled")},_createButtonZoomIn:function(){var e=$('<button id="zoombar-plus" class="btn btn-default"><span class="fa fa-plus"></span></button>');this.$container.append(e),e.on("click touchstart dblclick",function(){return smap.map.zoomIn(),!1})},_createButtonZoomUt:function(){var e=$('<button id="zoombar-minus" class="btn btn-default"><span class="fa fa-minus"></span></button>');this.$container.append(e),e.on("click touchstart dblclick",function(){return smap.map.zoomOut(),!1})},onRemove:function(){}}),L.control.zoombar=function(e){return new L.Control.Zoombar(e)},L.Control.Osmbuildings=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{errorOsmbuildings:"Kunde inte visa 3D byggnader",notSupported:"Din webbläsare stödjer 3D byggnader"},en:{errorOsmbuildings:"Can´t visualize 3D buildings",notSupported:"Your browser does not support 3D buildings"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-Osmbuildings"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawButton(),this._container},onRemove:function(){},_drawButton:function(){var e=$('<button id="smap-glocate-btn" class="btn btn-default"><span class="fa fa-cube"></span></button>');this.$container.append(e),this.btn=e,e.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this))},activate:function(){return this.active?!1:(this.active=!0,this.btn.addClass("btn-primary"),void(osmb=new OSMBuildings(this.map).load()))},deactivate:function(){return this.active?(this.active=!1,this.map.removeLayer(this.map._layers[osmb._leaflet_id]),void this.btn.removeClass("btn-primary")):!1}}),L.control.osmbuildings=function(e){return new L.Control.Osmbuildings(e)},L.Control.GetFeatureInfo=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",buffer:12,_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Markhöjder"},en:{btntitle:"Markhöjder"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-featureinfo"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this.featureInfoPanel={},this._container},onRemove:function(){},activate:function(){this.active=!0,this.btn.addClass("btn-primary");var e=smap.cmd.getControl("L.Control.SelectWMS");e.deactivate();var t=smap.cmd.getControl("L.Control.SelectVector");t.deactivate(),this.featureInfoPanel.selectionPanelCreated?this._updateSelectionPanel():this._drawSelectionPanel(),this.map.on("click",this._onMapClick,this),$(".mapdiv")[0].style.cursor="crosshair"},deactivate:function(){this.active=!1,this.btn.removeClass("btn-primary");var e=smap.cmd.getControl("L.Control.SelectWMS");e.activate();var t=smap.cmd.getControl("L.Control.SelectVector");t.activate(),this.map.off("click",this._onMapClick,this),this._hideSelectionPanel(),"undefined"!=typeof this.heightLayer&&null!==this.heightLayer,$(".mapdiv")[0].style.cursor=""},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-selection-info",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-getFeatureinfo-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="fa fa-selection-info"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAUCAQAAAAua3X8AAAAAXNSR0IArs4c6QAAAAlwSFlzAAARKgAAESoB/3Si4QAAAAd0SU1FB+ACBQkGM3HV728AAAACYktHRAD/h4/MvwAAAdxJREFUGBkFwU9olnUcAPDP9/c877Ze5xzqQMfAdkjsD74oKhJ0UC8dMiX0Ktgh0tElPAR5CjzWqSjw5KVAIoMui4koSgaZf1CC8KAyVzidurV3ub3P8/z8fILrO+b6QggZbFy+eXF2kGWVLceDqZmbo40EWl7Y6ooF/f5xP38UJaPn1q6NeP76D50jl4ce1qu3fXh2ZqE17wVB3NIB3+dvLL977Vc4/GxhuKvRmJA6gFuq/MYkj4OWfo1AIwGsGFC6fXsk96bG83ZJVkoS/IH9n6+KiS9fu/M8F7PznshoUMJOl3K/ibtPt/w2tutCFNMWNUo9lDD9yWGHnNh84OpgZ2+ZJ9tq/6tRSDD2da+62pzK1e6VPFN51JcWH2SBLIGByrxpXSlu7LBu2AZkhSyBoYi96bvo/72Xt13ztG5amwgkJcSjr4rVX3Boqa3URE9SyGq1BN/6NN5MB/O+Ex+caT9OFj2RhUIhwTH8ebLr5+sDn9UjjREdoVFblgD+9swv7r8/HOnH+bgnBLIE8JbCUeOniZ+6MaeSlV6RJjHzDmMnX9V9G/59b3BNWympLAmm/vtrkMqcjZIVm6fO71pac0PI+eMoae8Z6mthVC3L1vd2Xpg1rrESAxMvAXiEtvkQFNikAAAAAElFTkSuQmCC"></img></span></button>');

t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this)),this.btn=t,this.$container.append(t)}},_drawSelectionPanel:function(){this.featureInfoPanel.maxWidth=300,this.featureInfoPanel.maxHeight=250,this.featureInfoPanel.minHeight=150,window.featureInfoPanel_state?0==window.featureInfoPanel_state?window.featureInfoPanel_state=1:1==window.featureInfoPanel_state&&(window.featureInfoPanel_state=0):window.featureInfoPanel_state=0,this.featureInfoPanel.selectionPanelCreated=!0;var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.featureInfoPanel.getfeatureInfoPanel_div=document.createElement("div"),this.featureInfoPanel.getfeatureInfoPanel_div.id="getfeatureInfoPanel_div",this.featureInfoPanel.getfeatureInfoPanel_div.style.background="white",this.featureInfoPanel.getfeatureInfoPanel_div.style.position="fixed",this.featureInfoPanel.getfeatureInfoPanel_div.style.top="0px",this.featureInfoPanel.getfeatureInfoPanel_div.style.zIndex="2005",this.featureInfoPanel.getfeatureInfoPanel_div.style.width=70*e/100+"px",this.featureInfoPanel.getfeatureInfoPanel_div.style.maxWidth=this.featureInfoPanel.maxWidth+"px",this.featureInfoPanel.getfeatureInfoPanel_div.style.minHeight=this.featureInfoPanel.minHeight+"px",this.featureInfoPanel.getfeatureInfoPanel_div.style.display="block",this.featureInfoPanel.getfeatureInfoPanel_div.style.background="rgba(255,255,255,0)",this.featureInfoPanel.getfeatureInfoPanel_div.style.className="modal-dialog";var n=e/2-this.featureInfoPanel.maxWidth/2;this.featureInfoPanel.getfeatureInfoPanel_div.style.right=n+"px",40>n&&(this.featureInfoPanel.getfeatureInfoPanel_div.style.right="40px",n=40);var a=document.createElement("button");a.id="docSelectionpanelButtonID",a.className="minimize",a.onclick=function(){document.getElementById("selectionPanelDocImg");$("#getfeatureInfoPanel_div")[0].style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="block",window.featureInfoPanel_state=1};var i=document.createElement("span");i.id="selectionPanelDocImg",i.className="glyphicon glyphicon-minus",a.appendChild(i),this.featureInfoPanel.getfeatureInfoPanel_div.appendChild(a);var o=document.createElement("button");o.id="StopGetInfoWidget",o.className="close";var s=document.createElement("span");s.id="selectionPanelDocImg2",s.className="glyphicon glyphicon-remove",o.appendChild(s),this.featureInfoPanel.getfeatureInfoPanel_div.appendChild(o),this.featureInfoPanel.getfeatureInfoPanel_body_div=document.createElement("div"),this.featureInfoPanel.getfeatureInfoPanel_body_div.id="getfeatureInfoPanel_body_div",this.featureInfoPanel.getfeatureInfoPanel_body_div.className="modal-body",this.featureInfoPanel.getfeatureInfoPanel_body_div.style.background="white",this.featureInfoPanel.getfeatureInfoPanel_body_div.style.height="100%",this.featureInfoPanel.getfeatureInfoPanel_body_div.style.overflow="auto";var l=$('<div><h4 class="modal-header" style="position:absolute; top:-10px; left:0; border-bottom: solid 1px #ccc; width:100%; margin-bottom: 5px;">Markhöjder</h4><div class="row" style="padding-top:35px"><div class=".col-sm-12"><div class="btn-group" role="group" aria-label="..."><button id="deleteAllHeightPoints" type="button" class="btn btn-default">Radera alla</button></div></div></div>  <div style="margin-top: 0.2em;" class="row"><div class=".col-sm-8">            <table><tr><td>Behåll gamla punkter</td> <td> <input checked type="checkbox" id="keepOldPoints_id" name="keepOldPoints" aria-label="..."></td></tr><tr><td colspan="2"><button class="btn btn-default btn-sm he-tog">Mer info</button></td></tr> <tr style="display:none;" class="he-ogt"> <td colspan="2"> <b>Höjddata RH2000:</b> Med detta verktyget klickar du kartan och får reda på höjdvärdet i RH2000. NNH-data med 2m upplösning. Klicka på punkten för att få mer information.</td> </tr></table>                 </div>')[0];this.featureInfoPanel.getfeatureInfoPanel_body_div.appendChild(l),this.featureInfoPanel.getfeatureInfoPanel_div.appendChild(this.featureInfoPanel.getfeatureInfoPanel_body_div),document.body.appendChild(this.featureInfoPanel.getfeatureInfoPanel_div),this.featureInfoPanel.getfeatureInfoPanel_div_alt=document.createElement("div"),this.featureInfoPanel.getfeatureInfoPanel_div_alt.id="getfeatureInfoPanel_div_alt_id",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.background="#fff",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.position="fixed",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.top="0px",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.zIndex="2005",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.width="195px",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.height="45px",this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.display="none",n+=42.5,this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.right=n+"px";var l=$('<div><h4 class="modal-header" style="position:absolute; top:-10px; left:0; width:100%; margin-bottom: 5px; border:0">Markhöjder</h4></div>')[0];this.featureInfoPanel.getfeatureInfoPanel_div_alt.appendChild(l);var r=document.createElement("button");r.id="docSelectionpanelAltButtonID",r.className="minimize",r.onclick=function(){window.featureInfoPanel_state=0;document.getElementById("selectionPanelDocImg");$("#getfeatureInfoPanel_div")[0].style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"};var p=document.createElement("span");p.id="selectionPanelDocImg",p.className="glyphicon glyphicon-plus",r.appendChild(p),this.featureInfoPanel.getfeatureInfoPanel_div_alt.appendChild(r);var d=document.createElement("button");d.id="StopGetInfoWidget_alt",d.className="close";var c=document.createElement("span");c.id="selectionPanelDocImg_alt2",c.className="glyphicon glyphicon-remove",d.appendChild(c),this.featureInfoPanel.getfeatureInfoPanel_div_alt.appendChild(d),document.body.appendChild(this.featureInfoPanel.getfeatureInfoPanel_div_alt),this.featureInfoPanel.selectionPanelVisible=!0,smap.map.on("resize onorientationchange",$.proxy(function(){this._adjustResize_orientationChange()},this)),$("[name='keepOldPoints']").bootstrapSwitch(),$("#deleteAllHeightPoints").on("click",function(){window.heightLayer.clearLayers()}),$("#StopGetInfoWidget").on("click",function(){document.getElementById("smap-getFeatureinfo-btn").click()}),$("#StopGetInfoWidget_alt").on("click",function(){document.getElementById("smap-getFeatureinfo-btn").click()}),$(".btn.btn-default.btn-sm.he-tog").on("touchstart click",$.proxy(function(){$(".btn.btn-default.btn-sm.he-tog")[0].style.display="none",$(".he-ogt")[0].style.display="block",this.featureInfoPanel.getfeatureInfoPanel_div.style.height=35*t/100+"px"},this))},_toggleSelectionPanel:function(){"fa fa-2x fa-chevron-left"===$("#lswitch-btn")[0].childNodes[0].className?($("#getfeatureInfoPanel_div_alt_id")[0].style.display="none",$("#getfeatureInfoPanel_div")[0].style.display="none"):"fa fa-bars fa-2x"===$("#lswitch-btn")[0].childNodes[0].className?window.featureInfoPanel_state?1===window.featureInfoPanel_state?($("#getfeatureInfoPanel_div")[0].style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="block"):0===window.featureInfoPanel_state&&(window.featureInfoPanel_state=0):($("#getfeatureInfoPanel_div")[0].style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"):"fa fa-2x fa-bars"===$("#lswitch-btn")[0].childNodes[0].className&&(window.featureInfoPanel_state?1===window.featureInfoPanel_state?($("#getfeatureInfoPanel_div")[0].style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="block"):0===window.featureInfoPanel_state&&(window.featureInfoPanel_state=0):($("#getfeatureInfoPanel_div")[0].style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"))},_showSelectionPanel:function(){this.featureInfoPanel.selectionPanelVisible||(window.featureInfoPanel_state=0,this.featureInfoPanel.getfeatureInfoPanel_div.style.display="block",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none",this.featureInfoPanel.selectionPanelVisible=!0)},_hideSelectionPanel:function(){window.featureInfoPanel_state=1,this.featureInfoPanel.selectionPanelVisible=!1,this.featureInfoPanel.getfeatureInfoPanel_div.style.display="none",$("#getfeatureInfoPanel_div_alt_id")[0].style.display="none"},_updateSelectionPanel:function(){this._showSelectionPanel();var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;$(".btn.btn-default.btn-sm.he-tog")[0].style.display="block",$(".he-ogt")[0].style.display="none",this.featureInfoPanel.getfeatureInfoPanel_div.style.height=13*e/100+"px"},_adjustResize_orientationChange:function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e/2-this.featureInfoPanel.maxWidth/2);this.featureInfoPanel.getfeatureInfoPanel_div.style.left=t+"px",30>t&&(this.featureInfoPanel.getfeatureInfoPanel_div.style.left="30px"),this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.left=t+"px",30>t&&(this.featureInfoPanel.getfeatureInfoPanel_div_alt.style.left="30px")},_onMapClick:function(e){this._updateSelectionPanel();var getHeightValue=this._getFeatureInfo(e);("undefined"==typeof this.heightLayer||null===this.heightLayer)&&(this.heightLayer=L.layerGroup(),window.heightLayer=this.heightLayer,this.heightLayer.id="heightLayer",this.map.addLayer(this.heightLayer));var keepOldPointsState=document.getElementById("keepOldPoints_id").checked;keepOldPointsState||window.heightLayer.clearLayers();var mapLabel_pr=function(){if(getHeightValue.mapLabel){if(isNaN(getHeightValue.mapLabel))return getHeightValue.mapLabel;var local_label=eval(getHeightValue.mapLabel);return local_label=local_label>=0?"+"+(Math.round(100*local_label)/100).toString():(Math.round(100*local_label)/100).toString()}return"fel"}(),labelUnit="Ingen data"===mapLabel_pr?"":"m",markerIcon=L.divIcon({className:"height-div-icon",html:'<p style="position:relative;bottom:3px;font-size:10.5pt;font-family:Arial;font-weight:normal;color:#000;text-shadow:0 0 5px #fff"><b>'+mapLabel_pr+"&nbsp;"+labelUnit+"</b></p>"}),markerOptions={icon:markerIcon,clickable:!0,externalGraphic:"http://"+window.location.host+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1)+"img/legend/empty.png",label:mapLabel_pr+" "+labelUnit,fontColor:"#000000",fontSize:10.5,fontFamily:"Arial",fontWeight:"bold",labelAlign:"lb",labelXOffset:-4,labelYOffset:-4},createRandomNumber=Math.random().toString().split(".")[1],heightMarker=L.marker([e.latlng.lat,e.latlng.lng],markerOptions);heightMarker.id="heightMarkerId_"+createRandomNumber;var heightPopupOptions={keepInView:!1},heightPopup=L.popup(heightPopupOptions),popupContent="<div><div><b>Koordinatsystem:</b> </br> WGS 84 decimal (lat, lon)</div><div><b>Latitud: </b>"+Math.round(1e4*e.latlng.lat)/1e4+"</div><div><b>Longitud: </b>"+Math.round(1e4*e.latlng.lng)/1e4+"</div><div><b>Höjd </b>: "+mapLabel_pr+" "+labelUnit+"</div></div>",parentHeightDiv=document.createElement("div");parentHeightDiv.appendChild($(popupContent)[0]);var deleteSingleMarker_div=document.createElement("div");deleteSingleMarker_button=document.createElement("button"),deleteSingleMarker_button.id="smap-height-popupbtn_"+createRandomNumber,deleteSingleMarker_button.className="btn btn-default btn-sm",deleteSingleMarker_button.value="Ta bort",deleteSingleMarker_button[getTextContent(deleteSingleMarker_button)]="Ta bort",deleteSingleMarker_button.onclick=function(){var e=null,t="heightMarkerId_"+this.id.split("_")[1],n=window.heightLayer._layers;if(n)for(lay in n)n[lay].id===t&&(e=n[lay]);window.heightLayer.removeLayer(e)},deleteSingleMarker_div.appendChild(deleteSingleMarker_button),parentHeightDiv.childNodes[0].appendChild(deleteSingleMarker_div),heightPopup.setContent(parentHeightDiv),heightMarker.bindPopup(heightPopup),heightMarker.addTo(this.heightLayer),0===window.featureInfoPanel_state?document.getElementById("docSelectionpanelButtonID").click():""},_createHeightSymbol:function(e){var t=document.createElement("canvas");t.id="heightData",t.width="55",t.height="25";var n=t.getContext("2d");return n.font="15px serif",n.fillText(e,0,15),t.toDataURL()},_getFeatureInfo:function(e){var t={},n="";if(this.options.selectOptions){for(v in this.options.selectOptions)"URL"!==v&&(n=n+v+"="+this.options.selectOptions[v]+"&");if(this.options.selectOptions.URL)if(this.options.selectOptions.URL.indexOf("?")>=0){var a=this.options.selectOptions.URL.split("?"),i=a[0],o=a[1];n=i+"?"+n+o}else n=this.options.selectOptions.URL+"?"+n;var s=this.map.latLngToContainerPoint(e.latlng),l=this.options.buffer,r=new OpenLayers.Pixel(s.x-l,s.y+l),p=new OpenLayers.Pixel(s.x+l,s.y-l),d=L.point(r.x,r.y),c=L.point(p.x,p.y),m=this.map.containerPointToLatLng(d),u=this.map.containerPointToLatLng(c),h=L.latLngBounds(m,u),_=h.toBBoxString();if(this.options.selectOptions.SRS&&"EPSG:4326"!==this.options.selectOptions.SRS){var g=h.getSouthWest(),f=h.getNorthEast();g=utils.projectLatLng(g,"EPSG:4326",this.options.selectOptions.SRS,!1,!1),f=utils.projectLatLng(f,"EPSG:4326",this.options.selectOptions.SRS,!1,!1),h=L.latLngBounds(g,f),_=h.toBBoxString()}n=n+"&BBOX="+_+"&X="+utils.round(s.x)+"&Y="+utils.round(s.y)+"&WIDTH="+utils.round(this.map.getSize().x)+"&HEIGHT="+utils.round(this.map.getSize().y)+"&exceptions=application%2Fvnd.ogc.se_xml";var b=new this._xhr_handler;if(b.open("GET",n,!1),b.send(null),4==b.readyState&&200==b.status)var y=b.responseText;if("text/html"==this.options.selectOptions.INFO_FORMAT){var k=document.createElement("html");jQuery(k).html(y),mapLabel=this.options.mapLbelColumn,catchAll_th=k.getElementsByTagName("th"),catchAll_td=k.getElementsByTagName("td"),mapLabel_index=function(){for(var e=0;e<catchAll_th.length;e++)if(catchAll_th[e][getTextContent(catchAll_th[e])]===mapLabel)return e}(),mapLabelValue=mapLabel_index?catchAll_td[mapLabel_index][getTextContent(catchAll_td[mapLabel_index])]:"Ingen data",t.mapLabel=mapLabelValue,t.fullResponse=k}}return t},_showSplashMessage:function(e){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,a=document.createElement("div"),i=300,o=300;a.id="generalSplashID",a.style.width=i+"px",a.style.height=o+"px",a.style.left=t/2-i/2+"px",a.style.top=n/2-o/2+"px",a.style.background="rgba(0,0,0,0.8)",a.style.zIndex="4000",a.style.position="fixed",a.style.border="5px solid white",a.style.borderRadius="15px";var s=document.createElement("div");s.id="closeSpan_div_id",s.style.position="relative";var l=document.createElement("span");l.style.color="white",l[getTextContent(l)]=" X ",l.style.position="relative",l.style.borderRadius="20px",l.style.background="rgba(0,0,0,1)",l.style.fontSize="25px",l.style.top="10px",l.style.left=i/2-10+"px",l.onclick=function(){var e=document.getElementById("generalSplashID");e&&document.body.removeChild(e)},s.appendChild(l),a.appendChild(s);var r=document.createElement("div");r.style.marginTop="20px",r.style.marginLeft="10px",r.style.color="white",r[getTextContent(r)]=e+" Meddelandet kommer att stängas i 10 sekunder.",a.appendChild(r),document.body.appendChild(a),window.setTimeout(function(){var e=document.getElementById("generalSplashID");e&&document.body.removeChild(e)},1e4)},_xhr_handler:function(e,t){try{return new XMLHttpRequest}catch(n){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(n){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}return alert("XMLHttpRequest not supported"),null}}),L.Control.DrawMarker=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",buffer:12,_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Placera markör"},en:{btntitle:"Place marker"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-drawmarker"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this.featureInfoPanel={},this._container},onRemove:function(){},activate:function(){$("#drawMarker").click(),$("#smap-drawMarker-btn").removeClass("btn-default"),$("#smap-drawMarker-btn").addClass("btn-primary")},deactivate:function(){},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-map-marker",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-drawMarker-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="fa fa-map-marker"><img class=""></img></span></button>');t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this)),this.btn=t,this.$container.append(t)}}}),L.control.getFeatureInfo=function(e){return new L.Control.GetFeatureInfo(e)},L.Control.ShowHideSearch=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",_lang:{sv:{titleInfo:"",bodyContent:""}}},_lang:{sv:{btntitle:"Visa/dölj sök"},en:{btntitle:"Show/hide search"}},_setLang:function(e){e=e||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[e]:null)},initialize:function(e){L.setOptions(this,e),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(e.langCode)},onAdd:function(e){return this.map=e,this._container=L.DomUtil.create("div","leaflet-control-showhidesearch"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._hideSearchPanelOnload(),this._container},onRemove:function(){},activate:function(){this.active=!0,this.btn.addClass("btn-primary");var e=document.getElementById("smap-search-div");e&&(e.style.display="table",$("#searchInputDetact").focus(),$(".popover.fade.bottom.in.thandler-popover")&&$(".popover.fade.bottom.in.thandler-popover").length>0&&($(".thandler-btn.popover-dismiss").click(),$(".tooltip.fade.bottom.in")[0].style.display="none"))},deactivate:function(){this.active=!1,this.btn.removeClass("btn-primary");var e=document.getElementById("smap-search-div");e&&(e.style.display="none")},_drawBtn:function(){var e=this;if(this.options.addToMenu)smap.cmd.addToolButton("","glyphicon glyphicon-search",function(){return e.activate(),!1},null);else{var t=$('<button id="smap-showhidesearch-btn" title="'+e.lang.btntitle+'"  class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button>');t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this)),this.btn=t,this.$container.append(t)}},_hideSearchPanelOnload:function(){var e=document.getElementById("smap-search-div");e?e.style.display="none":window.setTimeout(function(){var e=document.getElementById("smap-search-div");e&&(e.style.display="none")},2e3)}}),L.Control.showHideSearch=function(e){return new L.Control.ShowHideSearch(e)},window.loadedPopup_image_Height=0,window.loadedPopup_image_Width=0,window.getTextContent=function(e){var t="innerText"in e?"innerText":"textContent";return t},window.adj_lswitch_btn=function(){document.getElementById("lswitch-panel_unselectable")&&($("#lswitch-btn")[0].style.left=document.getElementById("lswitch-panel_unselectable").getBoundingClientRect().right+"px")},smap.event.on("smap.core.applyparams",function(){smap.cmd.advSearch(smap.map)}),smap.event.on("smap.core.applyparams",function(){smap.cmd.mergeLayers()}),smap.event.on("smap.core.applyparams",function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;e&&(375>e||window!=window.top)&&$(".lswitch-btnhide.btn.btn-default")&&$(".lswitch-btnhide.btn.btn-default").length>0&&$(".lswitch-btnhide.btn.btn-default")[0].click()}),smap.event.on("smap.core.applyparams",function(){var e={};e.hideAllModules=window.getQueryParameters("hideallmodules"),e.hideSearchModule=window.getQueryParameters("hidesearchmodule"),e.hideOpacityModule=window.getQueryParameters("hideopacitymodule"),e.hideMeasureModule=window.getQueryParameters("hidemeasuremodule"),e.hideShareModule=window.getQueryParameters("hidesharemodule"),e.hideHeightModule=window.getQueryParameters("hideheightmodule"),e.hidePrintModule=window.getQueryParameters("hideprintmodule"),e.hideAboutMapModule=window.getQueryParameters("hideaboutmapmodule"),e.hideLocateModule=window.getQueryParameters("hideLocateModule");var t=function(e){e.hideSearchModule.length>0&&"true"===e.hideSearchModule&&($("#smap-showhidesearch-btn")[0].style.display="none"),e.hideOpacityModule.length>0&&"true"===e.hideOpacityModule&&($("#smap-opacity-btn")[0].style.display="none"),e.hideMeasureModule.length>0&&"true"===e.hideMeasureModule&&($(".leaflet-control-measuredraw.leaflet-control")[0].style.display="none"),e.hideShareModule.length>0&&"true"===e.hideShareModule&&($("#smap-sharelink-btn")[0].style.display="none"),e.hideHeightModule.length>0&&"true"===e.hideHeightModule&&($("#smap-getFeatureinfo-btn")[0].style.display="none"),e.hidePrintModule.length>0&&"true"===e.hidePrintModule&&($("#smap-print-btn")[0].style.display="none"),e.hideAboutMapModule.length>0&&"true"===e.hideAboutMapModule&&($("#smap-info-btn")[0].style.display="none"),e.hideLocateModule.length>0&&"true"===e.hideLocateModule&&($("#smap-glocate-btn")[0].style.display="none")};if(e.hideAllModules.length>0)if("true"===e.hideAllModules){for(key in e)"hideLocateModule"===key&&(e[key].length>0?"true"===e[key]||(e[key]="false"):e[key]="false"),"false"!==e[key]&&(e[key]="true");t(e);var n="true";for(key in e)"hideLocateModule"===key||"false"===e[key]&&(n="false");"true"===n&&$(".thandler-btn.popover-dismiss")&&$(".thandler-btn.popover-dismiss").length>0&&($(".thandler-btn.popover-dismiss")[0].style.display="none")}else t(e);else t(e);var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;(257>a||361>i)&&$("#kristianstad_logo_id")&&$("#kristianstad_logo_id").length>0&&($("#kristianstad_logo_id")[0].style.display="none")}),smap.inv={},smap.inv.panel={},smap.inv.panel._showLabelTipMessage_counter=0,window.onerror=function(e,t,n){var a=function(){var e=new Date,t=e.getDate(),n=e.getMonth()+1;return 10>t&&(t="0"+t),10>n&&(n="0"+n),year=e.getFullYear(),date=year+"-"+n+"-"+t+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}(),i=a+" Error: "+e+" Script: "+t+" Line: "+n,o="/kkartor/park_besiktning_handlers/park_client_error.php?error="+i+"&session="+localStorage.getItem("inv_session_id")+".session"+smap.cmd._randomTextAndNumberParameter(),s=new smap.cmd._xhr_handler;if(s.open("GET",o,!1),s.send(null),4==s.readyState&&200==s.status){JSON.parse(s.responseText)}};